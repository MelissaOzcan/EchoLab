function JY(r,o){for(var d=0;d<o.length;d++){const u=o[d];if(typeof u!="string"&&!Array.isArray(u)){for(const m in u)if(m!=="default"&&!(m in r)){const E=Object.getOwnPropertyDescriptor(u,m);E&&Object.defineProperty(r,m,E.get?E:{enumerable:!0,get:()=>u[m]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))u(m);new MutationObserver(m=>{for(const E of m)if(E.type==="childList")for(const y of E.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&u(y)}).observe(document,{childList:!0,subtree:!0});function d(m){const E={};return m.integrity&&(E.integrity=m.integrity),m.referrerPolicy&&(E.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?E.credentials="include":m.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function u(m){if(m.ep)return;m.ep=!0;const E=d(m);fetch(m.href,E)}})();var Bm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function RM(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var CM={exports:{}},tE={},IM={exports:{}},Rt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lp=Symbol.for("react.element"),XY=Symbol.for("react.portal"),QY=Symbol.for("react.fragment"),$Y=Symbol.for("react.strict_mode"),ZY=Symbol.for("react.profiler"),eq=Symbol.for("react.provider"),tq=Symbol.for("react.context"),nq=Symbol.for("react.forward_ref"),iq=Symbol.for("react.suspense"),rq=Symbol.for("react.memo"),sq=Symbol.for("react.lazy"),NL=Symbol.iterator;function oq(r){return r===null||typeof r!="object"?null:(r=NL&&r[NL]||r["@@iterator"],typeof r=="function"?r:null)}var wM={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},AM=Object.assign,OM={};function Hl(r,o,d){this.props=r,this.context=o,this.refs=OM,this.updater=d||wM}Hl.prototype.isReactComponent={};Hl.prototype.setState=function(r,o){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,o,"setState")};Hl.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function bM(){}bM.prototype=Hl.prototype;function zR(r,o,d){this.props=r,this.context=o,this.refs=OM,this.updater=d||wM}var YR=zR.prototype=new bM;YR.constructor=zR;AM(YR,Hl.prototype);YR.isPureReactComponent=!0;var PL=Array.isArray,NM=Object.prototype.hasOwnProperty,qR={current:null},PM={key:!0,ref:!0,__self:!0,__source:!0};function DM(r,o,d){var u,m={},E=null,y=null;if(o!=null)for(u in o.ref!==void 0&&(y=o.ref),o.key!==void 0&&(E=""+o.key),o)NM.call(o,u)&&!PM.hasOwnProperty(u)&&(m[u]=o[u]);var b=arguments.length-2;if(b===1)m.children=d;else if(1<b){for(var P=Array(b),U=0;U<b;U++)P[U]=arguments[U+2];m.children=P}if(r&&r.defaultProps)for(u in b=r.defaultProps,b)m[u]===void 0&&(m[u]=b[u]);return{$$typeof:lp,type:r,key:E,ref:y,props:m,_owner:qR.current}}function aq(r,o){return{$$typeof:lp,type:r.type,key:o,ref:r.ref,props:r.props,_owner:r._owner}}function JR(r){return typeof r=="object"&&r!==null&&r.$$typeof===lp}function cq(r){var o={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(d){return o[d]})}var DL=/\/+/g;function iy(r,o){return typeof r=="object"&&r!==null&&r.key!=null?cq(""+r.key):o.toString(36)}function l_(r,o,d,u,m){var E=typeof r;(E==="undefined"||E==="boolean")&&(r=null);var y=!1;if(r===null)y=!0;else switch(E){case"string":case"number":y=!0;break;case"object":switch(r.$$typeof){case lp:case XY:y=!0}}if(y)return y=r,m=m(y),r=u===""?"."+iy(y,0):u,PL(m)?(d="",r!=null&&(d=r.replace(DL,"$&/")+"/"),l_(m,o,d,"",function(U){return U})):m!=null&&(JR(m)&&(m=aq(m,d+(!m.key||y&&y.key===m.key?"":(""+m.key).replace(DL,"$&/")+"/")+r)),o.push(m)),1;if(y=0,u=u===""?".":u+":",PL(r))for(var b=0;b<r.length;b++){E=r[b];var P=u+iy(E,b);y+=l_(E,o,d,P,m)}else if(P=oq(r),typeof P=="function")for(r=P.call(r),b=0;!(E=r.next()).done;)E=E.value,P=u+iy(E,b++),y+=l_(E,o,d,P,m);else if(E==="object")throw o=String(r),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return y}function jm(r,o,d){if(r==null)return r;var u=[],m=0;return l_(r,u,"","",function(E){return o.call(d,E,m++)}),u}function dq(r){if(r._status===-1){var o=r._result;o=o(),o.then(function(d){(r._status===0||r._status===-1)&&(r._status=1,r._result=d)},function(d){(r._status===0||r._status===-1)&&(r._status=2,r._result=d)}),r._status===-1&&(r._status=0,r._result=o)}if(r._status===1)return r._result.default;throw r._result}var qi={current:null},u_={transition:null},lq={ReactCurrentDispatcher:qi,ReactCurrentBatchConfig:u_,ReactCurrentOwner:qR};function kM(){throw Error("act(...) is not supported in production builds of React.")}Rt.Children={map:jm,forEach:function(r,o,d){jm(r,function(){o.apply(this,arguments)},d)},count:function(r){var o=0;return jm(r,function(){o++}),o},toArray:function(r){return jm(r,function(o){return o})||[]},only:function(r){if(!JR(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Rt.Component=Hl;Rt.Fragment=QY;Rt.Profiler=ZY;Rt.PureComponent=zR;Rt.StrictMode=$Y;Rt.Suspense=iq;Rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lq;Rt.act=kM;Rt.cloneElement=function(r,o,d){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var u=AM({},r.props),m=r.key,E=r.ref,y=r._owner;if(o!=null){if(o.ref!==void 0&&(E=o.ref,y=qR.current),o.key!==void 0&&(m=""+o.key),r.type&&r.type.defaultProps)var b=r.type.defaultProps;for(P in o)NM.call(o,P)&&!PM.hasOwnProperty(P)&&(u[P]=o[P]===void 0&&b!==void 0?b[P]:o[P])}var P=arguments.length-2;if(P===1)u.children=d;else if(1<P){b=Array(P);for(var U=0;U<P;U++)b[U]=arguments[U+2];u.children=b}return{$$typeof:lp,type:r.type,key:m,ref:E,props:u,_owner:y}};Rt.createContext=function(r){return r={$$typeof:tq,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:eq,_context:r},r.Consumer=r};Rt.createElement=DM;Rt.createFactory=function(r){var o=DM.bind(null,r);return o.type=r,o};Rt.createRef=function(){return{current:null}};Rt.forwardRef=function(r){return{$$typeof:nq,render:r}};Rt.isValidElement=JR;Rt.lazy=function(r){return{$$typeof:sq,_payload:{_status:-1,_result:r},_init:dq}};Rt.memo=function(r,o){return{$$typeof:rq,type:r,compare:o===void 0?null:o}};Rt.startTransition=function(r){var o=u_.transition;u_.transition={};try{r()}finally{u_.transition=o}};Rt.unstable_act=kM;Rt.useCallback=function(r,o){return qi.current.useCallback(r,o)};Rt.useContext=function(r){return qi.current.useContext(r)};Rt.useDebugValue=function(){};Rt.useDeferredValue=function(r){return qi.current.useDeferredValue(r)};Rt.useEffect=function(r,o){return qi.current.useEffect(r,o)};Rt.useId=function(){return qi.current.useId()};Rt.useImperativeHandle=function(r,o,d){return qi.current.useImperativeHandle(r,o,d)};Rt.useInsertionEffect=function(r,o){return qi.current.useInsertionEffect(r,o)};Rt.useLayoutEffect=function(r,o){return qi.current.useLayoutEffect(r,o)};Rt.useMemo=function(r,o){return qi.current.useMemo(r,o)};Rt.useReducer=function(r,o,d){return qi.current.useReducer(r,o,d)};Rt.useRef=function(r){return qi.current.useRef(r)};Rt.useState=function(r){return qi.current.useState(r)};Rt.useSyncExternalStore=function(r,o,d){return qi.current.useSyncExternalStore(r,o,d)};Rt.useTransition=function(){return qi.current.useTransition()};Rt.version="18.3.1";IM.exports=Rt;var le=IM.exports;const zi=RM(le),uq=JY({__proto__:null,default:zi},[le]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hq=le,pq=Symbol.for("react.element"),fq=Symbol.for("react.fragment"),mq=Object.prototype.hasOwnProperty,_q=hq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Eq={key:!0,ref:!0,__self:!0,__source:!0};function LM(r,o,d){var u,m={},E=null,y=null;d!==void 0&&(E=""+d),o.key!==void 0&&(E=""+o.key),o.ref!==void 0&&(y=o.ref);for(u in o)mq.call(o,u)&&!Eq.hasOwnProperty(u)&&(m[u]=o[u]);if(r&&r.defaultProps)for(u in o=r.defaultProps,o)m[u]===void 0&&(m[u]=o[u]);return{$$typeof:pq,type:r,key:E,ref:y,props:m,_owner:_q.current}}tE.Fragment=fq;tE.jsx=LM;tE.jsxs=LM;CM.exports=tE;var ce=CM.exports,Fy={},MM={exports:{}},Mr={},UM={exports:{}},xM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function o(Pe,Me){var ot=Pe.length;Pe.push(Me);e:for(;0<ot;){var Je=ot-1>>>1,at=Pe[Je];if(0<m(at,Me))Pe[Je]=Me,Pe[ot]=at,ot=Je;else break e}}function d(Pe){return Pe.length===0?null:Pe[0]}function u(Pe){if(Pe.length===0)return null;var Me=Pe[0],ot=Pe.pop();if(ot!==Me){Pe[0]=ot;e:for(var Je=0,at=Pe.length,Kn=at>>>1;Je<Kn;){var kn=2*(Je+1)-1,Li=Pe[kn],Ti=kn+1,sd=Pe[Ti];if(0>m(Li,ot))Ti<at&&0>m(sd,Li)?(Pe[Je]=sd,Pe[Ti]=ot,Je=Ti):(Pe[Je]=Li,Pe[kn]=ot,Je=kn);else if(Ti<at&&0>m(sd,ot))Pe[Je]=sd,Pe[Ti]=ot,Je=Ti;else break e}}return Me}function m(Pe,Me){var ot=Pe.sortIndex-Me.sortIndex;return ot!==0?ot:Pe.id-Me.id}if(typeof performance=="object"&&typeof performance.now=="function"){var E=performance;r.unstable_now=function(){return E.now()}}else{var y=Date,b=y.now();r.unstable_now=function(){return y.now()-b}}var P=[],U=[],K=1,M=null,X=3,oe=!1,Z=!1,ne=!1,Se=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function q(Pe){for(var Me=d(U);Me!==null;){if(Me.callback===null)u(U);else if(Me.startTime<=Pe)u(U),Me.sortIndex=Me.expirationTime,o(P,Me);else break;Me=d(U)}}function ue(Pe){if(ne=!1,q(Pe),!Z)if(d(P)!==null)Z=!0,ht(Re);else{var Me=d(U);Me!==null&&Xi(ue,Me.startTime-Pe)}}function Re(Pe,Me){Z=!1,ne&&(ne=!1,J(je),je=-1),oe=!0;var ot=X;try{for(q(Me),M=d(P);M!==null&&(!(M.expirationTime>Me)||Pe&&!Dn());){var Je=M.callback;if(typeof Je=="function"){M.callback=null,X=M.priorityLevel;var at=Je(M.expirationTime<=Me);Me=r.unstable_now(),typeof at=="function"?M.callback=at:M===d(P)&&u(P),q(Me)}else u(P);M=d(P)}if(M!==null)var Kn=!0;else{var kn=d(U);kn!==null&&Xi(ue,kn.startTime-Me),Kn=!1}return Kn}finally{M=null,X=ot,oe=!1}}var be=!1,we=null,je=-1,gt=5,Le=-1;function Dn(){return!(r.unstable_now()-Le<gt)}function ki(){if(we!==null){var Pe=r.unstable_now();Le=Pe;var Me=!0;try{Me=we(!0,Pe)}finally{Me?xr():(be=!1,we=null)}}else be=!1}var xr;if(typeof H=="function")xr=function(){H(ki)};else if(typeof MessageChannel<"u"){var Bt=new MessageChannel,$e=Bt.port2;Bt.port1.onmessage=ki,xr=function(){$e.postMessage(null)}}else xr=function(){Se(ki,0)};function ht(Pe){we=Pe,be||(be=!0,xr())}function Xi(Pe,Me){je=Se(function(){Pe(r.unstable_now())},Me)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Pe){Pe.callback=null},r.unstable_continueExecution=function(){Z||oe||(Z=!0,ht(Re))},r.unstable_forceFrameRate=function(Pe){0>Pe||125<Pe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):gt=0<Pe?Math.floor(1e3/Pe):5},r.unstable_getCurrentPriorityLevel=function(){return X},r.unstable_getFirstCallbackNode=function(){return d(P)},r.unstable_next=function(Pe){switch(X){case 1:case 2:case 3:var Me=3;break;default:Me=X}var ot=X;X=Me;try{return Pe()}finally{X=ot}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Pe,Me){switch(Pe){case 1:case 2:case 3:case 4:case 5:break;default:Pe=3}var ot=X;X=Pe;try{return Me()}finally{X=ot}},r.unstable_scheduleCallback=function(Pe,Me,ot){var Je=r.unstable_now();switch(typeof ot=="object"&&ot!==null?(ot=ot.delay,ot=typeof ot=="number"&&0<ot?Je+ot:Je):ot=Je,Pe){case 1:var at=-1;break;case 2:at=250;break;case 5:at=1073741823;break;case 4:at=1e4;break;default:at=5e3}return at=ot+at,Pe={id:K++,callback:Me,priorityLevel:Pe,startTime:ot,expirationTime:at,sortIndex:-1},ot>Je?(Pe.sortIndex=ot,o(U,Pe),d(P)===null&&Pe===d(U)&&(ne?(J(je),je=-1):ne=!0,Xi(ue,ot-Je))):(Pe.sortIndex=at,o(P,Pe),Z||oe||(Z=!0,ht(Re))),Pe},r.unstable_shouldYield=Dn,r.unstable_wrapCallback=function(Pe){var Me=X;return function(){var ot=X;X=Me;try{return Pe.apply(this,arguments)}finally{X=ot}}}})(xM);UM.exports=xM;var gq=UM.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sq=le,Lr=gq;function Ce(r){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+r,d=1;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var VM=new Set,Wh={};function nd(r,o){Ul(r,o),Ul(r+"Capture",o)}function Ul(r,o){for(Wh[r]=o,r=0;r<o.length;r++)VM.add(o[r])}var Go=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),By=Object.prototype.hasOwnProperty,Tq=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,kL={},LL={};function vq(r){return By.call(LL,r)?!0:By.call(kL,r)?!1:Tq.test(r)?LL[r]=!0:(kL[r]=!0,!1)}function yq(r,o,d,u){if(d!==null&&d.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return u?!1:d!==null?!d.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Rq(r,o,d,u){if(o===null||typeof o>"u"||yq(r,o,d,u))return!0;if(u)return!1;if(d!==null)switch(d.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Ji(r,o,d,u,m,E,y){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=u,this.attributeNamespace=m,this.mustUseProperty=d,this.propertyName=r,this.type=o,this.sanitizeURL=E,this.removeEmptyString=y}var Si={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){Si[r]=new Ji(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var o=r[0];Si[o]=new Ji(o,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){Si[r]=new Ji(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){Si[r]=new Ji(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){Si[r]=new Ji(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){Si[r]=new Ji(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){Si[r]=new Ji(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){Si[r]=new Ji(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){Si[r]=new Ji(r,5,!1,r.toLowerCase(),null,!1,!1)});var XR=/[\-:]([a-z])/g;function QR(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var o=r.replace(XR,QR);Si[o]=new Ji(o,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var o=r.replace(XR,QR);Si[o]=new Ji(o,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var o=r.replace(XR,QR);Si[o]=new Ji(o,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){Si[r]=new Ji(r,1,!1,r.toLowerCase(),null,!1,!1)});Si.xlinkHref=new Ji("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){Si[r]=new Ji(r,1,!1,r.toLowerCase(),null,!0,!0)});function $R(r,o,d,u){var m=Si.hasOwnProperty(o)?Si[o]:null;(m!==null?m.type!==0:u||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(Rq(o,d,m,u)&&(d=null),u||m===null?vq(o)&&(d===null?r.removeAttribute(o):r.setAttribute(o,""+d)):m.mustUseProperty?r[m.propertyName]=d===null?m.type===3?!1:"":d:(o=m.attributeName,u=m.attributeNamespace,d===null?r.removeAttribute(o):(m=m.type,d=m===3||m===4&&d===!0?"":""+d,u?r.setAttributeNS(u,o,d):r.setAttribute(o,d))))}var zo=Sq.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Gm=Symbol.for("react.element"),El=Symbol.for("react.portal"),gl=Symbol.for("react.fragment"),ZR=Symbol.for("react.strict_mode"),jy=Symbol.for("react.profiler"),FM=Symbol.for("react.provider"),BM=Symbol.for("react.context"),eC=Symbol.for("react.forward_ref"),Gy=Symbol.for("react.suspense"),Wy=Symbol.for("react.suspense_list"),tC=Symbol.for("react.memo"),Fa=Symbol.for("react.lazy"),jM=Symbol.for("react.offscreen"),ML=Symbol.iterator;function _h(r){return r===null||typeof r!="object"?null:(r=ML&&r[ML]||r["@@iterator"],typeof r=="function"?r:null)}var Pn=Object.assign,ry;function wh(r){if(ry===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);ry=o&&o[1]||""}return`
`+ry+r}var sy=!1;function oy(r,o){if(!r||sy)return"";sy=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(U){var u=U}Reflect.construct(r,[],o)}else{try{o.call()}catch(U){u=U}r.call(o.prototype)}else{try{throw Error()}catch(U){u=U}r()}}catch(U){if(U&&u&&typeof U.stack=="string"){for(var m=U.stack.split(`
`),E=u.stack.split(`
`),y=m.length-1,b=E.length-1;1<=y&&0<=b&&m[y]!==E[b];)b--;for(;1<=y&&0<=b;y--,b--)if(m[y]!==E[b]){if(y!==1||b!==1)do if(y--,b--,0>b||m[y]!==E[b]){var P=`
`+m[y].replace(" at new "," at ");return r.displayName&&P.includes("<anonymous>")&&(P=P.replace("<anonymous>",r.displayName)),P}while(1<=y&&0<=b);break}}}finally{sy=!1,Error.prepareStackTrace=d}return(r=r?r.displayName||r.name:"")?wh(r):""}function Cq(r){switch(r.tag){case 5:return wh(r.type);case 16:return wh("Lazy");case 13:return wh("Suspense");case 19:return wh("SuspenseList");case 0:case 2:case 15:return r=oy(r.type,!1),r;case 11:return r=oy(r.type.render,!1),r;case 1:return r=oy(r.type,!0),r;default:return""}}function Hy(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case gl:return"Fragment";case El:return"Portal";case jy:return"Profiler";case ZR:return"StrictMode";case Gy:return"Suspense";case Wy:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case BM:return(r.displayName||"Context")+".Consumer";case FM:return(r._context.displayName||"Context")+".Provider";case eC:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case tC:return o=r.displayName||null,o!==null?o:Hy(r.type)||"Memo";case Fa:o=r._payload,r=r._init;try{return Hy(r(o))}catch{}}return null}function Iq(r){var o=r.type;switch(r.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=o.render,r=r.displayName||r.name||"",o.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Hy(o);case 8:return o===ZR?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function nc(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function GM(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function wq(r){var o=GM(r)?"checked":"value",d=Object.getOwnPropertyDescriptor(r.constructor.prototype,o),u=""+r[o];if(!r.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var m=d.get,E=d.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return m.call(this)},set:function(y){u=""+y,E.call(this,y)}}),Object.defineProperty(r,o,{enumerable:d.enumerable}),{getValue:function(){return u},setValue:function(y){u=""+y},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function Wm(r){r._valueTracker||(r._valueTracker=wq(r))}function WM(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var d=o.getValue(),u="";return r&&(u=GM(r)?r.checked?"true":"false":r.value),r=u,r!==d?(o.setValue(r),!0):!1}function w_(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Ky(r,o){var d=o.checked;return Pn({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??r._wrapperState.initialChecked})}function UL(r,o){var d=o.defaultValue==null?"":o.defaultValue,u=o.checked!=null?o.checked:o.defaultChecked;d=nc(o.value!=null?o.value:d),r._wrapperState={initialChecked:u,initialValue:d,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function HM(r,o){o=o.checked,o!=null&&$R(r,"checked",o,!1)}function zy(r,o){HM(r,o);var d=nc(o.value),u=o.type;if(d!=null)u==="number"?(d===0&&r.value===""||r.value!=d)&&(r.value=""+d):r.value!==""+d&&(r.value=""+d);else if(u==="submit"||u==="reset"){r.removeAttribute("value");return}o.hasOwnProperty("value")?Yy(r,o.type,d):o.hasOwnProperty("defaultValue")&&Yy(r,o.type,nc(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(r.defaultChecked=!!o.defaultChecked)}function xL(r,o,d){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var u=o.type;if(!(u!=="submit"&&u!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+r._wrapperState.initialValue,d||o===r.value||(r.value=o),r.defaultValue=o}d=r.name,d!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,d!==""&&(r.name=d)}function Yy(r,o,d){(o!=="number"||w_(r.ownerDocument)!==r)&&(d==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+d&&(r.defaultValue=""+d))}var Ah=Array.isArray;function Nl(r,o,d,u){if(r=r.options,o){o={};for(var m=0;m<d.length;m++)o["$"+d[m]]=!0;for(d=0;d<r.length;d++)m=o.hasOwnProperty("$"+r[d].value),r[d].selected!==m&&(r[d].selected=m),m&&u&&(r[d].defaultSelected=!0)}else{for(d=""+nc(d),o=null,m=0;m<r.length;m++){if(r[m].value===d){r[m].selected=!0,u&&(r[m].defaultSelected=!0);return}o!==null||r[m].disabled||(o=r[m])}o!==null&&(o.selected=!0)}}function qy(r,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Ce(91));return Pn({},o,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function VL(r,o){var d=o.value;if(d==null){if(d=o.children,o=o.defaultValue,d!=null){if(o!=null)throw Error(Ce(92));if(Ah(d)){if(1<d.length)throw Error(Ce(93));d=d[0]}o=d}o==null&&(o=""),d=o}r._wrapperState={initialValue:nc(d)}}function KM(r,o){var d=nc(o.value),u=nc(o.defaultValue);d!=null&&(d=""+d,d!==r.value&&(r.value=d),o.defaultValue==null&&r.defaultValue!==d&&(r.defaultValue=d)),u!=null&&(r.defaultValue=""+u)}function FL(r){var o=r.textContent;o===r._wrapperState.initialValue&&o!==""&&o!==null&&(r.value=o)}function zM(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Jy(r,o){return r==null||r==="http://www.w3.org/1999/xhtml"?zM(o):r==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Hm,YM=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,d,u,m){MSApp.execUnsafeLocalFunction(function(){return r(o,d,u,m)})}:r}(function(r,o){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=o;else{for(Hm=Hm||document.createElement("div"),Hm.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=Hm.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;o.firstChild;)r.appendChild(o.firstChild)}});function Hh(r,o){if(o){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=o;return}}r.textContent=o}var Dh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Aq=["Webkit","ms","Moz","O"];Object.keys(Dh).forEach(function(r){Aq.forEach(function(o){o=o+r.charAt(0).toUpperCase()+r.substring(1),Dh[o]=Dh[r]})});function qM(r,o,d){return o==null||typeof o=="boolean"||o===""?"":d||typeof o!="number"||o===0||Dh.hasOwnProperty(r)&&Dh[r]?(""+o).trim():o+"px"}function JM(r,o){r=r.style;for(var d in o)if(o.hasOwnProperty(d)){var u=d.indexOf("--")===0,m=qM(d,o[d],u);d==="float"&&(d="cssFloat"),u?r.setProperty(d,m):r[d]=m}}var Oq=Pn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xy(r,o){if(o){if(Oq[r]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Ce(137,r));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Ce(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(Ce(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Ce(62))}}function Qy(r,o){if(r.indexOf("-")===-1)return typeof o.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $y=null;function nC(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Zy=null,Pl=null,Dl=null;function BL(r){if(r=pp(r)){if(typeof Zy!="function")throw Error(Ce(280));var o=r.stateNode;o&&(o=oE(o),Zy(r.stateNode,r.type,o))}}function XM(r){Pl?Dl?Dl.push(r):Dl=[r]:Pl=r}function QM(){if(Pl){var r=Pl,o=Dl;if(Dl=Pl=null,BL(r),o)for(r=0;r<o.length;r++)BL(o[r])}}function $M(r,o){return r(o)}function ZM(){}var ay=!1;function eU(r,o,d){if(ay)return r(o,d);ay=!0;try{return $M(r,o,d)}finally{ay=!1,(Pl!==null||Dl!==null)&&(ZM(),QM())}}function Kh(r,o){var d=r.stateNode;if(d===null)return null;var u=oE(d);if(u===null)return null;d=u[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(r=r.type,u=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!u;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(Ce(231,o,typeof d));return d}var eR=!1;if(Go)try{var Eh={};Object.defineProperty(Eh,"passive",{get:function(){eR=!0}}),window.addEventListener("test",Eh,Eh),window.removeEventListener("test",Eh,Eh)}catch{eR=!1}function bq(r,o,d,u,m,E,y,b,P){var U=Array.prototype.slice.call(arguments,3);try{o.apply(d,U)}catch(K){this.onError(K)}}var kh=!1,A_=null,O_=!1,tR=null,Nq={onError:function(r){kh=!0,A_=r}};function Pq(r,o,d,u,m,E,y,b,P){kh=!1,A_=null,bq.apply(Nq,arguments)}function Dq(r,o,d,u,m,E,y,b,P){if(Pq.apply(this,arguments),kh){if(kh){var U=A_;kh=!1,A_=null}else throw Error(Ce(198));O_||(O_=!0,tR=U)}}function id(r){var o=r,d=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,o.flags&4098&&(d=o.return),r=o.return;while(r)}return o.tag===3?d:null}function tU(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function jL(r){if(id(r)!==r)throw Error(Ce(188))}function kq(r){var o=r.alternate;if(!o){if(o=id(r),o===null)throw Error(Ce(188));return o!==r?null:r}for(var d=r,u=o;;){var m=d.return;if(m===null)break;var E=m.alternate;if(E===null){if(u=m.return,u!==null){d=u;continue}break}if(m.child===E.child){for(E=m.child;E;){if(E===d)return jL(m),r;if(E===u)return jL(m),o;E=E.sibling}throw Error(Ce(188))}if(d.return!==u.return)d=m,u=E;else{for(var y=!1,b=m.child;b;){if(b===d){y=!0,d=m,u=E;break}if(b===u){y=!0,u=m,d=E;break}b=b.sibling}if(!y){for(b=E.child;b;){if(b===d){y=!0,d=E,u=m;break}if(b===u){y=!0,u=E,d=m;break}b=b.sibling}if(!y)throw Error(Ce(189))}}if(d.alternate!==u)throw Error(Ce(190))}if(d.tag!==3)throw Error(Ce(188));return d.stateNode.current===d?r:o}function nU(r){return r=kq(r),r!==null?iU(r):null}function iU(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var o=iU(r);if(o!==null)return o;r=r.sibling}return null}var rU=Lr.unstable_scheduleCallback,GL=Lr.unstable_cancelCallback,Lq=Lr.unstable_shouldYield,Mq=Lr.unstable_requestPaint,Wn=Lr.unstable_now,Uq=Lr.unstable_getCurrentPriorityLevel,iC=Lr.unstable_ImmediatePriority,sU=Lr.unstable_UserBlockingPriority,b_=Lr.unstable_NormalPriority,xq=Lr.unstable_LowPriority,oU=Lr.unstable_IdlePriority,nE=null,co=null;function Vq(r){if(co&&typeof co.onCommitFiberRoot=="function")try{co.onCommitFiberRoot(nE,r,void 0,(r.current.flags&128)===128)}catch{}}var Ds=Math.clz32?Math.clz32:jq,Fq=Math.log,Bq=Math.LN2;function jq(r){return r>>>=0,r===0?32:31-(Fq(r)/Bq|0)|0}var Km=64,zm=4194304;function Oh(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function N_(r,o){var d=r.pendingLanes;if(d===0)return 0;var u=0,m=r.suspendedLanes,E=r.pingedLanes,y=d&268435455;if(y!==0){var b=y&~m;b!==0?u=Oh(b):(E&=y,E!==0&&(u=Oh(E)))}else y=d&~m,y!==0?u=Oh(y):E!==0&&(u=Oh(E));if(u===0)return 0;if(o!==0&&o!==u&&!(o&m)&&(m=u&-u,E=o&-o,m>=E||m===16&&(E&4194240)!==0))return o;if(u&4&&(u|=d&16),o=r.entangledLanes,o!==0)for(r=r.entanglements,o&=u;0<o;)d=31-Ds(o),m=1<<d,u|=r[d],o&=~m;return u}function Gq(r,o){switch(r){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wq(r,o){for(var d=r.suspendedLanes,u=r.pingedLanes,m=r.expirationTimes,E=r.pendingLanes;0<E;){var y=31-Ds(E),b=1<<y,P=m[y];P===-1?(!(b&d)||b&u)&&(m[y]=Gq(b,o)):P<=o&&(r.expiredLanes|=b),E&=~b}}function nR(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function aU(){var r=Km;return Km<<=1,!(Km&4194240)&&(Km=64),r}function cy(r){for(var o=[],d=0;31>d;d++)o.push(r);return o}function up(r,o,d){r.pendingLanes|=o,o!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,o=31-Ds(o),r[o]=d}function Hq(r,o){var d=r.pendingLanes&~o;r.pendingLanes=o,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=o,r.mutableReadLanes&=o,r.entangledLanes&=o,o=r.entanglements;var u=r.eventTimes;for(r=r.expirationTimes;0<d;){var m=31-Ds(d),E=1<<m;o[m]=0,u[m]=-1,r[m]=-1,d&=~E}}function rC(r,o){var d=r.entangledLanes|=o;for(r=r.entanglements;d;){var u=31-Ds(d),m=1<<u;m&o|r[u]&o&&(r[u]|=o),d&=~m}}var qt=0;function cU(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var dU,sC,lU,uU,hU,iR=!1,Ym=[],za=null,Ya=null,qa=null,zh=new Map,Yh=new Map,ja=[],Kq="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function WL(r,o){switch(r){case"focusin":case"focusout":za=null;break;case"dragenter":case"dragleave":Ya=null;break;case"mouseover":case"mouseout":qa=null;break;case"pointerover":case"pointerout":zh.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yh.delete(o.pointerId)}}function gh(r,o,d,u,m,E){return r===null||r.nativeEvent!==E?(r={blockedOn:o,domEventName:d,eventSystemFlags:u,nativeEvent:E,targetContainers:[m]},o!==null&&(o=pp(o),o!==null&&sC(o)),r):(r.eventSystemFlags|=u,o=r.targetContainers,m!==null&&o.indexOf(m)===-1&&o.push(m),r)}function zq(r,o,d,u,m){switch(o){case"focusin":return za=gh(za,r,o,d,u,m),!0;case"dragenter":return Ya=gh(Ya,r,o,d,u,m),!0;case"mouseover":return qa=gh(qa,r,o,d,u,m),!0;case"pointerover":var E=m.pointerId;return zh.set(E,gh(zh.get(E)||null,r,o,d,u,m)),!0;case"gotpointercapture":return E=m.pointerId,Yh.set(E,gh(Yh.get(E)||null,r,o,d,u,m)),!0}return!1}function pU(r){var o=Kc(r.target);if(o!==null){var d=id(o);if(d!==null){if(o=d.tag,o===13){if(o=tU(d),o!==null){r.blockedOn=o,hU(r.priority,function(){lU(d)});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function h_(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var d=rR(r.domEventName,r.eventSystemFlags,o[0],r.nativeEvent);if(d===null){d=r.nativeEvent;var u=new d.constructor(d.type,d);$y=u,d.target.dispatchEvent(u),$y=null}else return o=pp(d),o!==null&&sC(o),r.blockedOn=d,!1;o.shift()}return!0}function HL(r,o,d){h_(r)&&d.delete(o)}function Yq(){iR=!1,za!==null&&h_(za)&&(za=null),Ya!==null&&h_(Ya)&&(Ya=null),qa!==null&&h_(qa)&&(qa=null),zh.forEach(HL),Yh.forEach(HL)}function Sh(r,o){r.blockedOn===o&&(r.blockedOn=null,iR||(iR=!0,Lr.unstable_scheduleCallback(Lr.unstable_NormalPriority,Yq)))}function qh(r){function o(m){return Sh(m,r)}if(0<Ym.length){Sh(Ym[0],r);for(var d=1;d<Ym.length;d++){var u=Ym[d];u.blockedOn===r&&(u.blockedOn=null)}}for(za!==null&&Sh(za,r),Ya!==null&&Sh(Ya,r),qa!==null&&Sh(qa,r),zh.forEach(o),Yh.forEach(o),d=0;d<ja.length;d++)u=ja[d],u.blockedOn===r&&(u.blockedOn=null);for(;0<ja.length&&(d=ja[0],d.blockedOn===null);)pU(d),d.blockedOn===null&&ja.shift()}var kl=zo.ReactCurrentBatchConfig,P_=!0;function qq(r,o,d,u){var m=qt,E=kl.transition;kl.transition=null;try{qt=1,oC(r,o,d,u)}finally{qt=m,kl.transition=E}}function Jq(r,o,d,u){var m=qt,E=kl.transition;kl.transition=null;try{qt=4,oC(r,o,d,u)}finally{qt=m,kl.transition=E}}function oC(r,o,d,u){if(P_){var m=rR(r,o,d,u);if(m===null)gy(r,o,u,D_,d),WL(r,u);else if(zq(m,r,o,d,u))u.stopPropagation();else if(WL(r,u),o&4&&-1<Kq.indexOf(r)){for(;m!==null;){var E=pp(m);if(E!==null&&dU(E),E=rR(r,o,d,u),E===null&&gy(r,o,u,D_,d),E===m)break;m=E}m!==null&&u.stopPropagation()}else gy(r,o,u,null,d)}}var D_=null;function rR(r,o,d,u){if(D_=null,r=nC(u),r=Kc(r),r!==null)if(o=id(r),o===null)r=null;else if(d=o.tag,d===13){if(r=tU(o),r!==null)return r;r=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null);return D_=r,null}function fU(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Uq()){case iC:return 1;case sU:return 4;case b_:case xq:return 16;case oU:return 536870912;default:return 16}default:return 16}}var Wa=null,aC=null,p_=null;function mU(){if(p_)return p_;var r,o=aC,d=o.length,u,m="value"in Wa?Wa.value:Wa.textContent,E=m.length;for(r=0;r<d&&o[r]===m[r];r++);var y=d-r;for(u=1;u<=y&&o[d-u]===m[E-u];u++);return p_=m.slice(r,1<u?1-u:void 0)}function f_(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function qm(){return!0}function KL(){return!1}function Ur(r){function o(d,u,m,E,y){this._reactName=d,this._targetInst=m,this.type=u,this.nativeEvent=E,this.target=y,this.currentTarget=null;for(var b in r)r.hasOwnProperty(b)&&(d=r[b],this[b]=d?d(E):E[b]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?qm:KL,this.isPropagationStopped=KL,this}return Pn(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=qm)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=qm)},persist:function(){},isPersistent:qm}),o}var Kl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cC=Ur(Kl),hp=Pn({},Kl,{view:0,detail:0}),Xq=Ur(hp),dy,ly,Th,iE=Pn({},hp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dC,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Th&&(Th&&r.type==="mousemove"?(dy=r.screenX-Th.screenX,ly=r.screenY-Th.screenY):ly=dy=0,Th=r),dy)},movementY:function(r){return"movementY"in r?r.movementY:ly}}),zL=Ur(iE),Qq=Pn({},iE,{dataTransfer:0}),$q=Ur(Qq),Zq=Pn({},hp,{relatedTarget:0}),uy=Ur(Zq),e7=Pn({},Kl,{animationName:0,elapsedTime:0,pseudoElement:0}),t7=Ur(e7),n7=Pn({},Kl,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),i7=Ur(n7),r7=Pn({},Kl,{data:0}),YL=Ur(r7),s7={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},o7={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},a7={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function c7(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=a7[r])?!!o[r]:!1}function dC(){return c7}var d7=Pn({},hp,{key:function(r){if(r.key){var o=s7[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=f_(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?o7[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dC,charCode:function(r){return r.type==="keypress"?f_(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?f_(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),l7=Ur(d7),u7=Pn({},iE,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qL=Ur(u7),h7=Pn({},hp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dC}),p7=Ur(h7),f7=Pn({},Kl,{propertyName:0,elapsedTime:0,pseudoElement:0}),m7=Ur(f7),_7=Pn({},iE,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),E7=Ur(_7),g7=[9,13,27,32],lC=Go&&"CompositionEvent"in window,Lh=null;Go&&"documentMode"in document&&(Lh=document.documentMode);var S7=Go&&"TextEvent"in window&&!Lh,_U=Go&&(!lC||Lh&&8<Lh&&11>=Lh),JL=" ",XL=!1;function EU(r,o){switch(r){case"keyup":return g7.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function gU(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Sl=!1;function T7(r,o){switch(r){case"compositionend":return gU(o);case"keypress":return o.which!==32?null:(XL=!0,JL);case"textInput":return r=o.data,r===JL&&XL?null:r;default:return null}}function v7(r,o){if(Sl)return r==="compositionend"||!lC&&EU(r,o)?(r=mU(),p_=aC=Wa=null,Sl=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return _U&&o.locale!=="ko"?null:o.data;default:return null}}var y7={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function QL(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!y7[r.type]:o==="textarea"}function SU(r,o,d,u){XM(u),o=k_(o,"onChange"),0<o.length&&(d=new cC("onChange","change",null,d,u),r.push({event:d,listeners:o}))}var Mh=null,Jh=null;function R7(r){NU(r,0)}function rE(r){var o=yl(r);if(WM(o))return r}function C7(r,o){if(r==="change")return o}var TU=!1;if(Go){var hy;if(Go){var py="oninput"in document;if(!py){var $L=document.createElement("div");$L.setAttribute("oninput","return;"),py=typeof $L.oninput=="function"}hy=py}else hy=!1;TU=hy&&(!document.documentMode||9<document.documentMode)}function ZL(){Mh&&(Mh.detachEvent("onpropertychange",vU),Jh=Mh=null)}function vU(r){if(r.propertyName==="value"&&rE(Jh)){var o=[];SU(o,Jh,r,nC(r)),eU(R7,o)}}function I7(r,o,d){r==="focusin"?(ZL(),Mh=o,Jh=d,Mh.attachEvent("onpropertychange",vU)):r==="focusout"&&ZL()}function w7(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return rE(Jh)}function A7(r,o){if(r==="click")return rE(o)}function O7(r,o){if(r==="input"||r==="change")return rE(o)}function b7(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var Ls=typeof Object.is=="function"?Object.is:b7;function Xh(r,o){if(Ls(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var d=Object.keys(r),u=Object.keys(o);if(d.length!==u.length)return!1;for(u=0;u<d.length;u++){var m=d[u];if(!By.call(o,m)||!Ls(r[m],o[m]))return!1}return!0}function e1(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function t1(r,o){var d=e1(r);r=0;for(var u;d;){if(d.nodeType===3){if(u=r+d.textContent.length,r<=o&&u>=o)return{node:d,offset:o-r};r=u}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=e1(d)}}function yU(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?yU(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function RU(){for(var r=window,o=w_();o instanceof r.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)r=o.contentWindow;else break;o=w_(r.document)}return o}function uC(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}function N7(r){var o=RU(),d=r.focusedElem,u=r.selectionRange;if(o!==d&&d&&d.ownerDocument&&yU(d.ownerDocument.documentElement,d)){if(u!==null&&uC(d)){if(o=u.start,r=u.end,r===void 0&&(r=o),"selectionStart"in d)d.selectionStart=o,d.selectionEnd=Math.min(r,d.value.length);else if(r=(o=d.ownerDocument||document)&&o.defaultView||window,r.getSelection){r=r.getSelection();var m=d.textContent.length,E=Math.min(u.start,m);u=u.end===void 0?E:Math.min(u.end,m),!r.extend&&E>u&&(m=u,u=E,E=m),m=t1(d,E);var y=t1(d,u);m&&y&&(r.rangeCount!==1||r.anchorNode!==m.node||r.anchorOffset!==m.offset||r.focusNode!==y.node||r.focusOffset!==y.offset)&&(o=o.createRange(),o.setStart(m.node,m.offset),r.removeAllRanges(),E>u?(r.addRange(o),r.extend(y.node,y.offset)):(o.setEnd(y.node,y.offset),r.addRange(o)))}}for(o=[],r=d;r=r.parentNode;)r.nodeType===1&&o.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<o.length;d++)r=o[d],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var P7=Go&&"documentMode"in document&&11>=document.documentMode,Tl=null,sR=null,Uh=null,oR=!1;function n1(r,o,d){var u=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;oR||Tl==null||Tl!==w_(u)||(u=Tl,"selectionStart"in u&&uC(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),Uh&&Xh(Uh,u)||(Uh=u,u=k_(sR,"onSelect"),0<u.length&&(o=new cC("onSelect","select",null,o,d),r.push({event:o,listeners:u}),o.target=Tl)))}function Jm(r,o){var d={};return d[r.toLowerCase()]=o.toLowerCase(),d["Webkit"+r]="webkit"+o,d["Moz"+r]="moz"+o,d}var vl={animationend:Jm("Animation","AnimationEnd"),animationiteration:Jm("Animation","AnimationIteration"),animationstart:Jm("Animation","AnimationStart"),transitionend:Jm("Transition","TransitionEnd")},fy={},CU={};Go&&(CU=document.createElement("div").style,"AnimationEvent"in window||(delete vl.animationend.animation,delete vl.animationiteration.animation,delete vl.animationstart.animation),"TransitionEvent"in window||delete vl.transitionend.transition);function sE(r){if(fy[r])return fy[r];if(!vl[r])return r;var o=vl[r],d;for(d in o)if(o.hasOwnProperty(d)&&d in CU)return fy[r]=o[d];return r}var IU=sE("animationend"),wU=sE("animationiteration"),AU=sE("animationstart"),OU=sE("transitionend"),bU=new Map,i1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function rc(r,o){bU.set(r,o),nd(o,[r])}for(var my=0;my<i1.length;my++){var _y=i1[my],D7=_y.toLowerCase(),k7=_y[0].toUpperCase()+_y.slice(1);rc(D7,"on"+k7)}rc(IU,"onAnimationEnd");rc(wU,"onAnimationIteration");rc(AU,"onAnimationStart");rc("dblclick","onDoubleClick");rc("focusin","onFocus");rc("focusout","onBlur");rc(OU,"onTransitionEnd");Ul("onMouseEnter",["mouseout","mouseover"]);Ul("onMouseLeave",["mouseout","mouseover"]);Ul("onPointerEnter",["pointerout","pointerover"]);Ul("onPointerLeave",["pointerout","pointerover"]);nd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));nd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));nd("onBeforeInput",["compositionend","keypress","textInput","paste"]);nd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));nd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));nd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),L7=new Set("cancel close invalid load scroll toggle".split(" ").concat(bh));function r1(r,o,d){var u=r.type||"unknown-event";r.currentTarget=d,Dq(u,o,void 0,r),r.currentTarget=null}function NU(r,o){o=(o&4)!==0;for(var d=0;d<r.length;d++){var u=r[d],m=u.event;u=u.listeners;e:{var E=void 0;if(o)for(var y=u.length-1;0<=y;y--){var b=u[y],P=b.instance,U=b.currentTarget;if(b=b.listener,P!==E&&m.isPropagationStopped())break e;r1(m,b,U),E=P}else for(y=0;y<u.length;y++){if(b=u[y],P=b.instance,U=b.currentTarget,b=b.listener,P!==E&&m.isPropagationStopped())break e;r1(m,b,U),E=P}}}if(O_)throw r=tR,O_=!1,tR=null,r}function _n(r,o){var d=o[uR];d===void 0&&(d=o[uR]=new Set);var u=r+"__bubble";d.has(u)||(PU(o,r,2,!1),d.add(u))}function Ey(r,o,d){var u=0;o&&(u|=4),PU(d,r,u,o)}var Xm="_reactListening"+Math.random().toString(36).slice(2);function Qh(r){if(!r[Xm]){r[Xm]=!0,VM.forEach(function(d){d!=="selectionchange"&&(L7.has(d)||Ey(d,!1,r),Ey(d,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[Xm]||(o[Xm]=!0,Ey("selectionchange",!1,o))}}function PU(r,o,d,u){switch(fU(o)){case 1:var m=qq;break;case 4:m=Jq;break;default:m=oC}d=m.bind(null,o,d,r),m=void 0,!eR||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(m=!0),u?m!==void 0?r.addEventListener(o,d,{capture:!0,passive:m}):r.addEventListener(o,d,!0):m!==void 0?r.addEventListener(o,d,{passive:m}):r.addEventListener(o,d,!1)}function gy(r,o,d,u,m){var E=u;if(!(o&1)&&!(o&2)&&u!==null)e:for(;;){if(u===null)return;var y=u.tag;if(y===3||y===4){var b=u.stateNode.containerInfo;if(b===m||b.nodeType===8&&b.parentNode===m)break;if(y===4)for(y=u.return;y!==null;){var P=y.tag;if((P===3||P===4)&&(P=y.stateNode.containerInfo,P===m||P.nodeType===8&&P.parentNode===m))return;y=y.return}for(;b!==null;){if(y=Kc(b),y===null)return;if(P=y.tag,P===5||P===6){u=E=y;continue e}b=b.parentNode}}u=u.return}eU(function(){var U=E,K=nC(d),M=[];e:{var X=bU.get(r);if(X!==void 0){var oe=cC,Z=r;switch(r){case"keypress":if(f_(d)===0)break e;case"keydown":case"keyup":oe=l7;break;case"focusin":Z="focus",oe=uy;break;case"focusout":Z="blur",oe=uy;break;case"beforeblur":case"afterblur":oe=uy;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":oe=zL;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":oe=$q;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":oe=p7;break;case IU:case wU:case AU:oe=t7;break;case OU:oe=m7;break;case"scroll":oe=Xq;break;case"wheel":oe=E7;break;case"copy":case"cut":case"paste":oe=i7;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":oe=qL}var ne=(o&4)!==0,Se=!ne&&r==="scroll",J=ne?X!==null?X+"Capture":null:X;ne=[];for(var H=U,q;H!==null;){q=H;var ue=q.stateNode;if(q.tag===5&&ue!==null&&(q=ue,J!==null&&(ue=Kh(H,J),ue!=null&&ne.push($h(H,ue,q)))),Se)break;H=H.return}0<ne.length&&(X=new oe(X,Z,null,d,K),M.push({event:X,listeners:ne}))}}if(!(o&7)){e:{if(X=r==="mouseover"||r==="pointerover",oe=r==="mouseout"||r==="pointerout",X&&d!==$y&&(Z=d.relatedTarget||d.fromElement)&&(Kc(Z)||Z[Wo]))break e;if((oe||X)&&(X=K.window===K?K:(X=K.ownerDocument)?X.defaultView||X.parentWindow:window,oe?(Z=d.relatedTarget||d.toElement,oe=U,Z=Z?Kc(Z):null,Z!==null&&(Se=id(Z),Z!==Se||Z.tag!==5&&Z.tag!==6)&&(Z=null)):(oe=null,Z=U),oe!==Z)){if(ne=zL,ue="onMouseLeave",J="onMouseEnter",H="mouse",(r==="pointerout"||r==="pointerover")&&(ne=qL,ue="onPointerLeave",J="onPointerEnter",H="pointer"),Se=oe==null?X:yl(oe),q=Z==null?X:yl(Z),X=new ne(ue,H+"leave",oe,d,K),X.target=Se,X.relatedTarget=q,ue=null,Kc(K)===U&&(ne=new ne(J,H+"enter",Z,d,K),ne.target=q,ne.relatedTarget=Se,ue=ne),Se=ue,oe&&Z)t:{for(ne=oe,J=Z,H=0,q=ne;q;q=fl(q))H++;for(q=0,ue=J;ue;ue=fl(ue))q++;for(;0<H-q;)ne=fl(ne),H--;for(;0<q-H;)J=fl(J),q--;for(;H--;){if(ne===J||J!==null&&ne===J.alternate)break t;ne=fl(ne),J=fl(J)}ne=null}else ne=null;oe!==null&&s1(M,X,oe,ne,!1),Z!==null&&Se!==null&&s1(M,Se,Z,ne,!0)}}e:{if(X=U?yl(U):window,oe=X.nodeName&&X.nodeName.toLowerCase(),oe==="select"||oe==="input"&&X.type==="file")var Re=C7;else if(QL(X))if(TU)Re=O7;else{Re=w7;var be=I7}else(oe=X.nodeName)&&oe.toLowerCase()==="input"&&(X.type==="checkbox"||X.type==="radio")&&(Re=A7);if(Re&&(Re=Re(r,U))){SU(M,Re,d,K);break e}be&&be(r,X,U),r==="focusout"&&(be=X._wrapperState)&&be.controlled&&X.type==="number"&&Yy(X,"number",X.value)}switch(be=U?yl(U):window,r){case"focusin":(QL(be)||be.contentEditable==="true")&&(Tl=be,sR=U,Uh=null);break;case"focusout":Uh=sR=Tl=null;break;case"mousedown":oR=!0;break;case"contextmenu":case"mouseup":case"dragend":oR=!1,n1(M,d,K);break;case"selectionchange":if(P7)break;case"keydown":case"keyup":n1(M,d,K)}var we;if(lC)e:{switch(r){case"compositionstart":var je="onCompositionStart";break e;case"compositionend":je="onCompositionEnd";break e;case"compositionupdate":je="onCompositionUpdate";break e}je=void 0}else Sl?EU(r,d)&&(je="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(je="onCompositionStart");je&&(_U&&d.locale!=="ko"&&(Sl||je!=="onCompositionStart"?je==="onCompositionEnd"&&Sl&&(we=mU()):(Wa=K,aC="value"in Wa?Wa.value:Wa.textContent,Sl=!0)),be=k_(U,je),0<be.length&&(je=new YL(je,r,null,d,K),M.push({event:je,listeners:be}),we?je.data=we:(we=gU(d),we!==null&&(je.data=we)))),(we=S7?T7(r,d):v7(r,d))&&(U=k_(U,"onBeforeInput"),0<U.length&&(K=new YL("onBeforeInput","beforeinput",null,d,K),M.push({event:K,listeners:U}),K.data=we))}NU(M,o)})}function $h(r,o,d){return{instance:r,listener:o,currentTarget:d}}function k_(r,o){for(var d=o+"Capture",u=[];r!==null;){var m=r,E=m.stateNode;m.tag===5&&E!==null&&(m=E,E=Kh(r,d),E!=null&&u.unshift($h(r,E,m)),E=Kh(r,o),E!=null&&u.push($h(r,E,m))),r=r.return}return u}function fl(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function s1(r,o,d,u,m){for(var E=o._reactName,y=[];d!==null&&d!==u;){var b=d,P=b.alternate,U=b.stateNode;if(P!==null&&P===u)break;b.tag===5&&U!==null&&(b=U,m?(P=Kh(d,E),P!=null&&y.unshift($h(d,P,b))):m||(P=Kh(d,E),P!=null&&y.push($h(d,P,b)))),d=d.return}y.length!==0&&r.push({event:o,listeners:y})}var M7=/\r\n?/g,U7=/\u0000|\uFFFD/g;function o1(r){return(typeof r=="string"?r:""+r).replace(M7,`
`).replace(U7,"")}function Qm(r,o,d){if(o=o1(o),o1(r)!==o&&d)throw Error(Ce(425))}function L_(){}var aR=null,cR=null;function dR(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var lR=typeof setTimeout=="function"?setTimeout:void 0,x7=typeof clearTimeout=="function"?clearTimeout:void 0,a1=typeof Promise=="function"?Promise:void 0,V7=typeof queueMicrotask=="function"?queueMicrotask:typeof a1<"u"?function(r){return a1.resolve(null).then(r).catch(F7)}:lR;function F7(r){setTimeout(function(){throw r})}function Sy(r,o){var d=o,u=0;do{var m=d.nextSibling;if(r.removeChild(d),m&&m.nodeType===8)if(d=m.data,d==="/$"){if(u===0){r.removeChild(m),qh(o);return}u--}else d!=="$"&&d!=="$?"&&d!=="$!"||u++;d=m}while(d);qh(o)}function Ja(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return r}function c1(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"){if(o===0)return r;o--}else d==="/$"&&o++}r=r.previousSibling}return null}var zl=Math.random().toString(36).slice(2),oo="__reactFiber$"+zl,Zh="__reactProps$"+zl,Wo="__reactContainer$"+zl,uR="__reactEvents$"+zl,B7="__reactListeners$"+zl,j7="__reactHandles$"+zl;function Kc(r){var o=r[oo];if(o)return o;for(var d=r.parentNode;d;){if(o=d[Wo]||d[oo]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(r=c1(r);r!==null;){if(d=r[oo])return d;r=c1(r)}return o}r=d,d=r.parentNode}return null}function pp(r){return r=r[oo]||r[Wo],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function yl(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Ce(33))}function oE(r){return r[Zh]||null}var hR=[],Rl=-1;function sc(r){return{current:r}}function En(r){0>Rl||(r.current=hR[Rl],hR[Rl]=null,Rl--)}function pn(r,o){Rl++,hR[Rl]=r.current,r.current=o}var ic={},Di=sc(ic),fr=sc(!1),Qc=ic;function xl(r,o){var d=r.type.contextTypes;if(!d)return ic;var u=r.stateNode;if(u&&u.__reactInternalMemoizedUnmaskedChildContext===o)return u.__reactInternalMemoizedMaskedChildContext;var m={},E;for(E in d)m[E]=o[E];return u&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=o,r.__reactInternalMemoizedMaskedChildContext=m),m}function mr(r){return r=r.childContextTypes,r!=null}function M_(){En(fr),En(Di)}function d1(r,o,d){if(Di.current!==ic)throw Error(Ce(168));pn(Di,o),pn(fr,d)}function DU(r,o,d){var u=r.stateNode;if(o=o.childContextTypes,typeof u.getChildContext!="function")return d;u=u.getChildContext();for(var m in u)if(!(m in o))throw Error(Ce(108,Iq(r)||"Unknown",m));return Pn({},d,u)}function U_(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||ic,Qc=Di.current,pn(Di,r),pn(fr,fr.current),!0}function l1(r,o,d){var u=r.stateNode;if(!u)throw Error(Ce(169));d?(r=DU(r,o,Qc),u.__reactInternalMemoizedMergedChildContext=r,En(fr),En(Di),pn(Di,r)):En(fr),pn(fr,d)}var Vo=null,aE=!1,Ty=!1;function kU(r){Vo===null?Vo=[r]:Vo.push(r)}function G7(r){aE=!0,kU(r)}function oc(){if(!Ty&&Vo!==null){Ty=!0;var r=0,o=qt;try{var d=Vo;for(qt=1;r<d.length;r++){var u=d[r];do u=u(!0);while(u!==null)}Vo=null,aE=!1}catch(m){throw Vo!==null&&(Vo=Vo.slice(r+1)),rU(iC,oc),m}finally{qt=o,Ty=!1}}return null}var Cl=[],Il=0,x_=null,V_=0,os=[],as=0,$c=null,Fo=1,Bo="";function Gc(r,o){Cl[Il++]=V_,Cl[Il++]=x_,x_=r,V_=o}function LU(r,o,d){os[as++]=Fo,os[as++]=Bo,os[as++]=$c,$c=r;var u=Fo;r=Bo;var m=32-Ds(u)-1;u&=~(1<<m),d+=1;var E=32-Ds(o)+m;if(30<E){var y=m-m%5;E=(u&(1<<y)-1).toString(32),u>>=y,m-=y,Fo=1<<32-Ds(o)+m|d<<m|u,Bo=E+r}else Fo=1<<E|d<<m|u,Bo=r}function hC(r){r.return!==null&&(Gc(r,1),LU(r,1,0))}function pC(r){for(;r===x_;)x_=Cl[--Il],Cl[Il]=null,V_=Cl[--Il],Cl[Il]=null;for(;r===$c;)$c=os[--as],os[as]=null,Bo=os[--as],os[as]=null,Fo=os[--as],os[as]=null}var kr=null,Dr=null,In=!1,Ps=null;function MU(r,o){var d=ds(5,null,null,0);d.elementType="DELETED",d.stateNode=o,d.return=r,o=r.deletions,o===null?(r.deletions=[d],r.flags|=16):o.push(d)}function u1(r,o){switch(r.tag){case 5:var d=r.type;return o=o.nodeType!==1||d.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(r.stateNode=o,kr=r,Dr=Ja(o.firstChild),!0):!1;case 6:return o=r.pendingProps===""||o.nodeType!==3?null:o,o!==null?(r.stateNode=o,kr=r,Dr=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(d=$c!==null?{id:Fo,overflow:Bo}:null,r.memoizedState={dehydrated:o,treeContext:d,retryLane:1073741824},d=ds(18,null,null,0),d.stateNode=o,d.return=r,r.child=d,kr=r,Dr=null,!0):!1;default:return!1}}function pR(r){return(r.mode&1)!==0&&(r.flags&128)===0}function fR(r){if(In){var o=Dr;if(o){var d=o;if(!u1(r,o)){if(pR(r))throw Error(Ce(418));o=Ja(d.nextSibling);var u=kr;o&&u1(r,o)?MU(u,d):(r.flags=r.flags&-4097|2,In=!1,kr=r)}}else{if(pR(r))throw Error(Ce(418));r.flags=r.flags&-4097|2,In=!1,kr=r}}}function h1(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;kr=r}function $m(r){if(r!==kr)return!1;if(!In)return h1(r),In=!0,!1;var o;if((o=r.tag!==3)&&!(o=r.tag!==5)&&(o=r.type,o=o!=="head"&&o!=="body"&&!dR(r.type,r.memoizedProps)),o&&(o=Dr)){if(pR(r))throw UU(),Error(Ce(418));for(;o;)MU(r,o),o=Ja(o.nextSibling)}if(h1(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Ce(317));e:{for(r=r.nextSibling,o=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"){if(o===0){Dr=Ja(r.nextSibling);break e}o--}else d!=="$"&&d!=="$!"&&d!=="$?"||o++}r=r.nextSibling}Dr=null}}else Dr=kr?Ja(r.stateNode.nextSibling):null;return!0}function UU(){for(var r=Dr;r;)r=Ja(r.nextSibling)}function Vl(){Dr=kr=null,In=!1}function fC(r){Ps===null?Ps=[r]:Ps.push(r)}var W7=zo.ReactCurrentBatchConfig;function vh(r,o,d){if(r=d.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(Ce(309));var u=d.stateNode}if(!u)throw Error(Ce(147,r));var m=u,E=""+r;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===E?o.ref:(o=function(y){var b=m.refs;y===null?delete b[E]:b[E]=y},o._stringRef=E,o)}if(typeof r!="string")throw Error(Ce(284));if(!d._owner)throw Error(Ce(290,r))}return r}function Zm(r,o){throw r=Object.prototype.toString.call(o),Error(Ce(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r))}function p1(r){var o=r._init;return o(r._payload)}function xU(r){function o(J,H){if(r){var q=J.deletions;q===null?(J.deletions=[H],J.flags|=16):q.push(H)}}function d(J,H){if(!r)return null;for(;H!==null;)o(J,H),H=H.sibling;return null}function u(J,H){for(J=new Map;H!==null;)H.key!==null?J.set(H.key,H):J.set(H.index,H),H=H.sibling;return J}function m(J,H){return J=Za(J,H),J.index=0,J.sibling=null,J}function E(J,H,q){return J.index=q,r?(q=J.alternate,q!==null?(q=q.index,q<H?(J.flags|=2,H):q):(J.flags|=2,H)):(J.flags|=1048576,H)}function y(J){return r&&J.alternate===null&&(J.flags|=2),J}function b(J,H,q,ue){return H===null||H.tag!==6?(H=Ay(q,J.mode,ue),H.return=J,H):(H=m(H,q),H.return=J,H)}function P(J,H,q,ue){var Re=q.type;return Re===gl?K(J,H,q.props.children,ue,q.key):H!==null&&(H.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===Fa&&p1(Re)===H.type)?(ue=m(H,q.props),ue.ref=vh(J,H,q),ue.return=J,ue):(ue=v_(q.type,q.key,q.props,null,J.mode,ue),ue.ref=vh(J,H,q),ue.return=J,ue)}function U(J,H,q,ue){return H===null||H.tag!==4||H.stateNode.containerInfo!==q.containerInfo||H.stateNode.implementation!==q.implementation?(H=Oy(q,J.mode,ue),H.return=J,H):(H=m(H,q.children||[]),H.return=J,H)}function K(J,H,q,ue,Re){return H===null||H.tag!==7?(H=Jc(q,J.mode,ue,Re),H.return=J,H):(H=m(H,q),H.return=J,H)}function M(J,H,q){if(typeof H=="string"&&H!==""||typeof H=="number")return H=Ay(""+H,J.mode,q),H.return=J,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case Gm:return q=v_(H.type,H.key,H.props,null,J.mode,q),q.ref=vh(J,null,H),q.return=J,q;case El:return H=Oy(H,J.mode,q),H.return=J,H;case Fa:var ue=H._init;return M(J,ue(H._payload),q)}if(Ah(H)||_h(H))return H=Jc(H,J.mode,q,null),H.return=J,H;Zm(J,H)}return null}function X(J,H,q,ue){var Re=H!==null?H.key:null;if(typeof q=="string"&&q!==""||typeof q=="number")return Re!==null?null:b(J,H,""+q,ue);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case Gm:return q.key===Re?P(J,H,q,ue):null;case El:return q.key===Re?U(J,H,q,ue):null;case Fa:return Re=q._init,X(J,H,Re(q._payload),ue)}if(Ah(q)||_h(q))return Re!==null?null:K(J,H,q,ue,null);Zm(J,q)}return null}function oe(J,H,q,ue,Re){if(typeof ue=="string"&&ue!==""||typeof ue=="number")return J=J.get(q)||null,b(H,J,""+ue,Re);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case Gm:return J=J.get(ue.key===null?q:ue.key)||null,P(H,J,ue,Re);case El:return J=J.get(ue.key===null?q:ue.key)||null,U(H,J,ue,Re);case Fa:var be=ue._init;return oe(J,H,q,be(ue._payload),Re)}if(Ah(ue)||_h(ue))return J=J.get(q)||null,K(H,J,ue,Re,null);Zm(H,ue)}return null}function Z(J,H,q,ue){for(var Re=null,be=null,we=H,je=H=0,gt=null;we!==null&&je<q.length;je++){we.index>je?(gt=we,we=null):gt=we.sibling;var Le=X(J,we,q[je],ue);if(Le===null){we===null&&(we=gt);break}r&&we&&Le.alternate===null&&o(J,we),H=E(Le,H,je),be===null?Re=Le:be.sibling=Le,be=Le,we=gt}if(je===q.length)return d(J,we),In&&Gc(J,je),Re;if(we===null){for(;je<q.length;je++)we=M(J,q[je],ue),we!==null&&(H=E(we,H,je),be===null?Re=we:be.sibling=we,be=we);return In&&Gc(J,je),Re}for(we=u(J,we);je<q.length;je++)gt=oe(we,J,je,q[je],ue),gt!==null&&(r&&gt.alternate!==null&&we.delete(gt.key===null?je:gt.key),H=E(gt,H,je),be===null?Re=gt:be.sibling=gt,be=gt);return r&&we.forEach(function(Dn){return o(J,Dn)}),In&&Gc(J,je),Re}function ne(J,H,q,ue){var Re=_h(q);if(typeof Re!="function")throw Error(Ce(150));if(q=Re.call(q),q==null)throw Error(Ce(151));for(var be=Re=null,we=H,je=H=0,gt=null,Le=q.next();we!==null&&!Le.done;je++,Le=q.next()){we.index>je?(gt=we,we=null):gt=we.sibling;var Dn=X(J,we,Le.value,ue);if(Dn===null){we===null&&(we=gt);break}r&&we&&Dn.alternate===null&&o(J,we),H=E(Dn,H,je),be===null?Re=Dn:be.sibling=Dn,be=Dn,we=gt}if(Le.done)return d(J,we),In&&Gc(J,je),Re;if(we===null){for(;!Le.done;je++,Le=q.next())Le=M(J,Le.value,ue),Le!==null&&(H=E(Le,H,je),be===null?Re=Le:be.sibling=Le,be=Le);return In&&Gc(J,je),Re}for(we=u(J,we);!Le.done;je++,Le=q.next())Le=oe(we,J,je,Le.value,ue),Le!==null&&(r&&Le.alternate!==null&&we.delete(Le.key===null?je:Le.key),H=E(Le,H,je),be===null?Re=Le:be.sibling=Le,be=Le);return r&&we.forEach(function(ki){return o(J,ki)}),In&&Gc(J,je),Re}function Se(J,H,q,ue){if(typeof q=="object"&&q!==null&&q.type===gl&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case Gm:e:{for(var Re=q.key,be=H;be!==null;){if(be.key===Re){if(Re=q.type,Re===gl){if(be.tag===7){d(J,be.sibling),H=m(be,q.props.children),H.return=J,J=H;break e}}else if(be.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===Fa&&p1(Re)===be.type){d(J,be.sibling),H=m(be,q.props),H.ref=vh(J,be,q),H.return=J,J=H;break e}d(J,be);break}else o(J,be);be=be.sibling}q.type===gl?(H=Jc(q.props.children,J.mode,ue,q.key),H.return=J,J=H):(ue=v_(q.type,q.key,q.props,null,J.mode,ue),ue.ref=vh(J,H,q),ue.return=J,J=ue)}return y(J);case El:e:{for(be=q.key;H!==null;){if(H.key===be)if(H.tag===4&&H.stateNode.containerInfo===q.containerInfo&&H.stateNode.implementation===q.implementation){d(J,H.sibling),H=m(H,q.children||[]),H.return=J,J=H;break e}else{d(J,H);break}else o(J,H);H=H.sibling}H=Oy(q,J.mode,ue),H.return=J,J=H}return y(J);case Fa:return be=q._init,Se(J,H,be(q._payload),ue)}if(Ah(q))return Z(J,H,q,ue);if(_h(q))return ne(J,H,q,ue);Zm(J,q)}return typeof q=="string"&&q!==""||typeof q=="number"?(q=""+q,H!==null&&H.tag===6?(d(J,H.sibling),H=m(H,q),H.return=J,J=H):(d(J,H),H=Ay(q,J.mode,ue),H.return=J,J=H),y(J)):d(J,H)}return Se}var Fl=xU(!0),VU=xU(!1),F_=sc(null),B_=null,wl=null,mC=null;function _C(){mC=wl=B_=null}function EC(r){var o=F_.current;En(F_),r._currentValue=o}function mR(r,o,d){for(;r!==null;){var u=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,u!==null&&(u.childLanes|=o)):u!==null&&(u.childLanes&o)!==o&&(u.childLanes|=o),r===d)break;r=r.return}}function Ll(r,o){B_=r,mC=wl=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&o&&(pr=!0),r.firstContext=null)}function ps(r){var o=r._currentValue;if(mC!==r)if(r={context:r,memoizedValue:o,next:null},wl===null){if(B_===null)throw Error(Ce(308));wl=r,B_.dependencies={lanes:0,firstContext:r}}else wl=wl.next=r;return o}var zc=null;function gC(r){zc===null?zc=[r]:zc.push(r)}function FU(r,o,d,u){var m=o.interleaved;return m===null?(d.next=d,gC(o)):(d.next=m.next,m.next=d),o.interleaved=d,Ho(r,u)}function Ho(r,o){r.lanes|=o;var d=r.alternate;for(d!==null&&(d.lanes|=o),d=r,r=r.return;r!==null;)r.childLanes|=o,d=r.alternate,d!==null&&(d.childLanes|=o),d=r,r=r.return;return d.tag===3?d.stateNode:null}var Ba=!1;function SC(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function BU(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function jo(r,o){return{eventTime:r,lane:o,tag:0,payload:null,callback:null,next:null}}function Xa(r,o,d){var u=r.updateQueue;if(u===null)return null;if(u=u.shared,Mt&2){var m=u.pending;return m===null?o.next=o:(o.next=m.next,m.next=o),u.pending=o,Ho(r,d)}return m=u.interleaved,m===null?(o.next=o,gC(u)):(o.next=m.next,m.next=o),u.interleaved=o,Ho(r,d)}function m_(r,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194240)!==0)){var u=o.lanes;u&=r.pendingLanes,d|=u,o.lanes=d,rC(r,d)}}function f1(r,o){var d=r.updateQueue,u=r.alternate;if(u!==null&&(u=u.updateQueue,d===u)){var m=null,E=null;if(d=d.firstBaseUpdate,d!==null){do{var y={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};E===null?m=E=y:E=E.next=y,d=d.next}while(d!==null);E===null?m=E=o:E=E.next=o}else m=E=o;d={baseState:u.baseState,firstBaseUpdate:m,lastBaseUpdate:E,shared:u.shared,effects:u.effects},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=o:r.next=o,d.lastBaseUpdate=o}function j_(r,o,d,u){var m=r.updateQueue;Ba=!1;var E=m.firstBaseUpdate,y=m.lastBaseUpdate,b=m.shared.pending;if(b!==null){m.shared.pending=null;var P=b,U=P.next;P.next=null,y===null?E=U:y.next=U,y=P;var K=r.alternate;K!==null&&(K=K.updateQueue,b=K.lastBaseUpdate,b!==y&&(b===null?K.firstBaseUpdate=U:b.next=U,K.lastBaseUpdate=P))}if(E!==null){var M=m.baseState;y=0,K=U=P=null,b=E;do{var X=b.lane,oe=b.eventTime;if((u&X)===X){K!==null&&(K=K.next={eventTime:oe,lane:0,tag:b.tag,payload:b.payload,callback:b.callback,next:null});e:{var Z=r,ne=b;switch(X=o,oe=d,ne.tag){case 1:if(Z=ne.payload,typeof Z=="function"){M=Z.call(oe,M,X);break e}M=Z;break e;case 3:Z.flags=Z.flags&-65537|128;case 0:if(Z=ne.payload,X=typeof Z=="function"?Z.call(oe,M,X):Z,X==null)break e;M=Pn({},M,X);break e;case 2:Ba=!0}}b.callback!==null&&b.lane!==0&&(r.flags|=64,X=m.effects,X===null?m.effects=[b]:X.push(b))}else oe={eventTime:oe,lane:X,tag:b.tag,payload:b.payload,callback:b.callback,next:null},K===null?(U=K=oe,P=M):K=K.next=oe,y|=X;if(b=b.next,b===null){if(b=m.shared.pending,b===null)break;X=b,b=X.next,X.next=null,m.lastBaseUpdate=X,m.shared.pending=null}}while(!0);if(K===null&&(P=M),m.baseState=P,m.firstBaseUpdate=U,m.lastBaseUpdate=K,o=m.shared.interleaved,o!==null){m=o;do y|=m.lane,m=m.next;while(m!==o)}else E===null&&(m.shared.lanes=0);ed|=y,r.lanes=y,r.memoizedState=M}}function m1(r,o,d){if(r=o.effects,o.effects=null,r!==null)for(o=0;o<r.length;o++){var u=r[o],m=u.callback;if(m!==null){if(u.callback=null,u=d,typeof m!="function")throw Error(Ce(191,m));m.call(u)}}}var fp={},lo=sc(fp),ep=sc(fp),tp=sc(fp);function Yc(r){if(r===fp)throw Error(Ce(174));return r}function TC(r,o){switch(pn(tp,o),pn(ep,r),pn(lo,fp),r=o.nodeType,r){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Jy(null,"");break;default:r=r===8?o.parentNode:o,o=r.namespaceURI||null,r=r.tagName,o=Jy(o,r)}En(lo),pn(lo,o)}function Bl(){En(lo),En(ep),En(tp)}function jU(r){Yc(tp.current);var o=Yc(lo.current),d=Jy(o,r.type);o!==d&&(pn(ep,r),pn(lo,d))}function vC(r){ep.current===r&&(En(lo),En(ep))}var bn=sc(0);function G_(r){for(var o=r;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var vy=[];function yC(){for(var r=0;r<vy.length;r++)vy[r]._workInProgressVersionPrimary=null;vy.length=0}var __=zo.ReactCurrentDispatcher,yy=zo.ReactCurrentBatchConfig,Zc=0,Nn=null,si=null,hi=null,W_=!1,xh=!1,np=0,H7=0;function bi(){throw Error(Ce(321))}function RC(r,o){if(o===null)return!1;for(var d=0;d<o.length&&d<r.length;d++)if(!Ls(r[d],o[d]))return!1;return!0}function CC(r,o,d,u,m,E){if(Zc=E,Nn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,__.current=r===null||r.memoizedState===null?q7:J7,r=d(u,m),xh){E=0;do{if(xh=!1,np=0,25<=E)throw Error(Ce(301));E+=1,hi=si=null,o.updateQueue=null,__.current=X7,r=d(u,m)}while(xh)}if(__.current=H_,o=si!==null&&si.next!==null,Zc=0,hi=si=Nn=null,W_=!1,o)throw Error(Ce(300));return r}function IC(){var r=np!==0;return np=0,r}function so(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return hi===null?Nn.memoizedState=hi=r:hi=hi.next=r,hi}function fs(){if(si===null){var r=Nn.alternate;r=r!==null?r.memoizedState:null}else r=si.next;var o=hi===null?Nn.memoizedState:hi.next;if(o!==null)hi=o,si=r;else{if(r===null)throw Error(Ce(310));si=r,r={memoizedState:si.memoizedState,baseState:si.baseState,baseQueue:si.baseQueue,queue:si.queue,next:null},hi===null?Nn.memoizedState=hi=r:hi=hi.next=r}return hi}function ip(r,o){return typeof o=="function"?o(r):o}function Ry(r){var o=fs(),d=o.queue;if(d===null)throw Error(Ce(311));d.lastRenderedReducer=r;var u=si,m=u.baseQueue,E=d.pending;if(E!==null){if(m!==null){var y=m.next;m.next=E.next,E.next=y}u.baseQueue=m=E,d.pending=null}if(m!==null){E=m.next,u=u.baseState;var b=y=null,P=null,U=E;do{var K=U.lane;if((Zc&K)===K)P!==null&&(P=P.next={lane:0,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null}),u=U.hasEagerState?U.eagerState:r(u,U.action);else{var M={lane:K,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null};P===null?(b=P=M,y=u):P=P.next=M,Nn.lanes|=K,ed|=K}U=U.next}while(U!==null&&U!==E);P===null?y=u:P.next=b,Ls(u,o.memoizedState)||(pr=!0),o.memoizedState=u,o.baseState=y,o.baseQueue=P,d.lastRenderedState=u}if(r=d.interleaved,r!==null){m=r;do E=m.lane,Nn.lanes|=E,ed|=E,m=m.next;while(m!==r)}else m===null&&(d.lanes=0);return[o.memoizedState,d.dispatch]}function Cy(r){var o=fs(),d=o.queue;if(d===null)throw Error(Ce(311));d.lastRenderedReducer=r;var u=d.dispatch,m=d.pending,E=o.memoizedState;if(m!==null){d.pending=null;var y=m=m.next;do E=r(E,y.action),y=y.next;while(y!==m);Ls(E,o.memoizedState)||(pr=!0),o.memoizedState=E,o.baseQueue===null&&(o.baseState=E),d.lastRenderedState=E}return[E,u]}function GU(){}function WU(r,o){var d=Nn,u=fs(),m=o(),E=!Ls(u.memoizedState,m);if(E&&(u.memoizedState=m,pr=!0),u=u.queue,wC(zU.bind(null,d,u,r),[r]),u.getSnapshot!==o||E||hi!==null&&hi.memoizedState.tag&1){if(d.flags|=2048,rp(9,KU.bind(null,d,u,m,o),void 0,null),pi===null)throw Error(Ce(349));Zc&30||HU(d,o,m)}return m}function HU(r,o,d){r.flags|=16384,r={getSnapshot:o,value:d},o=Nn.updateQueue,o===null?(o={lastEffect:null,stores:null},Nn.updateQueue=o,o.stores=[r]):(d=o.stores,d===null?o.stores=[r]:d.push(r))}function KU(r,o,d,u){o.value=d,o.getSnapshot=u,YU(o)&&qU(r)}function zU(r,o,d){return d(function(){YU(o)&&qU(r)})}function YU(r){var o=r.getSnapshot;r=r.value;try{var d=o();return!Ls(r,d)}catch{return!0}}function qU(r){var o=Ho(r,1);o!==null&&ks(o,r,1,-1)}function _1(r){var o=so();return typeof r=="function"&&(r=r()),o.memoizedState=o.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ip,lastRenderedState:r},o.queue=r,r=r.dispatch=Y7.bind(null,Nn,r),[o.memoizedState,r]}function rp(r,o,d,u){return r={tag:r,create:o,destroy:d,deps:u,next:null},o=Nn.updateQueue,o===null?(o={lastEffect:null,stores:null},Nn.updateQueue=o,o.lastEffect=r.next=r):(d=o.lastEffect,d===null?o.lastEffect=r.next=r:(u=d.next,d.next=r,r.next=u,o.lastEffect=r)),r}function JU(){return fs().memoizedState}function E_(r,o,d,u){var m=so();Nn.flags|=r,m.memoizedState=rp(1|o,d,void 0,u===void 0?null:u)}function cE(r,o,d,u){var m=fs();u=u===void 0?null:u;var E=void 0;if(si!==null){var y=si.memoizedState;if(E=y.destroy,u!==null&&RC(u,y.deps)){m.memoizedState=rp(o,d,E,u);return}}Nn.flags|=r,m.memoizedState=rp(1|o,d,E,u)}function E1(r,o){return E_(8390656,8,r,o)}function wC(r,o){return cE(2048,8,r,o)}function XU(r,o){return cE(4,2,r,o)}function QU(r,o){return cE(4,4,r,o)}function $U(r,o){if(typeof o=="function")return r=r(),o(r),function(){o(null)};if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function ZU(r,o,d){return d=d!=null?d.concat([r]):null,cE(4,4,$U.bind(null,o,r),d)}function AC(){}function e2(r,o){var d=fs();o=o===void 0?null:o;var u=d.memoizedState;return u!==null&&o!==null&&RC(o,u[1])?u[0]:(d.memoizedState=[r,o],r)}function t2(r,o){var d=fs();o=o===void 0?null:o;var u=d.memoizedState;return u!==null&&o!==null&&RC(o,u[1])?u[0]:(r=r(),d.memoizedState=[r,o],r)}function n2(r,o,d){return Zc&21?(Ls(d,o)||(d=aU(),Nn.lanes|=d,ed|=d,r.baseState=!0),o):(r.baseState&&(r.baseState=!1,pr=!0),r.memoizedState=d)}function K7(r,o){var d=qt;qt=d!==0&&4>d?d:4,r(!0);var u=yy.transition;yy.transition={};try{r(!1),o()}finally{qt=d,yy.transition=u}}function i2(){return fs().memoizedState}function z7(r,o,d){var u=$a(r);if(d={lane:u,action:d,hasEagerState:!1,eagerState:null,next:null},r2(r))s2(o,d);else if(d=FU(r,o,d,u),d!==null){var m=Yi();ks(d,r,u,m),o2(d,o,u)}}function Y7(r,o,d){var u=$a(r),m={lane:u,action:d,hasEagerState:!1,eagerState:null,next:null};if(r2(r))s2(o,m);else{var E=r.alternate;if(r.lanes===0&&(E===null||E.lanes===0)&&(E=o.lastRenderedReducer,E!==null))try{var y=o.lastRenderedState,b=E(y,d);if(m.hasEagerState=!0,m.eagerState=b,Ls(b,y)){var P=o.interleaved;P===null?(m.next=m,gC(o)):(m.next=P.next,P.next=m),o.interleaved=m;return}}catch{}finally{}d=FU(r,o,m,u),d!==null&&(m=Yi(),ks(d,r,u,m),o2(d,o,u))}}function r2(r){var o=r.alternate;return r===Nn||o!==null&&o===Nn}function s2(r,o){xh=W_=!0;var d=r.pending;d===null?o.next=o:(o.next=d.next,d.next=o),r.pending=o}function o2(r,o,d){if(d&4194240){var u=o.lanes;u&=r.pendingLanes,d|=u,o.lanes=d,rC(r,d)}}var H_={readContext:ps,useCallback:bi,useContext:bi,useEffect:bi,useImperativeHandle:bi,useInsertionEffect:bi,useLayoutEffect:bi,useMemo:bi,useReducer:bi,useRef:bi,useState:bi,useDebugValue:bi,useDeferredValue:bi,useTransition:bi,useMutableSource:bi,useSyncExternalStore:bi,useId:bi,unstable_isNewReconciler:!1},q7={readContext:ps,useCallback:function(r,o){return so().memoizedState=[r,o===void 0?null:o],r},useContext:ps,useEffect:E1,useImperativeHandle:function(r,o,d){return d=d!=null?d.concat([r]):null,E_(4194308,4,$U.bind(null,o,r),d)},useLayoutEffect:function(r,o){return E_(4194308,4,r,o)},useInsertionEffect:function(r,o){return E_(4,2,r,o)},useMemo:function(r,o){var d=so();return o=o===void 0?null:o,r=r(),d.memoizedState=[r,o],r},useReducer:function(r,o,d){var u=so();return o=d!==void 0?d(o):o,u.memoizedState=u.baseState=o,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:o},u.queue=r,r=r.dispatch=z7.bind(null,Nn,r),[u.memoizedState,r]},useRef:function(r){var o=so();return r={current:r},o.memoizedState=r},useState:_1,useDebugValue:AC,useDeferredValue:function(r){return so().memoizedState=r},useTransition:function(){var r=_1(!1),o=r[0];return r=K7.bind(null,r[1]),so().memoizedState=r,[o,r]},useMutableSource:function(){},useSyncExternalStore:function(r,o,d){var u=Nn,m=so();if(In){if(d===void 0)throw Error(Ce(407));d=d()}else{if(d=o(),pi===null)throw Error(Ce(349));Zc&30||HU(u,o,d)}m.memoizedState=d;var E={value:d,getSnapshot:o};return m.queue=E,E1(zU.bind(null,u,E,r),[r]),u.flags|=2048,rp(9,KU.bind(null,u,E,d,o),void 0,null),d},useId:function(){var r=so(),o=pi.identifierPrefix;if(In){var d=Bo,u=Fo;d=(u&~(1<<32-Ds(u)-1)).toString(32)+d,o=":"+o+"R"+d,d=np++,0<d&&(o+="H"+d.toString(32)),o+=":"}else d=H7++,o=":"+o+"r"+d.toString(32)+":";return r.memoizedState=o},unstable_isNewReconciler:!1},J7={readContext:ps,useCallback:e2,useContext:ps,useEffect:wC,useImperativeHandle:ZU,useInsertionEffect:XU,useLayoutEffect:QU,useMemo:t2,useReducer:Ry,useRef:JU,useState:function(){return Ry(ip)},useDebugValue:AC,useDeferredValue:function(r){var o=fs();return n2(o,si.memoizedState,r)},useTransition:function(){var r=Ry(ip)[0],o=fs().memoizedState;return[r,o]},useMutableSource:GU,useSyncExternalStore:WU,useId:i2,unstable_isNewReconciler:!1},X7={readContext:ps,useCallback:e2,useContext:ps,useEffect:wC,useImperativeHandle:ZU,useInsertionEffect:XU,useLayoutEffect:QU,useMemo:t2,useReducer:Cy,useRef:JU,useState:function(){return Cy(ip)},useDebugValue:AC,useDeferredValue:function(r){var o=fs();return si===null?o.memoizedState=r:n2(o,si.memoizedState,r)},useTransition:function(){var r=Cy(ip)[0],o=fs().memoizedState;return[r,o]},useMutableSource:GU,useSyncExternalStore:WU,useId:i2,unstable_isNewReconciler:!1};function Os(r,o){if(r&&r.defaultProps){o=Pn({},o),r=r.defaultProps;for(var d in r)o[d]===void 0&&(o[d]=r[d]);return o}return o}function _R(r,o,d,u){o=r.memoizedState,d=d(u,o),d=d==null?o:Pn({},o,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var dE={isMounted:function(r){return(r=r._reactInternals)?id(r)===r:!1},enqueueSetState:function(r,o,d){r=r._reactInternals;var u=Yi(),m=$a(r),E=jo(u,m);E.payload=o,d!=null&&(E.callback=d),o=Xa(r,E,m),o!==null&&(ks(o,r,m,u),m_(o,r,m))},enqueueReplaceState:function(r,o,d){r=r._reactInternals;var u=Yi(),m=$a(r),E=jo(u,m);E.tag=1,E.payload=o,d!=null&&(E.callback=d),o=Xa(r,E,m),o!==null&&(ks(o,r,m,u),m_(o,r,m))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var d=Yi(),u=$a(r),m=jo(d,u);m.tag=2,o!=null&&(m.callback=o),o=Xa(r,m,u),o!==null&&(ks(o,r,u,d),m_(o,r,u))}};function g1(r,o,d,u,m,E,y){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(u,E,y):o.prototype&&o.prototype.isPureReactComponent?!Xh(d,u)||!Xh(m,E):!0}function a2(r,o,d){var u=!1,m=ic,E=o.contextType;return typeof E=="object"&&E!==null?E=ps(E):(m=mr(o)?Qc:Di.current,u=o.contextTypes,E=(u=u!=null)?xl(r,m):ic),o=new o(d,E),r.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=dE,r.stateNode=o,o._reactInternals=r,u&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=m,r.__reactInternalMemoizedMaskedChildContext=E),o}function S1(r,o,d,u){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,u),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,u),o.state!==r&&dE.enqueueReplaceState(o,o.state,null)}function ER(r,o,d,u){var m=r.stateNode;m.props=d,m.state=r.memoizedState,m.refs={},SC(r);var E=o.contextType;typeof E=="object"&&E!==null?m.context=ps(E):(E=mr(o)?Qc:Di.current,m.context=xl(r,E)),m.state=r.memoizedState,E=o.getDerivedStateFromProps,typeof E=="function"&&(_R(r,o,E,d),m.state=r.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(o=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),o!==m.state&&dE.enqueueReplaceState(m,m.state,null),j_(r,d,m,u),m.state=r.memoizedState),typeof m.componentDidMount=="function"&&(r.flags|=4194308)}function jl(r,o){try{var d="",u=o;do d+=Cq(u),u=u.return;while(u);var m=d}catch(E){m=`
Error generating stack: `+E.message+`
`+E.stack}return{value:r,source:o,stack:m,digest:null}}function Iy(r,o,d){return{value:r,source:null,stack:d??null,digest:o??null}}function gR(r,o){try{console.error(o.value)}catch(d){setTimeout(function(){throw d})}}var Q7=typeof WeakMap=="function"?WeakMap:Map;function c2(r,o,d){d=jo(-1,d),d.tag=3,d.payload={element:null};var u=o.value;return d.callback=function(){z_||(z_=!0,OR=u),gR(r,o)},d}function d2(r,o,d){d=jo(-1,d),d.tag=3;var u=r.type.getDerivedStateFromError;if(typeof u=="function"){var m=o.value;d.payload=function(){return u(m)},d.callback=function(){gR(r,o)}}var E=r.stateNode;return E!==null&&typeof E.componentDidCatch=="function"&&(d.callback=function(){gR(r,o),typeof u!="function"&&(Qa===null?Qa=new Set([this]):Qa.add(this));var y=o.stack;this.componentDidCatch(o.value,{componentStack:y!==null?y:""})}),d}function T1(r,o,d){var u=r.pingCache;if(u===null){u=r.pingCache=new Q7;var m=new Set;u.set(o,m)}else m=u.get(o),m===void 0&&(m=new Set,u.set(o,m));m.has(d)||(m.add(d),r=uJ.bind(null,r,o,d),o.then(r,r))}function v1(r){do{var o;if((o=r.tag===13)&&(o=r.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return r;r=r.return}while(r!==null);return null}function y1(r,o,d,u,m){return r.mode&1?(r.flags|=65536,r.lanes=m,r):(r===o?r.flags|=65536:(r.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(o=jo(-1,1),o.tag=2,Xa(d,o,1))),d.lanes|=1),r)}var $7=zo.ReactCurrentOwner,pr=!1;function Ki(r,o,d,u){o.child=r===null?VU(o,null,d,u):Fl(o,r.child,d,u)}function R1(r,o,d,u,m){d=d.render;var E=o.ref;return Ll(o,m),u=CC(r,o,d,u,E,m),d=IC(),r!==null&&!pr?(o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~m,Ko(r,o,m)):(In&&d&&hC(o),o.flags|=1,Ki(r,o,u,m),o.child)}function C1(r,o,d,u,m){if(r===null){var E=d.type;return typeof E=="function"&&!MC(E)&&E.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(o.tag=15,o.type=E,l2(r,o,E,u,m)):(r=v_(d.type,null,u,o,o.mode,m),r.ref=o.ref,r.return=o,o.child=r)}if(E=r.child,!(r.lanes&m)){var y=E.memoizedProps;if(d=d.compare,d=d!==null?d:Xh,d(y,u)&&r.ref===o.ref)return Ko(r,o,m)}return o.flags|=1,r=Za(E,u),r.ref=o.ref,r.return=o,o.child=r}function l2(r,o,d,u,m){if(r!==null){var E=r.memoizedProps;if(Xh(E,u)&&r.ref===o.ref)if(pr=!1,o.pendingProps=u=E,(r.lanes&m)!==0)r.flags&131072&&(pr=!0);else return o.lanes=r.lanes,Ko(r,o,m)}return SR(r,o,d,u,m)}function u2(r,o,d){var u=o.pendingProps,m=u.children,E=r!==null?r.memoizedState:null;if(u.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},pn(Ol,Nr),Nr|=d;else{if(!(d&1073741824))return r=E!==null?E.baseLanes|d:d,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:r,cachePool:null,transitions:null},o.updateQueue=null,pn(Ol,Nr),Nr|=r,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},u=E!==null?E.baseLanes:d,pn(Ol,Nr),Nr|=u}else E!==null?(u=E.baseLanes|d,o.memoizedState=null):u=d,pn(Ol,Nr),Nr|=u;return Ki(r,o,m,d),o.child}function h2(r,o){var d=o.ref;(r===null&&d!==null||r!==null&&r.ref!==d)&&(o.flags|=512,o.flags|=2097152)}function SR(r,o,d,u,m){var E=mr(d)?Qc:Di.current;return E=xl(o,E),Ll(o,m),d=CC(r,o,d,u,E,m),u=IC(),r!==null&&!pr?(o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~m,Ko(r,o,m)):(In&&u&&hC(o),o.flags|=1,Ki(r,o,d,m),o.child)}function I1(r,o,d,u,m){if(mr(d)){var E=!0;U_(o)}else E=!1;if(Ll(o,m),o.stateNode===null)g_(r,o),a2(o,d,u),ER(o,d,u,m),u=!0;else if(r===null){var y=o.stateNode,b=o.memoizedProps;y.props=b;var P=y.context,U=d.contextType;typeof U=="object"&&U!==null?U=ps(U):(U=mr(d)?Qc:Di.current,U=xl(o,U));var K=d.getDerivedStateFromProps,M=typeof K=="function"||typeof y.getSnapshotBeforeUpdate=="function";M||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(b!==u||P!==U)&&S1(o,y,u,U),Ba=!1;var X=o.memoizedState;y.state=X,j_(o,u,y,m),P=o.memoizedState,b!==u||X!==P||fr.current||Ba?(typeof K=="function"&&(_R(o,d,K,u),P=o.memoizedState),(b=Ba||g1(o,d,b,u,X,P,U))?(M||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(o.flags|=4194308)):(typeof y.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=u,o.memoizedState=P),y.props=u,y.state=P,y.context=U,u=b):(typeof y.componentDidMount=="function"&&(o.flags|=4194308),u=!1)}else{y=o.stateNode,BU(r,o),b=o.memoizedProps,U=o.type===o.elementType?b:Os(o.type,b),y.props=U,M=o.pendingProps,X=y.context,P=d.contextType,typeof P=="object"&&P!==null?P=ps(P):(P=mr(d)?Qc:Di.current,P=xl(o,P));var oe=d.getDerivedStateFromProps;(K=typeof oe=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(b!==M||X!==P)&&S1(o,y,u,P),Ba=!1,X=o.memoizedState,y.state=X,j_(o,u,y,m);var Z=o.memoizedState;b!==M||X!==Z||fr.current||Ba?(typeof oe=="function"&&(_R(o,d,oe,u),Z=o.memoizedState),(U=Ba||g1(o,d,U,u,X,Z,P)||!1)?(K||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(u,Z,P),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(u,Z,P)),typeof y.componentDidUpdate=="function"&&(o.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof y.componentDidUpdate!="function"||b===r.memoizedProps&&X===r.memoizedState||(o.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||b===r.memoizedProps&&X===r.memoizedState||(o.flags|=1024),o.memoizedProps=u,o.memoizedState=Z),y.props=u,y.state=Z,y.context=P,u=U):(typeof y.componentDidUpdate!="function"||b===r.memoizedProps&&X===r.memoizedState||(o.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||b===r.memoizedProps&&X===r.memoizedState||(o.flags|=1024),u=!1)}return TR(r,o,d,u,E,m)}function TR(r,o,d,u,m,E){h2(r,o);var y=(o.flags&128)!==0;if(!u&&!y)return m&&l1(o,d,!1),Ko(r,o,E);u=o.stateNode,$7.current=o;var b=y&&typeof d.getDerivedStateFromError!="function"?null:u.render();return o.flags|=1,r!==null&&y?(o.child=Fl(o,r.child,null,E),o.child=Fl(o,null,b,E)):Ki(r,o,b,E),o.memoizedState=u.state,m&&l1(o,d,!0),o.child}function p2(r){var o=r.stateNode;o.pendingContext?d1(r,o.pendingContext,o.pendingContext!==o.context):o.context&&d1(r,o.context,!1),TC(r,o.containerInfo)}function w1(r,o,d,u,m){return Vl(),fC(m),o.flags|=256,Ki(r,o,d,u),o.child}var vR={dehydrated:null,treeContext:null,retryLane:0};function yR(r){return{baseLanes:r,cachePool:null,transitions:null}}function f2(r,o,d){var u=o.pendingProps,m=bn.current,E=!1,y=(o.flags&128)!==0,b;if((b=y)||(b=r!==null&&r.memoizedState===null?!1:(m&2)!==0),b?(E=!0,o.flags&=-129):(r===null||r.memoizedState!==null)&&(m|=1),pn(bn,m&1),r===null)return fR(o),r=o.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(o.mode&1?r.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(y=u.children,r=u.fallback,E?(u=o.mode,E=o.child,y={mode:"hidden",children:y},!(u&1)&&E!==null?(E.childLanes=0,E.pendingProps=y):E=hE(y,u,0,null),r=Jc(r,u,d,null),E.return=o,r.return=o,E.sibling=r,o.child=E,o.child.memoizedState=yR(d),o.memoizedState=vR,r):OC(o,y));if(m=r.memoizedState,m!==null&&(b=m.dehydrated,b!==null))return Z7(r,o,y,u,b,m,d);if(E){E=u.fallback,y=o.mode,m=r.child,b=m.sibling;var P={mode:"hidden",children:u.children};return!(y&1)&&o.child!==m?(u=o.child,u.childLanes=0,u.pendingProps=P,o.deletions=null):(u=Za(m,P),u.subtreeFlags=m.subtreeFlags&14680064),b!==null?E=Za(b,E):(E=Jc(E,y,d,null),E.flags|=2),E.return=o,u.return=o,u.sibling=E,o.child=u,u=E,E=o.child,y=r.child.memoizedState,y=y===null?yR(d):{baseLanes:y.baseLanes|d,cachePool:null,transitions:y.transitions},E.memoizedState=y,E.childLanes=r.childLanes&~d,o.memoizedState=vR,u}return E=r.child,r=E.sibling,u=Za(E,{mode:"visible",children:u.children}),!(o.mode&1)&&(u.lanes=d),u.return=o,u.sibling=null,r!==null&&(d=o.deletions,d===null?(o.deletions=[r],o.flags|=16):d.push(r)),o.child=u,o.memoizedState=null,u}function OC(r,o){return o=hE({mode:"visible",children:o},r.mode,0,null),o.return=r,r.child=o}function e_(r,o,d,u){return u!==null&&fC(u),Fl(o,r.child,null,d),r=OC(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function Z7(r,o,d,u,m,E,y){if(d)return o.flags&256?(o.flags&=-257,u=Iy(Error(Ce(422))),e_(r,o,y,u)):o.memoizedState!==null?(o.child=r.child,o.flags|=128,null):(E=u.fallback,m=o.mode,u=hE({mode:"visible",children:u.children},m,0,null),E=Jc(E,m,y,null),E.flags|=2,u.return=o,E.return=o,u.sibling=E,o.child=u,o.mode&1&&Fl(o,r.child,null,y),o.child.memoizedState=yR(y),o.memoizedState=vR,E);if(!(o.mode&1))return e_(r,o,y,null);if(m.data==="$!"){if(u=m.nextSibling&&m.nextSibling.dataset,u)var b=u.dgst;return u=b,E=Error(Ce(419)),u=Iy(E,u,void 0),e_(r,o,y,u)}if(b=(y&r.childLanes)!==0,pr||b){if(u=pi,u!==null){switch(y&-y){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=m&(u.suspendedLanes|y)?0:m,m!==0&&m!==E.retryLane&&(E.retryLane=m,Ho(r,m),ks(u,r,m,-1))}return LC(),u=Iy(Error(Ce(421))),e_(r,o,y,u)}return m.data==="$?"?(o.flags|=128,o.child=r.child,o=hJ.bind(null,r),m._reactRetry=o,null):(r=E.treeContext,Dr=Ja(m.nextSibling),kr=o,In=!0,Ps=null,r!==null&&(os[as++]=Fo,os[as++]=Bo,os[as++]=$c,Fo=r.id,Bo=r.overflow,$c=o),o=OC(o,u.children),o.flags|=4096,o)}function A1(r,o,d){r.lanes|=o;var u=r.alternate;u!==null&&(u.lanes|=o),mR(r.return,o,d)}function wy(r,o,d,u,m){var E=r.memoizedState;E===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:u,tail:d,tailMode:m}:(E.isBackwards=o,E.rendering=null,E.renderingStartTime=0,E.last=u,E.tail=d,E.tailMode=m)}function m2(r,o,d){var u=o.pendingProps,m=u.revealOrder,E=u.tail;if(Ki(r,o,u.children,d),u=bn.current,u&2)u=u&1|2,o.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&A1(r,d,o);else if(r.tag===19)A1(r,d,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}u&=1}if(pn(bn,u),!(o.mode&1))o.memoizedState=null;else switch(m){case"forwards":for(d=o.child,m=null;d!==null;)r=d.alternate,r!==null&&G_(r)===null&&(m=d),d=d.sibling;d=m,d===null?(m=o.child,o.child=null):(m=d.sibling,d.sibling=null),wy(o,!1,m,d,E);break;case"backwards":for(d=null,m=o.child,o.child=null;m!==null;){if(r=m.alternate,r!==null&&G_(r)===null){o.child=m;break}r=m.sibling,m.sibling=d,d=m,m=r}wy(o,!0,d,null,E);break;case"together":wy(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function g_(r,o){!(o.mode&1)&&r!==null&&(r.alternate=null,o.alternate=null,o.flags|=2)}function Ko(r,o,d){if(r!==null&&(o.dependencies=r.dependencies),ed|=o.lanes,!(d&o.childLanes))return null;if(r!==null&&o.child!==r.child)throw Error(Ce(153));if(o.child!==null){for(r=o.child,d=Za(r,r.pendingProps),o.child=d,d.return=o;r.sibling!==null;)r=r.sibling,d=d.sibling=Za(r,r.pendingProps),d.return=o;d.sibling=null}return o.child}function eJ(r,o,d){switch(o.tag){case 3:p2(o),Vl();break;case 5:jU(o);break;case 1:mr(o.type)&&U_(o);break;case 4:TC(o,o.stateNode.containerInfo);break;case 10:var u=o.type._context,m=o.memoizedProps.value;pn(F_,u._currentValue),u._currentValue=m;break;case 13:if(u=o.memoizedState,u!==null)return u.dehydrated!==null?(pn(bn,bn.current&1),o.flags|=128,null):d&o.child.childLanes?f2(r,o,d):(pn(bn,bn.current&1),r=Ko(r,o,d),r!==null?r.sibling:null);pn(bn,bn.current&1);break;case 19:if(u=(d&o.childLanes)!==0,r.flags&128){if(u)return m2(r,o,d);o.flags|=128}if(m=o.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),pn(bn,bn.current),u)break;return null;case 22:case 23:return o.lanes=0,u2(r,o,d)}return Ko(r,o,d)}var _2,RR,E2,g2;_2=function(r,o){for(var d=o.child;d!==null;){if(d.tag===5||d.tag===6)r.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===o)break;for(;d.sibling===null;){if(d.return===null||d.return===o)return;d=d.return}d.sibling.return=d.return,d=d.sibling}};RR=function(){};E2=function(r,o,d,u){var m=r.memoizedProps;if(m!==u){r=o.stateNode,Yc(lo.current);var E=null;switch(d){case"input":m=Ky(r,m),u=Ky(r,u),E=[];break;case"select":m=Pn({},m,{value:void 0}),u=Pn({},u,{value:void 0}),E=[];break;case"textarea":m=qy(r,m),u=qy(r,u),E=[];break;default:typeof m.onClick!="function"&&typeof u.onClick=="function"&&(r.onclick=L_)}Xy(d,u);var y;d=null;for(U in m)if(!u.hasOwnProperty(U)&&m.hasOwnProperty(U)&&m[U]!=null)if(U==="style"){var b=m[U];for(y in b)b.hasOwnProperty(y)&&(d||(d={}),d[y]="")}else U!=="dangerouslySetInnerHTML"&&U!=="children"&&U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&U!=="autoFocus"&&(Wh.hasOwnProperty(U)?E||(E=[]):(E=E||[]).push(U,null));for(U in u){var P=u[U];if(b=m!=null?m[U]:void 0,u.hasOwnProperty(U)&&P!==b&&(P!=null||b!=null))if(U==="style")if(b){for(y in b)!b.hasOwnProperty(y)||P&&P.hasOwnProperty(y)||(d||(d={}),d[y]="");for(y in P)P.hasOwnProperty(y)&&b[y]!==P[y]&&(d||(d={}),d[y]=P[y])}else d||(E||(E=[]),E.push(U,d)),d=P;else U==="dangerouslySetInnerHTML"?(P=P?P.__html:void 0,b=b?b.__html:void 0,P!=null&&b!==P&&(E=E||[]).push(U,P)):U==="children"?typeof P!="string"&&typeof P!="number"||(E=E||[]).push(U,""+P):U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&(Wh.hasOwnProperty(U)?(P!=null&&U==="onScroll"&&_n("scroll",r),E||b===P||(E=[])):(E=E||[]).push(U,P))}d&&(E=E||[]).push("style",d);var U=E;(o.updateQueue=U)&&(o.flags|=4)}};g2=function(r,o,d,u){d!==u&&(o.flags|=4)};function yh(r,o){if(!In)switch(r.tailMode){case"hidden":o=r.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var u=null;d!==null;)d.alternate!==null&&(u=d),d=d.sibling;u===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:u.sibling=null}}function Ni(r){var o=r.alternate!==null&&r.alternate.child===r.child,d=0,u=0;if(o)for(var m=r.child;m!==null;)d|=m.lanes|m.childLanes,u|=m.subtreeFlags&14680064,u|=m.flags&14680064,m.return=r,m=m.sibling;else for(m=r.child;m!==null;)d|=m.lanes|m.childLanes,u|=m.subtreeFlags,u|=m.flags,m.return=r,m=m.sibling;return r.subtreeFlags|=u,r.childLanes=d,o}function tJ(r,o,d){var u=o.pendingProps;switch(pC(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ni(o),null;case 1:return mr(o.type)&&M_(),Ni(o),null;case 3:return u=o.stateNode,Bl(),En(fr),En(Di),yC(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(r===null||r.child===null)&&($m(o)?o.flags|=4:r===null||r.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,Ps!==null&&(PR(Ps),Ps=null))),RR(r,o),Ni(o),null;case 5:vC(o);var m=Yc(tp.current);if(d=o.type,r!==null&&o.stateNode!=null)E2(r,o,d,u,m),r.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!u){if(o.stateNode===null)throw Error(Ce(166));return Ni(o),null}if(r=Yc(lo.current),$m(o)){u=o.stateNode,d=o.type;var E=o.memoizedProps;switch(u[oo]=o,u[Zh]=E,r=(o.mode&1)!==0,d){case"dialog":_n("cancel",u),_n("close",u);break;case"iframe":case"object":case"embed":_n("load",u);break;case"video":case"audio":for(m=0;m<bh.length;m++)_n(bh[m],u);break;case"source":_n("error",u);break;case"img":case"image":case"link":_n("error",u),_n("load",u);break;case"details":_n("toggle",u);break;case"input":UL(u,E),_n("invalid",u);break;case"select":u._wrapperState={wasMultiple:!!E.multiple},_n("invalid",u);break;case"textarea":VL(u,E),_n("invalid",u)}Xy(d,E),m=null;for(var y in E)if(E.hasOwnProperty(y)){var b=E[y];y==="children"?typeof b=="string"?u.textContent!==b&&(E.suppressHydrationWarning!==!0&&Qm(u.textContent,b,r),m=["children",b]):typeof b=="number"&&u.textContent!==""+b&&(E.suppressHydrationWarning!==!0&&Qm(u.textContent,b,r),m=["children",""+b]):Wh.hasOwnProperty(y)&&b!=null&&y==="onScroll"&&_n("scroll",u)}switch(d){case"input":Wm(u),xL(u,E,!0);break;case"textarea":Wm(u),FL(u);break;case"select":case"option":break;default:typeof E.onClick=="function"&&(u.onclick=L_)}u=m,o.updateQueue=u,u!==null&&(o.flags|=4)}else{y=m.nodeType===9?m:m.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=zM(d)),r==="http://www.w3.org/1999/xhtml"?d==="script"?(r=y.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof u.is=="string"?r=y.createElement(d,{is:u.is}):(r=y.createElement(d),d==="select"&&(y=r,u.multiple?y.multiple=!0:u.size&&(y.size=u.size))):r=y.createElementNS(r,d),r[oo]=o,r[Zh]=u,_2(r,o,!1,!1),o.stateNode=r;e:{switch(y=Qy(d,u),d){case"dialog":_n("cancel",r),_n("close",r),m=u;break;case"iframe":case"object":case"embed":_n("load",r),m=u;break;case"video":case"audio":for(m=0;m<bh.length;m++)_n(bh[m],r);m=u;break;case"source":_n("error",r),m=u;break;case"img":case"image":case"link":_n("error",r),_n("load",r),m=u;break;case"details":_n("toggle",r),m=u;break;case"input":UL(r,u),m=Ky(r,u),_n("invalid",r);break;case"option":m=u;break;case"select":r._wrapperState={wasMultiple:!!u.multiple},m=Pn({},u,{value:void 0}),_n("invalid",r);break;case"textarea":VL(r,u),m=qy(r,u),_n("invalid",r);break;default:m=u}Xy(d,m),b=m;for(E in b)if(b.hasOwnProperty(E)){var P=b[E];E==="style"?JM(r,P):E==="dangerouslySetInnerHTML"?(P=P?P.__html:void 0,P!=null&&YM(r,P)):E==="children"?typeof P=="string"?(d!=="textarea"||P!=="")&&Hh(r,P):typeof P=="number"&&Hh(r,""+P):E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&E!=="autoFocus"&&(Wh.hasOwnProperty(E)?P!=null&&E==="onScroll"&&_n("scroll",r):P!=null&&$R(r,E,P,y))}switch(d){case"input":Wm(r),xL(r,u,!1);break;case"textarea":Wm(r),FL(r);break;case"option":u.value!=null&&r.setAttribute("value",""+nc(u.value));break;case"select":r.multiple=!!u.multiple,E=u.value,E!=null?Nl(r,!!u.multiple,E,!1):u.defaultValue!=null&&Nl(r,!!u.multiple,u.defaultValue,!0);break;default:typeof m.onClick=="function"&&(r.onclick=L_)}switch(d){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}}u&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return Ni(o),null;case 6:if(r&&o.stateNode!=null)g2(r,o,r.memoizedProps,u);else{if(typeof u!="string"&&o.stateNode===null)throw Error(Ce(166));if(d=Yc(tp.current),Yc(lo.current),$m(o)){if(u=o.stateNode,d=o.memoizedProps,u[oo]=o,(E=u.nodeValue!==d)&&(r=kr,r!==null))switch(r.tag){case 3:Qm(u.nodeValue,d,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Qm(u.nodeValue,d,(r.mode&1)!==0)}E&&(o.flags|=4)}else u=(d.nodeType===9?d:d.ownerDocument).createTextNode(u),u[oo]=o,o.stateNode=u}return Ni(o),null;case 13:if(En(bn),u=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(In&&Dr!==null&&o.mode&1&&!(o.flags&128))UU(),Vl(),o.flags|=98560,E=!1;else if(E=$m(o),u!==null&&u.dehydrated!==null){if(r===null){if(!E)throw Error(Ce(318));if(E=o.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(Ce(317));E[oo]=o}else Vl(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;Ni(o),E=!1}else Ps!==null&&(PR(Ps),Ps=null),E=!0;if(!E)return o.flags&65536?o:null}return o.flags&128?(o.lanes=d,o):(u=u!==null,u!==(r!==null&&r.memoizedState!==null)&&u&&(o.child.flags|=8192,o.mode&1&&(r===null||bn.current&1?oi===0&&(oi=3):LC())),o.updateQueue!==null&&(o.flags|=4),Ni(o),null);case 4:return Bl(),RR(r,o),r===null&&Qh(o.stateNode.containerInfo),Ni(o),null;case 10:return EC(o.type._context),Ni(o),null;case 17:return mr(o.type)&&M_(),Ni(o),null;case 19:if(En(bn),E=o.memoizedState,E===null)return Ni(o),null;if(u=(o.flags&128)!==0,y=E.rendering,y===null)if(u)yh(E,!1);else{if(oi!==0||r!==null&&r.flags&128)for(r=o.child;r!==null;){if(y=G_(r),y!==null){for(o.flags|=128,yh(E,!1),u=y.updateQueue,u!==null&&(o.updateQueue=u,o.flags|=4),o.subtreeFlags=0,u=d,d=o.child;d!==null;)E=d,r=u,E.flags&=14680066,y=E.alternate,y===null?(E.childLanes=0,E.lanes=r,E.child=null,E.subtreeFlags=0,E.memoizedProps=null,E.memoizedState=null,E.updateQueue=null,E.dependencies=null,E.stateNode=null):(E.childLanes=y.childLanes,E.lanes=y.lanes,E.child=y.child,E.subtreeFlags=0,E.deletions=null,E.memoizedProps=y.memoizedProps,E.memoizedState=y.memoizedState,E.updateQueue=y.updateQueue,E.type=y.type,r=y.dependencies,E.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),d=d.sibling;return pn(bn,bn.current&1|2),o.child}r=r.sibling}E.tail!==null&&Wn()>Gl&&(o.flags|=128,u=!0,yh(E,!1),o.lanes=4194304)}else{if(!u)if(r=G_(y),r!==null){if(o.flags|=128,u=!0,d=r.updateQueue,d!==null&&(o.updateQueue=d,o.flags|=4),yh(E,!0),E.tail===null&&E.tailMode==="hidden"&&!y.alternate&&!In)return Ni(o),null}else 2*Wn()-E.renderingStartTime>Gl&&d!==1073741824&&(o.flags|=128,u=!0,yh(E,!1),o.lanes=4194304);E.isBackwards?(y.sibling=o.child,o.child=y):(d=E.last,d!==null?d.sibling=y:o.child=y,E.last=y)}return E.tail!==null?(o=E.tail,E.rendering=o,E.tail=o.sibling,E.renderingStartTime=Wn(),o.sibling=null,d=bn.current,pn(bn,u?d&1|2:d&1),o):(Ni(o),null);case 22:case 23:return kC(),u=o.memoizedState!==null,r!==null&&r.memoizedState!==null!==u&&(o.flags|=8192),u&&o.mode&1?Nr&1073741824&&(Ni(o),o.subtreeFlags&6&&(o.flags|=8192)):Ni(o),null;case 24:return null;case 25:return null}throw Error(Ce(156,o.tag))}function nJ(r,o){switch(pC(o),o.tag){case 1:return mr(o.type)&&M_(),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return Bl(),En(fr),En(Di),yC(),r=o.flags,r&65536&&!(r&128)?(o.flags=r&-65537|128,o):null;case 5:return vC(o),null;case 13:if(En(bn),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(Ce(340));Vl()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return En(bn),null;case 4:return Bl(),null;case 10:return EC(o.type._context),null;case 22:case 23:return kC(),null;case 24:return null;default:return null}}var t_=!1,Pi=!1,iJ=typeof WeakSet=="function"?WeakSet:Set,Ve=null;function Al(r,o){var d=r.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(u){Mn(r,o,u)}else d.current=null}function CR(r,o,d){try{d()}catch(u){Mn(r,o,u)}}var O1=!1;function rJ(r,o){if(aR=P_,r=RU(),uC(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var u=d.getSelection&&d.getSelection();if(u&&u.rangeCount!==0){d=u.anchorNode;var m=u.anchorOffset,E=u.focusNode;u=u.focusOffset;try{d.nodeType,E.nodeType}catch{d=null;break e}var y=0,b=-1,P=-1,U=0,K=0,M=r,X=null;t:for(;;){for(var oe;M!==d||m!==0&&M.nodeType!==3||(b=y+m),M!==E||u!==0&&M.nodeType!==3||(P=y+u),M.nodeType===3&&(y+=M.nodeValue.length),(oe=M.firstChild)!==null;)X=M,M=oe;for(;;){if(M===r)break t;if(X===d&&++U===m&&(b=y),X===E&&++K===u&&(P=y),(oe=M.nextSibling)!==null)break;M=X,X=M.parentNode}M=oe}d=b===-1||P===-1?null:{start:b,end:P}}else d=null}d=d||{start:0,end:0}}else d=null;for(cR={focusedElem:r,selectionRange:d},P_=!1,Ve=o;Ve!==null;)if(o=Ve,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,Ve=r;else for(;Ve!==null;){o=Ve;try{var Z=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(Z!==null){var ne=Z.memoizedProps,Se=Z.memoizedState,J=o.stateNode,H=J.getSnapshotBeforeUpdate(o.elementType===o.type?ne:Os(o.type,ne),Se);J.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var q=o.stateNode.containerInfo;q.nodeType===1?q.textContent="":q.nodeType===9&&q.documentElement&&q.removeChild(q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ce(163))}}catch(ue){Mn(o,o.return,ue)}if(r=o.sibling,r!==null){r.return=o.return,Ve=r;break}Ve=o.return}return Z=O1,O1=!1,Z}function Vh(r,o,d){var u=o.updateQueue;if(u=u!==null?u.lastEffect:null,u!==null){var m=u=u.next;do{if((m.tag&r)===r){var E=m.destroy;m.destroy=void 0,E!==void 0&&CR(o,d,E)}m=m.next}while(m!==u)}}function lE(r,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var d=o=o.next;do{if((d.tag&r)===r){var u=d.create;d.destroy=u()}d=d.next}while(d!==o)}}function IR(r){var o=r.ref;if(o!==null){var d=r.stateNode;switch(r.tag){case 5:r=d;break;default:r=d}typeof o=="function"?o(r):o.current=r}}function S2(r){var o=r.alternate;o!==null&&(r.alternate=null,S2(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&(delete o[oo],delete o[Zh],delete o[uR],delete o[B7],delete o[j7])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function T2(r){return r.tag===5||r.tag===3||r.tag===4}function b1(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||T2(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function wR(r,o,d){var u=r.tag;if(u===5||u===6)r=r.stateNode,o?d.nodeType===8?d.parentNode.insertBefore(r,o):d.insertBefore(r,o):(d.nodeType===8?(o=d.parentNode,o.insertBefore(r,d)):(o=d,o.appendChild(r)),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=L_));else if(u!==4&&(r=r.child,r!==null))for(wR(r,o,d),r=r.sibling;r!==null;)wR(r,o,d),r=r.sibling}function AR(r,o,d){var u=r.tag;if(u===5||u===6)r=r.stateNode,o?d.insertBefore(r,o):d.appendChild(r);else if(u!==4&&(r=r.child,r!==null))for(AR(r,o,d),r=r.sibling;r!==null;)AR(r,o,d),r=r.sibling}var Ei=null,bs=!1;function xa(r,o,d){for(d=d.child;d!==null;)v2(r,o,d),d=d.sibling}function v2(r,o,d){if(co&&typeof co.onCommitFiberUnmount=="function")try{co.onCommitFiberUnmount(nE,d)}catch{}switch(d.tag){case 5:Pi||Al(d,o);case 6:var u=Ei,m=bs;Ei=null,xa(r,o,d),Ei=u,bs=m,Ei!==null&&(bs?(r=Ei,d=d.stateNode,r.nodeType===8?r.parentNode.removeChild(d):r.removeChild(d)):Ei.removeChild(d.stateNode));break;case 18:Ei!==null&&(bs?(r=Ei,d=d.stateNode,r.nodeType===8?Sy(r.parentNode,d):r.nodeType===1&&Sy(r,d),qh(r)):Sy(Ei,d.stateNode));break;case 4:u=Ei,m=bs,Ei=d.stateNode.containerInfo,bs=!0,xa(r,o,d),Ei=u,bs=m;break;case 0:case 11:case 14:case 15:if(!Pi&&(u=d.updateQueue,u!==null&&(u=u.lastEffect,u!==null))){m=u=u.next;do{var E=m,y=E.destroy;E=E.tag,y!==void 0&&(E&2||E&4)&&CR(d,o,y),m=m.next}while(m!==u)}xa(r,o,d);break;case 1:if(!Pi&&(Al(d,o),u=d.stateNode,typeof u.componentWillUnmount=="function"))try{u.props=d.memoizedProps,u.state=d.memoizedState,u.componentWillUnmount()}catch(b){Mn(d,o,b)}xa(r,o,d);break;case 21:xa(r,o,d);break;case 22:d.mode&1?(Pi=(u=Pi)||d.memoizedState!==null,xa(r,o,d),Pi=u):xa(r,o,d);break;default:xa(r,o,d)}}function N1(r){var o=r.updateQueue;if(o!==null){r.updateQueue=null;var d=r.stateNode;d===null&&(d=r.stateNode=new iJ),o.forEach(function(u){var m=pJ.bind(null,r,u);d.has(u)||(d.add(u),u.then(m,m))})}}function As(r,o){var d=o.deletions;if(d!==null)for(var u=0;u<d.length;u++){var m=d[u];try{var E=r,y=o,b=y;e:for(;b!==null;){switch(b.tag){case 5:Ei=b.stateNode,bs=!1;break e;case 3:Ei=b.stateNode.containerInfo,bs=!0;break e;case 4:Ei=b.stateNode.containerInfo,bs=!0;break e}b=b.return}if(Ei===null)throw Error(Ce(160));v2(E,y,m),Ei=null,bs=!1;var P=m.alternate;P!==null&&(P.return=null),m.return=null}catch(U){Mn(m,o,U)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)y2(o,r),o=o.sibling}function y2(r,o){var d=r.alternate,u=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(As(o,r),ro(r),u&4){try{Vh(3,r,r.return),lE(3,r)}catch(ne){Mn(r,r.return,ne)}try{Vh(5,r,r.return)}catch(ne){Mn(r,r.return,ne)}}break;case 1:As(o,r),ro(r),u&512&&d!==null&&Al(d,d.return);break;case 5:if(As(o,r),ro(r),u&512&&d!==null&&Al(d,d.return),r.flags&32){var m=r.stateNode;try{Hh(m,"")}catch(ne){Mn(r,r.return,ne)}}if(u&4&&(m=r.stateNode,m!=null)){var E=r.memoizedProps,y=d!==null?d.memoizedProps:E,b=r.type,P=r.updateQueue;if(r.updateQueue=null,P!==null)try{b==="input"&&E.type==="radio"&&E.name!=null&&HM(m,E),Qy(b,y);var U=Qy(b,E);for(y=0;y<P.length;y+=2){var K=P[y],M=P[y+1];K==="style"?JM(m,M):K==="dangerouslySetInnerHTML"?YM(m,M):K==="children"?Hh(m,M):$R(m,K,M,U)}switch(b){case"input":zy(m,E);break;case"textarea":KM(m,E);break;case"select":var X=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!E.multiple;var oe=E.value;oe!=null?Nl(m,!!E.multiple,oe,!1):X!==!!E.multiple&&(E.defaultValue!=null?Nl(m,!!E.multiple,E.defaultValue,!0):Nl(m,!!E.multiple,E.multiple?[]:"",!1))}m[Zh]=E}catch(ne){Mn(r,r.return,ne)}}break;case 6:if(As(o,r),ro(r),u&4){if(r.stateNode===null)throw Error(Ce(162));m=r.stateNode,E=r.memoizedProps;try{m.nodeValue=E}catch(ne){Mn(r,r.return,ne)}}break;case 3:if(As(o,r),ro(r),u&4&&d!==null&&d.memoizedState.isDehydrated)try{qh(o.containerInfo)}catch(ne){Mn(r,r.return,ne)}break;case 4:As(o,r),ro(r);break;case 13:As(o,r),ro(r),m=r.child,m.flags&8192&&(E=m.memoizedState!==null,m.stateNode.isHidden=E,!E||m.alternate!==null&&m.alternate.memoizedState!==null||(PC=Wn())),u&4&&N1(r);break;case 22:if(K=d!==null&&d.memoizedState!==null,r.mode&1?(Pi=(U=Pi)||K,As(o,r),Pi=U):As(o,r),ro(r),u&8192){if(U=r.memoizedState!==null,(r.stateNode.isHidden=U)&&!K&&r.mode&1)for(Ve=r,K=r.child;K!==null;){for(M=Ve=K;Ve!==null;){switch(X=Ve,oe=X.child,X.tag){case 0:case 11:case 14:case 15:Vh(4,X,X.return);break;case 1:Al(X,X.return);var Z=X.stateNode;if(typeof Z.componentWillUnmount=="function"){u=X,d=X.return;try{o=u,Z.props=o.memoizedProps,Z.state=o.memoizedState,Z.componentWillUnmount()}catch(ne){Mn(u,d,ne)}}break;case 5:Al(X,X.return);break;case 22:if(X.memoizedState!==null){D1(M);continue}}oe!==null?(oe.return=X,Ve=oe):D1(M)}K=K.sibling}e:for(K=null,M=r;;){if(M.tag===5){if(K===null){K=M;try{m=M.stateNode,U?(E=m.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none"):(b=M.stateNode,P=M.memoizedProps.style,y=P!=null&&P.hasOwnProperty("display")?P.display:null,b.style.display=qM("display",y))}catch(ne){Mn(r,r.return,ne)}}}else if(M.tag===6){if(K===null)try{M.stateNode.nodeValue=U?"":M.memoizedProps}catch(ne){Mn(r,r.return,ne)}}else if((M.tag!==22&&M.tag!==23||M.memoizedState===null||M===r)&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===r)break e;for(;M.sibling===null;){if(M.return===null||M.return===r)break e;K===M&&(K=null),M=M.return}K===M&&(K=null),M.sibling.return=M.return,M=M.sibling}}break;case 19:As(o,r),ro(r),u&4&&N1(r);break;case 21:break;default:As(o,r),ro(r)}}function ro(r){var o=r.flags;if(o&2){try{e:{for(var d=r.return;d!==null;){if(T2(d)){var u=d;break e}d=d.return}throw Error(Ce(160))}switch(u.tag){case 5:var m=u.stateNode;u.flags&32&&(Hh(m,""),u.flags&=-33);var E=b1(r);AR(r,E,m);break;case 3:case 4:var y=u.stateNode.containerInfo,b=b1(r);wR(r,b,y);break;default:throw Error(Ce(161))}}catch(P){Mn(r,r.return,P)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function sJ(r,o,d){Ve=r,R2(r)}function R2(r,o,d){for(var u=(r.mode&1)!==0;Ve!==null;){var m=Ve,E=m.child;if(m.tag===22&&u){var y=m.memoizedState!==null||t_;if(!y){var b=m.alternate,P=b!==null&&b.memoizedState!==null||Pi;b=t_;var U=Pi;if(t_=y,(Pi=P)&&!U)for(Ve=m;Ve!==null;)y=Ve,P=y.child,y.tag===22&&y.memoizedState!==null?k1(m):P!==null?(P.return=y,Ve=P):k1(m);for(;E!==null;)Ve=E,R2(E),E=E.sibling;Ve=m,t_=b,Pi=U}P1(r)}else m.subtreeFlags&8772&&E!==null?(E.return=m,Ve=E):P1(r)}}function P1(r){for(;Ve!==null;){var o=Ve;if(o.flags&8772){var d=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:Pi||lE(5,o);break;case 1:var u=o.stateNode;if(o.flags&4&&!Pi)if(d===null)u.componentDidMount();else{var m=o.elementType===o.type?d.memoizedProps:Os(o.type,d.memoizedProps);u.componentDidUpdate(m,d.memoizedState,u.__reactInternalSnapshotBeforeUpdate)}var E=o.updateQueue;E!==null&&m1(o,E,u);break;case 3:var y=o.updateQueue;if(y!==null){if(d=null,o.child!==null)switch(o.child.tag){case 5:d=o.child.stateNode;break;case 1:d=o.child.stateNode}m1(o,y,d)}break;case 5:var b=o.stateNode;if(d===null&&o.flags&4){d=b;var P=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":P.autoFocus&&d.focus();break;case"img":P.src&&(d.src=P.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var U=o.alternate;if(U!==null){var K=U.memoizedState;if(K!==null){var M=K.dehydrated;M!==null&&qh(M)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ce(163))}Pi||o.flags&512&&IR(o)}catch(X){Mn(o,o.return,X)}}if(o===r){Ve=null;break}if(d=o.sibling,d!==null){d.return=o.return,Ve=d;break}Ve=o.return}}function D1(r){for(;Ve!==null;){var o=Ve;if(o===r){Ve=null;break}var d=o.sibling;if(d!==null){d.return=o.return,Ve=d;break}Ve=o.return}}function k1(r){for(;Ve!==null;){var o=Ve;try{switch(o.tag){case 0:case 11:case 15:var d=o.return;try{lE(4,o)}catch(P){Mn(o,d,P)}break;case 1:var u=o.stateNode;if(typeof u.componentDidMount=="function"){var m=o.return;try{u.componentDidMount()}catch(P){Mn(o,m,P)}}var E=o.return;try{IR(o)}catch(P){Mn(o,E,P)}break;case 5:var y=o.return;try{IR(o)}catch(P){Mn(o,y,P)}}}catch(P){Mn(o,o.return,P)}if(o===r){Ve=null;break}var b=o.sibling;if(b!==null){b.return=o.return,Ve=b;break}Ve=o.return}}var oJ=Math.ceil,K_=zo.ReactCurrentDispatcher,bC=zo.ReactCurrentOwner,ls=zo.ReactCurrentBatchConfig,Mt=0,pi=null,ei=null,gi=0,Nr=0,Ol=sc(0),oi=0,sp=null,ed=0,uE=0,NC=0,Fh=null,hr=null,PC=0,Gl=1/0,xo=null,z_=!1,OR=null,Qa=null,n_=!1,Ha=null,Y_=0,Bh=0,bR=null,S_=-1,T_=0;function Yi(){return Mt&6?Wn():S_!==-1?S_:S_=Wn()}function $a(r){return r.mode&1?Mt&2&&gi!==0?gi&-gi:W7.transition!==null?(T_===0&&(T_=aU()),T_):(r=qt,r!==0||(r=window.event,r=r===void 0?16:fU(r.type)),r):1}function ks(r,o,d,u){if(50<Bh)throw Bh=0,bR=null,Error(Ce(185));up(r,d,u),(!(Mt&2)||r!==pi)&&(r===pi&&(!(Mt&2)&&(uE|=d),oi===4&&Ga(r,gi)),_r(r,u),d===1&&Mt===0&&!(o.mode&1)&&(Gl=Wn()+500,aE&&oc()))}function _r(r,o){var d=r.callbackNode;Wq(r,o);var u=N_(r,r===pi?gi:0);if(u===0)d!==null&&GL(d),r.callbackNode=null,r.callbackPriority=0;else if(o=u&-u,r.callbackPriority!==o){if(d!=null&&GL(d),o===1)r.tag===0?G7(L1.bind(null,r)):kU(L1.bind(null,r)),V7(function(){!(Mt&6)&&oc()}),d=null;else{switch(cU(u)){case 1:d=iC;break;case 4:d=sU;break;case 16:d=b_;break;case 536870912:d=oU;break;default:d=b_}d=P2(d,C2.bind(null,r))}r.callbackPriority=o,r.callbackNode=d}}function C2(r,o){if(S_=-1,T_=0,Mt&6)throw Error(Ce(327));var d=r.callbackNode;if(Ml()&&r.callbackNode!==d)return null;var u=N_(r,r===pi?gi:0);if(u===0)return null;if(u&30||u&r.expiredLanes||o)o=q_(r,u);else{o=u;var m=Mt;Mt|=2;var E=w2();(pi!==r||gi!==o)&&(xo=null,Gl=Wn()+500,qc(r,o));do try{dJ();break}catch(b){I2(r,b)}while(!0);_C(),K_.current=E,Mt=m,ei!==null?o=0:(pi=null,gi=0,o=oi)}if(o!==0){if(o===2&&(m=nR(r),m!==0&&(u=m,o=NR(r,m))),o===1)throw d=sp,qc(r,0),Ga(r,u),_r(r,Wn()),d;if(o===6)Ga(r,u);else{if(m=r.current.alternate,!(u&30)&&!aJ(m)&&(o=q_(r,u),o===2&&(E=nR(r),E!==0&&(u=E,o=NR(r,E))),o===1))throw d=sp,qc(r,0),Ga(r,u),_r(r,Wn()),d;switch(r.finishedWork=m,r.finishedLanes=u,o){case 0:case 1:throw Error(Ce(345));case 2:Wc(r,hr,xo);break;case 3:if(Ga(r,u),(u&130023424)===u&&(o=PC+500-Wn(),10<o)){if(N_(r,0)!==0)break;if(m=r.suspendedLanes,(m&u)!==u){Yi(),r.pingedLanes|=r.suspendedLanes&m;break}r.timeoutHandle=lR(Wc.bind(null,r,hr,xo),o);break}Wc(r,hr,xo);break;case 4:if(Ga(r,u),(u&4194240)===u)break;for(o=r.eventTimes,m=-1;0<u;){var y=31-Ds(u);E=1<<y,y=o[y],y>m&&(m=y),u&=~E}if(u=m,u=Wn()-u,u=(120>u?120:480>u?480:1080>u?1080:1920>u?1920:3e3>u?3e3:4320>u?4320:1960*oJ(u/1960))-u,10<u){r.timeoutHandle=lR(Wc.bind(null,r,hr,xo),u);break}Wc(r,hr,xo);break;case 5:Wc(r,hr,xo);break;default:throw Error(Ce(329))}}}return _r(r,Wn()),r.callbackNode===d?C2.bind(null,r):null}function NR(r,o){var d=Fh;return r.current.memoizedState.isDehydrated&&(qc(r,o).flags|=256),r=q_(r,o),r!==2&&(o=hr,hr=d,o!==null&&PR(o)),r}function PR(r){hr===null?hr=r:hr.push.apply(hr,r)}function aJ(r){for(var o=r;;){if(o.flags&16384){var d=o.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var u=0;u<d.length;u++){var m=d[u],E=m.getSnapshot;m=m.value;try{if(!Ls(E(),m))return!1}catch{return!1}}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ga(r,o){for(o&=~NC,o&=~uE,r.suspendedLanes|=o,r.pingedLanes&=~o,r=r.expirationTimes;0<o;){var d=31-Ds(o),u=1<<d;r[d]=-1,o&=~u}}function L1(r){if(Mt&6)throw Error(Ce(327));Ml();var o=N_(r,0);if(!(o&1))return _r(r,Wn()),null;var d=q_(r,o);if(r.tag!==0&&d===2){var u=nR(r);u!==0&&(o=u,d=NR(r,u))}if(d===1)throw d=sp,qc(r,0),Ga(r,o),_r(r,Wn()),d;if(d===6)throw Error(Ce(345));return r.finishedWork=r.current.alternate,r.finishedLanes=o,Wc(r,hr,xo),_r(r,Wn()),null}function DC(r,o){var d=Mt;Mt|=1;try{return r(o)}finally{Mt=d,Mt===0&&(Gl=Wn()+500,aE&&oc())}}function td(r){Ha!==null&&Ha.tag===0&&!(Mt&6)&&Ml();var o=Mt;Mt|=1;var d=ls.transition,u=qt;try{if(ls.transition=null,qt=1,r)return r()}finally{qt=u,ls.transition=d,Mt=o,!(Mt&6)&&oc()}}function kC(){Nr=Ol.current,En(Ol)}function qc(r,o){r.finishedWork=null,r.finishedLanes=0;var d=r.timeoutHandle;if(d!==-1&&(r.timeoutHandle=-1,x7(d)),ei!==null)for(d=ei.return;d!==null;){var u=d;switch(pC(u),u.tag){case 1:u=u.type.childContextTypes,u!=null&&M_();break;case 3:Bl(),En(fr),En(Di),yC();break;case 5:vC(u);break;case 4:Bl();break;case 13:En(bn);break;case 19:En(bn);break;case 10:EC(u.type._context);break;case 22:case 23:kC()}d=d.return}if(pi=r,ei=r=Za(r.current,null),gi=Nr=o,oi=0,sp=null,NC=uE=ed=0,hr=Fh=null,zc!==null){for(o=0;o<zc.length;o++)if(d=zc[o],u=d.interleaved,u!==null){d.interleaved=null;var m=u.next,E=d.pending;if(E!==null){var y=E.next;E.next=m,u.next=y}d.pending=u}zc=null}return r}function I2(r,o){do{var d=ei;try{if(_C(),__.current=H_,W_){for(var u=Nn.memoizedState;u!==null;){var m=u.queue;m!==null&&(m.pending=null),u=u.next}W_=!1}if(Zc=0,hi=si=Nn=null,xh=!1,np=0,bC.current=null,d===null||d.return===null){oi=1,sp=o,ei=null;break}e:{var E=r,y=d.return,b=d,P=o;if(o=gi,b.flags|=32768,P!==null&&typeof P=="object"&&typeof P.then=="function"){var U=P,K=b,M=K.tag;if(!(K.mode&1)&&(M===0||M===11||M===15)){var X=K.alternate;X?(K.updateQueue=X.updateQueue,K.memoizedState=X.memoizedState,K.lanes=X.lanes):(K.updateQueue=null,K.memoizedState=null)}var oe=v1(y);if(oe!==null){oe.flags&=-257,y1(oe,y,b,E,o),oe.mode&1&&T1(E,U,o),o=oe,P=U;var Z=o.updateQueue;if(Z===null){var ne=new Set;ne.add(P),o.updateQueue=ne}else Z.add(P);break e}else{if(!(o&1)){T1(E,U,o),LC();break e}P=Error(Ce(426))}}else if(In&&b.mode&1){var Se=v1(y);if(Se!==null){!(Se.flags&65536)&&(Se.flags|=256),y1(Se,y,b,E,o),fC(jl(P,b));break e}}E=P=jl(P,b),oi!==4&&(oi=2),Fh===null?Fh=[E]:Fh.push(E),E=y;do{switch(E.tag){case 3:E.flags|=65536,o&=-o,E.lanes|=o;var J=c2(E,P,o);f1(E,J);break e;case 1:b=P;var H=E.type,q=E.stateNode;if(!(E.flags&128)&&(typeof H.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Qa===null||!Qa.has(q)))){E.flags|=65536,o&=-o,E.lanes|=o;var ue=d2(E,b,o);f1(E,ue);break e}}E=E.return}while(E!==null)}O2(d)}catch(Re){o=Re,ei===d&&d!==null&&(ei=d=d.return);continue}break}while(!0)}function w2(){var r=K_.current;return K_.current=H_,r===null?H_:r}function LC(){(oi===0||oi===3||oi===2)&&(oi=4),pi===null||!(ed&268435455)&&!(uE&268435455)||Ga(pi,gi)}function q_(r,o){var d=Mt;Mt|=2;var u=w2();(pi!==r||gi!==o)&&(xo=null,qc(r,o));do try{cJ();break}catch(m){I2(r,m)}while(!0);if(_C(),Mt=d,K_.current=u,ei!==null)throw Error(Ce(261));return pi=null,gi=0,oi}function cJ(){for(;ei!==null;)A2(ei)}function dJ(){for(;ei!==null&&!Lq();)A2(ei)}function A2(r){var o=N2(r.alternate,r,Nr);r.memoizedProps=r.pendingProps,o===null?O2(r):ei=o,bC.current=null}function O2(r){var o=r;do{var d=o.alternate;if(r=o.return,o.flags&32768){if(d=nJ(d,o),d!==null){d.flags&=32767,ei=d;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{oi=6,ei=null;return}}else if(d=tJ(d,o,Nr),d!==null){ei=d;return}if(o=o.sibling,o!==null){ei=o;return}ei=o=r}while(o!==null);oi===0&&(oi=5)}function Wc(r,o,d){var u=qt,m=ls.transition;try{ls.transition=null,qt=1,lJ(r,o,d,u)}finally{ls.transition=m,qt=u}return null}function lJ(r,o,d,u){do Ml();while(Ha!==null);if(Mt&6)throw Error(Ce(327));d=r.finishedWork;var m=r.finishedLanes;if(d===null)return null;if(r.finishedWork=null,r.finishedLanes=0,d===r.current)throw Error(Ce(177));r.callbackNode=null,r.callbackPriority=0;var E=d.lanes|d.childLanes;if(Hq(r,E),r===pi&&(ei=pi=null,gi=0),!(d.subtreeFlags&2064)&&!(d.flags&2064)||n_||(n_=!0,P2(b_,function(){return Ml(),null})),E=(d.flags&15990)!==0,d.subtreeFlags&15990||E){E=ls.transition,ls.transition=null;var y=qt;qt=1;var b=Mt;Mt|=4,bC.current=null,rJ(r,d),y2(d,r),N7(cR),P_=!!aR,cR=aR=null,r.current=d,sJ(d),Mq(),Mt=b,qt=y,ls.transition=E}else r.current=d;if(n_&&(n_=!1,Ha=r,Y_=m),E=r.pendingLanes,E===0&&(Qa=null),Vq(d.stateNode),_r(r,Wn()),o!==null)for(u=r.onRecoverableError,d=0;d<o.length;d++)m=o[d],u(m.value,{componentStack:m.stack,digest:m.digest});if(z_)throw z_=!1,r=OR,OR=null,r;return Y_&1&&r.tag!==0&&Ml(),E=r.pendingLanes,E&1?r===bR?Bh++:(Bh=0,bR=r):Bh=0,oc(),null}function Ml(){if(Ha!==null){var r=cU(Y_),o=ls.transition,d=qt;try{if(ls.transition=null,qt=16>r?16:r,Ha===null)var u=!1;else{if(r=Ha,Ha=null,Y_=0,Mt&6)throw Error(Ce(331));var m=Mt;for(Mt|=4,Ve=r.current;Ve!==null;){var E=Ve,y=E.child;if(Ve.flags&16){var b=E.deletions;if(b!==null){for(var P=0;P<b.length;P++){var U=b[P];for(Ve=U;Ve!==null;){var K=Ve;switch(K.tag){case 0:case 11:case 15:Vh(8,K,E)}var M=K.child;if(M!==null)M.return=K,Ve=M;else for(;Ve!==null;){K=Ve;var X=K.sibling,oe=K.return;if(S2(K),K===U){Ve=null;break}if(X!==null){X.return=oe,Ve=X;break}Ve=oe}}}var Z=E.alternate;if(Z!==null){var ne=Z.child;if(ne!==null){Z.child=null;do{var Se=ne.sibling;ne.sibling=null,ne=Se}while(ne!==null)}}Ve=E}}if(E.subtreeFlags&2064&&y!==null)y.return=E,Ve=y;else e:for(;Ve!==null;){if(E=Ve,E.flags&2048)switch(E.tag){case 0:case 11:case 15:Vh(9,E,E.return)}var J=E.sibling;if(J!==null){J.return=E.return,Ve=J;break e}Ve=E.return}}var H=r.current;for(Ve=H;Ve!==null;){y=Ve;var q=y.child;if(y.subtreeFlags&2064&&q!==null)q.return=y,Ve=q;else e:for(y=H;Ve!==null;){if(b=Ve,b.flags&2048)try{switch(b.tag){case 0:case 11:case 15:lE(9,b)}}catch(Re){Mn(b,b.return,Re)}if(b===y){Ve=null;break e}var ue=b.sibling;if(ue!==null){ue.return=b.return,Ve=ue;break e}Ve=b.return}}if(Mt=m,oc(),co&&typeof co.onPostCommitFiberRoot=="function")try{co.onPostCommitFiberRoot(nE,r)}catch{}u=!0}return u}finally{qt=d,ls.transition=o}}return!1}function M1(r,o,d){o=jl(d,o),o=c2(r,o,1),r=Xa(r,o,1),o=Yi(),r!==null&&(up(r,1,o),_r(r,o))}function Mn(r,o,d){if(r.tag===3)M1(r,r,d);else for(;o!==null;){if(o.tag===3){M1(o,r,d);break}else if(o.tag===1){var u=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Qa===null||!Qa.has(u))){r=jl(d,r),r=d2(o,r,1),o=Xa(o,r,1),r=Yi(),o!==null&&(up(o,1,r),_r(o,r));break}}o=o.return}}function uJ(r,o,d){var u=r.pingCache;u!==null&&u.delete(o),o=Yi(),r.pingedLanes|=r.suspendedLanes&d,pi===r&&(gi&d)===d&&(oi===4||oi===3&&(gi&130023424)===gi&&500>Wn()-PC?qc(r,0):NC|=d),_r(r,o)}function b2(r,o){o===0&&(r.mode&1?(o=zm,zm<<=1,!(zm&130023424)&&(zm=4194304)):o=1);var d=Yi();r=Ho(r,o),r!==null&&(up(r,o,d),_r(r,d))}function hJ(r){var o=r.memoizedState,d=0;o!==null&&(d=o.retryLane),b2(r,d)}function pJ(r,o){var d=0;switch(r.tag){case 13:var u=r.stateNode,m=r.memoizedState;m!==null&&(d=m.retryLane);break;case 19:u=r.stateNode;break;default:throw Error(Ce(314))}u!==null&&u.delete(o),b2(r,d)}var N2;N2=function(r,o,d){if(r!==null)if(r.memoizedProps!==o.pendingProps||fr.current)pr=!0;else{if(!(r.lanes&d)&&!(o.flags&128))return pr=!1,eJ(r,o,d);pr=!!(r.flags&131072)}else pr=!1,In&&o.flags&1048576&&LU(o,V_,o.index);switch(o.lanes=0,o.tag){case 2:var u=o.type;g_(r,o),r=o.pendingProps;var m=xl(o,Di.current);Ll(o,d),m=CC(null,o,u,r,m,d);var E=IC();return o.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,mr(u)?(E=!0,U_(o)):E=!1,o.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,SC(o),m.updater=dE,o.stateNode=m,m._reactInternals=o,ER(o,u,r,d),o=TR(null,o,u,!0,E,d)):(o.tag=0,In&&E&&hC(o),Ki(null,o,m,d),o=o.child),o;case 16:u=o.elementType;e:{switch(g_(r,o),r=o.pendingProps,m=u._init,u=m(u._payload),o.type=u,m=o.tag=mJ(u),r=Os(u,r),m){case 0:o=SR(null,o,u,r,d);break e;case 1:o=I1(null,o,u,r,d);break e;case 11:o=R1(null,o,u,r,d);break e;case 14:o=C1(null,o,u,Os(u.type,r),d);break e}throw Error(Ce(306,u,""))}return o;case 0:return u=o.type,m=o.pendingProps,m=o.elementType===u?m:Os(u,m),SR(r,o,u,m,d);case 1:return u=o.type,m=o.pendingProps,m=o.elementType===u?m:Os(u,m),I1(r,o,u,m,d);case 3:e:{if(p2(o),r===null)throw Error(Ce(387));u=o.pendingProps,E=o.memoizedState,m=E.element,BU(r,o),j_(o,u,null,d);var y=o.memoizedState;if(u=y.element,E.isDehydrated)if(E={element:u,isDehydrated:!1,cache:y.cache,pendingSuspenseBoundaries:y.pendingSuspenseBoundaries,transitions:y.transitions},o.updateQueue.baseState=E,o.memoizedState=E,o.flags&256){m=jl(Error(Ce(423)),o),o=w1(r,o,u,d,m);break e}else if(u!==m){m=jl(Error(Ce(424)),o),o=w1(r,o,u,d,m);break e}else for(Dr=Ja(o.stateNode.containerInfo.firstChild),kr=o,In=!0,Ps=null,d=VU(o,null,u,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Vl(),u===m){o=Ko(r,o,d);break e}Ki(r,o,u,d)}o=o.child}return o;case 5:return jU(o),r===null&&fR(o),u=o.type,m=o.pendingProps,E=r!==null?r.memoizedProps:null,y=m.children,dR(u,m)?y=null:E!==null&&dR(u,E)&&(o.flags|=32),h2(r,o),Ki(r,o,y,d),o.child;case 6:return r===null&&fR(o),null;case 13:return f2(r,o,d);case 4:return TC(o,o.stateNode.containerInfo),u=o.pendingProps,r===null?o.child=Fl(o,null,u,d):Ki(r,o,u,d),o.child;case 11:return u=o.type,m=o.pendingProps,m=o.elementType===u?m:Os(u,m),R1(r,o,u,m,d);case 7:return Ki(r,o,o.pendingProps,d),o.child;case 8:return Ki(r,o,o.pendingProps.children,d),o.child;case 12:return Ki(r,o,o.pendingProps.children,d),o.child;case 10:e:{if(u=o.type._context,m=o.pendingProps,E=o.memoizedProps,y=m.value,pn(F_,u._currentValue),u._currentValue=y,E!==null)if(Ls(E.value,y)){if(E.children===m.children&&!fr.current){o=Ko(r,o,d);break e}}else for(E=o.child,E!==null&&(E.return=o);E!==null;){var b=E.dependencies;if(b!==null){y=E.child;for(var P=b.firstContext;P!==null;){if(P.context===u){if(E.tag===1){P=jo(-1,d&-d),P.tag=2;var U=E.updateQueue;if(U!==null){U=U.shared;var K=U.pending;K===null?P.next=P:(P.next=K.next,K.next=P),U.pending=P}}E.lanes|=d,P=E.alternate,P!==null&&(P.lanes|=d),mR(E.return,d,o),b.lanes|=d;break}P=P.next}}else if(E.tag===10)y=E.type===o.type?null:E.child;else if(E.tag===18){if(y=E.return,y===null)throw Error(Ce(341));y.lanes|=d,b=y.alternate,b!==null&&(b.lanes|=d),mR(y,d,o),y=E.sibling}else y=E.child;if(y!==null)y.return=E;else for(y=E;y!==null;){if(y===o){y=null;break}if(E=y.sibling,E!==null){E.return=y.return,y=E;break}y=y.return}E=y}Ki(r,o,m.children,d),o=o.child}return o;case 9:return m=o.type,u=o.pendingProps.children,Ll(o,d),m=ps(m),u=u(m),o.flags|=1,Ki(r,o,u,d),o.child;case 14:return u=o.type,m=Os(u,o.pendingProps),m=Os(u.type,m),C1(r,o,u,m,d);case 15:return l2(r,o,o.type,o.pendingProps,d);case 17:return u=o.type,m=o.pendingProps,m=o.elementType===u?m:Os(u,m),g_(r,o),o.tag=1,mr(u)?(r=!0,U_(o)):r=!1,Ll(o,d),a2(o,u,m),ER(o,u,m,d),TR(null,o,u,!0,r,d);case 19:return m2(r,o,d);case 22:return u2(r,o,d)}throw Error(Ce(156,o.tag))};function P2(r,o){return rU(r,o)}function fJ(r,o,d,u){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ds(r,o,d,u){return new fJ(r,o,d,u)}function MC(r){return r=r.prototype,!(!r||!r.isReactComponent)}function mJ(r){if(typeof r=="function")return MC(r)?1:0;if(r!=null){if(r=r.$$typeof,r===eC)return 11;if(r===tC)return 14}return 2}function Za(r,o){var d=r.alternate;return d===null?(d=ds(r.tag,o,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=o,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&14680064,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,o=r.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d}function v_(r,o,d,u,m,E){var y=2;if(u=r,typeof r=="function")MC(r)&&(y=1);else if(typeof r=="string")y=5;else e:switch(r){case gl:return Jc(d.children,m,E,o);case ZR:y=8,m|=8;break;case jy:return r=ds(12,d,o,m|2),r.elementType=jy,r.lanes=E,r;case Gy:return r=ds(13,d,o,m),r.elementType=Gy,r.lanes=E,r;case Wy:return r=ds(19,d,o,m),r.elementType=Wy,r.lanes=E,r;case jM:return hE(d,m,E,o);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case FM:y=10;break e;case BM:y=9;break e;case eC:y=11;break e;case tC:y=14;break e;case Fa:y=16,u=null;break e}throw Error(Ce(130,r==null?r:typeof r,""))}return o=ds(y,d,o,m),o.elementType=r,o.type=u,o.lanes=E,o}function Jc(r,o,d,u){return r=ds(7,r,u,o),r.lanes=d,r}function hE(r,o,d,u){return r=ds(22,r,u,o),r.elementType=jM,r.lanes=d,r.stateNode={isHidden:!1},r}function Ay(r,o,d){return r=ds(6,r,null,o),r.lanes=d,r}function Oy(r,o,d){return o=ds(4,r.children!==null?r.children:[],r.key,o),o.lanes=d,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}function _J(r,o,d,u,m){this.tag=o,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cy(0),this.expirationTimes=cy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cy(0),this.identifierPrefix=u,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function UC(r,o,d,u,m,E,y,b,P){return r=new _J(r,o,d,b,P),o===1?(o=1,E===!0&&(o|=8)):o=0,E=ds(3,null,null,o),r.current=E,E.stateNode=r,E.memoizedState={element:u,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},SC(E),r}function EJ(r,o,d){var u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:El,key:u==null?null:""+u,children:r,containerInfo:o,implementation:d}}function D2(r){if(!r)return ic;r=r._reactInternals;e:{if(id(r)!==r||r.tag!==1)throw Error(Ce(170));var o=r;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(mr(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(Ce(171))}if(r.tag===1){var d=r.type;if(mr(d))return DU(r,d,o)}return o}function k2(r,o,d,u,m,E,y,b,P){return r=UC(d,u,!0,r,m,E,y,b,P),r.context=D2(null),d=r.current,u=Yi(),m=$a(d),E=jo(u,m),E.callback=o??null,Xa(d,E,m),r.current.lanes=m,up(r,m,u),_r(r,u),r}function pE(r,o,d,u){var m=o.current,E=Yi(),y=$a(m);return d=D2(d),o.context===null?o.context=d:o.pendingContext=d,o=jo(E,y),o.payload={element:r},u=u===void 0?null:u,u!==null&&(o.callback=u),r=Xa(m,o,y),r!==null&&(ks(r,m,y,E),m_(r,m,y)),y}function J_(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function U1(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<o?d:o}}function xC(r,o){U1(r,o),(r=r.alternate)&&U1(r,o)}function gJ(){return null}var L2=typeof reportError=="function"?reportError:function(r){console.error(r)};function VC(r){this._internalRoot=r}fE.prototype.render=VC.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(Ce(409));pE(r,o,null,null)};fE.prototype.unmount=VC.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;td(function(){pE(null,r,null,null)}),o[Wo]=null}};function fE(r){this._internalRoot=r}fE.prototype.unstable_scheduleHydration=function(r){if(r){var o=uU();r={blockedOn:null,target:r,priority:o};for(var d=0;d<ja.length&&o!==0&&o<ja[d].priority;d++);ja.splice(d,0,r),d===0&&pU(r)}};function FC(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function mE(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function x1(){}function SJ(r,o,d,u,m){if(m){if(typeof u=="function"){var E=u;u=function(){var U=J_(y);E.call(U)}}var y=k2(o,u,r,0,null,!1,!1,"",x1);return r._reactRootContainer=y,r[Wo]=y.current,Qh(r.nodeType===8?r.parentNode:r),td(),y}for(;m=r.lastChild;)r.removeChild(m);if(typeof u=="function"){var b=u;u=function(){var U=J_(P);b.call(U)}}var P=UC(r,0,!1,null,null,!1,!1,"",x1);return r._reactRootContainer=P,r[Wo]=P.current,Qh(r.nodeType===8?r.parentNode:r),td(function(){pE(o,P,d,u)}),P}function _E(r,o,d,u,m){var E=d._reactRootContainer;if(E){var y=E;if(typeof m=="function"){var b=m;m=function(){var P=J_(y);b.call(P)}}pE(o,y,r,m)}else y=SJ(d,o,r,m,u);return J_(y)}dU=function(r){switch(r.tag){case 3:var o=r.stateNode;if(o.current.memoizedState.isDehydrated){var d=Oh(o.pendingLanes);d!==0&&(rC(o,d|1),_r(o,Wn()),!(Mt&6)&&(Gl=Wn()+500,oc()))}break;case 13:td(function(){var u=Ho(r,1);if(u!==null){var m=Yi();ks(u,r,1,m)}}),xC(r,1)}};sC=function(r){if(r.tag===13){var o=Ho(r,134217728);if(o!==null){var d=Yi();ks(o,r,134217728,d)}xC(r,134217728)}};lU=function(r){if(r.tag===13){var o=$a(r),d=Ho(r,o);if(d!==null){var u=Yi();ks(d,r,o,u)}xC(r,o)}};uU=function(){return qt};hU=function(r,o){var d=qt;try{return qt=r,o()}finally{qt=d}};Zy=function(r,o,d){switch(o){case"input":if(zy(r,d),o=d.name,d.type==="radio"&&o!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<d.length;o++){var u=d[o];if(u!==r&&u.form===r.form){var m=oE(u);if(!m)throw Error(Ce(90));WM(u),zy(u,m)}}}break;case"textarea":KM(r,d);break;case"select":o=d.value,o!=null&&Nl(r,!!d.multiple,o,!1)}};$M=DC;ZM=td;var TJ={usingClientEntryPoint:!1,Events:[pp,yl,oE,XM,QM,DC]},Rh={findFiberByHostInstance:Kc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},vJ={bundleType:Rh.bundleType,version:Rh.version,rendererPackageName:Rh.rendererPackageName,rendererConfig:Rh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:zo.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=nU(r),r===null?null:r.stateNode},findFiberByHostInstance:Rh.findFiberByHostInstance||gJ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var i_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!i_.isDisabled&&i_.supportsFiber)try{nE=i_.inject(vJ),co=i_}catch{}}Mr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=TJ;Mr.createPortal=function(r,o){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!FC(o))throw Error(Ce(200));return EJ(r,o,null,d)};Mr.createRoot=function(r,o){if(!FC(r))throw Error(Ce(299));var d=!1,u="",m=L2;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(u=o.identifierPrefix),o.onRecoverableError!==void 0&&(m=o.onRecoverableError)),o=UC(r,1,!1,null,null,d,!1,u,m),r[Wo]=o.current,Qh(r.nodeType===8?r.parentNode:r),new VC(o)};Mr.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(Ce(188)):(r=Object.keys(r).join(","),Error(Ce(268,r)));return r=nU(o),r=r===null?null:r.stateNode,r};Mr.flushSync=function(r){return td(r)};Mr.hydrate=function(r,o,d){if(!mE(o))throw Error(Ce(200));return _E(null,r,o,!0,d)};Mr.hydrateRoot=function(r,o,d){if(!FC(r))throw Error(Ce(405));var u=d!=null&&d.hydratedSources||null,m=!1,E="",y=L2;if(d!=null&&(d.unstable_strictMode===!0&&(m=!0),d.identifierPrefix!==void 0&&(E=d.identifierPrefix),d.onRecoverableError!==void 0&&(y=d.onRecoverableError)),o=k2(o,null,r,1,d??null,m,!1,E,y),r[Wo]=o.current,Qh(r),u)for(r=0;r<u.length;r++)d=u[r],m=d._getVersion,m=m(d._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[d,m]:o.mutableSourceEagerHydrationData.push(d,m);return new fE(o)};Mr.render=function(r,o,d){if(!mE(o))throw Error(Ce(200));return _E(null,r,o,!1,d)};Mr.unmountComponentAtNode=function(r){if(!mE(r))throw Error(Ce(40));return r._reactRootContainer?(td(function(){_E(null,null,r,!1,function(){r._reactRootContainer=null,r[Wo]=null})}),!0):!1};Mr.unstable_batchedUpdates=DC;Mr.unstable_renderSubtreeIntoContainer=function(r,o,d,u){if(!mE(d))throw Error(Ce(200));if(r==null||r._reactInternals===void 0)throw Error(Ce(38));return _E(r,o,d,!1,u)};Mr.version="18.3.1-next-f1338f8080-20240426";function M2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(M2)}catch(r){console.error(r)}}M2(),MM.exports=Mr;var yJ=MM.exports,V1=yJ;Fy.createRoot=V1.createRoot,Fy.hydrateRoot=V1.hydrateRoot;/**
 * @remix-run/router v1.16.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function op(){return op=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(r[u]=d[u])}return r},op.apply(this,arguments)}var Ka;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(Ka||(Ka={}));const F1="popstate";function RJ(r){r===void 0&&(r={});function o(u,m){let{pathname:E,search:y,hash:b}=u.location;return DR("",{pathname:E,search:y,hash:b},m.state&&m.state.usr||null,m.state&&m.state.key||"default")}function d(u,m){return typeof m=="string"?m:X_(m)}return IJ(o,d,null,r)}function Hn(r,o){if(r===!1||r===null||typeof r>"u")throw new Error(o)}function U2(r,o){if(!r){typeof console<"u"&&console.warn(o);try{throw new Error(o)}catch{}}}function CJ(){return Math.random().toString(36).substr(2,8)}function B1(r,o){return{usr:r.state,key:r.key,idx:o}}function DR(r,o,d,u){return d===void 0&&(d=null),op({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof o=="string"?Yl(o):o,{state:d,key:o&&o.key||u||CJ()})}function X_(r){let{pathname:o="/",search:d="",hash:u=""}=r;return d&&d!=="?"&&(o+=d.charAt(0)==="?"?d:"?"+d),u&&u!=="#"&&(o+=u.charAt(0)==="#"?u:"#"+u),o}function Yl(r){let o={};if(r){let d=r.indexOf("#");d>=0&&(o.hash=r.substr(d),r=r.substr(0,d));let u=r.indexOf("?");u>=0&&(o.search=r.substr(u),r=r.substr(0,u)),r&&(o.pathname=r)}return o}function IJ(r,o,d,u){u===void 0&&(u={});let{window:m=document.defaultView,v5Compat:E=!1}=u,y=m.history,b=Ka.Pop,P=null,U=K();U==null&&(U=0,y.replaceState(op({},y.state,{idx:U}),""));function K(){return(y.state||{idx:null}).idx}function M(){b=Ka.Pop;let Se=K(),J=Se==null?null:Se-U;U=Se,P&&P({action:b,location:ne.location,delta:J})}function X(Se,J){b=Ka.Push;let H=DR(ne.location,Se,J);U=K()+1;let q=B1(H,U),ue=ne.createHref(H);try{y.pushState(q,"",ue)}catch(Re){if(Re instanceof DOMException&&Re.name==="DataCloneError")throw Re;m.location.assign(ue)}E&&P&&P({action:b,location:ne.location,delta:1})}function oe(Se,J){b=Ka.Replace;let H=DR(ne.location,Se,J);U=K();let q=B1(H,U),ue=ne.createHref(H);y.replaceState(q,"",ue),E&&P&&P({action:b,location:ne.location,delta:0})}function Z(Se){let J=m.location.origin!=="null"?m.location.origin:m.location.href,H=typeof Se=="string"?Se:X_(Se);return H=H.replace(/ $/,"%20"),Hn(J,"No window.location.(origin|href) available to create URL for href: "+H),new URL(H,J)}let ne={get action(){return b},get location(){return r(m,y)},listen(Se){if(P)throw new Error("A history only accepts one active listener");return m.addEventListener(F1,M),P=Se,()=>{m.removeEventListener(F1,M),P=null}},createHref(Se){return o(m,Se)},createURL:Z,encodeLocation(Se){let J=Z(Se);return{pathname:J.pathname,search:J.search,hash:J.hash}},push:X,replace:oe,go(Se){return y.go(Se)}};return ne}var j1;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(j1||(j1={}));function wJ(r,o,d){d===void 0&&(d="/");let u=typeof o=="string"?Yl(o):o,m=BC(u.pathname||"/",d);if(m==null)return null;let E=x2(r);AJ(E);let y=null;for(let b=0;y==null&&b<E.length;++b){let P=FJ(m);y=UJ(E[b],P)}return y}function x2(r,o,d,u){o===void 0&&(o=[]),d===void 0&&(d=[]),u===void 0&&(u="");let m=(E,y,b)=>{let P={relativePath:b===void 0?E.path||"":b,caseSensitive:E.caseSensitive===!0,childrenIndex:y,route:E};P.relativePath.startsWith("/")&&(Hn(P.relativePath.startsWith(u),'Absolute route path "'+P.relativePath+'" nested under path '+('"'+u+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),P.relativePath=P.relativePath.slice(u.length));let U=ec([u,P.relativePath]),K=d.concat(P);E.children&&E.children.length>0&&(Hn(E.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+U+'".')),x2(E.children,o,K,U)),!(E.path==null&&!E.index)&&o.push({path:U,score:LJ(U,E.index),routesMeta:K})};return r.forEach((E,y)=>{var b;if(E.path===""||!((b=E.path)!=null&&b.includes("?")))m(E,y);else for(let P of V2(E.path))m(E,y,P)}),o}function V2(r){let o=r.split("/");if(o.length===0)return[];let[d,...u]=o,m=d.endsWith("?"),E=d.replace(/\?$/,"");if(u.length===0)return m?[E,""]:[E];let y=V2(u.join("/")),b=[];return b.push(...y.map(P=>P===""?E:[E,P].join("/"))),m&&b.push(...y),b.map(P=>r.startsWith("/")&&P===""?"/":P)}function AJ(r){r.sort((o,d)=>o.score!==d.score?d.score-o.score:MJ(o.routesMeta.map(u=>u.childrenIndex),d.routesMeta.map(u=>u.childrenIndex)))}const OJ=/^:[\w-]+$/,bJ=3,NJ=2,PJ=1,DJ=10,kJ=-2,G1=r=>r==="*";function LJ(r,o){let d=r.split("/"),u=d.length;return d.some(G1)&&(u+=kJ),o&&(u+=NJ),d.filter(m=>!G1(m)).reduce((m,E)=>m+(OJ.test(E)?bJ:E===""?PJ:DJ),u)}function MJ(r,o){return r.length===o.length&&r.slice(0,-1).every((u,m)=>u===o[m])?r[r.length-1]-o[o.length-1]:0}function UJ(r,o){let{routesMeta:d}=r,u={},m="/",E=[];for(let y=0;y<d.length;++y){let b=d[y],P=y===d.length-1,U=m==="/"?o:o.slice(m.length)||"/",K=xJ({path:b.relativePath,caseSensitive:b.caseSensitive,end:P},U);if(!K)return null;Object.assign(u,K.params);let M=b.route;E.push({params:u,pathname:ec([m,K.pathname]),pathnameBase:WJ(ec([m,K.pathnameBase])),route:M}),K.pathnameBase!=="/"&&(m=ec([m,K.pathnameBase]))}return E}function xJ(r,o){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[d,u]=VJ(r.path,r.caseSensitive,r.end),m=o.match(d);if(!m)return null;let E=m[0],y=E.replace(/(.)\/+$/,"$1"),b=m.slice(1);return{params:u.reduce((U,K,M)=>{let{paramName:X,isOptional:oe}=K;if(X==="*"){let ne=b[M]||"";y=E.slice(0,E.length-ne.length).replace(/(.)\/+$/,"$1")}const Z=b[M];return oe&&!Z?U[X]=void 0:U[X]=(Z||"").replace(/%2F/g,"/"),U},{}),pathname:E,pathnameBase:y,pattern:r}}function VJ(r,o,d){o===void 0&&(o=!1),d===void 0&&(d=!0),U2(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let u=[],m="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(y,b,P)=>(u.push({paramName:b,isOptional:P!=null}),P?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(u.push({paramName:"*"}),m+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):d?m+="\\/*$":r!==""&&r!=="/"&&(m+="(?:(?=\\/|$))"),[new RegExp(m,o?void 0:"i"),u]}function FJ(r){try{return r.split("/").map(o=>decodeURIComponent(o).replace(/\//g,"%2F")).join("/")}catch(o){return U2(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+o+").")),r}}function BC(r,o){if(o==="/")return r;if(!r.toLowerCase().startsWith(o.toLowerCase()))return null;let d=o.endsWith("/")?o.length-1:o.length,u=r.charAt(d);return u&&u!=="/"?null:r.slice(d)||"/"}function BJ(r,o){o===void 0&&(o="/");let{pathname:d,search:u="",hash:m=""}=typeof r=="string"?Yl(r):r;return{pathname:d?d.startsWith("/")?d:jJ(d,o):o,search:HJ(u),hash:KJ(m)}}function jJ(r,o){let d=o.replace(/\/+$/,"").split("/");return r.split("/").forEach(m=>{m===".."?d.length>1&&d.pop():m!=="."&&d.push(m)}),d.length>1?d.join("/"):"/"}function by(r,o,d,u){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+o+"` field ["+JSON.stringify(u)+"].  Please separate it out to the ")+("`to."+d+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function GJ(r){return r.filter((o,d)=>d===0||o.route.path&&o.route.path.length>0)}function jC(r,o){let d=GJ(r);return o?d.map((u,m)=>m===r.length-1?u.pathname:u.pathnameBase):d.map(u=>u.pathnameBase)}function GC(r,o,d,u){u===void 0&&(u=!1);let m;typeof r=="string"?m=Yl(r):(m=op({},r),Hn(!m.pathname||!m.pathname.includes("?"),by("?","pathname","search",m)),Hn(!m.pathname||!m.pathname.includes("#"),by("#","pathname","hash",m)),Hn(!m.search||!m.search.includes("#"),by("#","search","hash",m)));let E=r===""||m.pathname==="",y=E?"/":m.pathname,b;if(y==null)b=d;else{let M=o.length-1;if(!u&&y.startsWith("..")){let X=y.split("/");for(;X[0]==="..";)X.shift(),M-=1;m.pathname=X.join("/")}b=M>=0?o[M]:"/"}let P=BJ(m,b),U=y&&y!=="/"&&y.endsWith("/"),K=(E||y===".")&&d.endsWith("/");return!P.pathname.endsWith("/")&&(U||K)&&(P.pathname+="/"),P}const ec=r=>r.join("/").replace(/\/\/+/g,"/"),WJ=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),HJ=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,KJ=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function zJ(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const F2=["post","put","patch","delete"];new Set(F2);const YJ=["get",...F2];new Set(YJ);/**
 * React Router v6.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ap(){return ap=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(r[u]=d[u])}return r},ap.apply(this,arguments)}const WC=le.createContext(null),qJ=le.createContext(null),ac=le.createContext(null),EE=le.createContext(null),cc=le.createContext({outlet:null,matches:[],isDataRoute:!1}),B2=le.createContext(null);function JJ(r,o){let{relative:d}=o===void 0?{}:o;ql()||Hn(!1);let{basename:u,navigator:m}=le.useContext(ac),{hash:E,pathname:y,search:b}=G2(r,{relative:d}),P=y;return u!=="/"&&(P=y==="/"?u:ec([u,y])),m.createHref({pathname:P,search:b,hash:E})}function ql(){return le.useContext(EE)!=null}function mp(){return ql()||Hn(!1),le.useContext(EE).location}function j2(r){le.useContext(ac).static||le.useLayoutEffect(r)}function rd(){let{isDataRoute:r}=le.useContext(cc);return r?c9():XJ()}function XJ(){ql()||Hn(!1);let r=le.useContext(WC),{basename:o,future:d,navigator:u}=le.useContext(ac),{matches:m}=le.useContext(cc),{pathname:E}=mp(),y=JSON.stringify(jC(m,d.v7_relativeSplatPath)),b=le.useRef(!1);return j2(()=>{b.current=!0}),le.useCallback(function(U,K){if(K===void 0&&(K={}),!b.current)return;if(typeof U=="number"){u.go(U);return}let M=GC(U,JSON.parse(y),E,K.relative==="path");r==null&&o!=="/"&&(M.pathname=M.pathname==="/"?o:ec([o,M.pathname])),(K.replace?u.replace:u.push)(M,K.state,K)},[o,u,y,E,r])}function G2(r,o){let{relative:d}=o===void 0?{}:o,{future:u}=le.useContext(ac),{matches:m}=le.useContext(cc),{pathname:E}=mp(),y=JSON.stringify(jC(m,u.v7_relativeSplatPath));return le.useMemo(()=>GC(r,JSON.parse(y),E,d==="path"),[r,y,E,d])}function QJ(r,o){return $J(r,o)}function $J(r,o,d,u){ql()||Hn(!1);let{navigator:m}=le.useContext(ac),{matches:E}=le.useContext(cc),y=E[E.length-1],b=y?y.params:{};y&&y.pathname;let P=y?y.pathnameBase:"/";y&&y.route;let U=mp(),K;if(o){var M;let Se=typeof o=="string"?Yl(o):o;P==="/"||(M=Se.pathname)!=null&&M.startsWith(P)||Hn(!1),K=Se}else K=U;let X=K.pathname||"/",oe=X;if(P!=="/"){let Se=P.replace(/^\//,"").split("/");oe="/"+X.replace(/^\//,"").split("/").slice(Se.length).join("/")}let Z=wJ(r,{pathname:oe}),ne=i9(Z&&Z.map(Se=>Object.assign({},Se,{params:Object.assign({},b,Se.params),pathname:ec([P,m.encodeLocation?m.encodeLocation(Se.pathname).pathname:Se.pathname]),pathnameBase:Se.pathnameBase==="/"?P:ec([P,m.encodeLocation?m.encodeLocation(Se.pathnameBase).pathname:Se.pathnameBase])})),E,d,u);return o&&ne?le.createElement(EE.Provider,{value:{location:ap({pathname:"/",search:"",hash:"",state:null,key:"default"},K),navigationType:Ka.Pop}},ne):ne}function ZJ(){let r=a9(),o=zJ(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),d=r instanceof Error?r.stack:null,m={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return le.createElement(le.Fragment,null,le.createElement("h2",null,"Unexpected Application Error!"),le.createElement("h3",{style:{fontStyle:"italic"}},o),d?le.createElement("pre",{style:m},d):null,null)}const e9=le.createElement(ZJ,null);class t9 extends le.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,d){return d.location!==o.location||d.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:d.error,location:d.location,revalidation:o.revalidation||d.revalidation}}componentDidCatch(o,d){console.error("React Router caught the following error during render",o,d)}render(){return this.state.error!==void 0?le.createElement(cc.Provider,{value:this.props.routeContext},le.createElement(B2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function n9(r){let{routeContext:o,match:d,children:u}=r,m=le.useContext(WC);return m&&m.static&&m.staticContext&&(d.route.errorElement||d.route.ErrorBoundary)&&(m.staticContext._deepestRenderedBoundaryId=d.route.id),le.createElement(cc.Provider,{value:o},u)}function i9(r,o,d,u){var m;if(o===void 0&&(o=[]),d===void 0&&(d=null),u===void 0&&(u=null),r==null){var E;if((E=d)!=null&&E.errors)r=d.matches;else return null}let y=r,b=(m=d)==null?void 0:m.errors;if(b!=null){let K=y.findIndex(M=>M.route.id&&(b==null?void 0:b[M.route.id])!==void 0);K>=0||Hn(!1),y=y.slice(0,Math.min(y.length,K+1))}let P=!1,U=-1;if(d&&u&&u.v7_partialHydration)for(let K=0;K<y.length;K++){let M=y[K];if((M.route.HydrateFallback||M.route.hydrateFallbackElement)&&(U=K),M.route.id){let{loaderData:X,errors:oe}=d,Z=M.route.loader&&X[M.route.id]===void 0&&(!oe||oe[M.route.id]===void 0);if(M.route.lazy||Z){P=!0,U>=0?y=y.slice(0,U+1):y=[y[0]];break}}}return y.reduceRight((K,M,X)=>{let oe,Z=!1,ne=null,Se=null;d&&(oe=b&&M.route.id?b[M.route.id]:void 0,ne=M.route.errorElement||e9,P&&(U<0&&X===0?(Z=!0,Se=null):U===X&&(Z=!0,Se=M.route.hydrateFallbackElement||null)));let J=o.concat(y.slice(0,X+1)),H=()=>{let q;return oe?q=ne:Z?q=Se:M.route.Component?q=le.createElement(M.route.Component,null):M.route.element?q=M.route.element:q=K,le.createElement(n9,{match:M,routeContext:{outlet:K,matches:J,isDataRoute:d!=null},children:q})};return d&&(M.route.ErrorBoundary||M.route.errorElement||X===0)?le.createElement(t9,{location:d.location,revalidation:d.revalidation,component:ne,error:oe,children:H(),routeContext:{outlet:null,matches:J,isDataRoute:!0}}):H()},null)}var W2=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(W2||{}),Q_=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(Q_||{});function r9(r){let o=le.useContext(WC);return o||Hn(!1),o}function s9(r){let o=le.useContext(qJ);return o||Hn(!1),o}function o9(r){let o=le.useContext(cc);return o||Hn(!1),o}function H2(r){let o=o9(),d=o.matches[o.matches.length-1];return d.route.id||Hn(!1),d.route.id}function a9(){var r;let o=le.useContext(B2),d=s9(Q_.UseRouteError),u=H2(Q_.UseRouteError);return o!==void 0?o:(r=d.errors)==null?void 0:r[u]}function c9(){let{router:r}=r9(W2.UseNavigateStable),o=H2(Q_.UseNavigateStable),d=le.useRef(!1);return j2(()=>{d.current=!0}),le.useCallback(function(m,E){E===void 0&&(E={}),d.current&&(typeof m=="number"?r.navigate(m):r.navigate(m,ap({fromRouteId:o},E)))},[r,o])}function W1(r){let{to:o,replace:d,state:u,relative:m}=r;ql()||Hn(!1);let{future:E,static:y}=le.useContext(ac),{matches:b}=le.useContext(cc),{pathname:P}=mp(),U=rd(),K=GC(o,jC(b,E.v7_relativeSplatPath),P,m==="path"),M=JSON.stringify(K);return le.useEffect(()=>U(JSON.parse(M),{replace:d,state:u,relative:m}),[U,M,m,d,u]),null}function Hc(r){Hn(!1)}function d9(r){let{basename:o="/",children:d=null,location:u,navigationType:m=Ka.Pop,navigator:E,static:y=!1,future:b}=r;ql()&&Hn(!1);let P=o.replace(/^\/*/,"/"),U=le.useMemo(()=>({basename:P,navigator:E,static:y,future:ap({v7_relativeSplatPath:!1},b)}),[P,b,E,y]);typeof u=="string"&&(u=Yl(u));let{pathname:K="/",search:M="",hash:X="",state:oe=null,key:Z="default"}=u,ne=le.useMemo(()=>{let Se=BC(K,P);return Se==null?null:{location:{pathname:Se,search:M,hash:X,state:oe,key:Z},navigationType:m}},[P,K,M,X,oe,Z,m]);return ne==null?null:le.createElement(ac.Provider,{value:U},le.createElement(EE.Provider,{children:d,value:ne}))}function l9(r){let{children:o,location:d}=r;return QJ(kR(o),d)}new Promise(()=>{});function kR(r,o){o===void 0&&(o=[]);let d=[];return le.Children.forEach(r,(u,m)=>{if(!le.isValidElement(u))return;let E=[...o,m];if(u.type===le.Fragment){d.push.apply(d,kR(u.props.children,E));return}u.type!==Hc&&Hn(!1),!u.props.index||!u.props.children||Hn(!1);let y={id:u.props.id||E.join("-"),caseSensitive:u.props.caseSensitive,element:u.props.element,Component:u.props.Component,index:u.props.index,path:u.props.path,loader:u.props.loader,action:u.props.action,errorElement:u.props.errorElement,ErrorBoundary:u.props.ErrorBoundary,hasErrorBoundary:u.props.ErrorBoundary!=null||u.props.errorElement!=null,shouldRevalidate:u.props.shouldRevalidate,handle:u.props.handle,lazy:u.props.lazy};u.props.children&&(y.children=kR(u.props.children,E)),d.push(y)}),d}/**
 * React Router DOM v6.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function LR(){return LR=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(r[u]=d[u])}return r},LR.apply(this,arguments)}function u9(r,o){if(r==null)return{};var d={},u=Object.keys(r),m,E;for(E=0;E<u.length;E++)m=u[E],!(o.indexOf(m)>=0)&&(d[m]=r[m]);return d}function h9(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function p9(r,o){return r.button===0&&(!o||o==="_self")&&!h9(r)}const f9=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],m9="6";try{window.__reactRouterVersion=m9}catch{}const _9="startTransition",H1=uq[_9];function E9(r){let{basename:o,children:d,future:u,window:m}=r,E=le.useRef();E.current==null&&(E.current=RJ({window:m,v5Compat:!0}));let y=E.current,[b,P]=le.useState({action:y.action,location:y.location}),{v7_startTransition:U}=u||{},K=le.useCallback(M=>{U&&H1?H1(()=>P(M)):P(M)},[P,U]);return le.useLayoutEffect(()=>y.listen(K),[y,K]),le.createElement(d9,{basename:o,children:d,location:b.location,navigationType:b.action,navigator:y,future:u})}const g9=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",S9=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,K2=le.forwardRef(function(o,d){let{onClick:u,relative:m,reloadDocument:E,replace:y,state:b,target:P,to:U,preventScrollReset:K,unstable_viewTransition:M}=o,X=u9(o,f9),{basename:oe}=le.useContext(ac),Z,ne=!1;if(typeof U=="string"&&S9.test(U)&&(Z=U,g9))try{let q=new URL(window.location.href),ue=U.startsWith("//")?new URL(q.protocol+U):new URL(U),Re=BC(ue.pathname,oe);ue.origin===q.origin&&Re!=null?U=Re+ue.search+ue.hash:ne=!0}catch{}let Se=JJ(U,{relative:m}),J=T9(U,{replace:y,state:b,target:P,preventScrollReset:K,relative:m,unstable_viewTransition:M});function H(q){u&&u(q),q.defaultPrevented||J(q)}return le.createElement("a",LR({},X,{href:Z||Se,onClick:ne||E?u:H,ref:d,target:P}))});var K1;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(K1||(K1={}));var z1;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(z1||(z1={}));function T9(r,o){let{target:d,replace:u,state:m,preventScrollReset:E,relative:y,unstable_viewTransition:b}=o===void 0?{}:o,P=rd(),U=mp(),K=G2(r,{relative:y});return le.useCallback(M=>{if(p9(M,d)){M.preventDefault();let X=u!==void 0?u:X_(U)===X_(K);P(r,{replace:X,state:m,preventScrollReset:E,relative:y,unstable_viewTransition:b})}},[U,P,K,u,m,d,r,E,y,b])}function z2(r,o){return function(){return r.apply(o,arguments)}}const{toString:v9}=Object.prototype,{getPrototypeOf:HC}=Object,gE=(r=>o=>{const d=v9.call(o);return r[d]||(r[d]=d.slice(8,-1).toLowerCase())})(Object.create(null)),po=r=>(r=r.toLowerCase(),o=>gE(o)===r),SE=r=>o=>typeof o===r,{isArray:Jl}=Array,cp=SE("undefined");function y9(r){return r!==null&&!cp(r)&&r.constructor!==null&&!cp(r.constructor)&&us(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const Y2=po("ArrayBuffer");function R9(r){let o;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?o=ArrayBuffer.isView(r):o=r&&r.buffer&&Y2(r.buffer),o}const C9=SE("string"),us=SE("function"),q2=SE("number"),TE=r=>r!==null&&typeof r=="object",I9=r=>r===!0||r===!1,y_=r=>{if(gE(r)!=="object")return!1;const o=HC(r);return(o===null||o===Object.prototype||Object.getPrototypeOf(o)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},w9=po("Date"),A9=po("File"),O9=po("Blob"),b9=po("FileList"),N9=r=>TE(r)&&us(r.pipe),P9=r=>{let o;return r&&(typeof FormData=="function"&&r instanceof FormData||us(r.append)&&((o=gE(r))==="formdata"||o==="object"&&us(r.toString)&&r.toString()==="[object FormData]"))},D9=po("URLSearchParams"),k9=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function _p(r,o,{allOwnKeys:d=!1}={}){if(r===null||typeof r>"u")return;let u,m;if(typeof r!="object"&&(r=[r]),Jl(r))for(u=0,m=r.length;u<m;u++)o.call(null,r[u],u,r);else{const E=d?Object.getOwnPropertyNames(r):Object.keys(r),y=E.length;let b;for(u=0;u<y;u++)b=E[u],o.call(null,r[b],b,r)}}function J2(r,o){o=o.toLowerCase();const d=Object.keys(r);let u=d.length,m;for(;u-- >0;)if(m=d[u],o===m.toLowerCase())return m;return null}const X2=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Q2=r=>!cp(r)&&r!==X2;function MR(){const{caseless:r}=Q2(this)&&this||{},o={},d=(u,m)=>{const E=r&&J2(o,m)||m;y_(o[E])&&y_(u)?o[E]=MR(o[E],u):y_(u)?o[E]=MR({},u):Jl(u)?o[E]=u.slice():o[E]=u};for(let u=0,m=arguments.length;u<m;u++)arguments[u]&&_p(arguments[u],d);return o}const L9=(r,o,d,{allOwnKeys:u}={})=>(_p(o,(m,E)=>{d&&us(m)?r[E]=z2(m,d):r[E]=m},{allOwnKeys:u}),r),M9=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),U9=(r,o,d,u)=>{r.prototype=Object.create(o.prototype,u),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:o.prototype}),d&&Object.assign(r.prototype,d)},x9=(r,o,d,u)=>{let m,E,y;const b={};if(o=o||{},r==null)return o;do{for(m=Object.getOwnPropertyNames(r),E=m.length;E-- >0;)y=m[E],(!u||u(y,r,o))&&!b[y]&&(o[y]=r[y],b[y]=!0);r=d!==!1&&HC(r)}while(r&&(!d||d(r,o))&&r!==Object.prototype);return o},V9=(r,o,d)=>{r=String(r),(d===void 0||d>r.length)&&(d=r.length),d-=o.length;const u=r.indexOf(o,d);return u!==-1&&u===d},F9=r=>{if(!r)return null;if(Jl(r))return r;let o=r.length;if(!q2(o))return null;const d=new Array(o);for(;o-- >0;)d[o]=r[o];return d},B9=(r=>o=>r&&o instanceof r)(typeof Uint8Array<"u"&&HC(Uint8Array)),j9=(r,o)=>{const u=(r&&r[Symbol.iterator]).call(r);let m;for(;(m=u.next())&&!m.done;){const E=m.value;o.call(r,E[0],E[1])}},G9=(r,o)=>{let d;const u=[];for(;(d=r.exec(o))!==null;)u.push(d);return u},W9=po("HTMLFormElement"),H9=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(d,u,m){return u.toUpperCase()+m}),Y1=(({hasOwnProperty:r})=>(o,d)=>r.call(o,d))(Object.prototype),K9=po("RegExp"),$2=(r,o)=>{const d=Object.getOwnPropertyDescriptors(r),u={};_p(d,(m,E)=>{let y;(y=o(m,E,r))!==!1&&(u[E]=y||m)}),Object.defineProperties(r,u)},z9=r=>{$2(r,(o,d)=>{if(us(r)&&["arguments","caller","callee"].indexOf(d)!==-1)return!1;const u=r[d];if(us(u)){if(o.enumerable=!1,"writable"in o){o.writable=!1;return}o.set||(o.set=()=>{throw Error("Can not rewrite read-only method '"+d+"'")})}})},Y9=(r,o)=>{const d={},u=m=>{m.forEach(E=>{d[E]=!0})};return Jl(r)?u(r):u(String(r).split(o)),d},q9=()=>{},J9=(r,o)=>(r=+r,Number.isFinite(r)?r:o),Ny="abcdefghijklmnopqrstuvwxyz",q1="0123456789",Z2={DIGIT:q1,ALPHA:Ny,ALPHA_DIGIT:Ny+Ny.toUpperCase()+q1},X9=(r=16,o=Z2.ALPHA_DIGIT)=>{let d="";const{length:u}=o;for(;r--;)d+=o[Math.random()*u|0];return d};function Q9(r){return!!(r&&us(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const $9=r=>{const o=new Array(10),d=(u,m)=>{if(TE(u)){if(o.indexOf(u)>=0)return;if(!("toJSON"in u)){o[m]=u;const E=Jl(u)?[]:{};return _p(u,(y,b)=>{const P=d(y,m+1);!cp(P)&&(E[b]=P)}),o[m]=void 0,E}}return u};return d(r,0)},Z9=po("AsyncFunction"),eX=r=>r&&(TE(r)||us(r))&&us(r.then)&&us(r.catch),_e={isArray:Jl,isArrayBuffer:Y2,isBuffer:y9,isFormData:P9,isArrayBufferView:R9,isString:C9,isNumber:q2,isBoolean:I9,isObject:TE,isPlainObject:y_,isUndefined:cp,isDate:w9,isFile:A9,isBlob:O9,isRegExp:K9,isFunction:us,isStream:N9,isURLSearchParams:D9,isTypedArray:B9,isFileList:b9,forEach:_p,merge:MR,extend:L9,trim:k9,stripBOM:M9,inherits:U9,toFlatObject:x9,kindOf:gE,kindOfTest:po,endsWith:V9,toArray:F9,forEachEntry:j9,matchAll:G9,isHTMLForm:W9,hasOwnProperty:Y1,hasOwnProp:Y1,reduceDescriptors:$2,freezeMethods:z9,toObjectSet:Y9,toCamelCase:H9,noop:q9,toFiniteNumber:J9,findKey:J2,global:X2,isContextDefined:Q2,ALPHABET:Z2,generateString:X9,isSpecCompliantForm:Q9,toJSONObject:$9,isAsyncFn:Z9,isThenable:eX};function kt(r,o,d,u,m){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",o&&(this.code=o),d&&(this.config=d),u&&(this.request=u),m&&(this.response=m)}_e.inherits(kt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:_e.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const ex=kt.prototype,tx={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{tx[r]={value:r}});Object.defineProperties(kt,tx);Object.defineProperty(ex,"isAxiosError",{value:!0});kt.from=(r,o,d,u,m,E)=>{const y=Object.create(ex);return _e.toFlatObject(r,y,function(P){return P!==Error.prototype},b=>b!=="isAxiosError"),kt.call(y,r.message,o,d,u,m),y.cause=r,y.name=r.name,E&&Object.assign(y,E),y};const tX=null;function UR(r){return _e.isPlainObject(r)||_e.isArray(r)}function nx(r){return _e.endsWith(r,"[]")?r.slice(0,-2):r}function J1(r,o,d){return r?r.concat(o).map(function(m,E){return m=nx(m),!d&&E?"["+m+"]":m}).join(d?".":""):o}function nX(r){return _e.isArray(r)&&!r.some(UR)}const iX=_e.toFlatObject(_e,{},null,function(o){return/^is[A-Z]/.test(o)});function vE(r,o,d){if(!_e.isObject(r))throw new TypeError("target must be an object");o=o||new FormData,d=_e.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ne,Se){return!_e.isUndefined(Se[ne])});const u=d.metaTokens,m=d.visitor||K,E=d.dots,y=d.indexes,P=(d.Blob||typeof Blob<"u"&&Blob)&&_e.isSpecCompliantForm(o);if(!_e.isFunction(m))throw new TypeError("visitor must be a function");function U(Z){if(Z===null)return"";if(_e.isDate(Z))return Z.toISOString();if(!P&&_e.isBlob(Z))throw new kt("Blob is not supported. Use a Buffer instead.");return _e.isArrayBuffer(Z)||_e.isTypedArray(Z)?P&&typeof Blob=="function"?new Blob([Z]):Buffer.from(Z):Z}function K(Z,ne,Se){let J=Z;if(Z&&!Se&&typeof Z=="object"){if(_e.endsWith(ne,"{}"))ne=u?ne:ne.slice(0,-2),Z=JSON.stringify(Z);else if(_e.isArray(Z)&&nX(Z)||(_e.isFileList(Z)||_e.endsWith(ne,"[]"))&&(J=_e.toArray(Z)))return ne=nx(ne),J.forEach(function(q,ue){!(_e.isUndefined(q)||q===null)&&o.append(y===!0?J1([ne],ue,E):y===null?ne:ne+"[]",U(q))}),!1}return UR(Z)?!0:(o.append(J1(Se,ne,E),U(Z)),!1)}const M=[],X=Object.assign(iX,{defaultVisitor:K,convertValue:U,isVisitable:UR});function oe(Z,ne){if(!_e.isUndefined(Z)){if(M.indexOf(Z)!==-1)throw Error("Circular reference detected in "+ne.join("."));M.push(Z),_e.forEach(Z,function(J,H){(!(_e.isUndefined(J)||J===null)&&m.call(o,J,_e.isString(H)?H.trim():H,ne,X))===!0&&oe(J,ne?ne.concat(H):[H])}),M.pop()}}if(!_e.isObject(r))throw new TypeError("data must be an object");return oe(r),o}function X1(r){const o={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(u){return o[u]})}function KC(r,o){this._pairs=[],r&&vE(r,this,o)}const ix=KC.prototype;ix.append=function(o,d){this._pairs.push([o,d])};ix.toString=function(o){const d=o?function(u){return o.call(this,u,X1)}:X1;return this._pairs.map(function(m){return d(m[0])+"="+d(m[1])},"").join("&")};function rX(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function rx(r,o,d){if(!o)return r;const u=d&&d.encode||rX,m=d&&d.serialize;let E;if(m?E=m(o,d):E=_e.isURLSearchParams(o)?o.toString():new KC(o,d).toString(u),E){const y=r.indexOf("#");y!==-1&&(r=r.slice(0,y)),r+=(r.indexOf("?")===-1?"?":"&")+E}return r}class Q1{constructor(){this.handlers=[]}use(o,d,u){return this.handlers.push({fulfilled:o,rejected:d,synchronous:u?u.synchronous:!1,runWhen:u?u.runWhen:null}),this.handlers.length-1}eject(o){this.handlers[o]&&(this.handlers[o]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(o){_e.forEach(this.handlers,function(u){u!==null&&o(u)})}}const sx={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},sX=typeof URLSearchParams<"u"?URLSearchParams:KC,oX=typeof FormData<"u"?FormData:null,aX=typeof Blob<"u"?Blob:null,cX={isBrowser:!0,classes:{URLSearchParams:sX,FormData:oX,Blob:aX},protocols:["http","https","file","blob","url","data"]},ox=typeof window<"u"&&typeof document<"u",dX=(r=>ox&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),lX=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",uX=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ox,hasStandardBrowserEnv:dX,hasStandardBrowserWebWorkerEnv:lX},Symbol.toStringTag,{value:"Module"})),ao={...uX,...cX};function hX(r,o){return vE(r,new ao.classes.URLSearchParams,Object.assign({visitor:function(d,u,m,E){return ao.isNode&&_e.isBuffer(d)?(this.append(u,d.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},o))}function pX(r){return _e.matchAll(/\w+|\[(\w*)]/g,r).map(o=>o[0]==="[]"?"":o[1]||o[0])}function fX(r){const o={},d=Object.keys(r);let u;const m=d.length;let E;for(u=0;u<m;u++)E=d[u],o[E]=r[E];return o}function ax(r){function o(d,u,m,E){let y=d[E++];if(y==="__proto__")return!0;const b=Number.isFinite(+y),P=E>=d.length;return y=!y&&_e.isArray(m)?m.length:y,P?(_e.hasOwnProp(m,y)?m[y]=[m[y],u]:m[y]=u,!b):((!m[y]||!_e.isObject(m[y]))&&(m[y]=[]),o(d,u,m[y],E)&&_e.isArray(m[y])&&(m[y]=fX(m[y])),!b)}if(_e.isFormData(r)&&_e.isFunction(r.entries)){const d={};return _e.forEachEntry(r,(u,m)=>{o(pX(u),m,d,0)}),d}return null}function mX(r,o,d){if(_e.isString(r))try{return(o||JSON.parse)(r),_e.trim(r)}catch(u){if(u.name!=="SyntaxError")throw u}return(d||JSON.stringify)(r)}const Ep={transitional:sx,adapter:["xhr","http"],transformRequest:[function(o,d){const u=d.getContentType()||"",m=u.indexOf("application/json")>-1,E=_e.isObject(o);if(E&&_e.isHTMLForm(o)&&(o=new FormData(o)),_e.isFormData(o))return m?JSON.stringify(ax(o)):o;if(_e.isArrayBuffer(o)||_e.isBuffer(o)||_e.isStream(o)||_e.isFile(o)||_e.isBlob(o))return o;if(_e.isArrayBufferView(o))return o.buffer;if(_e.isURLSearchParams(o))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),o.toString();let b;if(E){if(u.indexOf("application/x-www-form-urlencoded")>-1)return hX(o,this.formSerializer).toString();if((b=_e.isFileList(o))||u.indexOf("multipart/form-data")>-1){const P=this.env&&this.env.FormData;return vE(b?{"files[]":o}:o,P&&new P,this.formSerializer)}}return E||m?(d.setContentType("application/json",!1),mX(o)):o}],transformResponse:[function(o){const d=this.transitional||Ep.transitional,u=d&&d.forcedJSONParsing,m=this.responseType==="json";if(o&&_e.isString(o)&&(u&&!this.responseType||m)){const y=!(d&&d.silentJSONParsing)&&m;try{return JSON.parse(o)}catch(b){if(y)throw b.name==="SyntaxError"?kt.from(b,kt.ERR_BAD_RESPONSE,this,null,this.response):b}}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ao.classes.FormData,Blob:ao.classes.Blob},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};_e.forEach(["delete","get","head","post","put","patch"],r=>{Ep.headers[r]={}});const _X=_e.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),EX=r=>{const o={};let d,u,m;return r&&r.split(`
`).forEach(function(y){m=y.indexOf(":"),d=y.substring(0,m).trim().toLowerCase(),u=y.substring(m+1).trim(),!(!d||o[d]&&_X[d])&&(d==="set-cookie"?o[d]?o[d].push(u):o[d]=[u]:o[d]=o[d]?o[d]+", "+u:u)}),o},$1=Symbol("internals");function Ch(r){return r&&String(r).trim().toLowerCase()}function R_(r){return r===!1||r==null?r:_e.isArray(r)?r.map(R_):String(r)}function gX(r){const o=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=d.exec(r);)o[u[1]]=u[2];return o}const SX=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Py(r,o,d,u,m){if(_e.isFunction(u))return u.call(this,o,d);if(m&&(o=d),!!_e.isString(o)){if(_e.isString(u))return o.indexOf(u)!==-1;if(_e.isRegExp(u))return u.test(o)}}function TX(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(o,d,u)=>d.toUpperCase()+u)}function vX(r,o){const d=_e.toCamelCase(" "+o);["get","set","has"].forEach(u=>{Object.defineProperty(r,u+d,{value:function(m,E,y){return this[u].call(this,o,m,E,y)},configurable:!0})})}class hs{constructor(o){o&&this.set(o)}set(o,d,u){const m=this;function E(b,P,U){const K=Ch(P);if(!K)throw new Error("header name must be a non-empty string");const M=_e.findKey(m,K);(!M||m[M]===void 0||U===!0||U===void 0&&m[M]!==!1)&&(m[M||P]=R_(b))}const y=(b,P)=>_e.forEach(b,(U,K)=>E(U,K,P));return _e.isPlainObject(o)||o instanceof this.constructor?y(o,d):_e.isString(o)&&(o=o.trim())&&!SX(o)?y(EX(o),d):o!=null&&E(d,o,u),this}get(o,d){if(o=Ch(o),o){const u=_e.findKey(this,o);if(u){const m=this[u];if(!d)return m;if(d===!0)return gX(m);if(_e.isFunction(d))return d.call(this,m,u);if(_e.isRegExp(d))return d.exec(m);throw new TypeError("parser must be boolean|regexp|function")}}}has(o,d){if(o=Ch(o),o){const u=_e.findKey(this,o);return!!(u&&this[u]!==void 0&&(!d||Py(this,this[u],u,d)))}return!1}delete(o,d){const u=this;let m=!1;function E(y){if(y=Ch(y),y){const b=_e.findKey(u,y);b&&(!d||Py(u,u[b],b,d))&&(delete u[b],m=!0)}}return _e.isArray(o)?o.forEach(E):E(o),m}clear(o){const d=Object.keys(this);let u=d.length,m=!1;for(;u--;){const E=d[u];(!o||Py(this,this[E],E,o,!0))&&(delete this[E],m=!0)}return m}normalize(o){const d=this,u={};return _e.forEach(this,(m,E)=>{const y=_e.findKey(u,E);if(y){d[y]=R_(m),delete d[E];return}const b=o?TX(E):String(E).trim();b!==E&&delete d[E],d[b]=R_(m),u[b]=!0}),this}concat(...o){return this.constructor.concat(this,...o)}toJSON(o){const d=Object.create(null);return _e.forEach(this,(u,m)=>{u!=null&&u!==!1&&(d[m]=o&&_e.isArray(u)?u.join(", "):u)}),d}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([o,d])=>o+": "+d).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(o){return o instanceof this?o:new this(o)}static concat(o,...d){const u=new this(o);return d.forEach(m=>u.set(m)),u}static accessor(o){const u=(this[$1]=this[$1]={accessors:{}}).accessors,m=this.prototype;function E(y){const b=Ch(y);u[b]||(vX(m,y),u[b]=!0)}return _e.isArray(o)?o.forEach(E):E(o),this}}hs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);_e.reduceDescriptors(hs.prototype,({value:r},o)=>{let d=o[0].toUpperCase()+o.slice(1);return{get:()=>r,set(u){this[d]=u}}});_e.freezeMethods(hs);function Dy(r,o){const d=this||Ep,u=o||d,m=hs.from(u.headers);let E=u.data;return _e.forEach(r,function(b){E=b.call(d,E,m.normalize(),o?o.status:void 0)}),m.normalize(),E}function cx(r){return!!(r&&r.__CANCEL__)}function gp(r,o,d){kt.call(this,r??"canceled",kt.ERR_CANCELED,o,d),this.name="CanceledError"}_e.inherits(gp,kt,{__CANCEL__:!0});function yX(r,o,d){const u=d.config.validateStatus;!d.status||!u||u(d.status)?r(d):o(new kt("Request failed with status code "+d.status,[kt.ERR_BAD_REQUEST,kt.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d))}const RX=ao.hasStandardBrowserEnv?{write(r,o,d,u,m,E){const y=[r+"="+encodeURIComponent(o)];_e.isNumber(d)&&y.push("expires="+new Date(d).toGMTString()),_e.isString(u)&&y.push("path="+u),_e.isString(m)&&y.push("domain="+m),E===!0&&y.push("secure"),document.cookie=y.join("; ")},read(r){const o=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return o?decodeURIComponent(o[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function CX(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function IX(r,o){return o?r.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):r}function dx(r,o){return r&&!CX(o)?IX(r,o):o}const wX=ao.hasStandardBrowserEnv?function(){const o=/(msie|trident)/i.test(navigator.userAgent),d=document.createElement("a");let u;function m(E){let y=E;return o&&(d.setAttribute("href",y),y=d.href),d.setAttribute("href",y),{href:d.href,protocol:d.protocol?d.protocol.replace(/:$/,""):"",host:d.host,search:d.search?d.search.replace(/^\?/,""):"",hash:d.hash?d.hash.replace(/^#/,""):"",hostname:d.hostname,port:d.port,pathname:d.pathname.charAt(0)==="/"?d.pathname:"/"+d.pathname}}return u=m(window.location.href),function(y){const b=_e.isString(y)?m(y):y;return b.protocol===u.protocol&&b.host===u.host}}():function(){return function(){return!0}}();function AX(r){const o=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return o&&o[1]||""}function OX(r,o){r=r||10;const d=new Array(r),u=new Array(r);let m=0,E=0,y;return o=o!==void 0?o:1e3,function(P){const U=Date.now(),K=u[E];y||(y=U),d[m]=P,u[m]=U;let M=E,X=0;for(;M!==m;)X+=d[M++],M=M%r;if(m=(m+1)%r,m===E&&(E=(E+1)%r),U-y<o)return;const oe=K&&U-K;return oe?Math.round(X*1e3/oe):void 0}}function Z1(r,o){let d=0;const u=OX(50,250);return m=>{const E=m.loaded,y=m.lengthComputable?m.total:void 0,b=E-d,P=u(b),U=E<=y;d=E;const K={loaded:E,total:y,progress:y?E/y:void 0,bytes:b,rate:P||void 0,estimated:P&&y&&U?(y-E)/P:void 0,event:m};K[o?"download":"upload"]=!0,r(K)}}const bX=typeof XMLHttpRequest<"u",NX=bX&&function(r){return new Promise(function(d,u){let m=r.data;const E=hs.from(r.headers).normalize();let{responseType:y,withXSRFToken:b}=r,P;function U(){r.cancelToken&&r.cancelToken.unsubscribe(P),r.signal&&r.signal.removeEventListener("abort",P)}let K;if(_e.isFormData(m)){if(ao.hasStandardBrowserEnv||ao.hasStandardBrowserWebWorkerEnv)E.setContentType(!1);else if((K=E.getContentType())!==!1){const[ne,...Se]=K?K.split(";").map(J=>J.trim()).filter(Boolean):[];E.setContentType([ne||"multipart/form-data",...Se].join("; "))}}let M=new XMLHttpRequest;if(r.auth){const ne=r.auth.username||"",Se=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";E.set("Authorization","Basic "+btoa(ne+":"+Se))}const X=dx(r.baseURL,r.url);M.open(r.method.toUpperCase(),rx(X,r.params,r.paramsSerializer),!0),M.timeout=r.timeout;function oe(){if(!M)return;const ne=hs.from("getAllResponseHeaders"in M&&M.getAllResponseHeaders()),J={data:!y||y==="text"||y==="json"?M.responseText:M.response,status:M.status,statusText:M.statusText,headers:ne,config:r,request:M};yX(function(q){d(q),U()},function(q){u(q),U()},J),M=null}if("onloadend"in M?M.onloadend=oe:M.onreadystatechange=function(){!M||M.readyState!==4||M.status===0&&!(M.responseURL&&M.responseURL.indexOf("file:")===0)||setTimeout(oe)},M.onabort=function(){M&&(u(new kt("Request aborted",kt.ECONNABORTED,r,M)),M=null)},M.onerror=function(){u(new kt("Network Error",kt.ERR_NETWORK,r,M)),M=null},M.ontimeout=function(){let Se=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const J=r.transitional||sx;r.timeoutErrorMessage&&(Se=r.timeoutErrorMessage),u(new kt(Se,J.clarifyTimeoutError?kt.ETIMEDOUT:kt.ECONNABORTED,r,M)),M=null},ao.hasStandardBrowserEnv&&(b&&_e.isFunction(b)&&(b=b(r)),b||b!==!1&&wX(X))){const ne=r.xsrfHeaderName&&r.xsrfCookieName&&RX.read(r.xsrfCookieName);ne&&E.set(r.xsrfHeaderName,ne)}m===void 0&&E.setContentType(null),"setRequestHeader"in M&&_e.forEach(E.toJSON(),function(Se,J){M.setRequestHeader(J,Se)}),_e.isUndefined(r.withCredentials)||(M.withCredentials=!!r.withCredentials),y&&y!=="json"&&(M.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&M.addEventListener("progress",Z1(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&M.upload&&M.upload.addEventListener("progress",Z1(r.onUploadProgress)),(r.cancelToken||r.signal)&&(P=ne=>{M&&(u(!ne||ne.type?new gp(null,r,M):ne),M.abort(),M=null)},r.cancelToken&&r.cancelToken.subscribe(P),r.signal&&(r.signal.aborted?P():r.signal.addEventListener("abort",P)));const Z=AX(X);if(Z&&ao.protocols.indexOf(Z)===-1){u(new kt("Unsupported protocol "+Z+":",kt.ERR_BAD_REQUEST,r));return}M.send(m||null)})},xR={http:tX,xhr:NX};_e.forEach(xR,(r,o)=>{if(r){try{Object.defineProperty(r,"name",{value:o})}catch{}Object.defineProperty(r,"adapterName",{value:o})}});const eM=r=>`- ${r}`,PX=r=>_e.isFunction(r)||r===null||r===!1,lx={getAdapter:r=>{r=_e.isArray(r)?r:[r];const{length:o}=r;let d,u;const m={};for(let E=0;E<o;E++){d=r[E];let y;if(u=d,!PX(d)&&(u=xR[(y=String(d)).toLowerCase()],u===void 0))throw new kt(`Unknown adapter '${y}'`);if(u)break;m[y||"#"+E]=u}if(!u){const E=Object.entries(m).map(([b,P])=>`adapter ${b} `+(P===!1?"is not supported by the environment":"is not available in the build"));let y=o?E.length>1?`since :
`+E.map(eM).join(`
`):" "+eM(E[0]):"as no adapter specified";throw new kt("There is no suitable adapter to dispatch the request "+y,"ERR_NOT_SUPPORT")}return u},adapters:xR};function ky(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new gp(null,r)}function tM(r){return ky(r),r.headers=hs.from(r.headers),r.data=Dy.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),lx.getAdapter(r.adapter||Ep.adapter)(r).then(function(u){return ky(r),u.data=Dy.call(r,r.transformResponse,u),u.headers=hs.from(u.headers),u},function(u){return cx(u)||(ky(r),u&&u.response&&(u.response.data=Dy.call(r,r.transformResponse,u.response),u.response.headers=hs.from(u.response.headers))),Promise.reject(u)})}const nM=r=>r instanceof hs?{...r}:r;function Wl(r,o){o=o||{};const d={};function u(U,K,M){return _e.isPlainObject(U)&&_e.isPlainObject(K)?_e.merge.call({caseless:M},U,K):_e.isPlainObject(K)?_e.merge({},K):_e.isArray(K)?K.slice():K}function m(U,K,M){if(_e.isUndefined(K)){if(!_e.isUndefined(U))return u(void 0,U,M)}else return u(U,K,M)}function E(U,K){if(!_e.isUndefined(K))return u(void 0,K)}function y(U,K){if(_e.isUndefined(K)){if(!_e.isUndefined(U))return u(void 0,U)}else return u(void 0,K)}function b(U,K,M){if(M in o)return u(U,K);if(M in r)return u(void 0,U)}const P={url:E,method:E,data:E,baseURL:y,transformRequest:y,transformResponse:y,paramsSerializer:y,timeout:y,timeoutMessage:y,withCredentials:y,withXSRFToken:y,adapter:y,responseType:y,xsrfCookieName:y,xsrfHeaderName:y,onUploadProgress:y,onDownloadProgress:y,decompress:y,maxContentLength:y,maxBodyLength:y,beforeRedirect:y,transport:y,httpAgent:y,httpsAgent:y,cancelToken:y,socketPath:y,responseEncoding:y,validateStatus:b,headers:(U,K)=>m(nM(U),nM(K),!0)};return _e.forEach(Object.keys(Object.assign({},r,o)),function(K){const M=P[K]||m,X=M(r[K],o[K],K);_e.isUndefined(X)&&M!==b||(d[K]=X)}),d}const ux="1.6.8",zC={};["object","boolean","number","function","string","symbol"].forEach((r,o)=>{zC[r]=function(u){return typeof u===r||"a"+(o<1?"n ":" ")+r}});const iM={};zC.transitional=function(o,d,u){function m(E,y){return"[Axios v"+ux+"] Transitional option '"+E+"'"+y+(u?". "+u:"")}return(E,y,b)=>{if(o===!1)throw new kt(m(y," has been removed"+(d?" in "+d:"")),kt.ERR_DEPRECATED);return d&&!iM[y]&&(iM[y]=!0,console.warn(m(y," has been deprecated since v"+d+" and will be removed in the near future"))),o?o(E,y,b):!0}};function DX(r,o,d){if(typeof r!="object")throw new kt("options must be an object",kt.ERR_BAD_OPTION_VALUE);const u=Object.keys(r);let m=u.length;for(;m-- >0;){const E=u[m],y=o[E];if(y){const b=r[E],P=b===void 0||y(b,E,r);if(P!==!0)throw new kt("option "+E+" must be "+P,kt.ERR_BAD_OPTION_VALUE);continue}if(d!==!0)throw new kt("Unknown option "+E,kt.ERR_BAD_OPTION)}}const VR={assertOptions:DX,validators:zC},Va=VR.validators;class Xc{constructor(o){this.defaults=o,this.interceptors={request:new Q1,response:new Q1}}async request(o,d){try{return await this._request(o,d)}catch(u){if(u instanceof Error){let m;Error.captureStackTrace?Error.captureStackTrace(m={}):m=new Error;const E=m.stack?m.stack.replace(/^.+\n/,""):"";u.stack?E&&!String(u.stack).endsWith(E.replace(/^.+\n.+\n/,""))&&(u.stack+=`
`+E):u.stack=E}throw u}}_request(o,d){typeof o=="string"?(d=d||{},d.url=o):d=o||{},d=Wl(this.defaults,d);const{transitional:u,paramsSerializer:m,headers:E}=d;u!==void 0&&VR.assertOptions(u,{silentJSONParsing:Va.transitional(Va.boolean),forcedJSONParsing:Va.transitional(Va.boolean),clarifyTimeoutError:Va.transitional(Va.boolean)},!1),m!=null&&(_e.isFunction(m)?d.paramsSerializer={serialize:m}:VR.assertOptions(m,{encode:Va.function,serialize:Va.function},!0)),d.method=(d.method||this.defaults.method||"get").toLowerCase();let y=E&&_e.merge(E.common,E[d.method]);E&&_e.forEach(["delete","get","head","post","put","patch","common"],Z=>{delete E[Z]}),d.headers=hs.concat(y,E);const b=[];let P=!0;this.interceptors.request.forEach(function(ne){typeof ne.runWhen=="function"&&ne.runWhen(d)===!1||(P=P&&ne.synchronous,b.unshift(ne.fulfilled,ne.rejected))});const U=[];this.interceptors.response.forEach(function(ne){U.push(ne.fulfilled,ne.rejected)});let K,M=0,X;if(!P){const Z=[tM.bind(this),void 0];for(Z.unshift.apply(Z,b),Z.push.apply(Z,U),X=Z.length,K=Promise.resolve(d);M<X;)K=K.then(Z[M++],Z[M++]);return K}X=b.length;let oe=d;for(M=0;M<X;){const Z=b[M++],ne=b[M++];try{oe=Z(oe)}catch(Se){ne.call(this,Se);break}}try{K=tM.call(this,oe)}catch(Z){return Promise.reject(Z)}for(M=0,X=U.length;M<X;)K=K.then(U[M++],U[M++]);return K}getUri(o){o=Wl(this.defaults,o);const d=dx(o.baseURL,o.url);return rx(d,o.params,o.paramsSerializer)}}_e.forEach(["delete","get","head","options"],function(o){Xc.prototype[o]=function(d,u){return this.request(Wl(u||{},{method:o,url:d,data:(u||{}).data}))}});_e.forEach(["post","put","patch"],function(o){function d(u){return function(E,y,b){return this.request(Wl(b||{},{method:o,headers:u?{"Content-Type":"multipart/form-data"}:{},url:E,data:y}))}}Xc.prototype[o]=d(),Xc.prototype[o+"Form"]=d(!0)});class YC{constructor(o){if(typeof o!="function")throw new TypeError("executor must be a function.");let d;this.promise=new Promise(function(E){d=E});const u=this;this.promise.then(m=>{if(!u._listeners)return;let E=u._listeners.length;for(;E-- >0;)u._listeners[E](m);u._listeners=null}),this.promise.then=m=>{let E;const y=new Promise(b=>{u.subscribe(b),E=b}).then(m);return y.cancel=function(){u.unsubscribe(E)},y},o(function(E,y,b){u.reason||(u.reason=new gp(E,y,b),d(u.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(o){if(this.reason){o(this.reason);return}this._listeners?this._listeners.push(o):this._listeners=[o]}unsubscribe(o){if(!this._listeners)return;const d=this._listeners.indexOf(o);d!==-1&&this._listeners.splice(d,1)}static source(){let o;return{token:new YC(function(m){o=m}),cancel:o}}}function kX(r){return function(d){return r.apply(null,d)}}function LX(r){return _e.isObject(r)&&r.isAxiosError===!0}const FR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(FR).forEach(([r,o])=>{FR[o]=r});function hx(r){const o=new Xc(r),d=z2(Xc.prototype.request,o);return _e.extend(d,Xc.prototype,o,{allOwnKeys:!0}),_e.extend(d,o,null,{allOwnKeys:!0}),d.create=function(m){return hx(Wl(r,m))},d}const Kt=hx(Ep);Kt.Axios=Xc;Kt.CanceledError=gp;Kt.CancelToken=YC;Kt.isCancel=cx;Kt.VERSION=ux;Kt.toFormData=vE;Kt.AxiosError=kt;Kt.Cancel=Kt.CanceledError;Kt.all=function(o){return Promise.all(o)};Kt.spread=kX;Kt.isAxiosError=LX;Kt.mergeConfig=Wl;Kt.AxiosHeaders=hs;Kt.formToJSON=r=>ax(_e.isHTMLForm(r)?new FormData(r):r);Kt.getAdapter=lx.getAdapter;Kt.HttpStatusCode=FR;Kt.default=Kt;const qC="/assets/Echo-WRFRdSHk.png";function MX(){const r=rd(),[o,d]=le.useState({username:"",email:"",password:""}),[u,m]=le.useState("");le.useEffect(()=>{localStorage.getItem("token")&&r("/home");const U=setInterval(E,300);return()=>clearInterval(U)},[r]);function E(){const P=document.createElement("div");P.classList.add("bubble");let U=Math.random()*15+10;P.style.width=`${U}px`,P.style.height=P.style.width,P.style.left=`${Math.random()*100}%`,P.style.opacity=Math.random()*.5+.5,document.querySelector(".background-static").appendChild(P),setTimeout(()=>{P.remove()},1e4)}const y=P=>{d({...o,[P.target.name]:P.target.value})},b=async P=>{P.preventDefault();try{await Kt.post("http://3.142.174.77:4000/register",o),r("/login")}catch(U){U.response.data.error?(console.log(U),m(U.response.data.error)):m("An error occurred. Please try again."),console.error(U)}};return ce.jsxs("div",{className:"background-static",children:[ce.jsx("div",{className:"App-header",children:ce.jsx("img",{src:qC,className:"App-logo",alt:"logo"})}),ce.jsxs("div",{className:"form-container",children:[ce.jsx("h1",{children:"Register"}),u&&ce.jsx("p",{style:{color:"red"},children:u}),ce.jsxs("form",{onSubmit:b,children:[ce.jsx("input",{type:"text",name:"username",placeholder:"Username",value:o.username,onChange:y}),ce.jsx("br",{}),ce.jsx("input",{type:"email",name:"email",placeholder:"Email",value:o.email,onChange:y}),ce.jsx("br",{}),ce.jsx("input",{type:"password",name:"password",placeholder:"Password",value:o.password,onChange:y}),ce.jsx("br",{}),ce.jsx("button",{className:"form-button",type:"submit",children:"Register"})]}),ce.jsxs("p",{children:["Already have an account? ",ce.jsx(K2,{to:"/login",children:"Login here"})]})]})]})}function UX(){const r=rd(),[o,d]=le.useState({email:"",password:""}),[u,m]=le.useState("");le.useEffect(()=>{document.body.style.overflow="hidden";const P=localStorage.getItem("token");if(P){const K=JSON.parse(atob(P.split(".")[1])),M=Math.floor(Date.now()/1e3);K.exp<M?localStorage.removeItem("token"):r("/home")}const U=setInterval(E,300);return()=>clearInterval(U)},[r]);function E(){const P=document.createElement("div");P.classList.add("bubble");let U=Math.random()*15+10;P.style.width=`${U}px`,P.style.height=P.style.width,P.style.left=`${Math.random()*100}%`,P.style.opacity=Math.random()*.5+.5,document.querySelector(".background").appendChild(P),setTimeout(()=>{P.remove()},1e4)}const y=P=>{d({...o,[P.target.name]:P.target.value})},b=async P=>{P.preventDefault();try{const U=await Kt.post("http://3.142.174.77:4000/login",o);localStorage.setItem("token",U.data.token),localStorage.setItem("username",U.data.username),r("/home")}catch(U){U.response&&U.response.data.error?m(U.response.data.error):m("An error occurred. Please try again.")}};return ce.jsxs(ce.Fragment,{children:[ce.jsx("div",{className:"background",children:ce.jsx("div",{className:"App-header",children:ce.jsx("img",{src:qC,className:"App-logo",alt:"logo"})})}),ce.jsxs("div",{className:"form-container-2",children:[ce.jsx("h1",{children:"Login"}),u&&ce.jsx("p",{style:{color:"red"},children:u}),ce.jsxs("form",{onSubmit:b,children:[ce.jsx("input",{type:"email",name:"email",placeholder:"Email",value:o.email,onChange:y}),ce.jsx("br",{}),ce.jsx("input",{type:"password",name:"password",placeholder:"Password",value:o.password,onChange:y}),ce.jsx("br",{}),ce.jsx("button",{className:"form-button",type:"submit",children:"Login"})]}),ce.jsxs("p",{children:["Don't have an account? ",ce.jsx(K2,{to:"/register",children:"Register here"})]})]})]})}function xX(){const r=rd(),[o,d]=le.useState(""),[u,m]=le.useState(""),E=localStorage.getItem("username"),y=localStorage.getItem("token");le.useEffect(()=>{document.body.style.overflow="hidden",y||r("/login");const M=setInterval(b,300);return()=>clearInterval(M)},[y,r]);function b(){const M=document.createElement("div");M.classList.add("bubble");let X=Math.random()*15+10;M.style.width=`${X}px`,M.style.height=M.style.width,M.style.left=`${Math.random()*100}%`,M.style.opacity=Math.random()*.5+.5,document.querySelector(".background-static-home").appendChild(M),setTimeout(()=>{M.remove()},1e4)}const P=async M=>{M.preventDefault();try{const oe=(await Kt.post("http://3.142.174.77:4000/home",{username:E},{headers:{Authorization:`Bearer ${y}`}})).data.newRoom._id;localStorage.setItem("room-ID",oe),r(`/editor/${oe}/room`)}catch{d("Something went wrong. Please try again!")}},U=async M=>{M.preventDefault();try{const oe=(await Kt.post("http://3.142.174.77:4000/home/join",{roomId:u,username:E},{headers:{Authorization:`Bearer ${y}`}})).data.room._id;localStorage.setItem("room-ID",oe),r(`/editor/${oe}/room`)}catch{d("Something went wrong. Please try again!")}},K=async M=>{var X,oe;M.preventDefault();try{const Z=await Kt.delete(`http://3.142.174.77:4000/deleteuser/${E}`,{headers:{Authorization:`Bearer ${y}`}});localStorage.removeItem("token"),r("/login")}catch(Z){d("Something went wrong. Please try again!"),console.log(((oe=(X=Z.response)==null?void 0:X.data)==null?void 0:oe.error)||"An error occurred while deleting the user")}};return ce.jsxs("div",{className:"background-static-home",children:[ce.jsx("div",{className:"App-header",children:ce.jsx("img",{src:qC,className:"App-logo",alt:"logo"})}),ce.jsx("div",{className:"form-container",children:ce.jsxs("ul",{children:[ce.jsxs("h2",{children:["Welcome, ",E,"!"]}),ce.jsxs("form",{onSubmit:U,children:[ce.jsxs("li",{children:["Room ID:",ce.jsx("br",{}),ce.jsx("input",{id:"room-id",value:u,onChange:M=>m(M.target.value)})," "]}),ce.jsx("br",{}),ce.jsx("button",{type:"submit",children:"Join Room"})]}),ce.jsxs("li",{children:[ce.jsx("li",{children:ce.jsx("form",{onSubmit:P,children:ce.jsx("button",{type:"submit",children:"Create New Room"})})}),ce.jsx("button",{className:"bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded",onClick:()=>{localStorage.removeItem("token"),r("/login")},children:"Sign Out"})]}),ce.jsx("div",{className:"mt-4",children:ce.jsx("button",{className:"bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded",onClick:K,children:"Delete User"})}),ce.jsx("p",{children:o})]})})]})}function VX(r,o,d){return o in r?Object.defineProperty(r,o,{value:d,enumerable:!0,configurable:!0,writable:!0}):r[o]=d,r}function rM(r,o){var d=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(m){return Object.getOwnPropertyDescriptor(r,m).enumerable})),d.push.apply(d,u)}return d}function sM(r){for(var o=1;o<arguments.length;o++){var d=arguments[o]!=null?arguments[o]:{};o%2?rM(Object(d),!0).forEach(function(u){VX(r,u,d[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(d)):rM(Object(d)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(d,u))})}return r}function FX(r,o){if(r==null)return{};var d={},u=Object.keys(r),m,E;for(E=0;E<u.length;E++)m=u[E],!(o.indexOf(m)>=0)&&(d[m]=r[m]);return d}function BX(r,o){if(r==null)return{};var d=FX(r,o),u,m;if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(r);for(m=0;m<E.length;m++)u=E[m],!(o.indexOf(u)>=0)&&Object.prototype.propertyIsEnumerable.call(r,u)&&(d[u]=r[u])}return d}function jX(r,o){return GX(r)||WX(r,o)||HX(r,o)||KX()}function GX(r){if(Array.isArray(r))return r}function WX(r,o){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(r)))){var d=[],u=!0,m=!1,E=void 0;try{for(var y=r[Symbol.iterator](),b;!(u=(b=y.next()).done)&&(d.push(b.value),!(o&&d.length===o));u=!0);}catch(P){m=!0,E=P}finally{try{!u&&y.return!=null&&y.return()}finally{if(m)throw E}}return d}}function HX(r,o){if(r){if(typeof r=="string")return oM(r,o);var d=Object.prototype.toString.call(r).slice(8,-1);if(d==="Object"&&r.constructor&&(d=r.constructor.name),d==="Map"||d==="Set")return Array.from(r);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return oM(r,o)}}function oM(r,o){(o==null||o>r.length)&&(o=r.length);for(var d=0,u=new Array(o);d<o;d++)u[d]=r[d];return u}function KX(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zX(r,o,d){return o in r?Object.defineProperty(r,o,{value:d,enumerable:!0,configurable:!0,writable:!0}):r[o]=d,r}function aM(r,o){var d=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(m){return Object.getOwnPropertyDescriptor(r,m).enumerable})),d.push.apply(d,u)}return d}function cM(r){for(var o=1;o<arguments.length;o++){var d=arguments[o]!=null?arguments[o]:{};o%2?aM(Object(d),!0).forEach(function(u){zX(r,u,d[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(d)):aM(Object(d)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(d,u))})}return r}function YX(){for(var r=arguments.length,o=new Array(r),d=0;d<r;d++)o[d]=arguments[d];return function(u){return o.reduceRight(function(m,E){return E(m)},u)}}function Nh(r){return function o(){for(var d=this,u=arguments.length,m=new Array(u),E=0;E<u;E++)m[E]=arguments[E];return m.length>=r.length?r.apply(this,m):function(){for(var y=arguments.length,b=new Array(y),P=0;P<y;P++)b[P]=arguments[P];return o.apply(d,[].concat(m,b))}}}function $_(r){return{}.toString.call(r).includes("Object")}function qX(r){return!Object.keys(r).length}function dp(r){return typeof r=="function"}function JX(r,o){return Object.prototype.hasOwnProperty.call(r,o)}function XX(r,o){return $_(o)||tc("changeType"),Object.keys(o).some(function(d){return!JX(r,d)})&&tc("changeField"),o}function QX(r){dp(r)||tc("selectorType")}function $X(r){dp(r)||$_(r)||tc("handlerType"),$_(r)&&Object.values(r).some(function(o){return!dp(o)})&&tc("handlersType")}function ZX(r){r||tc("initialIsRequired"),$_(r)||tc("initialType"),qX(r)&&tc("initialContent")}function eQ(r,o){throw new Error(r[o]||r.default)}var tQ={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},tc=Nh(eQ)(tQ),r_={changes:XX,selector:QX,handler:$X,initial:ZX};function nQ(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};r_.initial(r),r_.handler(o);var d={current:r},u=Nh(sQ)(d,o),m=Nh(rQ)(d),E=Nh(r_.changes)(r),y=Nh(iQ)(d);function b(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(K){return K};return r_.selector(U),U(d.current)}function P(U){YX(u,m,E,y)(U)}return[b,P]}function iQ(r,o){return dp(o)?o(r.current):o}function rQ(r,o){return r.current=cM(cM({},r.current),o),o}function sQ(r,o,d){return dp(o)?o(r.current):Object.keys(d).forEach(function(u){var m;return(m=o[u])===null||m===void 0?void 0:m.call(o,r.current[u])}),d}var oQ={create:nQ},aQ={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs"}};function cQ(r){return function o(){for(var d=this,u=arguments.length,m=new Array(u),E=0;E<u;E++)m[E]=arguments[E];return m.length>=r.length?r.apply(this,m):function(){for(var y=arguments.length,b=new Array(y),P=0;P<y;P++)b[P]=arguments[P];return o.apply(d,[].concat(m,b))}}}function dQ(r){return{}.toString.call(r).includes("Object")}function lQ(r){return r||dM("configIsRequired"),dQ(r)||dM("configType"),r.urls?(uQ(),{paths:{vs:r.urls.monacoBase}}):r}function uQ(){console.warn(px.deprecation)}function hQ(r,o){throw new Error(r[o]||r.default)}var px={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},dM=cQ(hQ)(px),pQ={config:lQ},fQ=function(){for(var o=arguments.length,d=new Array(o),u=0;u<o;u++)d[u]=arguments[u];return function(m){return d.reduceRight(function(E,y){return y(E)},m)}};function fx(r,o){return Object.keys(o).forEach(function(d){o[d]instanceof Object&&r[d]&&Object.assign(o[d],fx(r[d],o[d]))}),sM(sM({},r),o)}var mQ={type:"cancelation",msg:"operation is manually canceled"};function Ly(r){var o=!1,d=new Promise(function(u,m){r.then(function(E){return o?m(mQ):u(E)}),r.catch(m)});return d.cancel=function(){return o=!0},d}var _Q=oQ.create({config:aQ,isInitialized:!1,resolve:null,reject:null,monaco:null}),mx=jX(_Q,2),Sp=mx[0],yE=mx[1];function EQ(r){var o=pQ.config(r),d=o.monaco,u=BX(o,["monaco"]);yE(function(m){return{config:fx(m.config,u),monaco:d}})}function gQ(){var r=Sp(function(o){var d=o.monaco,u=o.isInitialized,m=o.resolve;return{monaco:d,isInitialized:u,resolve:m}});if(!r.isInitialized){if(yE({isInitialized:!0}),r.monaco)return r.resolve(r.monaco),Ly(My);if(window.monaco&&window.monaco.editor)return _x(window.monaco),r.resolve(window.monaco),Ly(My);fQ(SQ,vQ)(yQ)}return Ly(My)}function SQ(r){return document.body.appendChild(r)}function TQ(r){var o=document.createElement("script");return r&&(o.src=r),o}function vQ(r){var o=Sp(function(u){var m=u.config,E=u.reject;return{config:m,reject:E}}),d=TQ("".concat(o.config.paths.vs,"/loader.js"));return d.onload=function(){return r()},d.onerror=o.reject,d}function yQ(){var r=Sp(function(d){var u=d.config,m=d.resolve,E=d.reject;return{config:u,resolve:m,reject:E}}),o=window.require;o.config(r.config),o(["vs/editor/editor.main"],function(d){_x(d),r.resolve(d)},function(d){r.reject(d)})}function _x(r){Sp().monaco||yE({monaco:r})}function RQ(){return Sp(function(r){var o=r.monaco;return o})}var My=new Promise(function(r,o){return yE({resolve:r,reject:o})}),Ex={config:EQ,init:gQ,__getMonacoInstance:RQ},CQ={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},Uy=CQ,IQ={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},wQ=IQ;function AQ({children:r}){return zi.createElement("div",{style:wQ.container},r)}var OQ=AQ,bQ=OQ;function NQ({width:r,height:o,isEditorReady:d,loading:u,_ref:m,className:E,wrapperProps:y}){return zi.createElement("section",{style:{...Uy.wrapper,width:r,height:o},...y},!d&&zi.createElement(bQ,null,u),zi.createElement("div",{ref:m,style:{...Uy.fullWidth,...!d&&Uy.hide},className:E}))}var PQ=NQ,gx=le.memo(PQ);function DQ(r){le.useEffect(r,[])}var Sx=DQ;function kQ(r,o,d=!0){let u=le.useRef(!0);le.useEffect(u.current||!d?()=>{u.current=!1}:r,o)}var Pr=kQ;function jh(){}function bl(r,o,d,u){return LQ(r,u)||MQ(r,o,d,u)}function LQ(r,o){return r.editor.getModel(Tx(r,o))}function MQ(r,o,d,u){return r.editor.createModel(o,d,u?Tx(r,u):void 0)}function Tx(r,o){return r.Uri.parse(o)}function UQ({original:r,modified:o,language:d,originalLanguage:u,modifiedLanguage:m,originalModelPath:E,modifiedModelPath:y,keepCurrentOriginalModel:b=!1,keepCurrentModifiedModel:P=!1,theme:U="light",loading:K="Loading...",options:M={},height:X="100%",width:oe="100%",className:Z,wrapperProps:ne={},beforeMount:Se=jh,onMount:J=jh}){let[H,q]=le.useState(!1),[ue,Re]=le.useState(!0),be=le.useRef(null),we=le.useRef(null),je=le.useRef(null),gt=le.useRef(J),Le=le.useRef(Se),Dn=le.useRef(!1);Sx(()=>{let $e=Ex.init();return $e.then(ht=>(we.current=ht)&&Re(!1)).catch(ht=>(ht==null?void 0:ht.type)!=="cancelation"&&console.error("Monaco initialization: error:",ht)),()=>be.current?Bt():$e.cancel()}),Pr(()=>{if(be.current&&we.current){let $e=be.current.getOriginalEditor(),ht=bl(we.current,r||"",u||d||"text",E||"");ht!==$e.getModel()&&$e.setModel(ht)}},[E],H),Pr(()=>{if(be.current&&we.current){let $e=be.current.getModifiedEditor(),ht=bl(we.current,o||"",m||d||"text",y||"");ht!==$e.getModel()&&$e.setModel(ht)}},[y],H),Pr(()=>{let $e=be.current.getModifiedEditor();$e.getOption(we.current.editor.EditorOption.readOnly)?$e.setValue(o||""):o!==$e.getValue()&&($e.executeEdits("",[{range:$e.getModel().getFullModelRange(),text:o||"",forceMoveMarkers:!0}]),$e.pushUndoStop())},[o],H),Pr(()=>{var $e,ht;(ht=($e=be.current)==null?void 0:$e.getModel())==null||ht.original.setValue(r||"")},[r],H),Pr(()=>{let{original:$e,modified:ht}=be.current.getModel();we.current.editor.setModelLanguage($e,u||d||"text"),we.current.editor.setModelLanguage(ht,m||d||"text")},[d,u,m],H),Pr(()=>{var $e;($e=we.current)==null||$e.editor.setTheme(U)},[U],H),Pr(()=>{var $e;($e=be.current)==null||$e.updateOptions(M)},[M],H);let ki=le.useCallback(()=>{var Xi;if(!we.current)return;Le.current(we.current);let $e=bl(we.current,r||"",u||d||"text",E||""),ht=bl(we.current,o||"",m||d||"text",y||"");(Xi=be.current)==null||Xi.setModel({original:$e,modified:ht})},[d,o,m,r,u,E,y]),xr=le.useCallback(()=>{var $e;!Dn.current&&je.current&&(be.current=we.current.editor.createDiffEditor(je.current,{automaticLayout:!0,...M}),ki(),($e=we.current)==null||$e.editor.setTheme(U),q(!0),Dn.current=!0)},[M,U,ki]);le.useEffect(()=>{H&&gt.current(be.current,we.current)},[H]),le.useEffect(()=>{!ue&&!H&&xr()},[ue,H,xr]);function Bt(){var ht,Xi,Pe,Me;let $e=(ht=be.current)==null?void 0:ht.getModel();b||((Xi=$e==null?void 0:$e.original)==null||Xi.dispose()),P||((Pe=$e==null?void 0:$e.modified)==null||Pe.dispose()),(Me=be.current)==null||Me.dispose()}return zi.createElement(gx,{width:oe,height:X,isEditorReady:H,loading:K,_ref:je,className:Z,wrapperProps:ne})}var xQ=UQ;le.memo(xQ);function VQ(r){let o=le.useRef();return le.useEffect(()=>{o.current=r},[r]),o.current}var FQ=VQ,s_=new Map;function BQ({defaultValue:r,defaultLanguage:o,defaultPath:d,value:u,language:m,path:E,theme:y="light",line:b,loading:P="Loading...",options:U={},overrideServices:K={},saveViewState:M=!0,keepCurrentModel:X=!1,width:oe="100%",height:Z="100%",className:ne,wrapperProps:Se={},beforeMount:J=jh,onMount:H=jh,onChange:q,onValidate:ue=jh}){let[Re,be]=le.useState(!1),[we,je]=le.useState(!0),gt=le.useRef(null),Le=le.useRef(null),Dn=le.useRef(null),ki=le.useRef(H),xr=le.useRef(J),Bt=le.useRef(),$e=le.useRef(u),ht=FQ(E),Xi=le.useRef(!1),Pe=le.useRef(!1);Sx(()=>{let Je=Ex.init();return Je.then(at=>(gt.current=at)&&je(!1)).catch(at=>(at==null?void 0:at.type)!=="cancelation"&&console.error("Monaco initialization: error:",at)),()=>Le.current?ot():Je.cancel()}),Pr(()=>{var at,Kn,kn,Li;let Je=bl(gt.current,r||u||"",o||m||"",E||d||"");Je!==((at=Le.current)==null?void 0:at.getModel())&&(M&&s_.set(ht,(Kn=Le.current)==null?void 0:Kn.saveViewState()),(kn=Le.current)==null||kn.setModel(Je),M&&((Li=Le.current)==null||Li.restoreViewState(s_.get(E))))},[E],Re),Pr(()=>{var Je;(Je=Le.current)==null||Je.updateOptions(U)},[U],Re),Pr(()=>{!Le.current||u===void 0||(Le.current.getOption(gt.current.editor.EditorOption.readOnly)?Le.current.setValue(u):u!==Le.current.getValue()&&(Pe.current=!0,Le.current.executeEdits("",[{range:Le.current.getModel().getFullModelRange(),text:u,forceMoveMarkers:!0}]),Le.current.pushUndoStop(),Pe.current=!1))},[u],Re),Pr(()=>{var at,Kn;let Je=(at=Le.current)==null?void 0:at.getModel();Je&&m&&((Kn=gt.current)==null||Kn.editor.setModelLanguage(Je,m))},[m],Re),Pr(()=>{var Je;b!==void 0&&((Je=Le.current)==null||Je.revealLine(b))},[b],Re),Pr(()=>{var Je;(Je=gt.current)==null||Je.editor.setTheme(y)},[y],Re);let Me=le.useCallback(()=>{var Je;if(!(!Dn.current||!gt.current)&&!Xi.current){xr.current(gt.current);let at=E||d,Kn=bl(gt.current,u||r||"",o||m||"",at||"");Le.current=(Je=gt.current)==null?void 0:Je.editor.create(Dn.current,{model:Kn,automaticLayout:!0,...U},K),M&&Le.current.restoreViewState(s_.get(at)),gt.current.editor.setTheme(y),b!==void 0&&Le.current.revealLine(b),be(!0),Xi.current=!0}},[r,o,d,u,m,E,U,K,M,y,b]);le.useEffect(()=>{Re&&ki.current(Le.current,gt.current)},[Re]),le.useEffect(()=>{!we&&!Re&&Me()},[we,Re,Me]),$e.current=u,le.useEffect(()=>{var Je,at;Re&&q&&((Je=Bt.current)==null||Je.dispose(),Bt.current=(at=Le.current)==null?void 0:at.onDidChangeModelContent(Kn=>{Pe.current||q(Le.current.getValue(),Kn)}))},[Re,q]),le.useEffect(()=>{if(Re){let Je=gt.current.editor.onDidChangeMarkers(at=>{var kn;let Kn=(kn=Le.current.getModel())==null?void 0:kn.uri;if(Kn&&at.find(Li=>Li.path===Kn.path)){let Li=gt.current.editor.getModelMarkers({resource:Kn});ue==null||ue(Li)}});return()=>{Je==null||Je.dispose()}}return()=>{}},[Re,ue]);function ot(){var Je,at;(Je=Bt.current)==null||Je.dispose(),X?M&&s_.set(E,Le.current.saveViewState()):(at=Le.current.getModel())==null||at.dispose(),Le.current.dispose()}return zi.createElement(gx,{width:oe,height:Z,isEditorReady:Re,loading:P,_ref:Dn,className:ne,wrapperProps:Se})}var jQ=BQ,GQ=le.memo(jQ),WQ=GQ;const ho=Object.create(null);ho.open="0";ho.close="1";ho.ping="2";ho.pong="3";ho.message="4";ho.upgrade="5";ho.noop="6";const C_=Object.create(null);Object.keys(ho).forEach(r=>{C_[ho[r]]=r});const BR={type:"error",data:"parser error"},vx=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",yx=typeof ArrayBuffer=="function",Rx=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,JC=({type:r,data:o},d,u)=>vx&&o instanceof Blob?d?u(o):lM(o,u):yx&&(o instanceof ArrayBuffer||Rx(o))?d?u(o):lM(new Blob([o]),u):u(ho[r]+(o||"")),lM=(r,o)=>{const d=new FileReader;return d.onload=function(){const u=d.result.split(",")[1];o("b"+(u||""))},d.readAsDataURL(r)};function uM(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let xy;function HQ(r,o){if(vx&&r.data instanceof Blob)return r.data.arrayBuffer().then(uM).then(o);if(yx&&(r.data instanceof ArrayBuffer||Rx(r.data)))return o(uM(r.data));JC(r,!1,d=>{xy||(xy=new TextEncoder),o(xy.encode(d))})}const hM="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ph=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<hM.length;r++)Ph[hM.charCodeAt(r)]=r;const KQ=r=>{let o=r.length*.75,d=r.length,u,m=0,E,y,b,P;r[r.length-1]==="="&&(o--,r[r.length-2]==="="&&o--);const U=new ArrayBuffer(o),K=new Uint8Array(U);for(u=0;u<d;u+=4)E=Ph[r.charCodeAt(u)],y=Ph[r.charCodeAt(u+1)],b=Ph[r.charCodeAt(u+2)],P=Ph[r.charCodeAt(u+3)],K[m++]=E<<2|y>>4,K[m++]=(y&15)<<4|b>>2,K[m++]=(b&3)<<6|P&63;return U},zQ=typeof ArrayBuffer=="function",XC=(r,o)=>{if(typeof r!="string")return{type:"message",data:Cx(r,o)};const d=r.charAt(0);return d==="b"?{type:"message",data:YQ(r.substring(1),o)}:C_[d]?r.length>1?{type:C_[d],data:r.substring(1)}:{type:C_[d]}:BR},YQ=(r,o)=>{if(zQ){const d=KQ(r);return Cx(d,o)}else return{base64:!0,data:r}},Cx=(r,o)=>{switch(o){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},Ix="",qQ=(r,o)=>{const d=r.length,u=new Array(d);let m=0;r.forEach((E,y)=>{JC(E,!1,b=>{u[y]=b,++m===d&&o(u.join(Ix))})})},JQ=(r,o)=>{const d=r.split(Ix),u=[];for(let m=0;m<d.length;m++){const E=XC(d[m],o);if(u.push(E),E.type==="error")break}return u};function XQ(){return new TransformStream({transform(r,o){HQ(r,d=>{const u=d.length;let m;if(u<126)m=new Uint8Array(1),new DataView(m.buffer).setUint8(0,u);else if(u<65536){m=new Uint8Array(3);const E=new DataView(m.buffer);E.setUint8(0,126),E.setUint16(1,u)}else{m=new Uint8Array(9);const E=new DataView(m.buffer);E.setUint8(0,127),E.setBigUint64(1,BigInt(u))}r.data&&typeof r.data!="string"&&(m[0]|=128),o.enqueue(m),o.enqueue(d)})}})}let Vy;function o_(r){return r.reduce((o,d)=>o+d.length,0)}function a_(r,o){if(r[0].length===o)return r.shift();const d=new Uint8Array(o);let u=0;for(let m=0;m<o;m++)d[m]=r[0][u++],u===r[0].length&&(r.shift(),u=0);return r.length&&u<r[0].length&&(r[0]=r[0].slice(u)),d}function QQ(r,o){Vy||(Vy=new TextDecoder);const d=[];let u=0,m=-1,E=!1;return new TransformStream({transform(y,b){for(d.push(y);;){if(u===0){if(o_(d)<1)break;const P=a_(d,1);E=(P[0]&128)===128,m=P[0]&127,m<126?u=3:m===126?u=1:u=2}else if(u===1){if(o_(d)<2)break;const P=a_(d,2);m=new DataView(P.buffer,P.byteOffset,P.length).getUint16(0),u=3}else if(u===2){if(o_(d)<8)break;const P=a_(d,8),U=new DataView(P.buffer,P.byteOffset,P.length),K=U.getUint32(0);if(K>Math.pow(2,21)-1){b.enqueue(BR);break}m=K*Math.pow(2,32)+U.getUint32(4),u=3}else{if(o_(d)<m)break;const P=a_(d,m);b.enqueue(XC(E?P:Vy.decode(P),o)),u=0}if(m===0||m>r){b.enqueue(BR);break}}}})}const wx=4;function ti(r){if(r)return $Q(r)}function $Q(r){for(var o in ti.prototype)r[o]=ti.prototype[o];return r}ti.prototype.on=ti.prototype.addEventListener=function(r,o){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(o),this};ti.prototype.once=function(r,o){function d(){this.off(r,d),o.apply(this,arguments)}return d.fn=o,this.on(r,d),this};ti.prototype.off=ti.prototype.removeListener=ti.prototype.removeAllListeners=ti.prototype.removeEventListener=function(r,o){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var d=this._callbacks["$"+r];if(!d)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var u,m=0;m<d.length;m++)if(u=d[m],u===o||u.fn===o){d.splice(m,1);break}return d.length===0&&delete this._callbacks["$"+r],this};ti.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var o=new Array(arguments.length-1),d=this._callbacks["$"+r],u=1;u<arguments.length;u++)o[u-1]=arguments[u];if(d){d=d.slice(0);for(var u=0,m=d.length;u<m;++u)d[u].apply(this,o)}return this};ti.prototype.emitReserved=ti.prototype.emit;ti.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};ti.prototype.hasListeners=function(r){return!!this.listeners(r).length};const cs=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function Ax(r,...o){return o.reduce((d,u)=>(r.hasOwnProperty(u)&&(d[u]=r[u]),d),{})}const ZQ=cs.setTimeout,e$=cs.clearTimeout;function RE(r,o){o.useNativeTimers?(r.setTimeoutFn=ZQ.bind(cs),r.clearTimeoutFn=e$.bind(cs)):(r.setTimeoutFn=cs.setTimeout.bind(cs),r.clearTimeoutFn=cs.clearTimeout.bind(cs))}const t$=1.33;function n$(r){return typeof r=="string"?i$(r):Math.ceil((r.byteLength||r.size)*t$)}function i$(r){let o=0,d=0;for(let u=0,m=r.length;u<m;u++)o=r.charCodeAt(u),o<128?d+=1:o<2048?d+=2:o<55296||o>=57344?d+=3:(u++,d+=4);return d}function r$(r){let o="";for(let d in r)r.hasOwnProperty(d)&&(o.length&&(o+="&"),o+=encodeURIComponent(d)+"="+encodeURIComponent(r[d]));return o}function s$(r){let o={},d=r.split("&");for(let u=0,m=d.length;u<m;u++){let E=d[u].split("=");o[decodeURIComponent(E[0])]=decodeURIComponent(E[1])}return o}class o$ extends Error{constructor(o,d,u){super(o),this.description=d,this.context=u,this.type="TransportError"}}class QC extends ti{constructor(o){super(),this.writable=!1,RE(this,o),this.opts=o,this.query=o.query,this.socket=o.socket}onError(o,d,u){return super.emitReserved("error",new o$(o,d,u)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(o){this.readyState==="open"&&this.write(o)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(o){const d=XC(o,this.socket.binaryType);this.onPacket(d)}onPacket(o){super.emitReserved("packet",o)}onClose(o){this.readyState="closed",super.emitReserved("close",o)}pause(o){}createUri(o,d={}){return o+"://"+this._hostname()+this._port()+this.opts.path+this._query(d)}_hostname(){const o=this.opts.hostname;return o.indexOf(":")===-1?o:"["+o+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(o){const d=r$(o);return d.length?"?"+d:""}}const Ox="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),jR=64,a$={};let pM=0,c_=0,fM;function mM(r){let o="";do o=Ox[r%jR]+o,r=Math.floor(r/jR);while(r>0);return o}function bx(){const r=mM(+new Date);return r!==fM?(pM=0,fM=r):r+"."+mM(pM++)}for(;c_<jR;c_++)a$[Ox[c_]]=c_;let Nx=!1;try{Nx=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const c$=Nx;function Px(r){const o=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!o||c$))return new XMLHttpRequest}catch{}if(!o)try{return new cs[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function d$(){}const l$=function(){return new Px({xdomain:!1}).responseType!=null}();class u$ extends QC{constructor(o){if(super(o),this.polling=!1,typeof location<"u"){const u=location.protocol==="https:";let m=location.port;m||(m=u?"443":"80"),this.xd=typeof location<"u"&&o.hostname!==location.hostname||m!==o.port}const d=o&&o.forceBase64;this.supportsBinary=l$&&!d,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(o){this.readyState="pausing";const d=()=>{this.readyState="paused",o()};if(this.polling||!this.writable){let u=0;this.polling&&(u++,this.once("pollComplete",function(){--u||d()})),this.writable||(u++,this.once("drain",function(){--u||d()}))}else d()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(o){const d=u=>{if(this.readyState==="opening"&&u.type==="open"&&this.onOpen(),u.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(u)};JQ(o,this.socket.binaryType).forEach(d),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const o=()=>{this.write([{type:"close"}])};this.readyState==="open"?o():this.once("open",o)}write(o){this.writable=!1,qQ(o,d=>{this.doWrite(d,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const o=this.opts.secure?"https":"http",d=this.query||{};return this.opts.timestampRequests!==!1&&(d[this.opts.timestampParam]=bx()),!this.supportsBinary&&!d.sid&&(d.b64=1),this.createUri(o,d)}request(o={}){return Object.assign(o,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new uo(this.uri(),o)}doWrite(o,d){const u=this.request({method:"POST",data:o});u.on("success",d),u.on("error",(m,E)=>{this.onError("xhr post error",m,E)})}doPoll(){const o=this.request();o.on("data",this.onData.bind(this)),o.on("error",(d,u)=>{this.onError("xhr poll error",d,u)}),this.pollXhr=o}}class uo extends ti{constructor(o,d){super(),RE(this,d),this.opts=d,this.method=d.method||"GET",this.uri=o,this.data=d.data!==void 0?d.data:null,this.create()}create(){var o;const d=Ax(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");d.xdomain=!!this.opts.xd;const u=this.xhr=new Px(d);try{u.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){u.setDisableHeaderCheck&&u.setDisableHeaderCheck(!0);for(let m in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(m)&&u.setRequestHeader(m,this.opts.extraHeaders[m])}}catch{}if(this.method==="POST")try{u.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{u.setRequestHeader("Accept","*/*")}catch{}(o=this.opts.cookieJar)===null||o===void 0||o.addCookies(u),"withCredentials"in u&&(u.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(u.timeout=this.opts.requestTimeout),u.onreadystatechange=()=>{var m;u.readyState===3&&((m=this.opts.cookieJar)===null||m===void 0||m.parseCookies(u)),u.readyState===4&&(u.status===200||u.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof u.status=="number"?u.status:0)},0))},u.send(this.data)}catch(m){this.setTimeoutFn(()=>{this.onError(m)},0);return}typeof document<"u"&&(this.index=uo.requestsCount++,uo.requests[this.index]=this)}onError(o){this.emitReserved("error",o,this.xhr),this.cleanup(!0)}cleanup(o){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=d$,o)try{this.xhr.abort()}catch{}typeof document<"u"&&delete uo.requests[this.index],this.xhr=null}}onLoad(){const o=this.xhr.responseText;o!==null&&(this.emitReserved("data",o),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}uo.requestsCount=0;uo.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",_M);else if(typeof addEventListener=="function"){const r="onpagehide"in cs?"pagehide":"unload";addEventListener(r,_M,!1)}}function _M(){for(let r in uo.requests)uo.requests.hasOwnProperty(r)&&uo.requests[r].abort()}const $C=typeof Promise=="function"&&typeof Promise.resolve=="function"?o=>Promise.resolve().then(o):(o,d)=>d(o,0),d_=cs.WebSocket||cs.MozWebSocket,EM=!0,h$="arraybuffer",gM=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class p$ extends QC{constructor(o){super(o),this.supportsBinary=!o.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const o=this.uri(),d=this.opts.protocols,u=gM?{}:Ax(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(u.headers=this.opts.extraHeaders);try{this.ws=EM&&!gM?d?new d_(o,d):new d_(o):new d_(o,d,u)}catch(m){return this.emitReserved("error",m)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=o=>this.onClose({description:"websocket connection closed",context:o}),this.ws.onmessage=o=>this.onData(o.data),this.ws.onerror=o=>this.onError("websocket error",o)}write(o){this.writable=!1;for(let d=0;d<o.length;d++){const u=o[d],m=d===o.length-1;JC(u,this.supportsBinary,E=>{const y={};try{EM&&this.ws.send(E)}catch{}m&&$C(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const o=this.opts.secure?"wss":"ws",d=this.query||{};return this.opts.timestampRequests&&(d[this.opts.timestampParam]=bx()),this.supportsBinary||(d.b64=1),this.createUri(o,d)}check(){return!!d_}}class f$ extends QC{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(o=>{this.onError("webtransport error",o)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(o=>{const d=QQ(Number.MAX_SAFE_INTEGER,this.socket.binaryType),u=o.readable.pipeThrough(d).getReader(),m=XQ();m.readable.pipeTo(o.writable),this.writer=m.writable.getWriter();const E=()=>{u.read().then(({done:b,value:P})=>{b||(this.onPacket(P),E())}).catch(b=>{})};E();const y={type:"open"};this.query.sid&&(y.data=`{"sid":"${this.query.sid}"}`),this.writer.write(y).then(()=>this.onOpen())})}))}write(o){this.writable=!1;for(let d=0;d<o.length;d++){const u=o[d],m=d===o.length-1;this.writer.write(u).then(()=>{m&&$C(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var o;(o=this.transport)===null||o===void 0||o.close()}}const m$={websocket:p$,webtransport:f$,polling:u$},_$=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,E$=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function GR(r){if(r.length>2e3)throw"URI too long";const o=r,d=r.indexOf("["),u=r.indexOf("]");d!=-1&&u!=-1&&(r=r.substring(0,d)+r.substring(d,u).replace(/:/g,";")+r.substring(u,r.length));let m=_$.exec(r||""),E={},y=14;for(;y--;)E[E$[y]]=m[y]||"";return d!=-1&&u!=-1&&(E.source=o,E.host=E.host.substring(1,E.host.length-1).replace(/;/g,":"),E.authority=E.authority.replace("[","").replace("]","").replace(/;/g,":"),E.ipv6uri=!0),E.pathNames=g$(E,E.path),E.queryKey=S$(E,E.query),E}function g$(r,o){const d=/\/{2,9}/g,u=o.replace(d,"/").split("/");return(o.slice(0,1)=="/"||o.length===0)&&u.splice(0,1),o.slice(-1)=="/"&&u.splice(u.length-1,1),u}function S$(r,o){const d={};return o.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(u,m,E){m&&(d[m]=E)}),d}let Dx=class ml extends ti{constructor(o,d={}){super(),this.binaryType=h$,this.writeBuffer=[],o&&typeof o=="object"&&(d=o,o=null),o?(o=GR(o),d.hostname=o.host,d.secure=o.protocol==="https"||o.protocol==="wss",d.port=o.port,o.query&&(d.query=o.query)):d.host&&(d.hostname=GR(d.host).host),RE(this,d),this.secure=d.secure!=null?d.secure:typeof location<"u"&&location.protocol==="https:",d.hostname&&!d.port&&(d.port=this.secure?"443":"80"),this.hostname=d.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=d.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=d.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},d),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=s$(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(o){const d=Object.assign({},this.opts.query);d.EIO=wx,d.transport=o,this.id&&(d.sid=this.id);const u=Object.assign({},this.opts,{query:d,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[o]);return new m$[o](u)}open(){let o;if(this.opts.rememberUpgrade&&ml.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)o="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else o=this.transports[0];this.readyState="opening";try{o=this.createTransport(o)}catch{this.transports.shift(),this.open();return}o.open(),this.setTransport(o)}setTransport(o){this.transport&&this.transport.removeAllListeners(),this.transport=o,o.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",d=>this.onClose("transport close",d))}probe(o){let d=this.createTransport(o),u=!1;ml.priorWebsocketSuccess=!1;const m=()=>{u||(d.send([{type:"ping",data:"probe"}]),d.once("packet",M=>{if(!u)if(M.type==="pong"&&M.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",d),!d)return;ml.priorWebsocketSuccess=d.name==="websocket",this.transport.pause(()=>{u||this.readyState!=="closed"&&(K(),this.setTransport(d),d.send([{type:"upgrade"}]),this.emitReserved("upgrade",d),d=null,this.upgrading=!1,this.flush())})}else{const X=new Error("probe error");X.transport=d.name,this.emitReserved("upgradeError",X)}}))};function E(){u||(u=!0,K(),d.close(),d=null)}const y=M=>{const X=new Error("probe error: "+M);X.transport=d.name,E(),this.emitReserved("upgradeError",X)};function b(){y("transport closed")}function P(){y("socket closed")}function U(M){d&&M.name!==d.name&&E()}const K=()=>{d.removeListener("open",m),d.removeListener("error",y),d.removeListener("close",b),this.off("close",P),this.off("upgrading",U)};d.once("open",m),d.once("error",y),d.once("close",b),this.once("close",P),this.once("upgrading",U),this.upgrades.indexOf("webtransport")!==-1&&o!=="webtransport"?this.setTimeoutFn(()=>{u||d.open()},200):d.open()}onOpen(){if(this.readyState="open",ml.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let o=0;const d=this.upgrades.length;for(;o<d;o++)this.probe(this.upgrades[o])}}onPacket(o){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",o),this.emitReserved("heartbeat"),this.resetPingTimeout(),o.type){case"open":this.onHandshake(JSON.parse(o.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const d=new Error("server error");d.code=o.data,this.onError(d);break;case"message":this.emitReserved("data",o.data),this.emitReserved("message",o.data);break}}onHandshake(o){this.emitReserved("handshake",o),this.id=o.sid,this.transport.query.sid=o.sid,this.upgrades=this.filterUpgrades(o.upgrades),this.pingInterval=o.pingInterval,this.pingTimeout=o.pingTimeout,this.maxPayload=o.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const o=this.getWritablePackets();this.transport.send(o),this.prevBufferLen=o.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let d=1;for(let u=0;u<this.writeBuffer.length;u++){const m=this.writeBuffer[u].data;if(m&&(d+=n$(m)),u>0&&d>this.maxPayload)return this.writeBuffer.slice(0,u);d+=2}return this.writeBuffer}write(o,d,u){return this.sendPacket("message",o,d,u),this}send(o,d,u){return this.sendPacket("message",o,d,u),this}sendPacket(o,d,u,m){if(typeof d=="function"&&(m=d,d=void 0),typeof u=="function"&&(m=u,u=null),this.readyState==="closing"||this.readyState==="closed")return;u=u||{},u.compress=u.compress!==!1;const E={type:o,data:d,options:u};this.emitReserved("packetCreate",E),this.writeBuffer.push(E),m&&this.once("flush",m),this.flush()}close(){const o=()=>{this.onClose("forced close"),this.transport.close()},d=()=>{this.off("upgrade",d),this.off("upgradeError",d),o()},u=()=>{this.once("upgrade",d),this.once("upgradeError",d)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?u():o()}):this.upgrading?u():o()),this}onError(o){ml.priorWebsocketSuccess=!1,this.emitReserved("error",o),this.onClose("transport error",o)}onClose(o,d){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",o,d),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(o){const d=[];let u=0;const m=o.length;for(;u<m;u++)~this.transports.indexOf(o[u])&&d.push(o[u]);return d}};Dx.protocol=wx;function T$(r,o="",d){let u=r;d=d||typeof location<"u"&&location,r==null&&(r=d.protocol+"//"+d.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=d.protocol+r:r=d.host+r),/^(https?|wss?):\/\//.test(r)||(typeof d<"u"?r=d.protocol+"//"+r:r="https://"+r),u=GR(r)),u.port||(/^(http|ws)$/.test(u.protocol)?u.port="80":/^(http|ws)s$/.test(u.protocol)&&(u.port="443")),u.path=u.path||"/";const E=u.host.indexOf(":")!==-1?"["+u.host+"]":u.host;return u.id=u.protocol+"://"+E+":"+u.port+o,u.href=u.protocol+"://"+E+(d&&d.port===u.port?"":":"+u.port),u}const v$=typeof ArrayBuffer=="function",y$=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,kx=Object.prototype.toString,R$=typeof Blob=="function"||typeof Blob<"u"&&kx.call(Blob)==="[object BlobConstructor]",C$=typeof File=="function"||typeof File<"u"&&kx.call(File)==="[object FileConstructor]";function ZC(r){return v$&&(r instanceof ArrayBuffer||y$(r))||R$&&r instanceof Blob||C$&&r instanceof File}function I_(r,o){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let d=0,u=r.length;d<u;d++)if(I_(r[d]))return!0;return!1}if(ZC(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return I_(r.toJSON(),!0);for(const d in r)if(Object.prototype.hasOwnProperty.call(r,d)&&I_(r[d]))return!0;return!1}function I$(r){const o=[],d=r.data,u=r;return u.data=WR(d,o),u.attachments=o.length,{packet:u,buffers:o}}function WR(r,o){if(!r)return r;if(ZC(r)){const d={_placeholder:!0,num:o.length};return o.push(r),d}else if(Array.isArray(r)){const d=new Array(r.length);for(let u=0;u<r.length;u++)d[u]=WR(r[u],o);return d}else if(typeof r=="object"&&!(r instanceof Date)){const d={};for(const u in r)Object.prototype.hasOwnProperty.call(r,u)&&(d[u]=WR(r[u],o));return d}return r}function w$(r,o){return r.data=HR(r.data,o),delete r.attachments,r}function HR(r,o){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<o.length)return o[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let d=0;d<r.length;d++)r[d]=HR(r[d],o);else if(typeof r=="object")for(const d in r)Object.prototype.hasOwnProperty.call(r,d)&&(r[d]=HR(r[d],o));return r}const A$=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],O$=5;var bt;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(bt||(bt={}));class b${constructor(o){this.replacer=o}encode(o){return(o.type===bt.EVENT||o.type===bt.ACK)&&I_(o)?this.encodeAsBinary({type:o.type===bt.EVENT?bt.BINARY_EVENT:bt.BINARY_ACK,nsp:o.nsp,data:o.data,id:o.id}):[this.encodeAsString(o)]}encodeAsString(o){let d=""+o.type;return(o.type===bt.BINARY_EVENT||o.type===bt.BINARY_ACK)&&(d+=o.attachments+"-"),o.nsp&&o.nsp!=="/"&&(d+=o.nsp+","),o.id!=null&&(d+=o.id),o.data!=null&&(d+=JSON.stringify(o.data,this.replacer)),d}encodeAsBinary(o){const d=I$(o),u=this.encodeAsString(d.packet),m=d.buffers;return m.unshift(u),m}}function SM(r){return Object.prototype.toString.call(r)==="[object Object]"}class eI extends ti{constructor(o){super(),this.reviver=o}add(o){let d;if(typeof o=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");d=this.decodeString(o);const u=d.type===bt.BINARY_EVENT;u||d.type===bt.BINARY_ACK?(d.type=u?bt.EVENT:bt.ACK,this.reconstructor=new N$(d),d.attachments===0&&super.emitReserved("decoded",d)):super.emitReserved("decoded",d)}else if(ZC(o)||o.base64)if(this.reconstructor)d=this.reconstructor.takeBinaryData(o),d&&(this.reconstructor=null,super.emitReserved("decoded",d));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+o)}decodeString(o){let d=0;const u={type:Number(o.charAt(0))};if(bt[u.type]===void 0)throw new Error("unknown packet type "+u.type);if(u.type===bt.BINARY_EVENT||u.type===bt.BINARY_ACK){const E=d+1;for(;o.charAt(++d)!=="-"&&d!=o.length;);const y=o.substring(E,d);if(y!=Number(y)||o.charAt(d)!=="-")throw new Error("Illegal attachments");u.attachments=Number(y)}if(o.charAt(d+1)==="/"){const E=d+1;for(;++d&&!(o.charAt(d)===","||d===o.length););u.nsp=o.substring(E,d)}else u.nsp="/";const m=o.charAt(d+1);if(m!==""&&Number(m)==m){const E=d+1;for(;++d;){const y=o.charAt(d);if(y==null||Number(y)!=y){--d;break}if(d===o.length)break}u.id=Number(o.substring(E,d+1))}if(o.charAt(++d)){const E=this.tryParse(o.substr(d));if(eI.isPayloadValid(u.type,E))u.data=E;else throw new Error("invalid payload")}return u}tryParse(o){try{return JSON.parse(o,this.reviver)}catch{return!1}}static isPayloadValid(o,d){switch(o){case bt.CONNECT:return SM(d);case bt.DISCONNECT:return d===void 0;case bt.CONNECT_ERROR:return typeof d=="string"||SM(d);case bt.EVENT:case bt.BINARY_EVENT:return Array.isArray(d)&&(typeof d[0]=="number"||typeof d[0]=="string"&&A$.indexOf(d[0])===-1);case bt.ACK:case bt.BINARY_ACK:return Array.isArray(d)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class N${constructor(o){this.packet=o,this.buffers=[],this.reconPack=o}takeBinaryData(o){if(this.buffers.push(o),this.buffers.length===this.reconPack.attachments){const d=w$(this.reconPack,this.buffers);return this.finishedReconstruction(),d}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const P$=Object.freeze(Object.defineProperty({__proto__:null,Decoder:eI,Encoder:b$,get PacketType(){return bt},protocol:O$},Symbol.toStringTag,{value:"Module"}));function Ns(r,o,d){return r.on(o,d),function(){r.off(o,d)}}const D$=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Lx extends ti{constructor(o,d,u){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=o,this.nsp=d,u&&u.auth&&(this.auth=u.auth),this._opts=Object.assign({},u),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const o=this.io;this.subs=[Ns(o,"open",this.onopen.bind(this)),Ns(o,"packet",this.onpacket.bind(this)),Ns(o,"error",this.onerror.bind(this)),Ns(o,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...o){return o.unshift("message"),this.emit.apply(this,o),this}emit(o,...d){if(D$.hasOwnProperty(o))throw new Error('"'+o.toString()+'" is a reserved event name');if(d.unshift(o),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(d),this;const u={type:bt.EVENT,data:d};if(u.options={},u.options.compress=this.flags.compress!==!1,typeof d[d.length-1]=="function"){const y=this.ids++,b=d.pop();this._registerAckCallback(y,b),u.id=y}const m=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!m||!this.connected)||(this.connected?(this.notifyOutgoingListeners(u),this.packet(u)):this.sendBuffer.push(u)),this.flags={},this}_registerAckCallback(o,d){var u;const m=(u=this.flags.timeout)!==null&&u!==void 0?u:this._opts.ackTimeout;if(m===void 0){this.acks[o]=d;return}const E=this.io.setTimeoutFn(()=>{delete this.acks[o];for(let b=0;b<this.sendBuffer.length;b++)this.sendBuffer[b].id===o&&this.sendBuffer.splice(b,1);d.call(this,new Error("operation has timed out"))},m),y=(...b)=>{this.io.clearTimeoutFn(E),d.apply(this,b)};y.withError=!0,this.acks[o]=y}emitWithAck(o,...d){return new Promise((u,m)=>{const E=(y,b)=>y?m(y):u(b);E.withError=!0,d.push(E),this.emit(o,...d)})}_addToQueue(o){let d;typeof o[o.length-1]=="function"&&(d=o.pop());const u={id:this._queueSeq++,tryCount:0,pending:!1,args:o,flags:Object.assign({fromQueue:!0},this.flags)};o.push((m,...E)=>u!==this._queue[0]?void 0:(m!==null?u.tryCount>this._opts.retries&&(this._queue.shift(),d&&d(m)):(this._queue.shift(),d&&d(null,...E)),u.pending=!1,this._drainQueue())),this._queue.push(u),this._drainQueue()}_drainQueue(o=!1){if(!this.connected||this._queue.length===0)return;const d=this._queue[0];d.pending&&!o||(d.pending=!0,d.tryCount++,this.flags=d.flags,this.emit.apply(this,d.args))}packet(o){o.nsp=this.nsp,this.io._packet(o)}onopen(){typeof this.auth=="function"?this.auth(o=>{this._sendConnectPacket(o)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(o){this.packet({type:bt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},o):o})}onerror(o){this.connected||this.emitReserved("connect_error",o)}onclose(o,d){this.connected=!1,delete this.id,this.emitReserved("disconnect",o,d),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(o=>{if(!this.sendBuffer.some(u=>String(u.id)===o)){const u=this.acks[o];delete this.acks[o],u.withError&&u.call(this,new Error("socket has been disconnected"))}})}onpacket(o){if(o.nsp===this.nsp)switch(o.type){case bt.CONNECT:o.data&&o.data.sid?this.onconnect(o.data.sid,o.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case bt.EVENT:case bt.BINARY_EVENT:this.onevent(o);break;case bt.ACK:case bt.BINARY_ACK:this.onack(o);break;case bt.DISCONNECT:this.ondisconnect();break;case bt.CONNECT_ERROR:this.destroy();const u=new Error(o.data.message);u.data=o.data.data,this.emitReserved("connect_error",u);break}}onevent(o){const d=o.data||[];o.id!=null&&d.push(this.ack(o.id)),this.connected?this.emitEvent(d):this.receiveBuffer.push(Object.freeze(d))}emitEvent(o){if(this._anyListeners&&this._anyListeners.length){const d=this._anyListeners.slice();for(const u of d)u.apply(this,o)}super.emit.apply(this,o),this._pid&&o.length&&typeof o[o.length-1]=="string"&&(this._lastOffset=o[o.length-1])}ack(o){const d=this;let u=!1;return function(...m){u||(u=!0,d.packet({type:bt.ACK,id:o,data:m}))}}onack(o){const d=this.acks[o.id];typeof d=="function"&&(delete this.acks[o.id],d.withError&&o.data.unshift(null),d.apply(this,o.data))}onconnect(o,d){this.id=o,this.recovered=d&&this._pid===d,this._pid=d,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(o=>this.emitEvent(o)),this.receiveBuffer=[],this.sendBuffer.forEach(o=>{this.notifyOutgoingListeners(o),this.packet(o)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(o=>o()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:bt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(o){return this.flags.compress=o,this}get volatile(){return this.flags.volatile=!0,this}timeout(o){return this.flags.timeout=o,this}onAny(o){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(o),this}prependAny(o){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(o),this}offAny(o){if(!this._anyListeners)return this;if(o){const d=this._anyListeners;for(let u=0;u<d.length;u++)if(o===d[u])return d.splice(u,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(o){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(o),this}prependAnyOutgoing(o){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(o),this}offAnyOutgoing(o){if(!this._anyOutgoingListeners)return this;if(o){const d=this._anyOutgoingListeners;for(let u=0;u<d.length;u++)if(o===d[u])return d.splice(u,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(o){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const d=this._anyOutgoingListeners.slice();for(const u of d)u.apply(this,o.data)}}}function Xl(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Xl.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var o=Math.random(),d=Math.floor(o*this.jitter*r);r=Math.floor(o*10)&1?r+d:r-d}return Math.min(r,this.max)|0};Xl.prototype.reset=function(){this.attempts=0};Xl.prototype.setMin=function(r){this.ms=r};Xl.prototype.setMax=function(r){this.max=r};Xl.prototype.setJitter=function(r){this.jitter=r};class KR extends ti{constructor(o,d){var u;super(),this.nsps={},this.subs=[],o&&typeof o=="object"&&(d=o,o=void 0),d=d||{},d.path=d.path||"/socket.io",this.opts=d,RE(this,d),this.reconnection(d.reconnection!==!1),this.reconnectionAttempts(d.reconnectionAttempts||1/0),this.reconnectionDelay(d.reconnectionDelay||1e3),this.reconnectionDelayMax(d.reconnectionDelayMax||5e3),this.randomizationFactor((u=d.randomizationFactor)!==null&&u!==void 0?u:.5),this.backoff=new Xl({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(d.timeout==null?2e4:d.timeout),this._readyState="closed",this.uri=o;const m=d.parser||P$;this.encoder=new m.Encoder,this.decoder=new m.Decoder,this._autoConnect=d.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(o){return arguments.length?(this._reconnection=!!o,this):this._reconnection}reconnectionAttempts(o){return o===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=o,this)}reconnectionDelay(o){var d;return o===void 0?this._reconnectionDelay:(this._reconnectionDelay=o,(d=this.backoff)===null||d===void 0||d.setMin(o),this)}randomizationFactor(o){var d;return o===void 0?this._randomizationFactor:(this._randomizationFactor=o,(d=this.backoff)===null||d===void 0||d.setJitter(o),this)}reconnectionDelayMax(o){var d;return o===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=o,(d=this.backoff)===null||d===void 0||d.setMax(o),this)}timeout(o){return arguments.length?(this._timeout=o,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(o){if(~this._readyState.indexOf("open"))return this;this.engine=new Dx(this.uri,this.opts);const d=this.engine,u=this;this._readyState="opening",this.skipReconnect=!1;const m=Ns(d,"open",function(){u.onopen(),o&&o()}),E=b=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",b),o?o(b):this.maybeReconnectOnOpen()},y=Ns(d,"error",E);if(this._timeout!==!1){const b=this._timeout,P=this.setTimeoutFn(()=>{m(),E(new Error("timeout")),d.close()},b);this.opts.autoUnref&&P.unref(),this.subs.push(()=>{this.clearTimeoutFn(P)})}return this.subs.push(m),this.subs.push(y),this}connect(o){return this.open(o)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const o=this.engine;this.subs.push(Ns(o,"ping",this.onping.bind(this)),Ns(o,"data",this.ondata.bind(this)),Ns(o,"error",this.onerror.bind(this)),Ns(o,"close",this.onclose.bind(this)),Ns(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(o){try{this.decoder.add(o)}catch(d){this.onclose("parse error",d)}}ondecoded(o){$C(()=>{this.emitReserved("packet",o)},this.setTimeoutFn)}onerror(o){this.emitReserved("error",o)}socket(o,d){let u=this.nsps[o];return u?this._autoConnect&&!u.active&&u.connect():(u=new Lx(this,o,d),this.nsps[o]=u),u}_destroy(o){const d=Object.keys(this.nsps);for(const u of d)if(this.nsps[u].active)return;this._close()}_packet(o){const d=this.encoder.encode(o);for(let u=0;u<d.length;u++)this.engine.write(d[u],o.options)}cleanup(){this.subs.forEach(o=>o()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(o,d){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",o,d),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const o=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const d=this.backoff.duration();this._reconnecting=!0;const u=this.setTimeoutFn(()=>{o.skipReconnect||(this.emitReserved("reconnect_attempt",o.backoff.attempts),!o.skipReconnect&&o.open(m=>{m?(o._reconnecting=!1,o.reconnect(),this.emitReserved("reconnect_error",m)):o.onreconnect()}))},d);this.opts.autoUnref&&u.unref(),this.subs.push(()=>{this.clearTimeoutFn(u)})}}onreconnect(){const o=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",o)}}const Ih={};function Gh(r,o){typeof r=="object"&&(o=r,r=void 0),o=o||{};const d=T$(r,o.path||"/socket.io"),u=d.source,m=d.id,E=d.path,y=Ih[m]&&E in Ih[m].nsps,b=o.forceNew||o["force new connection"]||o.multiplex===!1||y;let P;return b?P=new KR(u,o):(Ih[m]||(Ih[m]=new KR(u,o)),P=Ih[m]),d.query&&!o.query&&(o.query=d.queryKey),P.socket(d.path,o)}Object.assign(Gh,{Manager:KR,Socket:Lx,io:Gh,connect:Gh});var Mx={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},TM=zi.createContext&&zi.createContext(Mx),k$=["attr","size","title"];function L$(r,o){if(r==null)return{};var d=M$(r,o),u,m;if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(r);for(m=0;m<E.length;m++)u=E[m],!(o.indexOf(u)>=0)&&Object.prototype.propertyIsEnumerable.call(r,u)&&(d[u]=r[u])}return d}function M$(r,o){if(r==null)return{};var d={};for(var u in r)if(Object.prototype.hasOwnProperty.call(r,u)){if(o.indexOf(u)>=0)continue;d[u]=r[u]}return d}function Z_(){return Z_=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(r[u]=d[u])}return r},Z_.apply(this,arguments)}function vM(r,o){var d=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(m){return Object.getOwnPropertyDescriptor(r,m).enumerable})),d.push.apply(d,u)}return d}function eE(r){for(var o=1;o<arguments.length;o++){var d=arguments[o]!=null?arguments[o]:{};o%2?vM(Object(d),!0).forEach(function(u){U$(r,u,d[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(d)):vM(Object(d)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(d,u))})}return r}function U$(r,o,d){return o=x$(o),o in r?Object.defineProperty(r,o,{value:d,enumerable:!0,configurable:!0,writable:!0}):r[o]=d,r}function x$(r){var o=V$(r,"string");return typeof o=="symbol"?o:o+""}function V$(r,o){if(typeof r!="object"||!r)return r;var d=r[Symbol.toPrimitive];if(d!==void 0){var u=d.call(r,o||"default");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(r)}function Ux(r){return r&&r.map((o,d)=>zi.createElement(o.tag,eE({key:d},o.attr),Ux(o.child)))}function xx(r){return o=>zi.createElement(F$,Z_({attr:eE({},r.attr)},o),Ux(r.child))}function F$(r){var o=d=>{var{attr:u,size:m,title:E}=r,y=L$(r,k$),b=m||d.size||"1em",P;return d.className&&(P=d.className),r.className&&(P=(P?P+" ":"")+r.className),zi.createElement("svg",Z_({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},d.attr,u,y,{className:P,style:eE(eE({color:r.color||d.color},d.style),r.style),height:b,width:b,xmlns:"http://www.w3.org/2000/svg"}),E&&zi.createElement("title",null,E),r.children)};return TM!==void 0?zi.createElement(TM.Consumer,null,d=>o(d)):o(Mx)}function B$(r){return xx({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"2",x2:"22",y1:"2",y2:"22"},child:[]},{tag:"path",attr:{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2"},child:[]},{tag:"path",attr:{d:"M5 10v2a7 7 0 0 0 12 5"},child:[]},{tag:"path",attr:{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33"},child:[]},{tag:"path",attr:{d:"M9 9v3a3 3 0 0 0 5.12 2.12"},child:[]},{tag:"line",attr:{x1:"12",x2:"12",y1:"19",y2:"22"},child:[]}]})(r)}function j$(r){return xx({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"},child:[]},{tag:"path",attr:{d:"M19 10v2a7 7 0 0 1-14 0v-2"},child:[]},{tag:"line",attr:{x1:"12",x2:"12",y1:"19",y2:"22"},child:[]}]})(r)}var Vx={exports:{}};(function(r,o){(function(d,u){r.exports=u()})(Bm,function(){function d(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(i){if(i!=="default"&&!(i in n)){var s=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:function(){return t[i]}})}})}),Object.freeze(n)}var u=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Bm<"u"?Bm:typeof self<"u"?self:{};function m(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var E=function(n){try{return!!n()}catch{return!0}},y=!E(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),b=y,P=Function.prototype,U=P.call,K=b&&P.bind.bind(U,U),M=b?K:function(n){return function(){return U.apply(n,arguments)}},X=M({}.isPrototypeOf),oe=function(n){return n&&n.Math==Math&&n},Z=oe(typeof globalThis=="object"&&globalThis)||oe(typeof window=="object"&&window)||oe(typeof self=="object"&&self)||oe(typeof u=="object"&&u)||function(){return this}()||u||Function("return this")(),ne=y,Se=Function.prototype,J=Se.apply,H=Se.call,q=typeof Reflect=="object"&&Reflect.apply||(ne?H.bind(J):function(){return H.apply(J,arguments)}),ue=M,Re=ue({}.toString),be=ue("".slice),we=function(n){return be(Re(n),8,-1)},je=we,gt=M,Le=function(n){if(je(n)==="Function")return gt(n)},Dn=typeof document=="object"&&document.all,ki={all:Dn,IS_HTMLDDA:Dn===void 0&&Dn!==void 0},xr=ki.all,Bt=ki.IS_HTMLDDA?function(n){return typeof n=="function"||n===xr}:function(n){return typeof n=="function"},$e={},ht=!E(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Xi=y,Pe=Function.prototype.call,Me=Xi?Pe.bind(Pe):function(){return Pe.apply(Pe,arguments)},ot={},Je={}.propertyIsEnumerable,at=Object.getOwnPropertyDescriptor,Kn=at&&!Je.call({1:2},1);ot.f=Kn?function(n){var e=at(this,n);return!!e&&e.enumerable}:Je;var kn,Li,Ti=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}},sd=E,Bx=we,CE=Object,jx=M("".split),Tp=sd(function(){return!CE("z").propertyIsEnumerable(0)})?function(n){return Bx(n)=="String"?jx(n,""):CE(n)}:CE,vp=function(n){return n==null},Gx=vp,Wx=TypeError,Ql=function(n){if(Gx(n))throw Wx("Can't call method on "+n);return n},Hx=Tp,Kx=Ql,dc=function(n){return Hx(Kx(n))},tI=Bt,zx=ki.all,Er=ki.IS_HTMLDDA?function(n){return typeof n=="object"?n!==null:tI(n)||n===zx}:function(n){return typeof n=="object"?n!==null:tI(n)},Ms={},IE=Ms,wE=Z,Yx=Bt,nI=function(n){return Yx(n)?n:void 0},Mi=function(n,e){return arguments.length<2?nI(IE[n])||nI(wE[n]):IE[n]&&IE[n][e]||wE[n]&&wE[n][e]},lc=typeof navigator<"u"&&String(navigator.userAgent)||"",iI=Z,AE=lc,rI=iI.process,sI=iI.Deno,oI=rI&&rI.versions||sI&&sI.version,aI=oI&&oI.v8;aI&&(Li=(kn=aI.split("."))[0]>0&&kn[0]<4?1:+(kn[0]+kn[1])),!Li&&AE&&(!(kn=AE.match(/Edge\/(\d+)/))||kn[1]>=74)&&(kn=AE.match(/Chrome\/(\d+)/))&&(Li=+kn[1]);var uc=Li,cI=uc,qx=E,Jx=Z.String,od=!!Object.getOwnPropertySymbols&&!qx(function(){var n=Symbol();return!Jx(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&cI&&cI<41}),dI=od&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Xx=Mi,Qx=Bt,$x=X,Zx=Object,$l=dI?function(n){return typeof n=="symbol"}:function(n){var e=Xx("Symbol");return Qx(e)&&$x(e.prototype,Zx(n))},eV=String,ad=function(n){try{return eV(n)}catch{return"Object"}},tV=Bt,nV=ad,iV=TypeError,Vr=function(n){if(tV(n))return n;throw iV(nV(n)+" is not a function")},rV=Vr,sV=vp,OE=function(n,e){var t=n[e];return sV(t)?void 0:rV(t)},lI=Me,uI=Bt,hI=Er,oV=TypeError,pI={exports:{}},fI=Z,aV=Object.defineProperty,cV=function(n,e){try{aV(fI,n,{value:e,configurable:!0,writable:!0})}catch{fI[n]=e}return e},mI="__core-js_shared__",bE=Z[mI]||cV(mI,{}),_I=bE;(pI.exports=function(n,e){return _I[n]||(_I[n]=e!==void 0?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var cd=pI.exports,dV=Ql,lV=Object,Us=function(n){return lV(dV(n))},uV=Us,hV=M({}.hasOwnProperty),ai=Object.hasOwn||function(n,e){return hV(uV(n),e)},pV=M,fV=0,mV=Math.random(),_V=pV(1 .toString),NE=function(n){return"Symbol("+(n===void 0?"":n)+")_"+_V(++fV+mV,36)},EV=cd,EI=ai,gV=NE,SV=od,TV=dI,dd=Z.Symbol,PE=EV("wks"),vV=TV?dd.for||dd:dd&&dd.withoutSetter||gV,sn=function(n){return EI(PE,n)||(PE[n]=SV&&EI(dd,n)?dd[n]:vV("Symbol."+n)),PE[n]},yV=Me,gI=Er,SI=$l,RV=OE,CV=function(n,e){var t,i;if(uI(t=n.toString)&&!hI(i=lI(t,n))||uI(t=n.valueOf)&&!hI(i=lI(t,n)))return i;throw oV("Can't convert object to primitive value")},IV=TypeError,wV=sn("toPrimitive"),AV=function(n,e){if(!gI(n)||SI(n))return n;var t,i=RV(n,wV);if(i){if(t=yV(i,n,e),!gI(t)||SI(t))return t;throw IV("Can't convert object to primitive value")}return CV(n)},OV=$l,yp=function(n){var e=AV(n,"string");return OV(e)?e:e+""},TI=Er,DE=Z.document,bV=TI(DE)&&TI(DE.createElement),kE=function(n){return bV?DE.createElement(n):{}},NV=kE,vI=!ht&&!E(function(){return Object.defineProperty(NV("div"),"a",{get:function(){return 7}}).a!=7}),PV=ht,DV=Me,kV=ot,LV=Ti,MV=dc,UV=yp,xV=ai,VV=vI,yI=Object.getOwnPropertyDescriptor;$e.f=PV?yI:function(n,e){if(n=MV(n),e=UV(e),VV)try{return yI(n,e)}catch{}if(xV(n,e))return LV(!DV(kV.f,n,e),n[e])};var FV=E,BV=Bt,jV=/#|\.prototype\./,Zl=function(n,e){var t=WV[GV(n)];return t==KV||t!=HV&&(BV(e)?FV(e):!!e)},GV=Zl.normalize=function(n){return String(n).replace(jV,".").toLowerCase()},WV=Zl.data={},HV=Zl.NATIVE="N",KV=Zl.POLYFILL="P",RI=Zl,zV=Vr,YV=y,qV=Le(Le.bind),Yo=function(n,e){return zV(n),e===void 0?n:YV?qV(n,e):function(){return n.apply(e,arguments)}},Fr={},CI=ht&&E(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),JV=Er,XV=String,QV=TypeError,gr=function(n){if(JV(n))return n;throw QV(XV(n)+" is not an object")},$V=ht,ZV=vI,eF=CI,Rp=gr,II=yp,tF=TypeError,LE=Object.defineProperty,nF=Object.getOwnPropertyDescriptor,ME="enumerable",UE="configurable",xE="writable";Fr.f=$V?eF?function(n,e,t){if(Rp(n),e=II(e),Rp(t),typeof n=="function"&&e==="prototype"&&"value"in t&&xE in t&&!t[xE]){var i=nF(n,e);i&&i[xE]&&(n[e]=t.value,t={configurable:UE in t?t[UE]:i[UE],enumerable:ME in t?t[ME]:i[ME],writable:!1})}return LE(n,e,t)}:LE:function(n,e,t){if(Rp(n),e=II(e),Rp(t),ZV)try{return LE(n,e,t)}catch{}if("get"in t||"set"in t)throw tF("Accessors not supported");return"value"in t&&(n[e]=t.value),n};var iF=Fr,rF=Ti,qo=ht?function(n,e,t){return iF.f(n,e,rF(1,t))}:function(n,e,t){return n[e]=t,n},Cp=Z,sF=q,oF=Le,aF=Bt,cF=$e.f,dF=RI,ld=Ms,lF=Yo,ud=qo,wI=ai,uF=function(n){var e=function(t,i,s){if(this instanceof e){switch(arguments.length){case 0:return new n;case 1:return new n(t);case 2:return new n(t,i)}return new n(t,i,s)}return sF(n,this,arguments)};return e.prototype=n.prototype,e},Nt=function(n,e){var t,i,s,a,c,l,h,p,f,_=n.target,g=n.global,T=n.stat,w=n.proto,R=g?Cp:T?Cp[_]:(Cp[_]||{}).prototype,I=g?ld:ld[_]||ud(ld,_,{})[_],N=I.prototype;for(a in e)i=!(t=dF(g?a:_+(T?".":"#")+a,n.forced))&&R&&wI(R,a),l=I[a],i&&(h=n.dontCallGetSet?(f=cF(R,a))&&f.value:R[a]),c=i&&h?h:e[a],i&&typeof l==typeof c||(p=n.bind&&i?lF(c,Cp):n.wrap&&i?uF(c):w&&aF(c)?oF(c):c,(n.sham||c&&c.sham||l&&l.sham)&&ud(p,"sham",!0),ud(I,a,p),w&&(wI(ld,s=_+"Prototype")||ud(ld,s,{}),ud(ld[s],a,c),n.real&&N&&(t||!N[a])&&ud(N,a,c)))},hF=Math.ceil,pF=Math.floor,fF=Math.trunc||function(n){var e=+n;return(e>0?pF:hF)(e)},VE=function(n){var e=+n;return e!=e||e===0?0:fF(e)},mF=VE,_F=Math.max,EF=Math.min,AI=function(n,e){var t=mF(n);return t<0?_F(t+e,0):EF(t,e)},gF=VE,SF=Math.min,TF=function(n){return n>0?SF(gF(n),9007199254740991):0},Jo=function(n){return TF(n.length)},vF=dc,yF=AI,RF=Jo,OI=function(n){return function(e,t,i){var s,a=vF(e),c=RF(a),l=yF(i,c);if(n&&t!=t){for(;c>l;)if((s=a[l++])!=s)return!0}else for(;c>l;l++)if((n||l in a)&&a[l]===t)return n||l||0;return!n&&-1}},FE={includes:OI(!0),indexOf:OI(!1)},CF=FE.includes;Nt({target:"Array",proto:!0,forced:E(function(){return!Array(1).includes()})},{includes:function(n){return CF(this,n,arguments.length>1?arguments[1]:void 0)}});var IF=Ms,Xo=function(n){return IF[n+"Prototype"]},wF=Xo("Array").includes,AF=Er,OF=we,bF=sn("match"),NF=function(n){var e;return AF(n)&&((e=n[bF])!==void 0?!!e:OF(n)=="RegExp")},PF=TypeError,bI={};bI[sn("toStringTag")]="z";var BE=String(bI)==="[object z]",DF=BE,kF=Bt,Ip=we,LF=sn("toStringTag"),MF=Object,UF=Ip(function(){return arguments}())=="Arguments",Qo=DF?Ip:function(n){var e,t,i;return n===void 0?"Undefined":n===null?"Null":typeof(t=function(s,a){try{return s[a]}catch{}}(e=MF(n),LF))=="string"?t:UF?Ip(e):(i=Ip(e))=="Object"&&kF(e.callee)?"Arguments":i},xF=Qo,VF=String,Br=function(n){if(xF(n)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return VF(n)},FF=sn("match"),BF=Nt,jF=function(n){if(NF(n))throw PF("The method doesn't accept regular expressions");return n},GF=Ql,NI=Br,WF=function(n){var e=/./;try{"/./"[n](e)}catch{try{return e[FF]=!1,"/./"[n](e)}catch{}}return!1},HF=M("".indexOf);BF({target:"String",proto:!0,forced:!WF("includes")},{includes:function(n){return!!~HF(NI(GF(this)),NI(jF(n)),arguments.length>1?arguments[1]:void 0)}});var KF=Xo("String").includes,PI=X,zF=wF,YF=KF,jE=Array.prototype,GE=String.prototype,fe=m(function(n){var e=n.includes;return n===jE||PI(jE,n)&&e===jE.includes?zF:typeof n=="string"||n===GE||PI(GE,n)&&e===GE.includes?YF:e});let DI=!0,kI=!0;function wp(n,e,t){const i=n.match(e);return i&&i.length>=t&&parseInt(i[t],10)}function hc(n,e,t){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(c,l){if(c!==e)return s.apply(this,arguments);const h=p=>{const f=t(p);f&&(l.handleEvent?l.handleEvent(f):l(f))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,h),s.apply(this,[c,h])};const a=i.removeEventListener;i.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return a.apply(this,arguments);if(!this._eventMap[e].has(l))return a.apply(this,arguments);const h=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[c,h])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function qF(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(DI=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function JF(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(kI=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function LI(){if(typeof window=="object"){if(DI)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function WE(n,e){kI&&console.warn(n+" is deprecated, please use "+e+" instead.")}function MI(n){return Object.prototype.toString.call(n)==="[object Object]"}function UI(n){return MI(n)?Object.keys(n).reduce(function(e,t){const i=MI(n[t]),s=i?UI(n[t]):n[t],a=i&&!Object.keys(s).length;return s===void 0||a?e:Object.assign(e,{[t]:s})},{}):n}function HE(n,e,t){e&&!t.has(e.id)&&(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?HE(n,n.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(s=>{HE(n,n.get(s),t)})}))}function xI(n,e,t){const i=t?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const a=[];return n.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&a.push(c)}),a.forEach(c=>{n.forEach(l=>{l.type===i&&l.trackId===c.id&&HE(n,l,s)})}),s}const VI=LI;function FI(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const p=typeof c[h]=="object"?c[h]:{ideal:c[h]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const f=function(_,g){return _?_+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(p.ideal!==void 0){l.optional=l.optional||[];let _={};typeof p.ideal=="number"?(_[f("min",h)]=p.ideal,l.optional.push(_),_={},_[f("max",h)]=p.ideal,l.optional.push(_)):(_[f("",h)]=p.ideal,l.optional.push(_))}p.exact!==void 0&&typeof p.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[f("",h)]=p.exact):["min","max"].forEach(_=>{p[_]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[f(_,h)]=p[_])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},s=function(c,l){if(e.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const h=function(p,f,_){f in p&&!(_ in p)&&(p[_]=p[f],delete p[f])};h((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),h(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let h=c.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const p=e.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||p)){let f;if(delete c.video.facingMode,h.exact==="environment"||h.ideal==="environment"?f=["back","rear"]:h.exact!=="user"&&h.ideal!=="user"||(f=["front"]),f)return t.mediaDevices.enumerateDevices().then(_=>{let g=(_=_.filter(T=>T.kind==="videoinput")).find(T=>f.some(w=>T.label.toLowerCase().includes(w)));return!g&&_.length&&f.includes("back")&&(g=_[_.length-1]),g&&(c.video.deviceId=h.exact?{exact:g.deviceId}:{ideal:g.deviceId}),c.video=i(c.video),VI("chrome: "+JSON.stringify(c)),l(c)})}c.video=i(c.video)}return VI("chrome: "+JSON.stringify(c)),l(c)},a=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=(function(c,l,h){s(c,p=>{t.webkitGetUserMedia(p,l,f=>{h&&h(a(f))})})}).bind(t),t.mediaDevices.getUserMedia){const c=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(l){return s(l,h=>c(h).then(p=>{if(h.audio&&!p.getAudioTracks().length||h.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(a(p))))}}}function BI(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function jI(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",i=>{let s;s=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const a=new Event("track");a.track=i.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[t.stream],this.dispatchEvent(a)}),t.stream.getTracks().forEach(i=>{let s;s=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const a=new Event("track");a.track=i,a.receiver=s,a.transceiver={receiver:s},a.streams=[t.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else hc(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function GI(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(s,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=s.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(c,l){let h=s.apply(this,arguments);return h||(h=e(this,c),this._senders.push(h)),h};const a=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(c){a.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(a=>{const c=this._senders.find(l=>l.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const t=e.apply(this,[]);return t.forEach(i=>i._pc=this),t},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function WI(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[t,i,s]=arguments;if(arguments.length>0&&typeof t=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof t!="function"))return e.apply(this,[]);const a=function(l){const h={};return l.result().forEach(p=>{const f={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(_=>{f[_]=p.stat(_)}),h[f.id]=f}),h},c=function(l){return new Map(Object.keys(l).map(h=>[h,l[h]]))};if(arguments.length>=2){const l=function(h){i(c(a(h)))};return e.apply(this,[l,t])}return new Promise((l,h)=>{e.apply(this,[function(p){l(c(a(p)))},h])}).then(i,s)}}function HI(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(a=>a._pc=this),s});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>xI(a,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i}),hc(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>xI(s,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype)||!("getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const t=arguments[0];let i,s,a;return this.getSenders().forEach(c=>{c.track===t&&(i?a=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===t&&(s?a=!0:s=c),c.track===t)),a||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function KI(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(h=>{if(this.getSenders().find(p=>p.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();t.apply(this,arguments);const l=this.getSenders().filter(h=>c.indexOf(h)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(a);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),s.apply(this,arguments)}}function zI(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return KI(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const h=t.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(p=>this._reverseStreams[p.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(p=>{if(this.getSenders().find(f=>f.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const p=new n.MediaStream(h.getTracks());this._streams[h.id]=p,this._reverseStreams[p.id]=h,h=p}i.apply(this,[h])};const s=n.RTCPeerConnection.prototype.removeStream;function a(h,p){let f=p.sdp;return Object.keys(h._reverseStreams||[]).forEach(_=>{const g=h._reverseStreams[_],T=h._streams[g.id];f=f.replace(new RegExp(T.id,"g"),g.id)}),new RTCSessionDescription({type:p.type,sdp:f})}n.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},n.RTCPeerConnection.prototype.addTrack=function(h,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(g=>g===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const _=this._streams[p.id];if(_)_.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new n.MediaStream([h]);this._streams[p.id]=g,this._reverseStreams[g.id]=p,this.addStream(g)}return this.getSenders().find(g=>g.track===h)},["createOffer","createAnswer"].forEach(function(h){const p=n.RTCPeerConnection.prototype[h],f={[h](){const _=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[g=>{const T=a(this,g);_[0].apply(null,[T])},g=>{_[1]&&_[1].apply(null,g)},arguments[2]]):p.apply(this,arguments).then(g=>a(this,g))}};n.RTCPeerConnection.prototype[h]=f[h]});const c=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(h,p){let f=p.sdp;return Object.keys(h._reverseStreams||[]).forEach(_=>{const g=h._reverseStreams[_],T=h._streams[g.id];f=f.replace(new RegExp(g.id,"g"),T.id)}),new RTCSessionDescription({type:p.type,sdp:f})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const h=l.get.apply(this);return h.type===""?h:a(this,h)}}),n.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(_=>h.track===_)&&(p=this._streams[f])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function KE(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=n.RTCPeerConnection.prototype[t],s={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=s[t]})}function YI(n,e){hc(n,"negotiationneeded",t=>{const i=t.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return t})}var qI=Object.freeze({__proto__:null,fixNegotiationNeeded:YI,shimAddTrackRemoveTrack:zI,shimAddTrackRemoveTrackWithNative:KI,shimGetDisplayMedia:function(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(typeof e=="function"?n.navigator.mediaDevices.getDisplayMedia=function(t){return e(t).then(i=>{const s=t.video&&t.video.width,a=t.video&&t.video.height,c=t.video&&t.video.frameRate;return t.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},s&&(t.video.mandatory.maxWidth=s),a&&(t.video.mandatory.maxHeight=a),n.navigator.mediaDevices.getUserMedia(t)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:GI,shimGetStats:WI,shimGetUserMedia:FI,shimMediaStream:BI,shimOnTrack:jI,shimPeerConnection:KE,shimSenderReceiverGetStats:HI});function JI(n,e){const t=n&&n.navigator,i=n&&n.MediaStreamTrack;if(t.getUserMedia=function(s,a,c){WE("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(s).then(a,c)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const s=function(c,l,h){l in c&&!(h in c)&&(c[h]=c[l],delete c[l])},a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),s(c.audio,"autoGainControl","mozAutoGainControl"),s(c.audio,"noiseSuppression","mozNoiseSuppression")),a(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const l=c.apply(this,arguments);return s(l,"mozAutoGainControl","autoGainControl"),s(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),s(l,"autoGainControl","mozAutoGainControl"),s(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function XI(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function zE(n,e){if(typeof n!="object"||!n.RTCPeerConnection&&!n.mozRTCPeerConnection)return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const a=n.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=c[s]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;return i.apply(this,[s||null]).then(l=>{if(e.version<53&&!a)try{l.forEach(h=>{h.type=t[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;l.forEach((p,f)=>{l.set(f,Object.assign({},p,{type:t[p.type]||p.type}))})}return l}).then(a,c)}}function QI(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=t.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function $I(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const t=e.apply(this,[]);return t.forEach(i=>i._pc=this),t}),hc(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ZI(n){n.RTCPeerConnection&&!("removeStream"in n.RTCPeerConnection.prototype)&&(n.RTCPeerConnection.prototype.removeStream=function(e){WE("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function e0(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function t0(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let t=arguments[1]&&arguments[1].sendEncodings;t===void 0&&(t=[]),t=[...t];const i=t.length>0;i&&t.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:a}=s,c=a.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=t,a.sendEncodings=t,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return s})}function n0(n){if(typeof n!="object"||!n.RTCRtpSender)return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const t=e.apply(this,arguments);return"encodings"in t||(t.encodings=[].concat(this.sendEncodings||[{}])),t})}function i0(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function r0(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var s0=Object.freeze({__proto__:null,shimAddTransceiver:t0,shimCreateAnswer:r0,shimCreateOffer:i0,shimGetDisplayMedia:function(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(t){if(!t||!t.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return t.video===!0?t.video={mediaSource:e}:t.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(t)})},shimGetParameters:n0,shimGetUserMedia:JI,shimOnTrack:XI,shimPeerConnection:zE,shimRTCDataChannel:e0,shimReceiverGetStats:$I,shimRemoveStream:ZI,shimSenderGetStats:QI});function o0(n){if(typeof n=="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(i=>e.call(this,i,t)),t.getVideoTracks().forEach(i=>e.call(this,i,t))},n.RTCPeerConnection.prototype.addTrack=function(t,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(t===-1)return;this._localStreams.splice(t,1);const i=e.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function a0(n){if(typeof n=="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,this.dispatchEvent(a)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(t._remoteStreams||(t._remoteStreams=[]),t._remoteStreams.indexOf(s)>=0)return;t._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,t.dispatchEvent(a)})}),e.apply(t,arguments)}}}function c0(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,s=e.setLocalDescription,a=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(h,p){const f=arguments.length>=2?arguments[2]:arguments[0],_=t.apply(this,[f]);return p?(_.then(h,p),Promise.resolve()):_},e.createAnswer=function(h,p){const f=arguments.length>=2?arguments[2]:arguments[0],_=i.apply(this,[f]);return p?(_.then(h,p),Promise.resolve()):_};let l=function(h,p,f){const _=s.apply(this,[h]);return f?(_.then(p,f),Promise.resolve()):_};e.setLocalDescription=l,l=function(h,p,f){const _=a.apply(this,[h]);return f?(_.then(p,f),Promise.resolve()):_},e.setRemoteDescription=l,l=function(h,p,f){const _=c.apply(this,[h]);return f?(_.then(p,f),Promise.resolve()):_},e.addIceCandidate=l}function d0(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=s=>i(l0(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(t,i,s){e.mediaDevices.getUserMedia(t).then(i,s)}).bind(e))}function l0(n){return n&&n.video!==void 0?Object.assign({},n,{video:UI(n.video)}):n}function u0(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(t,i){if(t&&t.iceServers){const s=[];for(let a=0;a<t.iceServers.length;a++){let c=t.iceServers[a];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(WE("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,s.push(c)):s.push(t.iceServers[a])}t.iceServers=s}return new e(t,i)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function h0(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function p0(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(t){if(t){t.offerToReceiveAudio!==void 0&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");t.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):t.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),t.offerToReceiveVideo!==void 0&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);const s=this.getTransceivers().find(a=>a.receiver.track.kind==="video");t.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):t.offerToReceiveVideo!==!0||s||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function f0(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var m0=Object.freeze({__proto__:null,shimAudioContext:f0,shimCallbacksAPI:c0,shimConstraints:l0,shimCreateOfferLegacy:p0,shimGetUserMedia:d0,shimLocalStreamsAPI:o0,shimRTCIceServerUrls:u0,shimRemoteStreamsAPI:a0,shimTrackEventTransceiver:h0}),_0={exports:{}};(function(n){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(t){return t.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(t){const i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){const i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(s=>s.indexOf(i)===0)},e.parseCandidate=function(t){let i;i=t.indexOf("a=candidate:")===0?t.substring(12).split(" "):t.substring(10).split(" ");const s={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let a=8;a<i.length;a+=2)switch(i[a]){case"raddr":s.relatedAddress=i[a+1];break;case"rport":s.relatedPort=parseInt(i[a+1],10);break;case"tcptype":s.tcpType=i[a+1];break;case"ufrag":s.ufrag=i[a+1],s.usernameFragment=i[a+1];break;default:s[i[a]]===void 0&&(s[i[a]]=i[a+1])}return s},e.writeCandidate=function(t){const i=[];i.push(t.foundation);const s=t.component;s==="rtp"?i.push(1):s==="rtcp"?i.push(2):i.push(s),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);const a=t.type;return i.push("typ"),i.push(a),a!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let i=t.substring(9).split(" ");const s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(t){let i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);const s=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(t){const i=t.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const i={};let s;const a=t.substring(t.indexOf(" ")+1).split(";");for(let c=0;c<a.length;c++)s=a[c].trim().split("="),i[s[0].trim()]=s[1];return i},e.writeFmtp=function(t){let i="",s=t.payloadType;if(t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const a=[];Object.keys(t.parameters).forEach(c=>{t.parameters[c]!==void 0?a.push(c+"="+t.parameters[c]):a.push(c)}),i+="a=fmtp:"+s+" "+a.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){const i=t.substring(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){let i="",s=t.payloadType;return t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(a=>{i+="a=rtcp-fb:"+s+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){const i=t.indexOf(" "),s={ssrc:parseInt(t.substring(7,i),10)},a=t.indexOf(":",i);return a>-1?(s.attribute=t.substring(i+1,a),s.value=t.substring(a+1)):s.attribute=t.substring(i+1),s},e.parseSsrcGroup=function(t){const i=t.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(s=>parseInt(s,10))}},e.getMid=function(t){const i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(t){const i=t.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(t,i){return{role:"auto",fingerprints:e.matchPrefix(t+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){let s="a=setup:"+i+`\r
`;return t.fingerprints.forEach(a=>{s+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),s},e.parseCryptoLine=function(t){const i=t.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const i=t.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){return e.matchPrefix(t+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,i){const s=e.matchPrefix(t+i,"a=ice-ufrag:")[0],a=e.matchPrefix(t+i,"a=ice-pwd:")[0];return s&&a?{usernameFragment:s.substring(12),password:a.substring(10)}:null},e.writeIceParameters=function(t){let i="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(t){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(t)[0].split(" ");i.profile=s[2];for(let c=3;c<s.length;c++){const l=s[c],h=e.matchPrefix(t,"a=rtpmap:"+l+" ")[0];if(h){const p=e.parseRtpMap(h),f=e.matchPrefix(t,"a=fmtp:"+l+" ");switch(p.parameters=f.length?e.parseFmtp(f[0]):{},p.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(p.name.toUpperCase())}}}e.matchPrefix(t,"a=extmap:").forEach(c=>{i.headerExtensions.push(e.parseExtmap(c))});const a=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(c=>{a.forEach(l=>{c.rtcpFeedback.find(h=>h.type===l.type&&h.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(t,i){let s="";s+="m="+t+" ",s+=i.codecs.length>0?"9":"0",s+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{s+=e.writeRtpMap(c),s+=e.writeFmtp(c),s+=e.writeRtcpFb(c)});let a=0;return i.codecs.forEach(c=>{c.maxptime>a&&(a=c.maxptime)}),a>0&&(s+="a=maxptime:"+a+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{s+=e.writeExtmap(c)}),s},e.parseRtpEncodingParameters=function(t){const i=[],s=e.parseRtpParameters(t),a=s.fecMechanisms.indexOf("RED")!==-1,c=s.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(t,"a=ssrc:").map(g=>e.parseSsrcMedia(g)).filter(g=>g.attribute==="cname"),h=l.length>0&&l[0].ssrc;let p;const f=e.matchPrefix(t,"a=ssrc-group:FID").map(g=>g.substring(17).split(" ").map(T=>parseInt(T,10)));f.length>0&&f[0].length>1&&f[0][0]===h&&(p=f[0][1]),s.codecs.forEach(g=>{if(g.name.toUpperCase()==="RTX"&&g.parameters.apt){let T={ssrc:h,codecPayloadType:parseInt(g.parameters.apt,10)};h&&p&&(T.rtx={ssrc:p}),i.push(T),a&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:h,mechanism:c?"red+ulpfec":"red"},i.push(T))}}),i.length===0&&h&&i.push({ssrc:h});let _=e.matchPrefix(t,"b=");return _.length&&(_=_[0].indexOf("b=TIAS:")===0?parseInt(_[0].substring(7),10):_[0].indexOf("b=AS:")===0?1e3*parseInt(_[0].substring(5),10)*.95-16e3:void 0,i.forEach(g=>{g.maxBitrate=_})),i},e.parseRtcpParameters=function(t){const i={},s=e.matchPrefix(t,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);const a=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=a.length>0,i.compound=a.length===0;const c=e.matchPrefix(t,"a=rtcp-mux");return i.mux=c.length>0,i},e.writeRtcpParameters=function(t){let i="";return t.reducedSize&&(i+=`a=rtcp-rsize\r
`),t.mux&&(i+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(i+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),i},e.parseMsid=function(t){let i;const s=e.matchPrefix(t,"a=msid:");if(s.length===1)return i=s[0].substring(7).split(" "),{stream:i[0],track:i[1]};const a=e.matchPrefix(t,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return a.length>0?(i=a[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(t){const i=e.parseMLine(t),s=e.matchPrefix(t,"a=max-message-size:");let a;s.length>0&&(a=parseInt(s[0].substring(19),10)),isNaN(a)&&(a=65536);const c=e.matchPrefix(t,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:a};const l=e.matchPrefix(t,"a=sctpmap:");if(l.length>0){const h=l[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:a}}},e.writeSctpDescription=function(t,i){let s=[];return s=t.protocol!=="DTLS/SCTP"?["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,i,s){let a;const c=i!==void 0?i:2;return a=t||e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+a+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,i){const s=e.splitLines(t);for(let a=0;a<s.length;a++)switch(s[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[a].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const i=e.splitLines(t)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(t){const i=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const i=e.splitLines(t);for(let s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},n.exports=e})(_0);var E0=_0.exports,hd=m(E0),XF=d({__proto__:null,default:hd},[E0]);function Ap(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(t){if(typeof t=="object"&&t.candidate&&t.candidate.indexOf("a=")===0&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substr(2)),t.candidate&&t.candidate.length){const i=new e(t),s=hd.parseCandidate(t.candidate),a=Object.assign(i,s);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new e(t)},n.RTCIceCandidate.prototype=e.prototype,hc(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function YE(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||hc(n,"icecandidate",e=>{if(e.candidate){const t=hd.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function Op(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const t=function(l){if(!l||!l.sdp)return!1;const h=hd.splitSections(l.sdp);return h.shift(),h.some(p=>{const f=hd.parseMLine(p);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1})},i=function(l){const h=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const p=parseInt(h[1],10);return p!=p?-1:p},s=function(l){let h=65536;return e.browser==="firefox"&&(h=e.version<57?l===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),h},a=function(l,h){let p=65536;e.browser==="firefox"&&e.version===57&&(p=65535);const f=hd.matchPrefix(l.sdp,"a=max-message-size:");return f.length>0?p=parseInt(f[0].substr(19),10):e.browser==="firefox"&&h!==-1&&(p=2147483637),p},c=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const l=i(arguments[0]),h=s(l),p=a(arguments[0],l);let f;f=h===0&&p===0?Number.POSITIVE_INFINITY:h===0||p===0?Math.max(h,p):Math.min(h,p);const _={};Object.defineProperty(_,"maxMessageSize",{get:()=>f}),this._sctp=_}return c.apply(this,arguments)}}function bp(n){if(!n.RTCPeerConnection||!("createDataChannel"in n.RTCPeerConnection.prototype))return;function e(i,s){const a=i.send;i.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(i.readyState==="open"&&s.sctp&&l>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return a.apply(i,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const i=t.apply(this,arguments);return e(i,this),i},hc(n,"datachannel",i=>(e(i.channel,i.target),i))}function qE(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const a=s.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const c=new Event("connectionstatechange",s);a.dispatchEvent(c)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function JE(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return t.apply(this,arguments)}}function Np(n,e){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const t=n.RTCPeerConnection.prototype.addIceCandidate;t&&t.length!==0&&(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Pp(n,e){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const t=n.RTCPeerConnection.prototype.setLocalDescription;t&&t.length!==0&&(n.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return t.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?t.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>t.apply(this,[s]))})}var QF=Object.freeze({__proto__:null,removeExtmapAllowMixed:JE,shimAddIceCandidateNullOrEmpty:Np,shimConnectionState:qE,shimMaxMessageSize:Op,shimParameterlessSetLocalDescription:Pp,shimRTCIceCandidate:Ap,shimRTCIceCandidateRelayProtocol:YE,shimSendThrowTypeError:bp});(function({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=LI,i=function(a){const c={browser:null,version:null};if(a===void 0||!a.navigator)return c.browser="Not a browser.",c;const{navigator:l}=a;if(l.mozGetUserMedia)c.browser="firefox",c.version=wp(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||a.isSecureContext===!1&&a.webkitRTCPeerConnection)c.browser="chrome",c.version=wp(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!a.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=wp(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype}return c}(n),s={browserDetails:i,commonShim:QF,extractVersion:wp,disableLog:qF,disableWarnings:JF,sdp:XF};switch(i.browser){case"chrome":if(!qI||!KE||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),s;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),s;t("adapter.js shimming chrome."),s.browserShim=qI,Np(n,i),Pp(n),FI(n,i),BI(n),KE(n,i),jI(n),zI(n,i),GI(n),WI(n),HI(n),YI(n,i),Ap(n),YE(n),qE(n),Op(n,i),bp(n),JE(n,i);break;case"firefox":if(!s0||!zE||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),s;t("adapter.js shimming firefox."),s.browserShim=s0,Np(n,i),Pp(n),JI(n,i),zE(n,i),XI(n),ZI(n),QI(n),$I(n),e0(n),t0(n),n0(n),i0(n),r0(n),Ap(n),qE(n),Op(n,i),bp(n);break;case"safari":if(!m0||!e.shimSafari)return t("Safari shim is not included in this adapter release."),s;t("adapter.js shimming safari."),s.browserShim=m0,Np(n,i),Pp(n),u0(n),p0(n),c0(n),o0(n),a0(n),h0(n),d0(n),f0(n),Ap(n),YE(n),Op(n,i),bp(n),JE(n,i);break;default:t("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var g0={exports:{}},$F=Nt,ZF=ht,S0=Fr.f;$F({target:"Object",stat:!0,forced:Object.defineProperty!==S0,sham:!ZF},{defineProperty:S0});var T0=Ms.Object,eB=g0.exports=function(n,e,t){return T0.defineProperty(n,e,t)};T0.defineProperty.sham&&(eB.sham=!0);var tB=m(g0.exports),nB=we,XE=Array.isArray||function(n){return nB(n)=="Array"},iB=TypeError,rB=yp,sB=Fr,oB=Ti,QE=function(n,e,t){var i=rB(e);i in n?sB.f(n,i,oB(0,t)):n[i]=t},aB=Bt,$E=bE,cB=M(Function.toString);aB($E.inspectSource)||($E.inspectSource=function(n){return cB(n)});var v0=$E.inspectSource,dB=M,lB=E,y0=Bt,uB=Qo,hB=v0,R0=function(){},pB=[],C0=Mi("Reflect","construct"),ZE=/^\s*(?:class|function)\b/,fB=dB(ZE.exec),mB=!ZE.exec(R0),eu=function(n){if(!y0(n))return!1;try{return C0(R0,pB,n),!0}catch{return!1}},I0=function(n){if(!y0(n))return!1;switch(uB(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return mB||!!fB(ZE,hB(n))}catch{return!0}};I0.sham=!0;var eg=!C0||lB(function(){var n;return eu(eu.call)||!eu(Object)||!eu(function(){n=!0})||n})?I0:eu,w0=XE,_B=eg,EB=Er,gB=sn("species"),A0=Array,SB=function(n){var e;return w0(n)&&(e=n.constructor,(_B(e)&&(e===A0||w0(e.prototype))||EB(e)&&(e=e[gB])===null)&&(e=void 0)),e===void 0?A0:e},O0=function(n,e){return new(SB(n))(e===0?0:e)},TB=E,vB=uc,yB=sn("species"),RB=Nt,CB=E,IB=XE,wB=Er,AB=Us,OB=Jo,b0=function(n){if(n>9007199254740991)throw iB("Maximum allowed index exceeded");return n},N0=QE,bB=O0,NB=function(n){return vB>=51||!TB(function(){var e=[];return(e.constructor={})[yB]=function(){return{foo:1}},e[n](Boolean).foo!==1})},PB=uc,P0=sn("isConcatSpreadable"),DB=PB>=51||!CB(function(){var n=[];return n[P0]=!1,n.concat()[0]!==n}),kB=function(n){if(!wB(n))return!1;var e=n[P0];return e!==void 0?!!e:IB(n)};RB({target:"Array",proto:!0,arity:1,forced:!DB||!NB("concat")},{concat:function(n){var e,t,i,s,a,c=AB(this),l=bB(c,0),h=0;for(e=-1,i=arguments.length;e<i;e++)if(kB(a=e===-1?c:arguments[e]))for(s=OB(a),b0(h+s),t=0;t<s;t++,h++)t in a&&N0(l,h,a[t]);else b0(h+1),N0(l,h++,a);return l.length=h,l}});var tg={},Dp={},ng=ai,LB=dc,MB=FE.indexOf,UB=Dp,D0=M([].push),k0=function(n,e){var t,i=LB(n),s=0,a=[];for(t in i)!ng(UB,t)&&ng(i,t)&&D0(a,t);for(;e.length>s;)ng(i,t=e[s++])&&(~MB(a,t)||D0(a,t));return a},ig=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],xB=k0,VB=ig,kp=Object.keys||function(n){return xB(n,VB)},FB=ht,BB=CI,jB=Fr,GB=gr,WB=dc,HB=kp;tg.f=FB&&!BB?Object.defineProperties:function(n,e){GB(n);for(var t,i=WB(e),s=HB(e),a=s.length,c=0;a>c;)jB.f(n,t=s[c++],i[t]);return n};var Lp,L0=Mi("document","documentElement"),KB=NE,M0=cd("keys"),Mp=function(n){return M0[n]||(M0[n]=KB(n))},zB=gr,YB=tg,U0=ig,qB=Dp,JB=L0,XB=kE,rg="prototype",sg="script",x0=Mp("IE_PROTO"),og=function(){},V0=function(n){return"<"+sg+">"+n+"</"+sg+">"},F0=function(n){n.write(V0("")),n.close();var e=n.parentWindow.Object;return n=null,e},Up=function(){try{Lp=new ActiveXObject("htmlfile")}catch{}var n,e,t;Up=typeof document<"u"?document.domain&&Lp?F0(Lp):(e=XB("iframe"),t="java"+sg+":",e.style.display="none",JB.appendChild(e),e.src=String(t),(n=e.contentWindow.document).open(),n.write(V0("document.F=Object")),n.close(),n.F):F0(Lp);for(var i=U0.length;i--;)delete Up[rg][U0[i]];return Up()};qB[x0]=!0;var tu=Object.create||function(n,e){var t;return n!==null?(og[rg]=zB(n),t=new og,og[rg]=null,t[x0]=n):t=Up(),e===void 0?t:YB.f(t,e)},xp={},QB=k0,$B=ig.concat("length","prototype");xp.f=Object.getOwnPropertyNames||function(n){return QB(n,$B)};var B0={},j0=AI,ZB=Jo,ej=QE,tj=Array,nj=Math.max,ag=function(n,e,t){for(var i=ZB(n),s=j0(e,i),a=j0(t===void 0?i:t,i),c=tj(nj(a-s,0)),l=0;s<a;s++,l++)ej(c,l,n[s]);return c.length=l,c},ij=we,rj=dc,G0=xp.f,sj=ag,W0=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];B0.f=function(n){return W0&&ij(n)=="Window"?function(e){try{return G0(e)}catch{return sj(W0)}}(n):G0(rj(n))};var nu={};nu.f=Object.getOwnPropertySymbols;var oj=qo,$o=function(n,e,t,i){return i&&i.enumerable?n[e]=t:oj(n,e,t),n},aj=Fr,Vp=function(n,e,t){return aj.f(n,e,t)},pd={},cj=sn;pd.f=cj;var Fp,iu,Bp,H0=Ms,dj=ai,lj=pd,uj=Fr.f,Ln=function(n){var e=H0.Symbol||(H0.Symbol={});dj(e,n)||uj(e,n,{value:lj.f(n)})},hj=Me,pj=Mi,fj=sn,mj=$o,K0=function(){var n=pj("Symbol"),e=n&&n.prototype,t=e&&e.valueOf,i=fj("toPrimitive");e&&!e[i]&&mj(e,i,function(s){return hj(t,this)},{arity:1})},_j=Qo,Ej=BE?{}.toString:function(){return"[object "+_j(this)+"]"},gj=BE,Sj=Fr.f,Tj=qo,vj=ai,yj=Ej,z0=sn("toStringTag"),Zo=function(n,e,t,i){if(n){var s=t?n:n.prototype;vj(s,z0)||Sj(s,z0,{configurable:!0,value:e}),i&&!gj&&Tj(s,"toString",yj)}},Rj=Bt,Y0=Z.WeakMap,Cj=Rj(Y0)&&/native code/.test(String(Y0)),q0=Z,Ij=Er,wj=qo,cg=ai,dg=bE,Aj=Mp,Oj=Dp,J0="Object already initialized",lg=q0.TypeError,bj=q0.WeakMap;if(Cj||dg.state){var xs=dg.state||(dg.state=new bj);xs.get=xs.get,xs.has=xs.has,xs.set=xs.set,Fp=function(n,e){if(xs.has(n))throw lg(J0);return e.facade=n,xs.set(n,e),e},iu=function(n){return xs.get(n)||{}},Bp=function(n){return xs.has(n)}}else{var fd=Aj("state");Oj[fd]=!0,Fp=function(n,e){if(cg(n,fd))throw lg(J0);return e.facade=n,wj(n,fd,e),e},iu=function(n){return cg(n,fd)?n[fd]:{}},Bp=function(n){return cg(n,fd)}}var md={set:Fp,get:iu,has:Bp,enforce:function(n){return Bp(n)?iu(n):Fp(n,{})},getterFor:function(n){return function(e){var t;if(!Ij(e)||(t=iu(e)).type!==n)throw lg("Incompatible receiver, "+n+" required");return t}}},Nj=Yo,Pj=Tp,Dj=Us,kj=Jo,Lj=O0,X0=M([].push),ea=function(n){var e=n==1,t=n==2,i=n==3,s=n==4,a=n==6,c=n==7,l=n==5||a;return function(h,p,f,_){for(var g,T,w=Dj(h),R=Pj(w),I=Nj(p,f),N=kj(R),D=0,V=_||Lj,G=e?V(h,N):t||c?V(h,0):void 0;N>D;D++)if((l||D in R)&&(T=I(g=R[D],D,w),n))if(e)G[D]=T;else if(T)switch(n){case 3:return!0;case 5:return g;case 6:return D;case 2:X0(G,g)}else switch(n){case 4:return!1;case 7:X0(G,g)}return a?-1:i||s?s:G}},Mj={forEach:ea(0),map:ea(1),filter:ea(2),some:ea(3),every:ea(4),find:ea(5),findIndex:ea(6),filterReject:ea(7)},jp=Nt,ug=Z,hg=Me,Uj=M,_d=ht,Ed=od,xj=E,ci=ai,Vj=X,pg=gr,Gp=dc,fg=yp,Fj=Br,mg=Ti,ru=tu,Q0=kp,Bj=xp,$0=B0,jj=nu,Z0=$e,ew=Fr,Gj=tg,tw=ot,nw=$o,Wj=Vp,_g=cd,iw=Dp,rw=NE,Hj=sn,Kj=pd,zj=Ln,Yj=K0,qj=Zo,sw=md,Wp=Mj.forEach,Qi=Mp("hidden"),Hp="Symbol",su="prototype",Jj=sw.set,ow=sw.getterFor(Hp),ms=Object[su],pc=ug.Symbol,Kp=pc&&pc[su],Xj=ug.TypeError,Eg=ug.QObject,aw=Z0.f,fc=ew.f,cw=$0.f,Qj=tw.f,dw=Uj([].push),fo=_g("symbols"),ou=_g("op-symbols"),$j=_g("wks"),gg=!Eg||!Eg[su]||!Eg[su].findChild,Sg=_d&&xj(function(){return ru(fc({},"a",{get:function(){return fc(this,"a",{value:7}).a}})).a!=7})?function(n,e,t){var i=aw(ms,e);i&&delete ms[e],fc(n,e,t),i&&n!==ms&&fc(ms,e,i)}:fc,Tg=function(n,e){var t=fo[n]=ru(Kp);return Jj(t,{type:Hp,tag:n,description:e}),_d||(t.description=e),t},zp=function(n,e,t){n===ms&&zp(ou,e,t),pg(n);var i=fg(e);return pg(t),ci(fo,i)?(t.enumerable?(ci(n,Qi)&&n[Qi][i]&&(n[Qi][i]=!1),t=ru(t,{enumerable:mg(0,!1)})):(ci(n,Qi)||fc(n,Qi,mg(1,{})),n[Qi][i]=!0),Sg(n,i,t)):fc(n,i,t)},vg=function(n,e){pg(n);var t=Gp(e),i=Q0(t).concat(pw(t));return Wp(i,function(s){_d&&!hg(lw,t,s)||zp(n,s,t[s])}),n},lw=function(n){var e=fg(n),t=hg(Qj,this,e);return!(this===ms&&ci(fo,e)&&!ci(ou,e))&&(!(t||!ci(this,e)||!ci(fo,e)||ci(this,Qi)&&this[Qi][e])||t)},uw=function(n,e){var t=Gp(n),i=fg(e);if(t!==ms||!ci(fo,i)||ci(ou,i)){var s=aw(t,i);return!s||!ci(fo,i)||ci(t,Qi)&&t[Qi][i]||(s.enumerable=!0),s}},hw=function(n){var e=cw(Gp(n)),t=[];return Wp(e,function(i){ci(fo,i)||ci(iw,i)||dw(t,i)}),t},pw=function(n){var e=n===ms,t=cw(e?ou:Gp(n)),i=[];return Wp(t,function(s){!ci(fo,s)||e&&!ci(ms,s)||dw(i,fo[s])}),i};Ed||(pc=function(){if(Vj(Kp,this))throw Xj("Symbol is not a constructor");var n=arguments.length&&arguments[0]!==void 0?Fj(arguments[0]):void 0,e=rw(n),t=function(i){this===ms&&hg(t,ou,i),ci(this,Qi)&&ci(this[Qi],e)&&(this[Qi][e]=!1),Sg(this,e,mg(1,i))};return _d&&gg&&Sg(ms,e,{configurable:!0,set:t}),Tg(e,n)},nw(Kp=pc[su],"toString",function(){return ow(this).tag}),nw(pc,"withoutSetter",function(n){return Tg(rw(n),n)}),tw.f=lw,ew.f=zp,Gj.f=vg,Z0.f=uw,Bj.f=$0.f=hw,jj.f=pw,Kj.f=function(n){return Tg(Hj(n),n)},_d&&Wj(Kp,"description",{configurable:!0,get:function(){return ow(this).description}})),jp({global:!0,constructor:!0,wrap:!0,forced:!Ed,sham:!Ed},{Symbol:pc}),Wp(Q0($j),function(n){zj(n)}),jp({target:Hp,stat:!0,forced:!Ed},{useSetter:function(){gg=!0},useSimple:function(){gg=!1}}),jp({target:"Object",stat:!0,forced:!Ed,sham:!_d},{create:function(n,e){return e===void 0?ru(n):vg(ru(n),e)},defineProperty:zp,defineProperties:vg,getOwnPropertyDescriptor:uw}),jp({target:"Object",stat:!0,forced:!Ed},{getOwnPropertyNames:hw}),Yj(),qj(pc,Hp),iw[Qi]=!0;var fw=od&&!!Symbol.for&&!!Symbol.keyFor,Zj=Nt,e3=Mi,t3=ai,n3=Br,mw=cd,i3=fw,yg=mw("string-to-symbol-registry"),r3=mw("symbol-to-string-registry");Zj({target:"Symbol",stat:!0,forced:!i3},{for:function(n){var e=n3(n);if(t3(yg,e))return yg[e];var t=e3("Symbol")(e);return yg[e]=t,r3[t]=e,t}});var s3=Nt,o3=ai,a3=$l,c3=ad,d3=fw,_w=cd("symbol-to-string-registry");s3({target:"Symbol",stat:!0,forced:!d3},{keyFor:function(n){if(!a3(n))throw TypeError(c3(n)+" is not a symbol");if(o3(_w,n))return _w[n]}});var Ew=M([].slice),gw=XE,l3=Bt,Sw=we,u3=Br,Tw=M([].push),h3=Nt,vw=Mi,yw=q,p3=Me,au=M,Rw=E,Cw=Bt,Iw=$l,ww=Ew,f3=function(n){if(l3(n))return n;if(gw(n)){for(var e=n.length,t=[],i=0;i<e;i++){var s=n[i];typeof s=="string"?Tw(t,s):typeof s!="number"&&Sw(s)!="Number"&&Sw(s)!="String"||Tw(t,u3(s))}var a=t.length,c=!0;return function(l,h){if(c)return c=!1,h;if(gw(this))return h;for(var p=0;p<a;p++)if(t[p]===l)return h}}},m3=od,_3=String,ta=vw("JSON","stringify"),Yp=au(/./.exec),Aw=au("".charAt),E3=au("".charCodeAt),g3=au("".replace),S3=au(1 .toString),T3=/[\uD800-\uDFFF]/g,Ow=/^[\uD800-\uDBFF]$/,bw=/^[\uDC00-\uDFFF]$/,Nw=!m3||Rw(function(){var n=vw("Symbol")();return ta([n])!="[null]"||ta({a:n})!="{}"||ta(Object(n))!="{}"}),Pw=Rw(function(){return ta("\uDF06\uD834")!=='"\\udf06\\ud834"'||ta("\uDEAD")!=='"\\udead"'}),v3=function(n,e){var t=ww(arguments),i=f3(e);if(Cw(i)||n!==void 0&&!Iw(n))return t[1]=function(s,a){if(Cw(i)&&(a=p3(i,this,_3(s),a)),!Iw(a))return a},yw(ta,null,t)},y3=function(n,e,t){var i=Aw(t,e-1),s=Aw(t,e+1);return Yp(Ow,n)&&!Yp(bw,s)||Yp(bw,n)&&!Yp(Ow,i)?"\\u"+S3(E3(n,0),16):n};ta&&h3({target:"JSON",stat:!0,arity:3,forced:Nw||Pw},{stringify:function(n,e,t){var i=ww(arguments),s=yw(Nw?v3:ta,null,i);return Pw&&typeof s=="string"?g3(s,T3,y3):s}});var Dw=nu,R3=Us;Nt({target:"Object",stat:!0,forced:!od||E(function(){Dw.f(1)})},{getOwnPropertySymbols:function(n){var e=Dw.f;return e?e(R3(n)):[]}}),Ln("asyncIterator"),Ln("hasInstance"),Ln("isConcatSpreadable"),Ln("iterator"),Ln("match"),Ln("matchAll"),Ln("replace"),Ln("search"),Ln("species"),Ln("split");var C3=K0;Ln("toPrimitive"),C3();var I3=Mi,w3=Zo;Ln("toStringTag"),w3(I3("Symbol"),"Symbol"),Ln("unscopables"),Zo(Z.JSON,"JSON",!0);var mc,kw,Lw,A3=Ms.Symbol,gd={},Rg=ht,O3=ai,Mw=Function.prototype,b3=Rg&&Object.getOwnPropertyDescriptor,Cg=O3(Mw,"name"),Uw={EXISTS:Cg,PROPER:Cg&&(function(){}).name==="something",CONFIGURABLE:Cg&&(!Rg||Rg&&b3(Mw,"name").configurable)},N3=!E(function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype}),P3=ai,D3=Bt,k3=Us,L3=N3,xw=Mp("IE_PROTO"),Ig=Object,M3=Ig.prototype,wg=L3?Ig.getPrototypeOf:function(n){var e=k3(n);if(P3(e,xw))return e[xw];var t=e.constructor;return D3(t)&&e instanceof t?t.prototype:e instanceof Ig?M3:null},U3=E,x3=Bt,V3=Er,F3=tu,Vw=wg,B3=$o,Ag=sn("iterator"),Fw=!1;[].keys&&("next"in(Lw=[].keys())?(kw=Vw(Vw(Lw)))!==Object.prototype&&(mc=kw):Fw=!0);var j3=!V3(mc)||U3(function(){var n={};return mc[Ag].call(n)!==n});x3((mc=j3?{}:F3(mc))[Ag])||B3(mc,Ag,function(){return this});var Bw={IteratorPrototype:mc,BUGGY_SAFARI_ITERATORS:Fw},G3=Bw.IteratorPrototype,W3=tu,H3=Ti,K3=Zo,z3=gd,Y3=function(){return this},jw=function(n,e,t,i){var s=e+" Iterator";return n.prototype=W3(G3,{next:H3(+!i,t)}),K3(n,s,!1,!0),z3[s]=Y3,n},q3=M,J3=Vr,X3=Bt,Q3=String,$3=TypeError,Z3=function(n,e,t){try{return q3(J3(Object.getOwnPropertyDescriptor(n,e)[t]))}catch{}},e4=gr,t4=function(n){if(typeof n=="object"||X3(n))return n;throw $3("Can't set "+Q3(n)+" as a prototype")},n4=Object.setPrototypeOf||("__proto__"in{}?function(){var n,e=!1,t={};try{(n=Z3(Object.prototype,"__proto__","set"))(t,[]),e=t instanceof Array}catch{}return function(i,s){return e4(i),t4(s),e?n(i,s):i.__proto__=s,i}}():void 0),i4=Nt,r4=Me,s4=Uw,o4=jw,a4=wg,c4=Zo,Gw=$o,Ww=gd,d4=Bw,l4=s4.PROPER,qp=d4.BUGGY_SAFARI_ITERATORS,Og=sn("iterator"),Hw="keys",Jp="values",Kw="entries",u4=function(){return this},zw=function(n,e,t,i,s,a,c){o4(t,e,i);var l,h,p,f=function(N){if(N===s&&R)return R;if(!qp&&N in T)return T[N];switch(N){case Hw:case Jp:case Kw:return function(){return new t(this,N)}}return function(){return new t(this)}},_=e+" Iterator",g=!1,T=n.prototype,w=T[Og]||T["@@iterator"]||s&&T[s],R=!qp&&w||f(s),I=e=="Array"&&T.entries||w;if(I&&(l=a4(I.call(new n)))!==Object.prototype&&l.next&&(c4(l,_,!0,!0),Ww[_]=u4),l4&&s==Jp&&w&&w.name!==Jp&&(g=!0,R=function(){return r4(w,this)}),s)if(h={values:f(Jp),keys:a?R:f(Hw),entries:f(Kw)},c)for(p in h)(qp||g||!(p in T))&&Gw(T,p,h[p]);else i4({target:e,proto:!0,forced:qp||g},h);return c&&T[Og]!==R&&Gw(T,Og,R,{name:s}),Ww[e]=R,h},Yw=function(n,e){return{value:n,done:e}},h4=dc,qw=gd,Jw=md;Fr.f;var p4=zw,Xw=Yw,Qw="Array Iterator",f4=Jw.set,m4=Jw.getterFor(Qw);p4(Array,"Array",function(n,e){f4(this,{type:Qw,target:h4(n),index:0,kind:e})},function(){var n=m4(this),e=n.target,t=n.kind,i=n.index++;return!e||i>=e.length?(n.target=void 0,Xw(void 0,!0)):Xw(t=="keys"?i:t=="values"?e[i]:[i,e[i]],!1)},"values"),qw.Arguments=qw.Array;var _4={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},E4=Z,g4=Qo,S4=qo,$w=gd,Zw=sn("toStringTag");for(var bg in _4){var eA=E4[bg],Ng=eA&&eA.prototype;Ng&&g4(Ng)!==Zw&&S4(Ng,Zw,bg),$w[bg]=$w.Array}var T4=A3,v4=sn,y4=Fr.f,tA=v4("metadata"),nA=Function.prototype;nA[tA]===void 0&&y4(nA,tA,{value:null}),Ln("dispose"),Ln("metadata");var R4=T4;Ln("asyncDispose");var C4=M,Pg=Mi("Symbol"),I4=Pg.keyFor,w4=C4(Pg.prototype.valueOf),iA=Pg.isRegisteredSymbol||function(n){try{return I4(w4(n))!==void 0}catch{return!1}};Nt({target:"Symbol",stat:!0},{isRegisteredSymbol:iA});for(var A4=cd,rA=Mi,O4=M,b4=$l,N4=sn,Xp=rA("Symbol"),sA=Xp.isWellKnownSymbol,oA=rA("Object","getOwnPropertyNames"),P4=O4(Xp.prototype.valueOf),aA=A4("wks"),Dg=0,cA=oA(Xp),D4=cA.length;Dg<D4;Dg++)try{var dA=cA[Dg];b4(Xp[dA])&&N4(dA)}catch{}var lA=function(n){if(sA&&sA(n))return!0;try{for(var e=P4(n),t=0,i=oA(aA),s=i.length;t<s;t++)if(aA[i[t]]==e)return!0}catch{}return!1};Nt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:lA}),Ln("matcher"),Ln("observable"),Nt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:iA}),Nt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:lA}),Ln("metadataKey"),Ln("patternMatch"),Ln("replaceAll");var Sd=m(R4),kg=M,k4=VE,L4=Br,M4=Ql,U4=kg("".charAt),uA=kg("".charCodeAt),x4=kg("".slice),hA=function(n){return function(e,t){var i,s,a=L4(M4(e)),c=k4(t),l=a.length;return c<0||c>=l?n?"":void 0:(i=uA(a,c))<55296||i>56319||c+1===l||(s=uA(a,c+1))<56320||s>57343?n?U4(a,c):i:n?x4(a,c,c+2):s-56320+(i-55296<<10)+65536}},pA={codeAt:hA(!1),charAt:hA(!0)},V4=pA.charAt,F4=Br,fA=md,B4=zw,mA=Yw,_A="String Iterator",j4=fA.set,G4=fA.getterFor(_A);B4(String,"String",function(n){j4(this,{type:_A,string:F4(n),index:0})},function(){var n,e=G4(this),t=e.string,i=e.index;return i>=t.length?mA(void 0,!0):(n=V4(t,i),e.index+=n.length,mA(n,!1))});var EA=m(pd.f("iterator"));function cu(n){return cu=typeof Sd=="function"&&typeof EA=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Sd=="function"&&e.constructor===Sd&&e!==Sd.prototype?"symbol":typeof e},cu(n)}var W4=m(pd.f("toPrimitive"));function H4(n){var e=function(t,i){if(cu(t)!=="object"||t===null)return t;var s=t[W4];if(s!==void 0){var a=s.call(t,i||"default");if(cu(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(t)}(n,"string");return cu(e)==="symbol"?e:String(e)}function S(n,e,t){return(e=H4(e))in n?tB(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var K4=Xo("Array").keys,z4=Qo,Y4=ai,q4=X,J4=K4,Lg=Array.prototype,X4={DOMTokenList:!0,NodeList:!0},$i=m(function(n){var e=n.keys;return n===Lg||q4(Lg,n)&&e===Lg.keys||Y4(X4,z4(n))?J4:e}),gA=ad,Q4=TypeError,SA=ag,$4=Math.floor,Mg=function(n,e){var t=n.length,i=$4(t/2);return t<8?Z4(n,e):eG(n,Mg(SA(n,0,i),e),Mg(SA(n,i),e),e)},Z4=function(n,e){for(var t,i,s=n.length,a=1;a<s;){for(i=a,t=n[a];i&&e(n[i-1],t)>0;)n[i]=n[--i];i!==a++&&(n[i]=t)}return n},eG=function(n,e,t,i){for(var s=e.length,a=t.length,c=0,l=0;c<s||l<a;)n[c+l]=c<s&&l<a?i(e[c],t[l])<=0?e[c++]:t[l++]:c<s?e[c++]:t[l++];return n},TA=Mg,tG=E,Ug=function(n,e){var t=[][n];return!!t&&tG(function(){t.call(null,e||function(){return 1},1)})},vA=lc.match(/firefox\/(\d+)/i),nG=!!vA&&+vA[1],iG=/MSIE|Trident/.test(lc),yA=lc.match(/AppleWebKit\/(\d+)\./),rG=!!yA&&+yA[1],sG=Nt,RA=M,oG=Vr,aG=Us,CA=Jo,cG=function(n,e){if(!delete n[e])throw Q4("Cannot delete property "+gA(e)+" of "+gA(n))},IA=Br,xg=E,dG=TA,lG=Ug,wA=nG,uG=iG,AA=uc,OA=rG,na=[],bA=RA(na.sort),hG=RA(na.push),pG=xg(function(){na.sort(void 0)}),fG=xg(function(){na.sort(null)}),mG=lG("sort"),NA=!xg(function(){if(AA)return AA<70;if(!(wA&&wA>3)){if(uG)return!0;if(OA)return OA<603;var n,e,t,i,s="";for(n=65;n<76;n++){switch(e=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:t=3;break;case 68:case 71:t=4;break;default:t=2}for(i=0;i<47;i++)na.push({k:e+i,v:t})}for(na.sort(function(a,c){return c.v-a.v}),i=0;i<na.length;i++)e=na[i].k.charAt(0),s.charAt(s.length-1)!==e&&(s+=e);return s!=="DGBEFHACIJK"}});sG({target:"Array",proto:!0,forced:pG||!fG||!mG||!NA},{sort:function(n){n!==void 0&&oG(n);var e=aG(this);if(NA)return n===void 0?bA(e):bA(e,n);var t,i,s=[],a=CA(e);for(i=0;i<a;i++)i in e&&hG(s,e[i]);for(dG(s,function(c){return function(l,h){return h===void 0?-1:l===void 0?1:c!==void 0?+c(l,h)||0:IA(l)>IA(h)?1:-1}}(n)),t=CA(s),i=0;i<t;)e[i]=s[i++];for(;i<a;)cG(e,i++);return e}});var _G=Xo("Array").sort,EG=X,gG=_G,Vg=Array.prototype,du=m(function(n){var e=n.sort;return n===Vg||EG(Vg,n)&&e===Vg.sort?gG:e}),SG=Mi,TG=xp,vG=nu,yG=gr,RG=M([].concat),CG=SG("Reflect","ownKeys")||function(n){var e=TG.f(yG(n)),t=vG.f;return t?RG(e,t(n)):e},PA=ai,IG=CG,wG=$e,AG=Fr,OG=Er,bG=qo,DA=Error,NG=M("".replace),PG=String(DA("zxcasd").stack),kA=/\n\s*at [^:]*:[^\n]*/,DG=kA.test(PG),kG=Ti,LG=!E(function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",kG(1,7)),n.stack!==7)}),MG=qo,UG=function(n,e){if(DG&&typeof n=="string"&&!DA.prepareStackTrace)for(;e--;)n=NG(n,kA,"");return n},xG=LG,LA=Error.captureStackTrace,VG=gd,FG=sn("iterator"),BG=Array.prototype,MA=function(n){return n!==void 0&&(VG.Array===n||BG[FG]===n)},jG=Qo,UA=OE,GG=vp,WG=gd,HG=sn("iterator"),Qp=function(n){if(!GG(n))return UA(n,HG)||UA(n,"@@iterator")||WG[jG(n)]},KG=Me,zG=Vr,YG=gr,qG=ad,JG=Qp,XG=TypeError,Fg=function(n,e){var t=arguments.length<2?JG(n):e;if(zG(t))return YG(KG(t,n));throw XG(qG(n)+" is not iterable")},QG=Me,xA=gr,$G=OE,VA=function(n,e,t){var i,s;xA(n);try{if(!(i=$G(n,"return"))){if(e==="throw")throw t;return t}i=QG(i,n)}catch(a){s=!0,i=a}if(e==="throw")throw t;if(s)throw i;return xA(i),t},ZG=Yo,eW=Me,tW=gr,nW=ad,iW=MA,rW=Jo,FA=X,sW=Fg,oW=Qp,BA=VA,aW=TypeError,$p=function(n,e){this.stopped=n,this.result=e},jA=$p.prototype,lu=function(n,e,t){var i,s,a,c,l,h,p,f=t&&t.that,_=!(!t||!t.AS_ENTRIES),g=!(!t||!t.IS_RECORD),T=!(!t||!t.IS_ITERATOR),w=!(!t||!t.INTERRUPTED),R=ZG(e,f),I=function(D){return i&&BA(i,"normal",D),new $p(!0,D)},N=function(D){return _?(tW(D),w?R(D[0],D[1],I):R(D[0],D[1])):w?R(D,I):R(D)};if(g)i=n.iterator;else if(T)i=n;else{if(!(s=oW(n)))throw aW(nW(n)+" is not iterable");if(iW(s)){for(a=0,c=rW(n);c>a;a++)if((l=N(n[a]))&&FA(jA,l))return l;return new $p(!1)}i=sW(n,s)}for(h=g?n.next:i.next;!(p=eW(h,i)).done;){try{l=N(p.value)}catch(D){BA(i,"throw",D)}if(typeof l=="object"&&l&&FA(jA,l))return l}return new $p(!1)},cW=Br,dW=Nt,lW=X,uW=wg,Zp=n4,hW=function(n,e,t){for(var i=IG(e),s=AG.f,a=wG.f,c=0;c<i.length;c++){var l=i[c];PA(n,l)||t&&PA(t,l)||s(n,l,a(e,l))}},GA=tu,Bg=qo,jg=Ti,pW=function(n,e){OG(e)&&"cause"in e&&bG(n,"cause",e.cause)},fW=function(n,e,t,i){xG&&(LA?LA(n,e):MG(n,"stack",UG(t,i)))},mW=lu,_W=function(n,e){return n===void 0?arguments.length<2?"":e:cW(n)},EW=sn("toStringTag"),ef=Error,gW=[].push,Td=function(n,e){var t,i=lW(Gg,this);Zp?t=Zp(ef(),i?uW(this):Gg):(t=i?this:GA(Gg),Bg(t,EW,"Error")),e!==void 0&&Bg(t,"message",_W(e)),fW(t,Td,t.stack,1),arguments.length>2&&pW(t,arguments[2]);var s=[];return mW(n,gW,{that:s}),Bg(t,"errors",s),t};Zp?Zp(Td,ef):hW(Td,ef,{name:!0});var Gg=Td.prototype=GA(ef.prototype,{constructor:jg(1,Td),message:jg(1,""),name:jg(1,"AggregateError")});dW({global:!0,constructor:!0,arity:2},{AggregateError:Td});var uu,vd,WA,Wg,hu=typeof process<"u"&&we(process)=="process",SW=Mi,TW=Vp,vW=ht,HA=sn("species"),yW=X,RW=TypeError,Hg=function(n,e){if(yW(e,n))return n;throw RW("Incorrect invocation")},CW=eg,IW=ad,wW=TypeError,KA=gr,AW=function(n){if(CW(n))return n;throw wW(IW(n)+" is not a constructor")},OW=vp,bW=sn("species"),zA=function(n,e){var t,i=KA(n).constructor;return i===void 0||OW(t=KA(i)[bW])?e:AW(t)},NW=TypeError,tf=function(n,e){if(n<e)throw NW("Not enough arguments");return n},YA=/(?:ipad|iphone|ipod).*applewebkit/i.test(lc),Sr=Z,PW=q,DW=Yo,qA=Bt,kW=ai,JA=E,XA=L0,LW=Ew,QA=kE,MW=tf,UW=YA,xW=hu,Kg=Sr.setImmediate,zg=Sr.clearImmediate,VW=Sr.process,Yg=Sr.Dispatch,FW=Sr.Function,$A=Sr.MessageChannel,BW=Sr.String,qg=0,pu={},ZA="onreadystatechange";JA(function(){uu=Sr.location});var Jg=function(n){if(kW(pu,n)){var e=pu[n];delete pu[n],e()}},Xg=function(n){return function(){Jg(n)}},eO=function(n){Jg(n.data)},tO=function(n){Sr.postMessage(BW(n),uu.protocol+"//"+uu.host)};Kg&&zg||(Kg=function(n){MW(arguments.length,1);var e=qA(n)?n:FW(n),t=LW(arguments,1);return pu[++qg]=function(){PW(e,void 0,t)},vd(qg),qg},zg=function(n){delete pu[n]},xW?vd=function(n){VW.nextTick(Xg(n))}:Yg&&Yg.now?vd=function(n){Yg.now(Xg(n))}:$A&&!UW?(Wg=(WA=new $A).port2,WA.port1.onmessage=eO,vd=DW(Wg.postMessage,Wg)):Sr.addEventListener&&qA(Sr.postMessage)&&!Sr.importScripts&&uu&&uu.protocol!=="file:"&&!JA(tO)?(vd=tO,Sr.addEventListener("message",eO,!1)):vd=ZA in QA("script")?function(n){XA.appendChild(QA("script"))[ZA]=function(){XA.removeChild(this),Jg(n)}}:function(n){setTimeout(Xg(n),0)});var nO={set:Kg,clear:zg},iO=function(){this.head=null,this.tail=null};iO.prototype={add:function(n){var e={item:n,next:null},t=this.tail;t?t.next=e:this.head=e,this.tail=e},get:function(){var n=this.head;if(n)return(this.head=n.next)===null&&(this.tail=null),n.item}};var yd,Qg,$g,Zg,rO,sO=iO,jW=/ipad|iphone|ipod/i.test(lc)&&typeof Pebble<"u",GW=/web0s(?!.*chrome)/i.test(lc),_c=Z,oO=Yo,WW=$e.f,eS=nO.set,HW=sO,KW=YA,zW=jW,YW=GW,tS=hu,aO=_c.MutationObserver||_c.WebKitMutationObserver,cO=_c.document,dO=_c.process,nf=_c.Promise,lO=WW(_c,"queueMicrotask"),nS=lO&&lO.value;if(!nS){var rf=new HW,sf=function(){var n,e;for(tS&&(n=dO.domain)&&n.exit();e=rf.get();)try{e()}catch(t){throw rf.head&&yd(),t}n&&n.enter()};KW||tS||YW||!aO||!cO?!zW&&nf&&nf.resolve?((Zg=nf.resolve(void 0)).constructor=nf,rO=oO(Zg.then,Zg),yd=function(){rO(sf)}):tS?yd=function(){dO.nextTick(sf)}:(eS=oO(eS,_c),yd=function(){eS(sf)}):(Qg=!0,$g=cO.createTextNode(""),new aO(sf).observe($g,{characterData:!0}),yd=function(){$g.data=Qg=!Qg}),nS=function(n){rf.head||yd(),rf.add(n)}}var qW=nS,Rd=function(n){try{return{error:!1,value:n()}}catch(e){return{error:!0,value:e}}},Ec=Z.Promise,uO=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",JW=!uO&&!hu&&typeof window=="object"&&typeof document=="object",XW=Z,fu=Ec,QW=Bt,$W=RI,ZW=v0,e5=sn,t5=JW,n5=uO,iS=uc,hO=fu&&fu.prototype,i5=e5("species"),pO=!1,fO=QW(XW.PromiseRejectionEvent),r5=$W("Promise",function(){var n=ZW(fu),e=n!==String(fu);if(!e&&iS===66||!hO.catch||!hO.finally)return!0;if(!iS||iS<51||!/native code/.test(n)){var t=new fu(function(s){s(1)}),i=function(s){s(function(){},function(){})};if((t.constructor={})[i5]=i,!(pO=t.then(function(){})instanceof i))return!0}return!e&&(t5||n5)&&!fO}),mu={CONSTRUCTOR:r5,REJECTION_EVENT:fO,SUBCLASSING:pO},Vs={},mO=Vr,s5=TypeError,o5=function(n){var e,t;this.promise=new n(function(i,s){if(e!==void 0||t!==void 0)throw s5("Bad Promise constructor");e=i,t=s}),this.resolve=mO(e),this.reject=mO(t)};Vs.f=function(n){return new o5(n)};var rS,_O,a5=Nt,of=hu,ia=Z,_u=Me,c5=$o,d5=Zo,l5=function(n){var e=SW(n);vW&&e&&!e[HA]&&TW(e,HA,{configurable:!0,get:function(){return this}})},u5=Vr,sS=Bt,h5=Er,p5=Hg,f5=zA,EO=nO.set,oS=qW,m5=function(n,e){try{arguments.length==1?console.error(n):console.error(n,e)}catch{}},_5=Rd,E5=sO,gO=md,aS=Ec,SO=mu,TO=Vs,af="Promise",vO=SO.CONSTRUCTOR,g5=SO.REJECTION_EVENT,cS=gO.getterFor(af),S5=gO.set,T5=aS&&aS.prototype,Eu=aS,dS=T5,yO=ia.TypeError,lS=ia.document,uS=ia.process,hS=TO.f,v5=hS,y5=!!(lS&&lS.createEvent&&ia.dispatchEvent),RO="unhandledrejection",CO=function(n){var e;return!(!h5(n)||!sS(e=n.then))&&e},IO=function(n,e){var t,i,s,a=e.value,c=e.state==1,l=c?n.ok:n.fail,h=n.resolve,p=n.reject,f=n.domain;try{l?(c||(e.rejection===2&&C5(e),e.rejection=1),l===!0?t=a:(f&&f.enter(),t=l(a),f&&(f.exit(),s=!0)),t===n.promise?p(yO("Promise-chain cycle")):(i=CO(t))?_u(i,t,h,p):h(t)):p(a)}catch(_){f&&!s&&f.exit(),p(_)}},wO=function(n,e){n.notified||(n.notified=!0,oS(function(){for(var t,i=n.reactions;t=i.get();)IO(t,n);n.notified=!1,e&&!n.rejection&&R5(n)}))},AO=function(n,e,t){var i,s;y5?((i=lS.createEvent("Event")).promise=e,i.reason=t,i.initEvent(n,!1,!0),ia.dispatchEvent(i)):i={promise:e,reason:t},!g5&&(s=ia["on"+n])?s(i):n===RO&&m5("Unhandled promise rejection",t)},R5=function(n){_u(EO,ia,function(){var e,t=n.facade,i=n.value;if(OO(n)&&(e=_5(function(){of?uS.emit("unhandledRejection",i,t):AO(RO,t,i)}),n.rejection=of||OO(n)?2:1,e.error))throw e.value})},OO=function(n){return n.rejection!==1&&!n.parent},C5=function(n){_u(EO,ia,function(){var e=n.facade;of?uS.emit("rejectionHandled",e):AO("rejectionhandled",e,n.value)})},Cd=function(n,e,t){return function(i){n(e,i,t)}},Id=function(n,e,t){n.done||(n.done=!0,t&&(n=t),n.value=e,n.state=2,wO(n,!0))},pS=function(n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(n.facade===e)throw yO("Promise can't be resolved itself");var i=CO(e);i?oS(function(){var s={done:!1};try{_u(i,e,Cd(pS,s,n),Cd(Id,s,n))}catch(a){Id(s,a,n)}}):(n.value=e,n.state=1,wO(n,!1))}catch(s){Id({done:!1},s,n)}}};vO&&(dS=(Eu=function(n){p5(this,dS),u5(n),_u(rS,this);var e=cS(this);try{n(Cd(pS,e),Cd(Id,e))}catch(t){Id(e,t)}}).prototype,(rS=function(n){S5(this,{type:af,done:!1,notified:!1,parent:!1,reactions:new E5,rejection:!1,state:0,value:void 0})}).prototype=c5(dS,"then",function(n,e){var t=cS(this),i=hS(f5(this,Eu));return t.parent=!0,i.ok=!sS(n)||n,i.fail=sS(e)&&e,i.domain=of?uS.domain:void 0,t.state==0?t.reactions.add(i):oS(function(){IO(i,t)}),i.promise}),_O=function(){var n=new rS,e=cS(n);this.promise=n,this.resolve=Cd(pS,e),this.reject=Cd(Id,e)},TO.f=hS=function(n){return n===Eu||n===void 0?new _O(n):v5(n)}),a5({global:!0,constructor:!0,wrap:!0,forced:vO},{Promise:Eu}),d5(Eu,af,!1,!0),l5(af);var bO=sn("iterator"),NO=!1;try{var I5=0,PO={next:function(){return{done:!!I5++}},return:function(){NO=!0}};PO[bO]=function(){return this},Array.from(PO,function(){throw 2})}catch{}var w5=Ec,A5=function(n,e){if(!NO)return!1;var t=!1;try{var i={};i[bO]=function(){return{next:function(){return{done:t=!0}}}},n(i)}catch{}return t},cf=mu.CONSTRUCTOR||!A5(function(n){w5.all(n).then(void 0,function(){})}),O5=Me,b5=Vr,N5=Vs,P5=Rd,D5=lu;Nt({target:"Promise",stat:!0,forced:cf},{all:function(n){var e=this,t=N5.f(e),i=t.resolve,s=t.reject,a=P5(function(){var c=b5(e.resolve),l=[],h=0,p=1;D5(n,function(f){var _=h++,g=!1;p++,O5(c,e,f).then(function(T){g||(g=!0,l[_]=T,--p||i(l))},s)}),--p||i(l)});return a.error&&s(a.value),t.promise}});var k5=Nt,L5=mu.CONSTRUCTOR;Ec&&Ec.prototype,k5({target:"Promise",proto:!0,forced:L5,real:!0},{catch:function(n){return this.then(void 0,n)}});var M5=Me,U5=Vr,x5=Vs,V5=Rd,F5=lu;Nt({target:"Promise",stat:!0,forced:cf},{race:function(n){var e=this,t=x5.f(e),i=t.reject,s=V5(function(){var a=U5(e.resolve);F5(n,function(c){M5(a,e,c).then(t.resolve,i)})});return s.error&&i(s.value),t.promise}});var B5=Me,j5=Vs;Nt({target:"Promise",stat:!0,forced:mu.CONSTRUCTOR},{reject:function(n){var e=j5.f(this);return B5(e.reject,void 0,n),e.promise}});var G5=gr,W5=Er,H5=Vs,DO=function(n,e){if(G5(n),W5(e)&&e.constructor===n)return e;var t=H5.f(n);return(0,t.resolve)(e),t.promise},K5=Nt,z5=Ec,Y5=mu.CONSTRUCTOR,q5=DO,J5=Mi("Promise"),X5=!Y5;K5({target:"Promise",stat:!0,forced:!0},{resolve:function(n){return q5(X5&&this===J5?z5:this,n)}});var Q5=Me,$5=Vr,Z5=Vs,eH=Rd,tH=lu;Nt({target:"Promise",stat:!0,forced:cf},{allSettled:function(n){var e=this,t=Z5.f(e),i=t.resolve,s=t.reject,a=eH(function(){var c=$5(e.resolve),l=[],h=0,p=1;tH(n,function(f){var _=h++,g=!1;p++,Q5(c,e,f).then(function(T){g||(g=!0,l[_]={status:"fulfilled",value:T},--p||i(l))},function(T){g||(g=!0,l[_]={status:"rejected",reason:T},--p||i(l))})}),--p||i(l)});return a.error&&s(a.value),t.promise}});var nH=Me,iH=Vr,rH=Mi,sH=Vs,oH=Rd,aH=lu,kO="No one promise resolved";Nt({target:"Promise",stat:!0,forced:cf},{any:function(n){var e=this,t=rH("AggregateError"),i=sH.f(e),s=i.resolve,a=i.reject,c=oH(function(){var l=iH(e.resolve),h=[],p=0,f=1,_=!1;aH(n,function(g){var T=p++,w=!1;f++,nH(l,e,g).then(function(R){w||_||(_=!0,s(R))},function(R){w||_||(w=!0,h[T]=R,--f||a(new t(h,kO)))})}),--f||a(new t(h,kO))});return c.error&&a(c.value),i.promise}});var cH=Nt,fS=Ec,dH=E,lH=Mi,uH=Bt,hH=zA,LO=DO,pH=fS&&fS.prototype;cH({target:"Promise",proto:!0,real:!0,forced:!!fS&&dH(function(){pH.finally.call({then:function(){}},function(){})})},{finally:function(n){var e=hH(this,lH("Promise")),t=uH(n);return this.then(t?function(i){return LO(e,n()).then(function(){return i})}:n,t?function(i){return LO(e,n()).then(function(){throw i})}:n)}});var MO=Ms.Promise,W=m(MO);const fH=()=>{};function gu(){const n={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:fH};return n.promise=new W((e,t)=>{n.resolve=i=>{n.isFinished||(n.isResolved=!0,n.isFinished=!0,e(i),n.value=i)},n.reject=i=>{n.isFinished||(n.isRejected=!0,n.isFinished=!0,t(i))}}),n}const df=new Map,lf=new Map,Fs=new Map;var on,rt;(function(n){n.WIN_10="Windows 10",n.WIN_81="Windows 8.1",n.WIN_8="Windows 8",n.WIN_7="Windows 7",n.WIN_VISTA="Windows Vista",n.WIN_SERVER_2003="Windows Server 2003",n.WIN_XP="Windows XP",n.WIN_2000="Windows 2000",n.ANDROID="Android",n.HARMONY_OS="HarmonyOS",n.OPEN_BSD="Open BSD",n.SUN_OS="Sun OS",n.LINUX="Linux",n.IOS="iOS",n.MAC_OS="Mac OS",n.CHROMIUM_OS="Chromium OS",n.QNX="QNX",n.UNIX="UNIX",n.BEOS="BeOS",n.OS_2="OS/2",n.SEARCH_BOT="Search Bot"})(on||(on={})),function(n){n.CHROME="Chrome",n.SAFARI="Safari",n.EDGE="Edge",n.FIREFOX="Firefox",n.OPERA="OPR",n.QQ="QQBrowser",n.WECHAT="MicroMessenger"}(rt||(rt={}));var mS={exports:{}};(function(n,e){(function(t,i){var s="function",a="undefined",c="object",l="string",h="major",p="model",f="name",_="type",g="vendor",T="version",w="architecture",R="console",I="mobile",N="tablet",D="smarttv",V="wearable",G="embedded",F="Amazon",j="Apple",z="ASUS",Y="BlackBerry",re="Browser",ae="Chrome",Ue="Firefox",ze="Google",vt="Huawei",nn="LG",It="Microsoft",Gi="Motorola",ee="Opera",se="Samsung",ge="Sharp",ke="Sony",tt="Xiaomi",de="Zebra",C="Facebook",k="Chromium OS",x="Mac OS",ie=function(Wt){for(var rn={},wt=0;wt<Wt.length;wt++)rn[Wt[wt].toUpperCase()]=Wt[wt];return rn},xe=function(Wt,rn){return typeof Wt===l&&yt(rn).indexOf(yt(Wt))!==-1},yt=function(Wt){return Wt.toLowerCase()},Gn=function(Wt,rn){if(typeof Wt===l)return Wt=Wt.replace(/^\s\s*/,""),typeof rn===a?Wt:Wt.substring(0,350)},Wi=function(Wt,rn){for(var wt,Hi,io,Ht,nt,Oi,Ua=0;Ua<rn.length&&!nt;){var ws=rn[Ua],bL=rn[Ua+1];for(wt=Hi=0;wt<ws.length&&!nt&&ws[wt];)if(nt=ws[wt++].exec(Wt))for(io=0;io<bL.length;io++)Oi=nt[++Hi],typeof(Ht=bL[io])===c&&Ht.length>0?Ht.length===2?typeof Ht[1]==s?this[Ht[0]]=Ht[1].call(this,Oi):this[Ht[0]]=Ht[1]:Ht.length===3?typeof Ht[1]!==s||Ht[1].exec&&Ht[1].test?this[Ht[0]]=Oi?Oi.replace(Ht[1],Ht[2]):i:this[Ht[0]]=Oi?Ht[1].call(this,Oi,Ht[2]):i:Ht.length===4&&(this[Ht[0]]=Oi?Ht[3].call(this,Oi.replace(Ht[1],Ht[2])):i):this[Ht]=Oi||i;Ua+=2}},Mo=function(Wt,rn){for(var wt in rn)if(typeof rn[wt]===c&&rn[wt].length>0){for(var Hi=0;Hi<rn[wt].length;Hi++)if(xe(rn[wt][Hi],Wt))return wt==="?"?i:wt}else if(xe(rn[wt],Wt))return wt==="?"?i:wt;return Wt},Vm={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Fm={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,T],[/opios[\/ ]+([\w\.]+)/i],[T,[f,ee+" Mini"]],[/\bopr\/([\w\.]+)/i],[T,[f,ee]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[f,T],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[f,"UC"+re]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[T,[f,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[T,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[f,"IE"]],[/yabrowser\/([\w\.]+)/i],[T,[f,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+re],T],[/\bfocus\/([\w\.]+)/i],[T,[f,Ue+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[f,ee+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[f,ee+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[f,"MIUI "+re]],[/fxios\/([-\w\.]+)/i],[T,[f,Ue]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 "+re]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 "+re],T],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[f,T],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,C],T],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[f,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[f,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[f,ae+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,ae+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[f,"Android "+re]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[T,Mo,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[f,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[f,Ue+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[f,T],[/(cobalt)\/([\w\.]+)/i],[f,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[w,"amd64"]],[/(ia32(?=;))/i],[[w,yt]],[/((?:i[346]|x)86)[;\)]/i],[[w,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[w,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[w,"armhf"]],[/windows (ce|mobile); ppc;/i],[[w,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[w,/ower/,"",yt]],[/(sun4\w)[;\)]/i],[[w,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[w,yt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[g,se],[_,N]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[g,se],[_,I]],[/\((ip(?:hone|od)[\w ]*);/i],[p,[g,j],[_,I]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[g,j],[_,N]],[/(macintosh);/i],[p,[g,j]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[g,ge],[_,I]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[g,vt],[_,N]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[g,vt],[_,I]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[g,tt],[_,I]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[g,tt],[_,N]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[g,"OPPO"],[_,I]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[g,"Vivo"],[_,I]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[g,"Realme"],[_,I]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[g,Gi],[_,I]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[g,Gi],[_,N]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[g,nn],[_,N]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[g,nn],[_,I]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[g,"Lenovo"],[_,N]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[g,"Nokia"],[_,I]],[/(pixel c)\b/i],[p,[g,ze],[_,N]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[g,ze],[_,I]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[g,ke],[_,I]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[g,ke],[_,N]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[g,"OnePlus"],[_,I]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[g,F],[_,N]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[g,F],[_,I]],[/(playbook);[-\w\),; ]+(rim)/i],[p,g,[_,N]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[g,Y],[_,I]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[g,z],[_,N]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[g,z],[_,I]],[/(nexus 9)/i],[p,[g,"HTC"],[_,N]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[p,/_/g," "],[_,I]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[g,"Acer"],[_,N]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[g,"Meizu"],[_,I]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,p,[_,I]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,p,[_,N]],[/(surface duo)/i],[p,[g,It],[_,N]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[g,"Fairphone"],[_,I]],[/(u304aa)/i],[p,[g,"AT&T"],[_,I]],[/\bsie-(\w*)/i],[p,[g,"Siemens"],[_,I]],[/\b(rct\w+) b/i],[p,[g,"RCA"],[_,N]],[/\b(venue[\d ]{2,7}) b/i],[p,[g,"Dell"],[_,N]],[/\b(q(?:mv|ta)\w+) b/i],[p,[g,"Verizon"],[_,N]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[g,"Barnes & Noble"],[_,N]],[/\b(tm\d{3}\w+) b/i],[p,[g,"NuVision"],[_,N]],[/\b(k88) b/i],[p,[g,"ZTE"],[_,N]],[/\b(nx\d{3}j) b/i],[p,[g,"ZTE"],[_,I]],[/\b(gen\d{3}) b.+49h/i],[p,[g,"Swiss"],[_,I]],[/\b(zur\d{3}) b/i],[p,[g,"Swiss"],[_,N]],[/\b((zeki)?tb.*\b) b/i],[p,[g,"Zeki"],[_,N]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],p,[_,N]],[/\b(ns-?\w{0,9}) b/i],[p,[g,"Insignia"],[_,N]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[g,"NextBook"],[_,N]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],p,[_,I]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],p,[_,I]],[/\b(ph-1) /i],[p,[g,"Essential"],[_,I]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[g,"Envizen"],[_,N]],[/\b(trio[-\w\. ]+) b/i],[p,[g,"MachSpeed"],[_,N]],[/\btu_(1491) b/i],[p,[g,"Rotor"],[_,N]],[/(shield[\w ]+) b/i],[p,[g,"Nvidia"],[_,N]],[/(sprint) (\w+)/i],[g,p,[_,I]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[g,It],[_,I]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[g,de],[_,N]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[g,de],[_,I]],[/smart-tv.+(samsung)/i],[g,[_,D]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[g,se],[_,D]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,nn],[_,D]],[/(apple) ?tv/i],[g,[p,j+" TV"],[_,D]],[/crkey/i],[[p,ae+"cast"],[g,ze],[_,D]],[/droid.+aft(\w)( bui|\))/i],[p,[g,F],[_,D]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[g,ge],[_,D]],[/(bravia[\w ]+)( bui|\))/i],[p,[g,ke],[_,D]],[/(mitv-\w{5}) bui/i],[p,[g,tt],[_,D]],[/Hbbtv.*(technisat) (.*);/i],[g,p,[_,D]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,Gn],[p,Gn],[_,D]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[_,D]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,p,[_,R]],[/droid.+; (shield) bui/i],[p,[g,"Nvidia"],[_,R]],[/(playstation [345portablevi]+)/i],[p,[g,ke],[_,R]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[g,It],[_,R]],[/((pebble))app/i],[g,p,[_,V]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[g,j],[_,V]],[/droid.+; (glass) \d/i],[p,[g,ze],[_,V]],[/droid.+; (wt63?0{2,3})\)/i],[p,[g,de],[_,V]],[/(quest( 2| pro)?)/i],[p,[g,C],[_,V]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[_,G]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[_,I]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[_,N]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[_,N]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[_,I]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[f,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[f,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,T],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[f,[T,Mo,Vm]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,"Windows"],[T,Mo,Vm]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,x],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,T],[/\(bb(10);/i],[T,[f,Y]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[f,Ue+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[f,ae+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,k],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,T],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[f,T]]},br=function(Wt,rn){if(typeof Wt===c&&(rn=Wt,Wt=i),!(this instanceof br))return new br(Wt,rn).getResult();var wt=typeof t!==a&&t.navigator?t.navigator:i,Hi=Wt||(wt&&wt.userAgent?wt.userAgent:""),io=wt&&wt.userAgentData?wt.userAgentData:i,Ht=rn?function(nt,Oi){var Ua={};for(var ws in nt)Oi[ws]&&Oi[ws].length%2==0?Ua[ws]=Oi[ws].concat(nt[ws]):Ua[ws]=nt[ws];return Ua}(Fm,rn):Fm;return this.getBrowser=function(){var nt={};return nt[f]=i,nt[T]=i,Wi.call(nt,Hi,Ht.browser),nt[h]=function(Oi){return typeof Oi===l?Oi.replace(/[^\d\.]/g,"").split(".")[0]:i}(nt[T]),wt&&wt.brave&&typeof wt.brave.isBrave==s&&(nt[f]="Brave"),nt},this.getCPU=function(){var nt={};return nt[w]=i,Wi.call(nt,Hi,Ht.cpu),nt},this.getDevice=function(){var nt={};return nt[g]=i,nt[p]=i,nt[_]=i,Wi.call(nt,Hi,Ht.device),!nt[_]&&io&&io.mobile&&(nt[_]=I),nt[p]=="Macintosh"&&wt&&typeof wt.standalone!==a&&wt.maxTouchPoints&&wt.maxTouchPoints>2&&(nt[p]="iPad",nt[_]=N),nt},this.getEngine=function(){var nt={};return nt[f]=i,nt[T]=i,Wi.call(nt,Hi,Ht.engine),nt},this.getOS=function(){var nt={};return nt[f]=i,nt[T]=i,Wi.call(nt,Hi,Ht.os),!nt[f]&&io&&io.platform!="Unknown"&&(nt[f]=io.platform.replace(/chrome os/i,k).replace(/macos/i,x)),nt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Hi},this.setUA=function(nt){return Hi=typeof nt===l&&nt.length>350?Gn(nt,350):nt,this},this.setUA(Hi),this};br.VERSION="0.7.34",br.BROWSER=ie([f,T,h]),br.CPU=ie([w]),br.DEVICE=ie([p,g,_,R,I,D,N,V,G]),br.ENGINE=br.OS=ie([f,T]),n.exports&&(e=n.exports=br),e.UAParser=br;var Ma=typeof t!==a&&(t.jQuery||t.Zepto);if(Ma&&!Ma.ua){var pl=new br;Ma.ua=pl.getResult(),Ma.ua.get=function(){return pl.getUA()},Ma.ua.set=function(Wt){pl.setUA(Wt);var rn=pl.getResult();for(var wt in rn)Ma.ua[wt]=rn[wt]}}})(typeof window=="object"?window:u)})(mS,mS.exports);const UO=new(m(mS.exports));let mo=UO.getResult(),_S=null;function Ze(n){if(!_S){mo=UO.getResult();const e=function(a){if(a.engine.name==="Blink"&&a.browser.name!=="WeChat")return rt.CHROME;switch(a.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return rt.CHROME;case"Safari":case"Mobile Safari":return rt.SAFARI;case"Edge":return rt.EDGE;case"Firefox":return rt.FIREFOX;case"QQBrowser":return rt.QQ;case"Opera":return rt.OPERA;case"WeChat":return rt.WECHAT;default:return a.browser.name||""}}(mo),t=function(a){let c;return c=a.engine.name==="Blink"?a.engine.version||"":a.browser.version||"",c.split(".")[0]}(mo),i=function(a){return a.os.name==="Windows"?a.os.version?a.os.name+" "+a.os.version:a.os.name:a.os.name||""}(mo),s=mo.os.version;if(!(e&&t&&i&&s))return{name:e,version:t,os:i,osVersion:s};_S={name:e,version:t,os:i,osVersion:s}}return _S}function uf(){return Ze().os}function xO(){const n=Ze();return"".concat(n.os," ").concat(n.osVersion)}function hf(){const n=Ze();return!!(mo.engine.name==="WebKit"&&n.os===on.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&n.name!==rt.SAFARI||ni()&&n.name!==rt.SAFARI)}function mH(){const n=Ze();if(hf()){if(n.os===on.MAC_OS)return!0;if(n.os===on.IOS){const e=mo.os.version&&mo.os.version.split(".");if(e&&Number(e[0])===14&&e[1]&&Number(e[1])>=3||e&&Number(e[0])>14)return!0}}return!1}function _H(){return mo.engine.name==="WebKit"}function _o(){return Ze().name===rt.CHROME}function wn(){return Ze().name===rt.SAFARI}function mt(){return Ze().name===rt.FIREFOX}function ni(){return Ze().os===on.IOS}function ES(n){const e=Ze();return!(e.name!==rt.CHROME||!e.osVersion)&&Number(e.version)>=n}function VO(n){const e=Ze();return!(e.name!==rt.EDGE||!e.osVersion)&&Number(e.version)>=n}function FO(n){const e=Ze();return!(e.name!==rt.OPERA||!e.osVersion)&&Number(e.version)>=n}function BO(){const n=Ze();return!(n.name!==rt.CHROME||!n.osVersion)&&Number(n.version)<=90}function jO(){const n=Ze();if(n.os!==on.IOS||!n.osVersion)return!1;const e=n.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function wd(){const n=Ze();if(n.os!==on.IOS||!n.osVersion)return!1;const e=n.osVersion.split(".");return Number(e[0])===15}function gS(){const n=Ze();if(n.os!==on.IOS||!n.osVersion)return!1;const e=n.osVersion.split(".");return Number(e[0])===16}function GO(){const n=Ze();if(n.os!==on.IOS||!n.osVersion)return!1;const e=n.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function Bs(){return wn()&&navigator.maxTouchPoints>0}function WO(){return Ze().name===rt.WECHAT}function HO(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function ra(){const n=Ze();return n.name===rt.EDGE||n.name===rt.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function pf(){return uf()===on.ANDROID}function Su(){const n=Ze();return pf()&&(n.name===rt.CHROME||n.name===rt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var O;(function(n){n.UNEXPECTED_ERROR="UNEXPECTED_ERROR",n.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",n.TIMEOUT="TIMEOUT",n.INVALID_PARAMS="INVALID_PARAMS",n.NOT_READABLE="NOT_READABLE",n.NOT_SUPPORTED="NOT_SUPPORTED",n.INVALID_OPERATION="INVALID_OPERATION",n.OPERATION_ABORTED="OPERATION_ABORTED",n.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",n.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",n.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",n.DATACHANNEL_FAILED="DATACHANNEL_FAILED",n.NETWORK_ERROR="NETWORK_ERROR",n.NETWORK_TIMEOUT="NETWORK_TIMEOUT",n.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",n.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",n.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",n.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",n.ELECTRON_IS_NULL="ELECTRON_IS_NULL",n.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",n.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",n.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",n.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",n.PERMISSION_DENIED="PERMISSION_DENIED",n.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",n.TRACK_IS_DISABLED="TRACK_IS_DISABLED",n.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",n.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",n.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",n.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",n.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",n.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",n.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",n.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",n.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",n.UID_CONFLICT="UID_CONFLICT",n.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",n.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",n.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",n.INVALID_TRACK="INVALID_TRACK",n.SENDER_NOT_FOUND="SENDER_NOT_FOUND",n.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",n.SET_ANSWER_FAILED="SET_ANSWER_FAILED",n.ICE_FAILED="ICE_FAILED",n.PC_CLOSED="PC_CLOSED",n.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",n.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",n.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",n.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",n.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",n.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",n.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",n.INVALID_REMOTE_USER="INVALID_REMOTE_USER",n.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",n.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",n.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",n.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",n.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",n.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",n.WS_ABORT="WS_ABORT",n.WS_DISCONNECT="WS_DISCONNECT",n.WS_ERR="WS_ERR",n.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",n.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",n.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",n.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",n.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",n.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",n.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",n.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",n.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",n.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",n.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",n.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",n.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",n.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",n.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",n.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",n.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",n.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",n.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",n.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",n.INVALID_PLUGIN="INVALID_PLUGIN",n.DISCONNECT_P2P="DISCONNECT_P2P",n.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",n.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",n.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",n.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",n.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",n.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",n.PROHIBITED_OPERATION="PROHIBITED_OPERATION",n.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",n.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED"})(O||(O={}));let Q=class extends Error{constructor(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",t=arguments.length>2?arguments[2]:void 0;super(e),S(this,"code",void 0),S(this,"message",void 0),S(this,"data",void 0),S(this,"name","AgoraRTCException"),this.code=n,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=t}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return n==="error"&&(e||console).error(this.toString()),n==="warning"&&(e||console).warn(this.toString()),this}throw(n){throw this.print("error",n),this}};function Eo(n,e){if(typeof n!="boolean")throw new Q(O.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function an(n,e,t){if(!fe(t).call(t,n))throw new Q(O.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(t)))}function pt(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(n<t||n>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(s){return typeof s=="number"&&s%1==0}(n))throw new Q(O.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(t,", ").concat(i,"]. integer only"))}function SS(n,e){if(typeof n!="number"){if(!(n.min||n.max||n.ideal||n.exact))throw new Q(O.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));n.min!==void 0&&pt(n.min,"".concat(e,".min"),0,1/0),n.max!==void 0&&pt(n.max,"".concat(e,".max"),1,1/0),n.exact!==void 0&&pt(n.exact,"".concat(e,".exact"),1,1/0),n.ideal!==void 0&&pt(n.ideal,"".concat(e,".ideal"),1,1/0)}else pt(n,e,1,1/0)}function Un(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(n==null)throw new Q(O.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!KO(n,t,i,s))throw new Q(O.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(t,",").concat(i,"].").concat(s?" ASCII characters only.":""))}function go(n,e){if(!Array.isArray(n))throw new Q(O.INVALID_PARAMS,"".concat(e," should be an array"))}function Lt(n){return n==null}function KO(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof n=="string"&&n.length<=t&&n.length>=e&&(!i||function(s){if(typeof s!="string")return!1;for(let a=0;a<s.length;a+=1){const c=s.charCodeAt(a);if(c<0||c>255)return!1}return!0}(n))}function zO(n,e,t){if("getBigUint64"in DataView.prototype)return n.getBigUint64(e,t);const i=n.getUint32(e,t),s=n.getUint32(e+4,t),a=+!!t,c=+!t;return BigInt(i*c+s*a)<<BigInt(32)|BigInt(i*a+s*c)}function YO(n,e,t,i){if("setBigUint64"in DataView.prototype)return n.setBigUint64(e,t,i);const s=Number(t>>BigInt(32)),a=Number(t&BigInt(4294967295));n.setUint32(e,s,i),n.setUint32(e+4,a,i)}var Ad,ff;(function(n){n.COVERED="COVERED",n.POSITION="POSITION",n.SIZE="SIZE",n.STYLE="STYLE"})(Ad||(Ad={})),function(n){n.UNMOUNTED="UNMOUNTED",n.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(ff||(ff={}));const qO=new class{constructor(){S(this,"_clientSize",null),S(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),S(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),S(this,"getStyle",n=>window.getComputedStyle(n,null)),S(this,"checkCssVisibleProperty",n=>{var e;let t=!0;const i=this.getStyle(n),{display:s,visibility:a,opacity:c,filter:l}=i;return(s==="none"||fe(e=["hidden","collapse"]).call(e,a)||Number(c)<.1)&&(t=!1),t?(l&&l.split(" ").filter(h=>{var p;const f=h.split("(")[0];return fe(p=["brightness","blur","opacity"]).call(p,f)}).map(h=>{const[p,f]=h.split(/\(|\)/);return[p,Number(f.match(/^[0-9\.]+/))]}).forEach(h=>{const[p,f]=h;switch(p){case"brightness":(f<.1||f>3)&&(t=!1);break;case"blur":f>3&&(t=!1);break;case"opacity":f<.1&&(t=!1)}}),t):!1}),S(this,"checkPropertyUpToAllParentNodes",(n,e)=>{let t=!0,i=!0;const s=c=>e(c);let a=n;for(;a&&i;)s(a)||(t=!1,i=!1),a=a.parentElement,a||(i=!1);return t}),S(this,"checkActualCssVisibleIncludeInherit",n=>this.checkPropertyUpToAllParentNodes(n,this.checkCssVisibleProperty)),S(this,"getSizeAboutClient",n=>{const{width:e,height:t,left:i,right:s,top:a,bottom:c}=n.getBoundingClientRect(),l=this.getClientWidth(),h=this.getClientHeight();return{width:e,height:t,left:i,right:s,top:a,bottom:c,clientWidth:l,clientHeight:h,clientMin:Math.min(l,h)}}),S(this,"checkActualSize",()=>{const{width:n,height:e,clientMin:t}=this._clientSize;return this.checkSizeIsVisible(n,e,t)}),S(this,"elementFromPoint",(n,e)=>document.elementFromPoint?document.elementFromPoint(n,e):null),S(this,"checkCoverForAPoint",(n,e,t)=>{const i=this.elementFromPoint(n,e);return i!==null&&i!==t}),S(this,"getPointPositionList",()=>{const{width:n,height:e,left:t,top:i}=this._clientSize,s=n/6,a=e/6,c=[],l=10**6;for(let h=0;h<5;h++)for(let p=0;p<5;p++){const f=(t*l+(h===0?.1:h===4?(s*h*l-1e5)/l:s*h)*l)/l,_=(i*l+(p===0?.1:p===4?(a*p*l-1e5)/l:a*p)*l)/l;c.push({x:f,y:_})}return[...c]}),S(this,"checkElementCover",n=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,n)).filter(e=>!!e).length>6),S(this,"checkSizeIsVisible",(n,e,t)=>(n>50||t/n<=10)&&(e>50||t/e<=10)),S(this,"checkSizeOfPartInClient",()=>{const{left:n,right:e,top:t,bottom:i,clientHeight:s,clientWidth:a,clientMin:c}=this._clientSize;let l,h,p,f;if(n<0)l=0;else{if(!(n<a))return!1;l=n}if(e<0)return!1;if(h=e<a?e:a,t<0)p=0;else{if(!(t<s))return!1;p=t}if(i<0)return!1;f=i<s?i:s;const _=h-l,g=f-p;return this.checkSizeIsVisible(_,g,c)}),S(this,"returnHiddenResult",n=>(this._clientSize=null,{visible:!1,reason:n})),S(this,"checkOneElementVisible",n=>{if(n instanceof HTMLElement){if(this.checkElementIsMountedOnDom(n)){if(this.checkActualCssVisibleIncludeInherit(n)){if(this._clientSize=this.getSizeAboutClient(n),this.checkElementCover(n))return this.returnHiddenResult(Ad.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(Ad.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Ad.SIZE)}}return this.returnHiddenResult(Ad.STYLE)}return this.returnHiddenResult(ff.UNMOUNTED)}return this.returnHiddenResult(ff.INVALID_HTML_ELEMENT)}),S(this,"checkElementIsMountedOnDom",n=>this.checkPropertyUpToAllParentNodes(n,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function TS(n){return new TextEncoder().encode(n)}const JO=function(n,e){const t=new Uint8Array(n.byteLength+e.byteLength);return t.set(new Uint8Array(n),0),t.set(new Uint8Array(e),n.byteLength),t},EH=async n=>{const e=function(a){const c=window.atob(a),l=new Uint8Array(new ArrayBuffer(c.length));for(let h=0;h<c.length;h+=1)l[h]=c.charCodeAt(h);return l}(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),t=await window.crypto.subtle.importKey("spki",e,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=TS(n),s=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},t,i);return function(a){let c="";for(let l=0;l<a.length;l+=1)c+=String.fromCharCode(a[l]);return window.btoa(c)}(new Uint8Array(s))},vS=async n=>function(e,t){let i="";return new Uint8Array(e).forEach(s=>{i+=s.toString(t).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",TS(n)),16);class At{constructor(){S(this,"_events",{}),S(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,t)===-1&&i.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,t)===-1&&i.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const i=this._events[e],s=this._indexOfListener(i,t);s!==-1&&i.splice(s,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(c=>c);for(var i=arguments.length,s=new Array(i>1?i-1:0),a=1;a<i;a++)s[a-1]=arguments[a];for(let c=0;c<t.length;c+=1){const l=t[c];l.once&&this.off(e,l.listener),l.listener.apply(this,s||[])}}safeEmit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];[...this._events[e]||[]].forEach(a=>{a.once&&this.off(e,a.listener);try{a.listener.apply(this,i)}catch(c){console.error("safeEmit event:".concat(e," error ").concat(c==null?void 0:c.toString()))}})}_indexOfListener(e,t){let i=e.length;for(;i--;)if(e[i].listener===t)return i;return-1}}let Tu=null;function XO(){if(Tu)return Tu;if(window.electron)return Tu=window.electron;if(!window.require)return null;try{return Tu=window.require("electron"),Tu}catch{return null}}var Jt,Pt,yS,Ye,qe,gn,ii,So;function QO(n){return pt(n.timeout,"config.timeout",0,1e5),pt(n.timeoutFactor,"config.timeoutFactor",0,100,!1),pt(n.maxRetryCount,"config.maxRetryConfig",0,1/0),pt(n.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Od(n){if(!Array.isArray(n)||n.length<1)return!1;try{n.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function $O(n){return Un(n.turnServerURL,"turnServerURL"),Un(n.username,"username"),Un(n.password,"password"),n.udpport&&pt(n.udpport,"udpport",1,99999,!0),n.forceturn&&Eo(n.forceturn,"forceturn"),n.security&&Eo(n.security,"security"),n.tcpport&&pt(n.tcpport,"tcpport",1,99999,!0),!0}function ZO(n){return n.level!==void 0&&an(n.level,"level",[1,2,3]),n.delay!==void 0&&pt(n.delay,"delay",0,3e3,!0),!0}function Xt(n,e){for(var t=arguments.length,i=new Array(t>2?t-2:0),s=2;s<t;s++)i[s-2]=arguments[s];return n.getListeners(e).length===0?W.reject(new Q(O.UNEXPECTED_ERROR,"can not emit promise")):new W((a,c)=>{n.emit(e,...i,a,c)})}function _t(n,e){if(n.getListeners(e).length===0)return W.resolve();for(var t=arguments.length,i=new Array(t>2?t-2:0),s=2;s<t;s++)i[s-2]=arguments[s];return Xt(n,e,...i)}function Ui(n,e){if(n.getListeners(e).length===0)return null;for(var t=arguments.length,i=new Array(t>2?t-2:0),s=2;s<t;s++)i[s-2]=arguments[s];return gc(n,e,...i)}function gc(n,e){let t=null,i=null;for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];if(n.emit(e,...a,l=>{t=l},l=>{i=l}),i!==null)throw i;if(t===null)throw new Q(O.UNEXPECTED_ERROR,"handler is not sync");return t}(function(n){n.CREATE_CLIENT="createClient",n.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",n.SET_AREA="setArea",n.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",n.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",n.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",n.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",n.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",n.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",n.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",n.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",n.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",n.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",n.START_PROXY_SERVER="Client.startProxyServer",n.STOP_PROXY_SERVER="Client.stopProxyServer",n.SET_PROXY_SERVER="Client.setProxyServer",n.SET_TURN_SERVER="Client.setTurnServer",n.SET_CLIENT_ROLE="Client.setClientRole",n.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",n.ENABLE_DUAL_STREAM="Client.enableDualStream",n.DISABLE_DUAL_STREAM="Client.disableDualStream",n.JOIN="Client.join",n.LEAVE="Client.leave",n.PUBLISH="Client.publish",n.UNPUBLISH="Client.unpublish",n.SUBSCRIBE="Client.subscribe",n.MASS_SUBSCRIBE="Client.massSubscribe",n.MASS_UNSUBSCRIBE="Client.massUnsubscribe",n.UNSUBSCRIBE="Client.unsubscribe",n.RENEW_TOKEN="Client.renewToken",n.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",n.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",n.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",n.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",n.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",n.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",n.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",n.DATACHANNEL_FAILBACK="Client._datachannelFailback",n.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",n.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",n.START_LIVE_STREAMING="Client.startLiveStreaming",n.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",n.STOP_LIVE_STREAMING="Client.stopLiveStreaming",n.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",n.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",n.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",n.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",n.SET_CONFIG_DISTRIBUTE="_configDistribute",n.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",n.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",n.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",n.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",n.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",n.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",n.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",n.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",n.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",n.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",n.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",n.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",n.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",n.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",n.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",n.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",n.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",n.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",n.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",n.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",n.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",n.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",n.STREAM_TYPE_CHANGE="streamTypeChange",n.CONNECTION_STATE_CHANGE="connectionStateChange",n.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",n.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(Jt||(Jt={})),function(n){n.TRACER="tracer"}(Pt||(Pt={})),function(n){n[n.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",n[n.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",n[n.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(yS||(yS={})),function(n){n.LEAVE="LEAVE",n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.UID_BANNED="UID_BANNED",n.IP_BANNED="IP_BANNED",n.CHANNEL_BANNED="CHANNEL_BANNED",n.FALLBACK="FALLBACK",n.LICENSE_MISSING="LICENSE_MISSING",n.LICENSE_EXPIRED="LICENSE_EXPIRED",n.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",n.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",n.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",n.LICENSE_ILLEGAL="LICENSE_ILLEGAL",n.TOKEN_EXPIRE="TOKEN_EXPIRE"}(Ye||(Ye={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.MEDIA_RECONNECT_START="media-reconnect-start",n.MEDIA_RECONNECT_END="media-reconnect-end",n.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",n.USER_JOINED="user-joined",n.USER_LEAVED="user-left",n.USER_PUBLISHED="user-published",n.USER_UNPUBLISHED="user-unpublished",n.USER_INFO_UPDATED="user-info-updated",n.CLIENT_BANNED="client-banned",n.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",n.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",n.VOLUME_INDICATOR="volume-indicator",n.CRYPT_ERROR="crypt-error",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGED="stream-type-changed",n.STREAM_FALLBACK="stream-fallback",n.RECEIVE_METADATA="receive-metadata",n.STREAM_MESSAGE="stream-message",n.LIVE_STREAMING_ERROR="live-streaming-error",n.LIVE_STREAMING_WARNING="live-streaming-warning",n.INJECT_STREAM_STATUS="stream-inject-status",n.EXCEPTION="exception",n.ERROR="error",n.P2P_LOST="p2p_lost",n.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",n.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",n.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",n.PUBLISHED_USER_LIST="published-user-list",n.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",n.CONTENT_INSPECT_ERROR="content-inspect-error",n.CONTENT_INSPECT_RESULT="content-inspect-result",n.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(qe||(qe={})),function(n){n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK"}(gn||(gn={})),function(n){n.ONLINE="ONLINE",n.OFFLINE="OFFLINE"}(ii||(ii={})),function(n){n.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",n.ONLINE="ONLINE",n.OFFLINE="OFFLINE"}(So||(So={}));const Qt=new class extends At{set networkState(n){this.emit(So.NETWORK_STATE_CHANGE,n,this._networkState),n===ii.ONLINE?this.emit(So.ONLINE):n===ii.OFFLINE&&(this.onlineWaiter=new W(e=>{this.once(So.ONLINE,()=>{this.onlineWaiter=void 0,e(ii.ONLINE)})}),this.emit(So.OFFLINE)),this._networkState=n}get networkState(){return this._networkState}get isOnline(){return this._networkState===ii.ONLINE}constructor(){super(),S(this,"_moduleName","network-indicator"),S(this,"_networkState",ii.ONLINE),S(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ii.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ii.OFFLINE})}};var gH=Vr,SH=Us,TH=Tp,vH=Jo,yH=TypeError,eb=function(n){return function(e,t,i,s){gH(t);var a=SH(e),c=TH(a),l=vH(a),h=n?l-1:0,p=n?-1:1;if(i<2)for(;;){if(h in c){s=c[h],h+=p;break}if(h+=p,n?h<0:l<=h)throw yH("Reduce of empty array with no initial value")}for(;n?h>=0:l>h;h+=p)h in c&&(s=t(s,c[h],h,a));return s}},RH={left:eb(!1),right:eb(!0)}.left;Nt({target:"Array",proto:!0,forced:!hu&&uc>79&&uc<83||!Ug("reduce")},{reduce:function(n){var e=arguments.length;return RH(this,n,e,e>1?arguments[1]:void 0)}});var CH=Xo("Array").reduce,IH=X,wH=CH,RS=Array.prototype,To=m(function(n){var e=n.reduce;return n===RS||IH(RS,n)&&e===RS.reduce?wH:e});function tb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Sc(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?tb(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):tb(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function mf(n,e){const t=n.indexOf(e);t!==-1&&n.splice(t,1)}function bd(n){const e=[];return n.forEach(t=>{e.indexOf(t)===-1&&e.push(t)}),e}function _f(n){W!==void 0?W.resolve().then(n):setTimeout(n,0)}function St(n){return JSON.parse(JSON.stringify(n))}function Tc(n){try{return St(n)}catch{return n}}const nb={};function Nd(n,e){nb[e]||(nb[e]=!0,n())}function vu(n){const e=window.atob(n),t=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)t[i]=e.charCodeAt(i);return t}function Pd(n){let e="";for(let t=0;t<n.length;t+=1)e+=String.fromCharCode(n[t]);return window.btoa(e)}function ib(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const i=To(e).call(e,(c,l)=>c+l.length,0),s=new Uint8Array(new ArrayBuffer(i));let a=0;return e.forEach(c=>{s.set(c,a),a+=c.length}),s}function js(n){return window.TextEncoder?new TextEncoder().encode(n).length:n.length}function rb(n){let e=0;return/DingTalk/i.test(navigator.userAgent)&&n.realFormData&&(n=n.realFormData),n.forEach(t=>{e+=typeof t=="string"?js(t):t.size}),e+138}function AH(n){const e=new Q(O.TIMEOUT,"timeout");return new W((t,i)=>{window.setTimeout(()=>i(e),n)})}function Sn(n){return new W(e=>{window.setTimeout(e,n)})}function Et(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const t=Math.random().toString(16).substr(2,n).toLowerCase();return t.length===n?"".concat(e).concat(t):"".concat(e).concat(t)+Et(n-t.length,"")}function CS(){return Et(32,"").toUpperCase()}const Ef=()=>{},sb=new class{constructor(){S(this,"fnMap",new Map)}throttleByKey(n,e,t,i){for(var s=arguments.length,a=new Array(s>4?s-4:0),c=4;c<s;c++)a[c-4]=arguments[c];if(this.fnMap.has(e)){const l=this.fnMap.get(e);if(l.threshold!==t){l.fn(...l.args),clearTimeout(l.timer);const h=window.setTimeout(()=>{const p=this.fnMap.get(e);p&&p.fn(...p.args),this.fnMap.delete(e)},t);this.fnMap.set(e,{fn:n,threshold:t,timer:h,args:a,skipFn:i})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(e,Sc(Sc({},l),{},{fn:n,args:a,skipFn:i}))}else{const l=window.setTimeout(()=>{const h=this.fnMap.get(e);h&&h.fn(...h.args),this.fnMap.delete(e)},t);this.fnMap.set(e,{fn:n,threshold:t,timer:l,args:a,skipFn:i})}}},ob=sb.throttleByKey.bind(sb);function ab(n){return typeof n=="object"&&n!==null&&!(n instanceof RegExp)}function IS(n,e){if(!ab(n)||!ab(e)||Array.isArray(n)&&!Array.isArray(e)||!Array.isArray(n)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(n)){const t=[...n];for(let i=0;i<e.length;i++)t[i]=IS(n[i],e[i]);return t}{const t=Sc({},n);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(n,i)?t[i]=IS(n[i],e[i]):t[i]=e[i]);return t}}function cb(n,e){let t=[0];if(t=new Array(e).fill(0),n===0)return t;let i=0;for(;n>0&&(t[i]=255&n,n>>=8,i++,i!==e););return t}let OH=1,gf=console;class Tn{static setLogger(e){gf=e}constructor(e){S(this,"lockingPromise",W.resolve()),S(this,"locks",0),S(this,"name",""),S(this,"lockId",void 0),this.lockId=OH++,e&&(this.name=e),gf.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,gf.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));const i=new W(a=>{t=()=>{this.locks-=1,gf.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),a()}}),s=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>i),s}}function Dd(n,e){return function(t,i,s){const a=s.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this[e];if(!c)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(n));const l=await c.lock("From ".concat(n,".").concat(i));try{for(var h=arguments.length,p=new Array(h),f=0;f<h;f++)p[f]=arguments[f];return await a.apply(this,p)}finally{l()}},s}}const $t={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Sf(n,e){const t=Math.floor(e.timeout*Math.pow(e.timeoutFactor,n));return Math.min(e.maxRetryTimeout,t)}function _s(n,e,t,i){const s=Object.assign({},$t,i);let a=s.timeout;const c=async()=>{await function(p){return new W(f=>{window.setTimeout(f,p)})}(a),a*=s.timeoutFactor,a=Math.min(s.maxRetryTimeout,a)};let l=!1;const h=new W(async(p,f)=>{e=e||(()=>!1),t=t||(()=>!0);for(let _=0;_<s.maxRetryCount;_+=1){if(l)return f(new Q(O.OPERATION_ABORTED));try{const g=await n();if(!e(g,_)||_+1===s.maxRetryCount)return p(g);await c()}catch(g){if(!t(g,_)||_+1===s.maxRetryCount)return f(g);await c()}}});return h.cancel=()=>l=!0,h}let wS=class{constructor(n){S(this,"input",[]),S(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}mean(){var n;return this.input.length===0?0:To(n=this.input).call(n,(e,t)=>e+t)/this.input.length}};function db(n,e){return function(){return n.apply(e,arguments)}}const{toString:bH}=Object.prototype,{getPrototypeOf:AS}=Object,Tf=(OS=Object.create(null),n=>{const e=bH.call(n);return OS[e]||(OS[e]=e.slice(8,-1).toLowerCase())});var OS;const Gs=n=>(n=n.toLowerCase(),e=>Tf(e)===n),vf=n=>e=>typeof e===n,{isArray:kd}=Array,yu=vf("undefined"),lb=Gs("ArrayBuffer"),NH=vf("string"),jr=vf("function"),ub=vf("number"),yf=n=>n!==null&&typeof n=="object",Rf=n=>{if(Tf(n)!=="object")return!1;const e=AS(n);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in n||Symbol.iterator in n)},PH=Gs("Date"),DH=Gs("File"),kH=Gs("Blob"),LH=Gs("FileList"),MH=Gs("URLSearchParams");function Ru(n,e,{allOwnKeys:t=!1}={}){if(n==null)return;let i,s;if(typeof n!="object"&&(n=[n]),kd(n))for(i=0,s=n.length;i<s;i++)e.call(null,n[i],i,n);else{const a=t?Object.getOwnPropertyNames(n):Object.keys(n),c=a.length;let l;for(i=0;i<c;i++)l=a[i],e.call(null,n[l],l,n)}}function hb(n,e){e=e.toLowerCase();const t=Object.keys(n);let i,s=t.length;for(;s-- >0;)if(i=t[s],e===i.toLowerCase())return i;return null}const pb=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Bm,fb=n=>!yu(n)&&n!==pb,UH=(bS=typeof Uint8Array<"u"&&AS(Uint8Array),n=>bS&&n instanceof bS);var bS;const xH=Gs("HTMLFormElement"),mb=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),VH=Gs("RegExp"),_b=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),i={};Ru(t,(s,a)=>{let c;(c=e(s,a,n))!==!1&&(i[a]=c||s)}),Object.defineProperties(n,i)},NS="abcdefghijklmnopqrstuvwxyz",Eb="0123456789",gb={DIGIT:Eb,ALPHA:NS,ALPHA_DIGIT:NS+NS.toUpperCase()+Eb},FH=Gs("AsyncFunction");var me={isArray:kd,isArrayBuffer:lb,isBuffer:function(n){return n!==null&&!yu(n)&&n.constructor!==null&&!yu(n.constructor)&&jr(n.constructor.isBuffer)&&n.constructor.isBuffer(n)},isFormData:n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||jr(n.append)&&((e=Tf(n))==="formdata"||e==="object"&&jr(n.toString)&&n.toString()==="[object FormData]"))},isArrayBufferView:function(n){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer&&lb(n.buffer),e},isString:NH,isNumber:ub,isBoolean:n=>n===!0||n===!1,isObject:yf,isPlainObject:Rf,isUndefined:yu,isDate:PH,isFile:DH,isBlob:kH,isRegExp:VH,isFunction:jr,isStream:n=>yf(n)&&jr(n.pipe),isURLSearchParams:MH,isTypedArray:UH,isFileList:LH,forEach:Ru,merge:function n(){const{caseless:e}=fb(this)&&this||{},t={},i=(s,a)=>{const c=e&&hb(t,a)||a;Rf(t[c])&&Rf(s)?t[c]=n(t[c],s):Rf(s)?t[c]=n({},s):kd(s)?t[c]=s.slice():t[c]=s};for(let s=0,a=arguments.length;s<a;s++)arguments[s]&&Ru(arguments[s],i);return t},extend:(n,e,t,{allOwnKeys:i}={})=>(Ru(e,(s,a)=>{t&&jr(s)?n[a]=db(s,t):n[a]=s},{allOwnKeys:i}),n),trim:n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),inherits:(n,e,t,i)=>{n.prototype=Object.create(e.prototype,i),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},toFlatObject:(n,e,t,i)=>{let s,a,c;const l={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),a=s.length;a-- >0;)c=s[a],i&&!i(c,n,e)||l[c]||(e[c]=n[c],l[c]=!0);n=t!==!1&&AS(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},kindOf:Tf,kindOfTest:Gs,endsWith:(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const i=n.indexOf(e,t);return i!==-1&&i===t},toArray:n=>{if(!n)return null;if(kd(n))return n;let e=n.length;if(!ub(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},forEachEntry:(n,e)=>{const t=(n&&n[Symbol.iterator]).call(n);let i;for(;(i=t.next())&&!i.done;){const s=i.value;e.call(n,s[0],s[1])}},matchAll:(n,e)=>{let t;const i=[];for(;(t=n.exec(e))!==null;)i.push(t);return i},isHTMLForm:xH,hasOwnProperty:mb,hasOwnProp:mb,reduceDescriptors:_b,freezeMethods:n=>{_b(n,(e,t)=>{if(jr(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const i=n[t];jr(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")}))})},toObjectSet:(n,e)=>{const t={},i=s=>{s.forEach(a=>{t[a]=!0})};return kd(n)?i(n):i(String(n).split(e)),t},toCamelCase:n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,i){return t.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(n,e)=>(n=+n,Number.isFinite(n)?n:e),findKey:hb,global:pb,isContextDefined:fb,ALPHABET:gb,generateString:(n=16,e=gb.ALPHA_DIGIT)=>{let t="";const{length:i}=e;for(;n--;)t+=e[Math.random()*i|0];return t},isSpecCompliantForm:function(n){return!!(n&&jr(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])},toJSONObject:n=>{const e=new Array(10),t=(i,s)=>{if(yf(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[s]=i;const a=kd(i)?[]:{};return Ru(i,(c,l)=>{const h=t(c,s+1);!yu(h)&&(a[l]=h)}),e[s]=void 0,a}}return i};return t(n,0)},isAsyncFn:FH,isThenable:n=>n&&(yf(n)||jr(n))&&jr(n.then)&&jr(n.catch)};function Dt(n,e,t,i,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),i&&(this.request=i),s&&(this.response=s)}me.inherits(Dt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:me.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Sb=Dt.prototype,Tb={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Tb[n]={value:n}}),Object.defineProperties(Dt,Tb),Object.defineProperty(Sb,"isAxiosError",{value:!0}),Dt.from=(n,e,t,i,s,a)=>{const c=Object.create(Sb);return me.toFlatObject(n,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),Dt.call(c,n.message,e,t,i,s),c.cause=n,c.name=n.name,a&&Object.assign(c,a),c};function PS(n){return me.isPlainObject(n)||me.isArray(n)}function vb(n){return me.endsWith(n,"[]")?n.slice(0,-2):n}function yb(n,e,t){return n?n.concat(e).map(function(i,s){return i=vb(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}const BH=me.toFlatObject(me,{},null,function(n){return/^is[A-Z]/.test(n)});function Cf(n,e,t){if(!me.isObject(n))throw new TypeError("target must be an object");e=e||new FormData;const i=(t=me.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,T){return!me.isUndefined(T[g])})).metaTokens,s=t.visitor||p,a=t.dots,c=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&me.isSpecCompliantForm(e);if(!me.isFunction(s))throw new TypeError("visitor must be a function");function h(g){if(g===null)return"";if(me.isDate(g))return g.toISOString();if(!l&&me.isBlob(g))throw new Dt("Blob is not supported. Use a Buffer instead.");return me.isArrayBuffer(g)||me.isTypedArray(g)?l&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function p(g,T,w){let R=g;if(g&&!w&&typeof g=="object"){if(me.endsWith(T,"{}"))T=i?T:T.slice(0,-2),g=JSON.stringify(g);else if(me.isArray(g)&&function(I){return me.isArray(I)&&!I.some(PS)}(g)||(me.isFileList(g)||me.endsWith(T,"[]"))&&(R=me.toArray(g)))return T=vb(T),R.forEach(function(I,N){!me.isUndefined(I)&&I!==null&&e.append(c===!0?yb([T],N,a):c===null?T:T+"[]",h(I))}),!1}return!!PS(g)||(e.append(yb(w,T,a),h(g)),!1)}const f=[],_=Object.assign(BH,{defaultVisitor:p,convertValue:h,isVisitable:PS});if(!me.isObject(n))throw new TypeError("data must be an object");return function g(T,w){if(!me.isUndefined(T)){if(f.indexOf(T)!==-1)throw Error("Circular reference detected in "+w.join("."));f.push(T),me.forEach(T,function(R,I){(!(me.isUndefined(R)||R===null)&&s.call(e,R,me.isString(I)?I.trim():I,w,_))===!0&&g(R,w?w.concat(I):[I])}),f.pop()}}(n),e}function Rb(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function DS(n,e){this._pairs=[],n&&Cf(n,this,e)}const Cb=DS.prototype;function jH(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ib(n,e,t){if(!e)return n;const i=t&&t.encode||jH,s=t&&t.serialize;let a;if(a=s?s(e,t):me.isURLSearchParams(e)?e.toString():new DS(e,t).toString(i),a){const c=n.indexOf("#");c!==-1&&(n=n.slice(0,c)),n+=(n.indexOf("?")===-1?"?":"&")+a}return n}Cb.append=function(n,e){this._pairs.push([n,e])},Cb.toString=function(n){const e=n?function(t){return n.call(this,t,Rb)}:Rb;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};var wb=class{constructor(){this.handlers=[]}use(n,e,t){return this.handlers.push({fulfilled:n,rejected:e,synchronous:!!t&&t.synchronous,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){me.forEach(this.handlers,function(e){e!==null&&n(e)})}},Ab={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},GH={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:DS,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const Ob=typeof window<"u"&&typeof document<"u",WH=(bb=typeof navigator<"u"&&navigator.product,Ob&&["ReactNative","NativeScript","NS"].indexOf(bb)<0);var bb;const HH=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";var Ws={...Object.freeze({__proto__:null,hasBrowserEnv:Ob,hasStandardBrowserEnv:WH,hasStandardBrowserWebWorkerEnv:HH}),...GH};function Nb(n){function e(t,i,s,a){let c=t[a++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),h=a>=t.length;return c=!c&&me.isArray(s)?s.length:c,h?(me.hasOwnProp(s,c)?s[c]=[s[c],i]:s[c]=i,!l):(s[c]&&me.isObject(s[c])||(s[c]=[]),e(t,i,s[c],a)&&me.isArray(s[c])&&(s[c]=function(p){const f={},_=Object.keys(p);let g;const T=_.length;let w;for(g=0;g<T;g++)w=_[g],f[w]=p[w];return f}(s[c])),!l)}if(me.isFormData(n)&&me.isFunction(n.entries)){const t={};return me.forEachEntry(n,(i,s)=>{e(function(a){return me.matchAll(/\w+|\[(\w*)]/g,a).map(c=>c[0]==="[]"?"":c[1]||c[0])}(i),s,t,0)}),t}return null}const kS={transitional:Ab,adapter:["xhr","http"],transformRequest:[function(n,e){const t=e.getContentType()||"",i=t.indexOf("application/json")>-1,s=me.isObject(n);if(s&&me.isHTMLForm(n)&&(n=new FormData(n)),me.isFormData(n))return i?JSON.stringify(Nb(n)):n;if(me.isArrayBuffer(n)||me.isBuffer(n)||me.isStream(n)||me.isFile(n)||me.isBlob(n))return n;if(me.isArrayBufferView(n))return n.buffer;if(me.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let a;if(s){if(t.indexOf("application/x-www-form-urlencoded")>-1)return function(c,l){return Cf(c,new Ws.classes.URLSearchParams,Object.assign({visitor:function(h,p,f,_){return Ws.isNode&&me.isBuffer(h)?(this.append(p,h.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},l))}(n,this.formSerializer).toString();if((a=me.isFileList(n))||t.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Cf(a?{"files[]":n}:n,c&&new c,this.formSerializer)}}return s||i?(e.setContentType("application/json",!1),function(c,l,h){if(me.isString(c))try{return(l||JSON.parse)(c),me.trim(c)}catch(p){if(p.name!=="SyntaxError")throw p}return(0,JSON.stringify)(c)}(n)):n}],transformResponse:[function(n){const e=this.transitional||kS.transitional,t=e&&e.forcedJSONParsing,i=this.responseType==="json";if(n&&me.isString(n)&&(t&&!this.responseType||i)){const s=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(n)}catch(a){if(s)throw a.name==="SyntaxError"?Dt.from(a,Dt.ERR_BAD_RESPONSE,this,null,this.response):a}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ws.classes.FormData,Blob:Ws.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};me.forEach(["delete","get","head","post","put","patch"],n=>{kS.headers[n]={}});var LS=kS;const KH=me.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Pb=Symbol("internals");function Cu(n){return n&&String(n).trim().toLowerCase()}function If(n){return n===!1||n==null?n:me.isArray(n)?n.map(If):String(n)}function MS(n,e,t,i,s){return me.isFunction(i)?i.call(this,e,t):(s&&(e=t),me.isString(e)?me.isString(i)?e.indexOf(i)!==-1:me.isRegExp(i)?i.test(e):void 0:void 0)}class wf{constructor(e){e&&this.set(e)}set(e,t,i){const s=this;function a(l,h,p){const f=Cu(h);if(!f)throw new Error("header name must be a non-empty string");const _=me.findKey(s,f);(!_||s[_]===void 0||p===!0||p===void 0&&s[_]!==!1)&&(s[_||h]=If(l))}const c=(l,h)=>me.forEach(l,(p,f)=>a(p,f,h));return me.isPlainObject(e)||e instanceof this.constructor?c(e,t):me.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?c((l=>{const h={};let p,f,_;return l&&l.split(`
`).forEach(function(g){_=g.indexOf(":"),p=g.substring(0,_).trim().toLowerCase(),f=g.substring(_+1).trim(),!p||h[p]&&KH[p]||(p==="set-cookie"?h[p]?h[p].push(f):h[p]=[f]:h[p]=h[p]?h[p]+", "+f:f)}),h})(e),t):e!=null&&a(t,e,i),this}get(e,t){if(e=Cu(e)){const i=me.findKey(this,e);if(i){const s=this[i];if(!t)return s;if(t===!0)return function(a){const c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let h;for(;h=l.exec(a);)c[h[1]]=h[2];return c}(s);if(me.isFunction(t))return t.call(this,s,i);if(me.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Cu(e)){const i=me.findKey(this,e);return!(!i||this[i]===void 0||t&&!MS(0,this[i],i,t))}return!1}delete(e,t){const i=this;let s=!1;function a(c){if(c=Cu(c)){const l=me.findKey(i,c);!l||t&&!MS(0,i[l],l,t)||(delete i[l],s=!0)}}return me.isArray(e)?e.forEach(a):a(e),s}clear(e){const t=Object.keys(this);let i=t.length,s=!1;for(;i--;){const a=t[i];e&&!MS(0,this[a],a,e,!0)||(delete this[a],s=!0)}return s}normalize(e){const t=this,i={};return me.forEach(this,(s,a)=>{const c=me.findKey(i,a);if(c)return t[c]=If(s),void delete t[a];const l=e?function(h){return h.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(p,f,_)=>f.toUpperCase()+_)}(a):String(a).trim();l!==a&&delete t[a],t[l]=If(s),i[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return me.forEach(this,(i,s)=>{i!=null&&i!==!1&&(t[s]=e&&me.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const i=new this(e);return t.forEach(s=>i.set(s)),i}static accessor(e){const t=(this[Pb]=this[Pb]={accessors:{}}).accessors,i=this.prototype;function s(a){const c=Cu(a);t[c]||(function(l,h){const p=me.toCamelCase(" "+h);["get","set","has"].forEach(f=>{Object.defineProperty(l,f+p,{value:function(_,g,T){return this[f].call(this,h,_,g,T)},configurable:!0})})}(i,a),t[c]=!0)}return me.isArray(e)?e.forEach(s):s(e),this}}wf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),me.reduceDescriptors(wf.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(i){this[t]=i}}}),me.freezeMethods(wf);var vo=wf;function US(n,e){const t=this||LS,i=e||t,s=vo.from(i.headers);let a=i.data;return me.forEach(n,function(c){a=c.call(t,a,s.normalize(),e?e.status:void 0)}),s.normalize(),a}function Db(n){return!(!n||!n.__CANCEL__)}function Iu(n,e,t){Dt.call(this,n??"canceled",Dt.ERR_CANCELED,e,t),this.name="CanceledError"}me.inherits(Iu,Dt,{__CANCEL__:!0});var zH=Ws.hasStandardBrowserEnv?{write(n,e,t,i,s,a){const c=[n+"="+encodeURIComponent(e)];me.isNumber(t)&&c.push("expires="+new Date(t).toGMTString()),me.isString(i)&&c.push("path="+i),me.isString(s)&&c.push("domain="+s),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function kb(n,e){return n&&!function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}(e)?function(t,i){return i?t.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):t}(n,e):e}var YH=Ws.hasStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let t;function i(s){let a=s;return n&&(e.setAttribute("href",a),a=e.href),e.setAttribute("href",a),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return t=i(window.location.href),function(s){const a=me.isString(s)?i(s):s;return a.protocol===t.protocol&&a.host===t.host}}():function(){return!0};function Lb(n,e){let t=0;const i=function(s,a){s=s||10;const c=new Array(s),l=new Array(s);let h,p=0,f=0;return a=a!==void 0?a:1e3,function(_){const g=Date.now(),T=l[f];h||(h=g),c[p]=_,l[p]=g;let w=f,R=0;for(;w!==p;)R+=c[w++],w%=s;if(p=(p+1)%s,p===f&&(f=(f+1)%s),g-h<a)return;const I=T&&g-T;return I?Math.round(1e3*R/I):void 0}}(50,250);return s=>{const a=s.loaded,c=s.lengthComputable?s.total:void 0,l=a-t,h=i(l);t=a;const p={loaded:a,total:c,progress:c?a/c:void 0,bytes:l,rate:h||void 0,estimated:h&&c&&a<=c?(c-a)/h:void 0,event:s};p[e?"download":"upload"]=!0,n(p)}}var qH=typeof XMLHttpRequest<"u"&&function(n){return new Promise(function(e,t){let i=n.data;const s=vo.from(n.headers).normalize();let a,c,{responseType:l,withXSRFToken:h}=n;function p(){n.cancelToken&&n.cancelToken.unsubscribe(a),n.signal&&n.signal.removeEventListener("abort",a)}if(me.isFormData(i)){if(Ws.hasStandardBrowserEnv||Ws.hasStandardBrowserWebWorkerEnv)s.setContentType(!1);else if((c=s.getContentType())!==!1){const[w,...R]=c?c.split(";").map(I=>I.trim()).filter(Boolean):[];s.setContentType([w||"multipart/form-data",...R].join("; "))}}let f=new XMLHttpRequest;if(n.auth){const w=n.auth.username||"",R=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";s.set("Authorization","Basic "+btoa(w+":"+R))}const _=kb(n.baseURL,n.url);function g(){if(!f)return;const w=vo.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());(function(R,I,N){const D=N.config.validateStatus;N.status&&D&&!D(N.status)?I(new Dt("Request failed with status code "+N.status,[Dt.ERR_BAD_REQUEST,Dt.ERR_BAD_RESPONSE][Math.floor(N.status/100)-4],N.config,N.request,N)):R(N)})(function(R){e(R),p()},function(R){t(R),p()},{data:l&&l!=="text"&&l!=="json"?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:w,config:n,request:f}),f=null}if(f.open(n.method.toUpperCase(),Ib(_,n.params,n.paramsSerializer),!0),f.timeout=n.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&f.readyState===4&&(f.status!==0||f.responseURL&&f.responseURL.indexOf("file:")===0)&&setTimeout(g)},f.onabort=function(){f&&(t(new Dt("Request aborted",Dt.ECONNABORTED,n,f)),f=null)},f.onerror=function(){t(new Dt("Network Error",Dt.ERR_NETWORK,n,f)),f=null},f.ontimeout=function(){let w=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const R=n.transitional||Ab;n.timeoutErrorMessage&&(w=n.timeoutErrorMessage),t(new Dt(w,R.clarifyTimeoutError?Dt.ETIMEDOUT:Dt.ECONNABORTED,n,f)),f=null},Ws.hasStandardBrowserEnv&&(h&&me.isFunction(h)&&(h=h(n)),h||h!==!1&&YH(_))){const w=n.xsrfHeaderName&&n.xsrfCookieName&&zH.read(n.xsrfCookieName);w&&s.set(n.xsrfHeaderName,w)}i===void 0&&s.setContentType(null),"setRequestHeader"in f&&me.forEach(s.toJSON(),function(w,R){f.setRequestHeader(R,w)}),me.isUndefined(n.withCredentials)||(f.withCredentials=!!n.withCredentials),l&&l!=="json"&&(f.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&f.addEventListener("progress",Lb(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&f.upload&&f.upload.addEventListener("progress",Lb(n.onUploadProgress)),(n.cancelToken||n.signal)&&(a=w=>{f&&(t(!w||w.type?new Iu(null,n,f):w),f.abort(),f=null)},n.cancelToken&&n.cancelToken.subscribe(a),n.signal&&(n.signal.aborted?a():n.signal.addEventListener("abort",a)));const T=function(w){const R=/^([-+\w]{1,25})(:?\/\/|:)/.exec(w);return R&&R[1]||""}(_);T&&Ws.protocols.indexOf(T)===-1?t(new Dt("Unsupported protocol "+T+":",Dt.ERR_BAD_REQUEST,n)):f.send(i||null)})};const xS={http:null,xhr:qH};me.forEach(xS,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Mb=n=>`- ${n}`,JH=n=>me.isFunction(n)||n===null||n===!1;var Ub={getAdapter:n=>{n=me.isArray(n)?n:[n];const{length:e}=n;let t,i;const s={};for(let a=0;a<e;a++){let c;if(t=n[a],i=t,!JH(t)&&(i=xS[(c=String(t)).toLowerCase()],i===void 0))throw new Dt(`Unknown adapter '${c}'`);if(i)break;s[c||"#"+a]=i}if(!i){const a=Object.entries(s).map(([c,l])=>`adapter ${c} `+(l===!1?"is not supported by the environment":"is not available in the build"));throw new Dt("There is no suitable adapter to dispatch the request "+(e?a.length>1?`since :
`+a.map(Mb).join(`
`):" "+Mb(a[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:xS};function VS(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Iu(null,n)}function xb(n){return VS(n),n.headers=vo.from(n.headers),n.data=US.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Ub.getAdapter(n.adapter||LS.adapter)(n).then(function(e){return VS(n),e.data=US.call(n,n.transformResponse,e),e.headers=vo.from(e.headers),e},function(e){return Db(e)||(VS(n),e&&e.response&&(e.response.data=US.call(n,n.transformResponse,e.response),e.response.headers=vo.from(e.response.headers))),Promise.reject(e)})}const Vb=n=>n instanceof vo?n.toJSON():n;function Ld(n,e){e=e||{};const t={};function i(p,f,_){return me.isPlainObject(p)&&me.isPlainObject(f)?me.merge.call({caseless:_},p,f):me.isPlainObject(f)?me.merge({},f):me.isArray(f)?f.slice():f}function s(p,f,_){return me.isUndefined(f)?me.isUndefined(p)?void 0:i(void 0,p,_):i(p,f,_)}function a(p,f){if(!me.isUndefined(f))return i(void 0,f)}function c(p,f){return me.isUndefined(f)?me.isUndefined(p)?void 0:i(void 0,p):i(void 0,f)}function l(p,f,_){return _ in e?i(p,f):_ in n?i(void 0,p):void 0}const h={url:a,method:a,data:a,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(p,f)=>s(Vb(p),Vb(f),!0)};return me.forEach(Object.keys(Object.assign({},n,e)),function(p){const f=h[p]||s,_=f(n[p],e[p],p);me.isUndefined(_)&&f!==l||(t[p]=_)}),t}const Fb="1.6.7",FS={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{FS[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const Bb={};FS.transitional=function(n,e,t){function i(s,a){return"[Axios v"+Fb+"] Transitional option '"+s+"'"+a+(t?". "+t:"")}return(s,a,c)=>{if(n===!1)throw new Dt(i(a," has been removed"+(e?" in "+e:"")),Dt.ERR_DEPRECATED);return e&&!Bb[a]&&(Bb[a]=!0,console.warn(i(a," has been deprecated since v"+e+" and will be removed in the near future"))),!n||n(s,a,c)}};var BS={assertOptions:function(n,e,t){if(typeof n!="object")throw new Dt("options must be an object",Dt.ERR_BAD_OPTION_VALUE);const i=Object.keys(n);let s=i.length;for(;s-- >0;){const a=i[s],c=e[a];if(c){const l=n[a],h=l===void 0||c(l,a,n);if(h!==!0)throw new Dt("option "+a+" must be "+h,Dt.ERR_BAD_OPTION_VALUE)}else if(t!==!0)throw new Dt("Unknown option "+a,Dt.ERR_BAD_OPTION)}},validators:FS};const sa=BS.validators;let Af=class{constructor(n){this.defaults=n,this.interceptors={request:new wb,response:new wb}}async request(n,e){try{return await this._request(n,e)}catch(t){if(t instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";t.stack?s&&!String(t.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+s):t.stack=s}throw t}}_request(n,e){typeof n=="string"?(e=e||{}).url=n:e=n||{},e=Ld(this.defaults,e);const{transitional:t,paramsSerializer:i,headers:s}=e;t!==void 0&&BS.assertOptions(t,{silentJSONParsing:sa.transitional(sa.boolean),forcedJSONParsing:sa.transitional(sa.boolean),clarifyTimeoutError:sa.transitional(sa.boolean)},!1),i!=null&&(me.isFunction(i)?e.paramsSerializer={serialize:i}:BS.assertOptions(i,{encode:sa.function,serialize:sa.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=s&&me.merge(s.common,s[e.method]);s&&me.forEach(["delete","get","head","post","put","patch","common"],T=>{delete s[T]}),e.headers=vo.concat(a,s);const c=[];let l=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(e)===!1||(l=l&&T.synchronous,c.unshift(T.fulfilled,T.rejected))});const h=[];let p;this.interceptors.response.forEach(function(T){h.push(T.fulfilled,T.rejected)});let f,_=0;if(!l){const T=[xb.bind(this),void 0];for(T.unshift.apply(T,c),T.push.apply(T,h),f=T.length,p=Promise.resolve(e);_<f;)p=p.then(T[_++],T[_++]);return p}f=c.length;let g=e;for(_=0;_<f;){const T=c[_++],w=c[_++];try{g=T(g)}catch(R){w.call(this,R);break}}try{p=xb.call(this,g)}catch(T){return Promise.reject(T)}for(_=0,f=h.length;_<f;)p=p.then(h[_++],h[_++]);return p}getUri(n){return Ib(kb((n=Ld(this.defaults,n)).baseURL,n.url),n.params,n.paramsSerializer)}};me.forEach(["delete","get","head","options"],function(n){Af.prototype[n]=function(e,t){return this.request(Ld(t||{},{method:n,url:e,data:(t||{}).data}))}}),me.forEach(["post","put","patch"],function(n){function e(t){return function(i,s,a){return this.request(Ld(a||{},{method:n,headers:t?{"Content-Type":"multipart/form-data"}:{},url:i,data:s}))}}Af.prototype[n]=e(),Af.prototype[n+"Form"]=e(!0)});var Of=Af;class jS{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const i=this;this.promise.then(s=>{if(!i._listeners)return;let a=i._listeners.length;for(;a-- >0;)i._listeners[a](s);i._listeners=null}),this.promise.then=s=>{let a;const c=new Promise(l=>{i.subscribe(l),a=l}).then(s);return c.cancel=function(){i.unsubscribe(a)},c},e(function(s,a,c){i.reason||(i.reason=new Iu(s,a,c),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new jS(function(t){e=t}),cancel:e}}}var XH=jS;const GS={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(GS).forEach(([n,e])=>{GS[e]=n});var QH=GS;const zn=function n(e){const t=new Of(e),i=db(Of.prototype.request,t);return me.extend(i,Of.prototype,t,{allOwnKeys:!0}),me.extend(i,t,null,{allOwnKeys:!0}),i.create=function(s){return n(Ld(e,s))},i}(LS);zn.Axios=Of,zn.CanceledError=Iu,zn.CancelToken=XH,zn.isCancel=Db,zn.VERSION=Fb,zn.toFormData=Cf,zn.AxiosError=Dt,zn.Cancel=zn.CanceledError,zn.all=function(n){return Promise.all(n)},zn.spread=function(n){return function(e){return n.apply(null,e)}},zn.isAxiosError=function(n){return me.isObject(n)&&n.isAxiosError===!0},zn.mergeConfig=Ld,zn.AxiosHeaders=vo,zn.formToJSON=n=>Nb(me.isHTMLForm(n)?new FormData(n):n),zn.getAdapter=Ub.getAdapter,zn.HttpStatusCode=QH,zn.default=zn;var vi=zn;function jb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Gb(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?jb(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):jb(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let bf,Nf=0,WS=0;function HS(n,e,t,i){return new W((s,a)=>{e.responseType=e.responseType||"json",e.data&&!t?(e.data=JSON.stringify(e.data),Nf+=js(e.data)):t&&(e.data.size?Nf+=e.data.size:e.data instanceof FormData?Nf+=rb(e.data):Nf+=js(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=n,vi.request(e).then(c=>{typeof c.data=="string"?WS+=js(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?WS+=c.data.byteLength:WS+=js(JSON.stringify(c.data)),s(c.data)}).catch(c=>{vi.isCancel(c)?a(new Q(O.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new Q(O.NETWORK_TIMEOUT,c.message)):c.response?a(new Q(O.NETWORK_RESPONSE_ERROR,c.response.status)):a(new Q(O.NETWORK_ERROR,c.message))})})}async function $H(n,e){const t=new Blob([e.data],{type:"buffer"});return await HS(n,Gb(Gb({},e),{},{data:t,headers:{"Content-Type":"application/octet-stream"}}),!0)}const ZH=()=>(bf||bf||(bf=(window.location.protocol.split(":")[0]||"").toUpperCase(),bf))==="HTTPS",Wb=()=>window.isSecureContext!==void 0,Tr=function(n){if(n.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return n;const e=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(e&&e[1]&&e[2]){const i=e[1],s=e[2];return"".concat(i,".").concat(s)}const t=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(t&&t[1]&&t[2]){const i=t[1],s=t[2];return"".concat(i,".").concat(100*(Number(s)+1))}return"4.0.0.999"}("4.20.2"),KS=function(){try{return JSON.parse("true")===!0}catch{return!0}}();var yo;(function(n){n.Default="default",n.Auto="auto",n.Relay="relay",n.SdRtn="sd-rtn"})(yo||(yo={}));const zS="v4.20.2-0-g8ae7fdad(3/20/2024, 4:48:46 PM)",ri={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:100,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],PLUGIN_INFO:[]};function ft(n,e,t){var i,s;fe(i=Object.keys(ri)).call(i,n)&&(!t&&fe(s=Object.keys(oa)).call(s,n)||(ri[n]=e,n==="ENABLE_VIDEO_SEI"&&e===!0&&(ri.ENABLE_ENCODED_TRANSFORM=!0)))}function L(n){return ri[n]}const oa={};function Hb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function ye(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Hb(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Hb(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}var He;(function(n){n.SET_SESSION_ID="SET_SESSION_ID",n.SET_P2P_ID="SET_P2P_id",n.SET_DC_ID="SET_DC_id",n.SET_UID="SET_UID",n.SET_INT_UID="SET_INT_UID",n.SET_PUB_ID="SET_PUB_ID",n.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",n.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",n.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",n.AVOID_JOIN_START="AVOID_JOIN_START",n.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",n.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",n.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",n.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",n.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",n.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",n.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",n.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",n.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",n.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",n.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",n.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",n.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",n.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",n.RESET_KEY_METRICS="RESET_KEY_METRICS",n.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",n.SET_USE_P2P="SET_USE_P2P",n.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE"})(He||(He={}));class e6{constructor(e,t,i,s){S(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:i,clientId:s,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:yo.Default}}dispatch(e){this.state=function(t,i){switch(i.type){case He.SET_SESSION_ID:return ye(ye({},t),{},{sessionId:i.sessionId});case He.SET_P2P_ID:return ye(ye({},t),{},{p2pId:i.p2pId});case He.SET_UID:return ye(ye({},t),{},{uid:i.uid});case He.SET_INT_UID:return ye(ye({},t),{},{intUid:i.intUid});case He.SET_PUB_ID:return ye(ye({},t),{},{pubId:i.pubId});case He.KEY_METRIC_CLIENT_CREATED:return ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{clientCreated:i.metric})});case He.KEY_METRIC_JOIN_START:return ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{joinStart:i.metric})});case He.AVOID_JOIN_START:return ye(ye({},t),{},{avoidJoinStart:i.avoidJoinStart});case He.KEY_METRIC_JOIN_END:return ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{joinEnd:i.metric})});case He.KEY_METRIC_REQUEST_AP_START:return ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{requestAPStart:i.metric})});case He.KEY_METRIC_REQUEST_AP_END:return ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{requestAPEnd:i.metric})});case He.KEY_METRIC_JOIN_GATEWAY_START:return ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{joinGatewayStart:i.metric})});case He.KEY_METRIC_JOIN_GATEWAY_END:return ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{joinGatewayEnd:i.metric})});case He.KEY_METRIC_PEER_CONNECTION_START:return ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{peerConnectionStart:i.metric})});case He.KEY_METRIC_PEER_CONNECTION_END:return ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{peerConnectionEnd:i.metric})});case He.KEY_METRIC_DESCRIPTION_START:return ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{descriptionStart:i.metric})});case He.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{signalChannelOpen:i.metric})});case He.KEY_METRIC_ICE_CONNECTION_END:return ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{iceConnectionEnd:i.metric})});case He.KEY_METRIC_PUBLISH:{const s=t.keyMetrics.publish,a=s.findIndex(c=>c.trackId===i.metric.trackId);return a!==-1?(s[a]=ye(ye({},s[a]),i.metric),ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{publish:[...s]})})):ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{publish:[...t.keyMetrics.publish,i.metric]})})}case He.KEY_METRIC_SUBSCRIBE:{const s=t.keyMetrics.subscribe,a=s.findIndex(c=>c.userId===i.metric.userId&&c.type===i.metric.type);return a!==-1?(s[a]=ye(ye({},s[a]),i.metric),ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{subscribe:[...s]})})):ye(ye({},t),{},{keyMetrics:ye(ye({},t.keyMetrics),{},{subscribe:[...t.keyMetrics.subscribe,i.metric]})})}case He.SET_CLOUD_PROXY_SERVER_MODE:return t.cloudProxyServerMode=i.mode,t;case He.RECORD_JOIN_CHANNEL_SERVICE:return typeof i.index!="number"?t.joinChannelServiceRecords=[...t.joinChannelServiceRecords,i.record]:(t.joinChannelServiceRecords[i.index]=ye(ye({},t.joinChannelServiceRecords[i.index]),i.record),t.joinChannelServiceRecords=[...t.joinChannelServiceRecords]),t;case He.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return t.joinChannelServiceRecords=[],t;case He.RESET_KEY_METRICS:return t.keyMetrics={publish:[],subscribe:[]},t;case He.SET_USE_DATACHANNEL:return ye(ye({},t),{},{useDataChannel:i.val});case He.SET_USE_P2P:return ye(ye({},t),{},{useP2P:i.val});case He.SET_TRANSPORT_TYPE:return ye(ye({},t),{},{p2pTransport:i.val});default:return t}}(this.state,e)}set sessionId(e){this.dispatch({type:He.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:He.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:He.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:He.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:He.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:He.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:He.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(e){this.dispatch({type:He.SET_USE_DATACHANNEL,val:e})}get useDataChannel(){return this.state.useDataChannel}set useP2P(e){this.dispatch({type:He.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:He.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:He.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:He.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:He.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:He.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:He.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:He.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:He.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:He.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:He.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:He.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:He.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:He.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,i,s){this.dispatch({type:He.KEY_METRIC_PUBLISH,metric:ye(ye({trackId:e,type:t},i&&{publishStart:i}),s&&{publishEnd:s})})}subscribe(e,t,i,s,a,c,l){this.dispatch({type:He.KEY_METRIC_SUBSCRIBE,metric:ye(ye(ye(ye(ye({userId:e,type:t},i&&{subscribeStart:i}),s&&{subscribeEnd:s}),a&&{firstFrame:a}),c&&{streamAdded:c}),l&&{firstDecoded:l})})}massSubscribe(e,t,i,s){e.forEach(a=>{this.dispatch({type:He.KEY_METRIC_SUBSCRIBE,metric:ye(ye(ye({userId:a.userId,type:a.type},t&&{subscribeStart:t}),i&&{subscribeEnd:i}),s&&{firstFrame:s})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){e.service==="gateway"&&Array.isArray(e.urls)&&(e.urls=e.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof t!="number"?(this.dispatch({type:He.RECORD_JOIN_CHANNEL_SERVICE,record:ye(ye({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:He.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:He.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:He.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:He.AVOID_JOIN_START,avoidJoinStart:e})}}var aa,Kb;(function(n){n.h264="h264",n.h265="h265",n.vp8="vp8",n.vp9="vp9",n.av1="av1"})(aa||(aa={})),function(n){n.opus="opus",n.pcma="pcma",n.pcmu="pcmu",n.g722="g722"}(Kb||(Kb={}));const zb=128,t6=96,Yb=1e3,Md=10;let n6=0;const Pf=new class extends At{reportLogUploadError(n){this.emit("REPORT_LOG_UPLOAD",n)}};class i6{constructor(e){S(this,"logger",void 0),S(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function YS(){const n=new Date;return n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}function qb(){const n=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+n.getUTCMilliseconds():n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}const vr={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Df=Date.now(),wu=n=>{for(const e in vr)if(Object.prototype.hasOwnProperty.call(vr,e)&&vr[e]===n)return e;return"DEFAULT"},v=new class{constructor(){S(this,"proxyServerURL",void 0),S(this,"logLevel",vr.DEBUG),S(this,"uploadState","collecting"),S(this,"uploadLogWaitingList",[]),S(this,"uploadLogUploadingList",[]),S(this,"uploadErrorCount",0),S(this,"currentLogID",0),S(this,"url",void 0),S(this,"extLog",(n,e)=>{this.appendLogToWaitingList(n,...e)})}debug(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const i=[vr.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const i=[vr.INFO].concat(e);this.log.apply(this,i)}warning(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const i=[vr.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const i=[vr.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];const i=[vr.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(n){n=Math.min(Math.max(0,n),4),this.logLevel=n}enableLogUpload(){ft("UPLOAD_LOG",!0)}disableLogUpload(){ft("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(n){this.proxyServerURL=n}prefix(n){return new i6(this).prefix(n)}log(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];if(Date.now()-Df<100)return void setTimeout(()=>{this.log(...e)},Date.now()-Df);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=YS()+" Agora-SDK [".concat(wu(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const s=YS()+" %cAgora-SDK [".concat(wu(i),"]:");let a=[];if(!L("USE_NEW_LOG"))switch(i){case vr.DEBUG:a=[s,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,a);break;case vr.INFO:a=[s,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,a);break;case vr.WARNING:a=[s,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,a);break;case vr.ERROR:a=[s,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];if(Date.now()-Df<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-Df);const i=Math.max(0,Math.min(4,e[0]));e[0]=YS()+" Agora-SDK [".concat(wu(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(n){if(!L("UPLOAD_LOG"))return;for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];Array.isArray(t[0])?t[0][0]=qb()+" Agora-SDK [".concat(wu(n),"]:"):t[0]=qb()+" Agora-SDK [".concat(wu(n),"]:");let s="";t.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),s+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:n,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const n=this.uploadLogUploadingList,e={sdk_version:Tr,process_id:L("PROCESS_ID"),payload:JSON.stringify(n)};return _s(async()=>{const t=await vi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(L("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(L("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(t.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=t,i}},()=>(this.uploadLogUploadingList=[],!1),t=>(t.response?Pf.reportLogUploadError({status:t.response.status,data:t.response.data,headers:t.response.headers,message:t.message}):t.request?Pf.reportLogUploadError({status:t.request.status,message:t.message}):Pf.reportLogUploadError({status:-1,message:t.message}),!0),{timeout:L("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:L("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,L("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),L("UPLOAD_LOG_INTERVAL"))}).catch(n=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),L("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),L("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var Jb,Xb;function r6(n){return Un(n.reportId,"params.reportId",0,100,!1),Un(n.category,"params.category",0,100,!1),Un(n.event,"params.event",0,100,!1),Un(n.label,"params.label",0,100,!1),pt(n.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(n){n.FREE="free",n.UPLOADING="uploading"})(Jb||(Jb={})),function(n){n[n.MISC=0]="MISC",n[n.INTERNAL_EVENT=1]="INTERNAL_EVENT",n[n.PUBLIC_EVENT=2]="PUBLIC_EVENT",n[n.WEB_EVENT=3]="WEB_EVENT",n[n.INTERNAL_API=4]="INTERNAL_API",n[n.WEB_API=5]="WEB_API",n[n.PUBLIC_API=6]="PUBLIC_API"}(Xb||(Xb={}));const s6={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var cn,Ct,Qb,$b;function Zb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Fe(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Zb(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Zb(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}(function(n){n.PUBLISH="publish",n.SUBSCRIBE="subscribe",n.WS_COMPRESSOR_INIT="ws_compressor_init",n.SESSION_INIT="session_init",n.JOIN_CHOOSE_SERVER="join_choose_server",n.REQ_USER_ACCOUNT="req_user_account",n.JOIN_GATEWAY="join_gateway",n.REJOIN_GATEWAY="rejoin_gateway",n.STREAM_SWITCH="stream_switch",n.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",n.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",n.FIRST_VIDEO_RECEIVED="first_video_received",n.FIRST_AUDIO_RECEIVED="first_audio_received",n.FIRST_VIDEO_DECODE="first_video_decode",n.FIRST_AUDIO_DECODE="first_audio_decode",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_UPDATE_STREAM="on_update_stream",n.ON_REMOVE_STREAM="on_remove_stream",n.USER_ANALYTICS="req_user_analytics",n.PC_STATS="pc_stats",n.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities"})(cn||(cn={})),function(n){n.SESSION="io.agora.pb.Wrtc.Session",n.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",n.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",n.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",n.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",n.PUBLISH="io.agora.pb.Wrtc.Publish",n.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",n.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",n.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",n.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",n.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",n.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",n.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",n.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",n.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",n.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",n.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",n.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",n.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",n.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",n.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",n.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",n.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",n.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",n.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",n.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",n.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",n.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",n.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",n.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",n.PC_STATS="io.agora.pb.Wrtc.PCStats",n.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities"}(Ct||(Ct={})),function(n){n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(Qb||(Qb={})),function(n){n[n.SESSION=26]="SESSION",n[n.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",n[n.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",n[n.JOIN_GATEWAY=28]="JOIN_GATEWAY",n[n.PUBLISH=30]="PUBLISH",n[n.SUBSCRIBE=29]="SUBSCRIBE",n[n.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",n[n.STREAM_SWITCH=32]="STREAM_SWITCH",n[n.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",n[n.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",n[n.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",n[n.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",n[n.API_INVOKE=41]="API_INVOKE",n[n.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",n[n.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",n[n.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",n[n.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",n[n.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",n[n.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",n[n.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",n[n.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",n[n.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",n[n.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",n[n.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",n[n.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",n[n.USER_ANALYTICS=1e4]="USER_ANALYTICS",n[n.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}($b||($b={}));class Au{constructor(){S(this,"baseInfoMap",new Map),S(this,"proxyServer",void 0),S(this,"eventUploadTimer",void 0),S(this,"setSessionIdTimer",void 0),S(this,"url",void 0),S(this,"backupUrl",void 0),S(this,"_appId",void 0),S(this,"keyEventUploadPendingItems",[]),S(this,"normalEventUploadPendingItems",[]),S(this,"apiInvokeUploadPendingItems",[]),S(this,"apiInvokeCount",0),S(this,"ltsList",[]),S(this,"lastSendNormalEventTime",Date.now()),S(this,"customReportCounterTimer",void 0),S(this,"customReportCount",0),S(this,"extApiInvoke",async e=>{for(const t of e){const i=Fe(Fe({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Pt.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),L("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),L("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void v.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),i=Date.now(),s=t.startTime;t.startTime=i,v.debug("rewrite session ".concat(e," startTime: ").concat(i," , ").concat(i-s,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,i){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const s=Date.now();this.apiInvokeCount+=1;const a=this.apiInvokeCount,c=()=>({tag:t.tag,invokeId:a,sid:e,name:t.name,apiInvokeTime:s,options:t.options,states:t.states||null}),l=!!L("SHOW_REPORT_INVOKER_LOG");l&&v.info("".concat(t.name," start"),t.options);let h=!1;Sn(t.timeout).then(()=>{h||(this.sendApiInvoke(Fe(Fe({},c()),{},{error:O.API_INVOKE_TIMEOUT,success:!1})),v.debug("".concat(t.name," timeout")))});const p=new Q(O.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:f=>{const _=()=>{if(h)throw p;return h=!0,this.sendApiInvoke(Fe(Fe({},c()),{},{success:!0},t.reportResult&&{result:f})),l&&v.info("".concat(t.name," onSuccess")),f};return i?ob(_,t.name+"Success",i,()=>h=!0):_()},onError:f=>{const _=()=>{if(h)throw f;h=!0,this.sendApiInvoke(Fe(Fe({},c()),{},{success:!1,error:f})),l&&v.info("".concat(t.name," onFailure"),f.toString())};return i?ob(_,t.name+"Error",i,()=>h=!0):_()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const i=Date.now(),s=this.createBaseInfo(e,i);s.cname=t.cname;const a=Object.assign({},{willUploadConsoleLog:L("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:KS?"global":"oversea",areas:L("AREAS")&&L("AREAS").join(",")},t.extend),{stringUid:c,channelProfile:l,channelMode:h,isABTestSuccess:p,lsid:f,clientRole:_}=t,g=Date.now(),T=Fe(Fe({},s),{},{eventType:cn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:zS,lts:g,elapse:g-i,extend:JSON.stringify(a),mode:t.mode,process:L("PROCESS_ID"),appType:L("APP_TYPE"),success:!0,version:Tr,stringUid:c,channelProfile:l,channelMode:h,isABTestSuccess:p,lsid:f,clientType:20,clientRole:_,serviceId:L("PROCESS_ID"),extensionID:L("PLUGIN_INFO").join(",")||""});this.send({type:Ct.SESSION,data:T},!0)}joinChooseServer(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),c=Fe(Fe({},s),{},{eventType:cn.JOIN_CHOOSE_SERVER,lts:a,eventElapse:a-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:a-i.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:Ct.JOIN_CHOOSE_SERVER,data:c},!0)}reqUserAccount(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),c=Fe(Fe({},s),{},{eventType:cn.REQ_USER_ACCOUNT,lts:a,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:a-i.startTime,eventElapse:a-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Ct.REQ_USER_ACCOUNT,data:c},!0)}joinGateway(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info;t.vid&&(s.vid=t.vid),s.uid=t.uid,s.cid=t.cid;const a=Date.now(),{firstSuccess:c,avoidJoinStartTime:l,isProxy:h,addr:p}=t,f=a-(c&&l?l:i.startTime),_=Fe(Fe({},s),{},{eventType:cn.JOIN_GATEWAY,lts:a,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:f,eventElapse:a-t.lts,firstSuccess:c,signalChannel:t.signalChannel}),g=_.success?1:0;if(t.succ&&(i.lastJoinSuccessTime=a),c)this.send({type:Ct.JOIN_GATEWAY,data:_},!0);else{let T;if(p)if(h){const R=p.match(/h=(\d{1,3}-){3}\d{1,3}/g),I=p.match(/p=[0-9]{1,6}/g);T={isSuccess:g,gatewayIp:R&&R.length?R[0].split("=")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split("=")[1]:"",isProxy:h?1:0}}else{const R=p.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),I=p.match(/(:|p=)[0-9]{1,6}/g);T={isSuccess:g,gatewayIp:R&&R.length?R[0].split("//")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split(/:|p=/g)[1]:"",isProxy:h?1:0}}else T={isSuccess:g,gatewayIp:"",port:"",isProxy:h?1:0};delete _.success,delete _.eventType,delete _.firstSuccess,_.vid=Number(_.vid);const w=Object.assign({},_,T,{eventType:cn.REJOIN_GATEWAY});this.send({type:Ct.RE_JOIN_GATEWAY,data:w},!0)}}joinChannelTimeout(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=Date.now(),a=Fe(Fe({},i.info),{},{lts:s,timeout:t,elapse:s-i.startTime});this.send({type:Ct.JOIN_CHANNEL_TIMEOUT,data:a},!0)}publish(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),c=Fe(Fe({},s),{},{eventType:cn.PUBLISH,lts:a,eventElapse:t.eventElapse,elapse:a-i.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Ct.PUBLISH,data:c},!0)}subscribe(e,t,i){const s=this.baseInfoMap.get(e);if(!s)return;const a=s.info,c=Date.now(),l=Fe(Fe({},a),{},{eventType:cn.SUBSCRIBE,lts:c,eventElapse:t.eventElapse,elapse:c-s.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?l.peerSuid=t.peerid:l.peer=t.peerid,this.send({type:Ct.SUBSCRIBE,data:l},!0)}wsCompressorInit(e){var t;const i=[...$i(t=this.baseInfoMap).call(t)],s=i.length?i[0]:"UnableToGetSid",a=this.baseInfoMap.get(s);if(!a)return;const c=a.info,l=Date.now(),h=Fe(Fe({},c),{},{eventType:cn.WS_COMPRESSOR_INIT,lts:l,eventElapse:e.eventElapse,elapse:l-a.startTime,status:e.status?1:2});this.send({type:Ct.WS_COMPRESSOR_INIT,data:h},!0)}firstRemoteVideoDecode(e,t,i,s){const a=this.baseInfoMap.get(e);if(!a)return;const c=a.info,l=Date.now(),h=Fe(Fe(Fe({},c),s),{},{elapse:l-a.startTime,eventType:t,lts:l,firstDecodeFrame:Math.max(l-a.startTime,0),apEnd:Math.max(s.apEnd-a.startTime,0),apStart:Math.max(s.apStart-a.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-a.startTime,0),joinGwStart:Math.max(s.joinGwStart-a.startTime,0),pcEnd:Math.max(s.pcEnd-a.startTime,0),pcStart:Math.max(s.pcStart-a.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-a.startTime,0),subscriberStart:Math.max(s.subscriberStart-a.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-a.startTime,0)});this.send({type:i,data:h},!0)}firstRemoteFrame(e,t,i,s){const a=this.baseInfoMap.get(e);if(!a)return;const c=a.info,l=Date.now(),h=Fe(Fe(Fe({},c),s),{},{elapse:l-a.startTime,eventType:t,lts:l});this.send({type:i,data:h},!0)}pcStats(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),c=Fe(Fe(Fe({},s),t),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:a-i.startTime,eventType:cn.PC_STATS,lts:a});this.send({type:Ct.PC_STATS,data:c},!0)}updateRemoteRTPCapabilities(e,t){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),c=Fe(Fe(Fe({},s),t),{},{vid:s.vid===void 0?0:Number(s.vid),eventType:cn.UPDATE_REMOTE_RTPCAPABILITIES,lts:a});this.send({type:Ct.UPDATE_REMOTE_RTPCAPABILITIES,data:c},!0)}}onGatewayStream(e,t,i,s){const a=this.baseInfoMap.get(e);if(!a)return;const c=a.info,l=Date.now(),h=Fe(Fe(Fe({},c),s),{},{eventType:t,lts:l});this.send({type:i,data:h},!0)}streamSwitch(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),c=Fe(Fe({},s),{},{eventType:cn.STREAM_SWITCH,lts:a,isDual:t.isdual,elapse:a-i.startTime,success:t.succ});this.send({type:Ct.STREAM_SWITCH,data:c},!0)}requestProxyAppCenter(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),c=Fe(Fe({},s),{},{eventType:cn.REQUEST_PROXY_APPCENTER,lts:a,eventElapse:a-t.lts,elapse:a-i.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Ct.REQUEST_PROXY_APPCENTER,data:c},!0)}requestProxyWorkerManager(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),c=Fe(Fe({},s),{},{eventType:cn.REQUEST_PROXY_WORKER_MANAGER,lts:a,eventElapse:a-t.lts,elapse:a-i.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Ct.REQUEST_PROXY_WORKER_MANAGER,data:c},!0)}setProxyServer(e){this.proxyServer=e,e?v.debug("reportProxyServerurl: ".concat(e)):v.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),c=Fe(Fe({},s),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:a,elapse:a-i.startTime,joinChannelSuccessElapse:a-(i.lastJoinSuccessTime||a),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Ct.PEER_PUBLISH_STATUS,data:c},!0)}workerEvent(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now();(function(l,h,p){const f=l[h];if(!f||typeof f!="string")return[l];l[h]="";const _=js(JSON.stringify(l));let g=0;const T=[];let w=0;for(let R=0;R<f.length;R++)w+=f.charCodeAt(R)<=127?1:3,w<=p-_||(T[T.length]=Sc(Sc({},l),{},{[h]:f.substring(g,R)}),g=R,w=f.charCodeAt(R)<=127?1:3);return g!==f.length-1&&(T[T.length]=Sc(Sc({},l),{},{[h]:f.substring(g)})),T})(Fe(Fe(Fe({},s),t),{},{elapse:a-i.startTime,lts:a,productType:"WebRTC"}),"payload",1300).forEach(l=>this.send({type:Ct.WORKER_EVENT,data:l},!0))}apworkerEvent(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),c=Fe(Fe(Fe({},s),t),{},{elapse:a-i.startTime,lts:a});this.send({type:Ct.AP_WORKER_EVENT,data:c},!0)}joinWebProxyAP(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),c=Fe(Fe(Fe({},s),t),{},{elapse:a-i.startTime,lts:a,extend:t.extend||void 0});this.send({type:Ct.JOIN_WEB_PROXY_AP,data:c},!0)}WebSocketQuit(e,t){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),c=Fe(Fe(Fe({},s),t),{},{elapse:a-i.startTime,lts:a});this.send({type:Ct.WEBSOCKET_QUIT,data:c},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>L("CUSTOM_REPORT_LIMIT"))throw new Q(O.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),s=t.map(a=>({type:Ct.USER_ANALYTICS,data:Fe(Fe({sid:e},a),{},{lts:i})}));try{L("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(a){throw v.error("send custom report message failed",a.toString()),new Q(O.CUSTOM_REPORT_SEND_FAILED,a.message)}}sendApiInvoke(e){const t=L("NOT_REPORT_EVENT");if(e.tag&&fe(t)&&fe(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:s,uid:a,cid:c}=i.info;let l;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Q){const{code:p,message:f}=e.error;l=p||f||e.error.toString()}else l=e.error.toString();const h={invokeId:e.invokeId,sid:e.sid,cname:s,cid:c,uid:a,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?l:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Ct.API_INVOKE,data:h},!1),!0}appendSessionId(){Au.__CLIENT_LIST__.forEach(e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let i=0;i<t;i++){const s=this.apiInvokeUploadPendingItems.shift();s&&(s.sid=e._sessionId,this.sendApiInvoke(Object.assign({},s)))}}})}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>L("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const i=[],s=[];for(;e.length;){const c=e.shift();i.length<20?i.push(c):s.push(c)}e.push(...s);for(const c of[...i]){var a;this.ltsList.indexOf(c.data.lts)!==-1?(c.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(c.data.lts)):(this.ltsList.push(c.data.lts),du(a=this.ltsList).call(a,(l,h)=>l-h))}return t||(this.lastSendNormalEventTime=Date.now()),L("ENABLE_EVENT_REPORT")&&i.length&&(L("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((c=>l=>{L("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(c):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(c),this.normalEventUploadPendingItems.length>L("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-L("NORMAL_EVENT_QUEUE_CAPACITY")),v.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){Qt.networkState===ii.OFFLINE&&await W.race([Qt.onlineWaiter,Sn(2*$t.maxRetryTimeout)]);const t=a=>{let c=new Uint8Array;return a.forEach(l=>{const h=TS(JSON.stringify(l.data)),p=new ArrayBuffer(5),f=(g=>{let T=0;return Object.entries(Ct).forEach(w=>{let[R,I]=w;I===g.type&&(T=EventNameToID[R])}),T})(l),_=new DataView(p);_.setUint16(0,h.byteLength,!0),_.setUint8(2,255&f),_.setUint8(3,f>>>8&255),_.setUint8(4,f>>>16&255),c=JO(c,new Uint8Array(p)),c=JO(c,h)}),c},i="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(L("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let a=0;a<2;a+=1){a===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(L("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await HS(s,{timeout:1e4,data:t(e),headers:Fe(Fe({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(c){if(a===1)throw c;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(c=>JSON.stringify(c)),vid:(c=>{const l=c&&c.data.sid&&this.baseInfoMap.get(c.data.sid);return l&&l.info.vid&&+l.info.vid||0})(e[0])};Qt.networkState===ii.OFFLINE&&await W.race([Qt.onlineWaiter,Sn(2*$t.maxRetryTimeout)]);const s=t?"/events/proto-raws":"/events/messages";let a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("EVENT_REPORT_DOMAIN"),"&p=").concat(L("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(L("EVENT_REPORT_DOMAIN"),":").concat(L("STATS_COLLECTOR_PORT")).concat(s));for(let c=0;c<2;c+=1){c===1&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(L("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(L("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(L("STATS_COLLECTOR_PORT")).concat(s)));try{t?await $H(a,{timeout:1e4,data:i}):await HS(a,{timeout:1e4,data:i})}catch(l){if(c===1)throw l;continue}return}}createBaseInfo(e,t){const i=Object.assign({},s6);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:t}),i}reportResourceTiming(e,t){const i=performance.getEntriesByName(e),s=i[i.length-1];s&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:s,tag:Pt.TRACER}).onSuccess()}}function Ae(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,t,i){const s=i.value;if(typeof s=="function"){const a=n.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];let p=l;if(n.argsMap)try{p=n.argsMap(this,...l)}catch(_){v.warning(_),p=[]}try{JSON.stringify(p)}catch{v.warning("arguments for method ".concat(a,".").concat(String(t)," not serializable for apiInvoke.")),p=[]}const f=(n.report||Te).reportApiInvoke(this._sessionId||null,{name:"".concat(a,".").concat(String(t)),options:p,tag:Pt.TRACER,reportResult:n.reportResult},n.throttleTime);try{const _=s.apply(this,l);return _ instanceof W?_.then(g=>(f.onSuccess(n.reportResult&&g),g)).catch(g=>{throw f.onError(g),g}):(f.onSuccess(n.reportResult&&_),_)}catch(_){throw f.onError(_),_}}}return i}}S(Au,"__CLIENT_LIST__",[]);const Te=new Au;Pf.on("REPORT_LOG_UPLOAD",n=>{n.networkState=Qt.networkState,Te.reportApiInvoke(null,{name:"logUploadError",options:n,tag:Pt.TRACER})});const o6=["CHINA","GLOBAL"],di=function(){const n="us".concat("erna","me"),e="pa".concat("sswo","rd"),t=["t","s","t"];t.splice(1,0,"e");const i=t.join(""),s=[];for(let l=0;l<6;l++)s.push("1");const a=s.join(""),c={};return c[n]=i,c[e]=a,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=di,KS||(ri.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],ri.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],ri.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],ri.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ri.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],ri.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],ri.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",ri.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",ri.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",ri.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",ri.AREAS=["NORTH_AMERICA","OVERSEA"]);const eN=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],ca=[];function vc(n,e){return!!e&&ca.some(t=>t.uid===n&&t.channelName===e)}Au.__CLIENT_LIST__=ca;var qS,yi,Ud,Ou,Zi,Yn,Ie,We,pe,ve,Ro,De,tN,qn,Ne,dn,da,a6=Xo("Array").values,c6=Qo,d6=ai,l6=X,u6=a6,JS=Array.prototype,h6={DOMTokenList:!0,NodeList:!0},Es=m(function(n){var e=n.values;return n===JS||l6(JS,n)&&e===JS.values||d6(h6,c6(n))?u6:e});function $(n,e,t,i){var s,a=arguments.length,c=a<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(s=n[l])&&(c=(a<3?s(c):a>3?s(e,t,c):s(e,t))||c);return a>3&&c&&Object.defineProperty(e,t,c),c}function A(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}(function(n){n.L1T1="L1T1",n.L1T2="L1T2",n.L1T3="L1T3",n.L2T1_KEY="L2T1_KEY",n.L2T2_KEY="L2T2_KEY",n.L2T3_KEY="L2T3_KEY",n.L3T1_KEY="L3T1_KEY",n.L3T2_KEY="L3T2_KEY",n.L3T3_KEY="L3T3_KEY"})(qS||(qS={})),function(n){n.CERTIFICATE="certificate",n.CODEC="codec",n.CANDIDATE_PAIR="candidate-pair",n.LOCAL_CANDIDATE="local-candidate",n.REMOTE_CANDIDATE="remote-candidate",n.INBOUND="inbound-rtp",n.TRACK="track",n.OUTBOUND="outbound-rtp",n.PC="peer-connection",n.REMOTE_INBOUND="remote-inbound-rtp",n.REMOTE_OUTBOUND="remote-outbound-rtp",n.TRANSPORT="transport",n.CSRC="csrc",n.DATA_CHANNEL="data-channel",n.STREAM="stream",n.SENDER="sender",n.RECEIVER="receiver"}(yi||(yi={})),function(n){n[n.ACCESS_POINT=101]="ACCESS_POINT",n[n.UNILBS=201]="UNILBS",n[n.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Ud||(Ud={})),function(n){n[n.IIIEGAL_APPID=1]="IIIEGAL_APPID",n[n.IIIEGAL_UID=2]="IIIEGAL_UID",n[n.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Ou||(Ou={})),function(n){n[n.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",n[n.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",n[n.INTERNAL_ERROR=8]="INTERNAL_ERROR",n[n.NO_AUTHORIZED=9]="NO_AUTHORIZED",n[n.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",n[n.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",n[n.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",n[n.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",n[n.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",n[n.USER_OVERLOAD=16]="USER_OVERLOAD",n[n.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",n[n.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Zi||(Zi={})),function(n){n[n.NO_FLAG_SET=100]="NO_FLAG_SET",n[n.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",n[n.INVALID_FALG_SET=102]="INVALID_FALG_SET",n[n.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",n[n.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",n[n.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",n[n.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",n[n.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",n[n.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",n[n.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",n[n.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",n[n.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",n[n.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",n[n.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",n[n.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",n[n.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",n[n.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",n[n.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",n[n.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Yn||(Yn={})),function(n){n[n.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",n[n.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",n[n.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",n[n.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",n[n.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",n[n.K_TICKET_INVALID=7]="K_TICKET_INVALID",n[n.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",n[n.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",n[n.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",n[n.K_UID_BANNED=14]="K_UID_BANNED",n[n.K_IP_BANNED=15]="K_IP_BANNED",n[n.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",n[n.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",n[n.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",n[n.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",n[n.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",n[n.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",n[n.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",n[n.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",n[n.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",n[n.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",n[n.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",n[n.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",n[n.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",n[n.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",n[n.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",n[n.ERR_INVALID_UID=117]="ERR_INVALID_UID",n[n.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",n[n.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",n[n.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",n[n.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",n[n.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",n[n.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",n[n.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",n[n.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",n[n.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",n[n.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",n[n.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",n[n.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",n[n.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",n[n.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",n[n.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",n[n.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",n[n.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",n[n.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",n[n.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",n[n.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",n[n.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",n[n.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",n[n.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",n[n.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",n[n.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",n[n.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",n[n.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",n[n.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",n[n.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",n[n.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",n[n.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",n[n.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",n[n.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",n[n.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",n[n.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",n[n.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",n[n.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Ie||(Ie={})),function(n){n.CONNECTING="connecting",n.CONNECTED="connected",n.RECONNECTING="reconnecting",n.CLOSED="closed"}(We||(We={})),function(n){n.WS_CONNECTED="ws_connected",n.WS_RECONNECTING="ws_reconnecting",n.WS_CLOSED="ws_closed",n.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",n.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",n.ON_BINARY_DATA="on_binary_data",n.REQUEST_RECOVER="request_recover",n.REQUEST_JOIN_INFO="request_join_info",n.REQUEST_REJOIN_INFO="req_rejoin_info",n.IS_P2P_DISCONNECTED="is_p2p_dis",n.DISCONNECT_P2P="dis_p2p",n.ABORT_P2P_EXECUTION="abort_p2p_execution",n.NEED_RENEW_SESSION="need-sid",n.REPORT_JOIN_GATEWAY="report_join_gateway",n.REQUEST_TIMEOUT="request_timeout",n.REQUEST_SUCCESS="request_success",n.JOIN_RESPONSE="join_response",n.DATACHANNEL_PRECONNECT="datachannel_preconnect",n.DATACHANNEL_CONNECTING="datachannel_connecting",n.DATACHANNEL_FAILBACK="datachannel_failback",n.P2P_CONNECTION="p2p_connection",n.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",n.P2P_SUBSCRIBE="p2p_subscribe",n.P2P_UNSUBSCRIBE="p2p_unsubscribe",n.P2P_EXCHANGE_SDP="p2p_exchange_sdp",n.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",n.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(pe||(pe={})),function(n){n.PING="ping",n.PING_BACK="ping_back",n.JOIN="join_v3",n.REJOIN="rejoin_v3",n.LEAVE="leave",n.SET_CLIENT_ROLE="set_client_role",n.PUBLISH="publish",n.PUBLISH_DATASTREAM="publish_datastream",n.UNPUBLISH="unpublish",n.UNPUBLISH_DATASTREAM="unpublish_datastream",n.SUBSCRIBE="subscribe",n.PRE_SUBSCRIBE="pre_subscribe",n.SUBSCRIBE_DATASTREAM="subscribe_datastream",n.SUBSCRIBE_STREAMS="subscribe_streams",n.UNSUBSCRIBE="unsubscribe",n.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",n.UNSUBSCRIBE_STREAMS="unsubscribe_streams",n.SUBSCRIBE_CHANGE="subscribe_change",n.TRAFFIC_STATS="traffic_stats",n.RENEW_TOKEN="renew_token",n.SWITCH_VIDEO_STREAM="switch_video_stream",n.DEFAULT_VIDEO_STREAM="default_video_stream",n.SET_FALLBACK_OPTION="set_fallback_option",n.GATEWAY_INFO="gateway_info",n.CONTROL="control",n.SEND_METADATA="send_metadata",n.DATA_STREAM="data_stream",n.PICK_SVC_LAYER="pick_svc_layer",n.RESTART_ICE="restart_ice",n.CONNECT_PC="connect_pc",n.SET_VIDEO_PROFILE="set_video_profile",n.SET_PARAMETER="set_parameter",n.SET_RTM2_FLAG="set_rtm2_flag"}(ve||(ve={})),function(n){n.WRTC_STATS="wrtc_stats",n.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",n.DENOISER_STATS="denoiser_stats",n.EXTENSION_USAGE_STATS="extension_usage_stats"}(Ro||(Ro={})),function(n){n.ON_USER_ONLINE="on_user_online",n.ON_USER_OFFLINE="on_user_offline",n.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",n.ON_PUBLISH_STREAM="on_publish_stream",n.ON_UPLINK_STATS="on_uplink_stats",n.ON_P2P_LOST="on_p2p_lost",n.ON_REMOVE_STREAM="on_remove_stream",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",n.ON_USER_BANNED="on_user_banned",n.ON_USER_LICENSE_BANNED="on_user_license_banned",n.ON_NOTIFICATION="on_notification",n.ON_CRYPT_ERROR="on_crypt_error",n.MUTE_AUDIO="mute_audio",n.MUTE_VIDEO="mute_video",n.UNMUTE_AUDIO="unmute_audio",n.UNMUTE_VIDEO="unmute_video",n.ON_P2P_OK="on_p2p_ok",n.RECEIVE_METADATA="receive_metadata",n.ON_DATA_STREAM="on_data_stream",n.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",n.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",n.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",n.ENABLE_LOCAL_VIDEO="enable_local_video",n.DISABLE_LOCAL_VIDEO="disable_local_video",n.ENABLE_LOCAL_AUDIO="enable_local_audio",n.DISABLE_LOCAL_AUDIO="disable_local_audio",n.ON_PUBLISHED_USER_LIST="on_published_user_list"}(De||(De={})),function(n){n.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",n.NEED_ANSWER="NEED_ANSWER",n.NEED_RENEGOTIATE="NEED_RENEGOTIATE",n.P2P_LOST="P2P_LOST",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NEED_UNPUB="NEED_UNPUB",n.NEED_UNSUB="NEED_UNSUB",n.NEED_UPLOAD="NEED_UPLOAD",n.NEED_CONTROL="NEED_CONTROL",n.START_RECONNECT="START_RECONNECT",n.END_RECONNECT="END_RECONNECT",n.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(tN||(tN={})),function(n){n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY"}(qn||(qn={})),function(n){n.CONNECTED="websocket:connected",n.RECONNECTING="websocket:reconnecting",n.WILL_RECONNECT="websocket:will_reconnect",n.CLOSED="websocket:closed",n.FAILED="websocket:failed",n.ON_MESSAGE="websocket:on_message",n.REQUEST_NEW_URLS="websocket:request_new_urls",n.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",n.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(Ne||(Ne={}));class B extends Q{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),S(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,v)}throw(){super.throw(v)}}function XS(n){if(typeof n!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(n))throw v.error("Invalid Channel Name ".concat(n)),new B(O.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function QS(n){if(e=n,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||KO(n,1,255)))throw new B(O.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof n=="string"&&v.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(n){n.TRANSCODE="mix_streaming",n.RAW="raw_streaming",n.INJECT="inject_streaming"})(dn||(dn={})),function(n){n[n.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",n[n.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",n[n.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",n[n.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",n[n.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",n[n.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",n[n.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",n[n.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",n[n.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",n[n.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",n[n.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(da||(da={}));const p6={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},$S={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function ZS(n,e){Un(n.url,"".concat(e,".url"),1,1e3,!1),Lt(n.x)||pt(n.x,"".concat(e,".x"),0,1e4),Lt(n.y)||pt(n.y,"".concat(e,".y"),0,1e4),Lt(n.width)||pt(n.width,"".concat(e,".width"),0,1e4),Lt(n.height)||pt(n.height,"".concat(e,".height"),0,1e4),Lt(n.zOrder)||pt(n.zOrder,"".concat(e,".zOrder"),0,255),Lt(n.alpha)||pt(n.alpha,"".concat(e,".alpha"),0,1,!1)}const f6={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},m6={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var Gr,xd,zt,nN,Jn,gs,li,la,it,Ut,yc,en,kf,Qe;function iN(n){if(!n.channelName)throw new B(O.INVALID_PARAMS,"invalid channelName in info");if(typeof n.uid!="number")throw new B(O.INVALID_PARAMS,"invalid uid in info, uid must be a number");return n.token&&Un(n.token,"info.token",1,2047),QS(n.uid),XS(n.channelName),!0}(function(n){n.WARNING="@live_uap-warning",n.ERROR="@line_uap-error",n.PUBLISH_STREAM_STATUS="@live_uap-publish-status",n.INJECT_STREAM_STATUS="@live_uap-inject-status",n.WORKER_STATUS="@live_uap-worker-status",n.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(Gr||(Gr={})),function(n){n.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(xd||(xd={})),function(n){n[n.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",n[n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",n[n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",n[n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",n[n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",n[n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",n[n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",n[n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",n[n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",n[n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",n[n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",n[n.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",n[n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",n[n.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",n[n.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",n[n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(zt||(zt={})),function(n){n.CONNECT_FAILED="connect failed",n.CONNECT_TIMEOUT="connect timeout",n.WS_DISCONNECTED="websocket disconnected",n.REQUEST_TIMEOUT="request timeout",n.REQUEST_FAILED="request failed",n.WAIT_STATUS_TIMEOUT="wait status timeout",n.WAIT_STATUS_ERROR="wait status error",n.BAD_STATE="bad state",n.WS_ABORT="ws abort",n.AP_REQUEST_TIMEOUT="AP request timeout",n.AP_JSON_PARSE_ERROR="AP json parse error",n.AP_REQUEST_ERROR="AP request error",n.AP_REQUEST_ABORT="AP request abort"}(nN||(nN={})),function(n){n[n.SetSdkProfile=0]="SetSdkProfile",n[n.SetSourceChannel=1]="SetSourceChannel",n[n.SetSourceUserId=2]="SetSourceUserId",n[n.SetDestChannel=3]="SetDestChannel",n[n.StartPacketTransfer=4]="StartPacketTransfer",n[n.StopPacketTransfer=5]="StopPacketTransfer",n[n.UpdateDestChannel=6]="UpdateDestChannel",n[n.Reconnect=7]="Reconnect",n[n.SetVideoProfile=8]="SetVideoProfile"}(Jn||(Jn={})),function(n){n.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",n.NETWORK_CONNECTED="NETWORK_CONNECTED",n.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",n.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",n.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",n.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",n.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",n.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",n.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",n.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(gs||(gs={})),function(n){n.RELAY_STATE_IDLE="RELAY_STATE_IDLE",n.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",n.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",n.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(li||(li={})),function(n){n.RELAY_OK="RELAY_OK",n.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",n.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",n.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(la||(la={})),function(n){n.High="high",n.Low="low",n.Audio="audio",n.Screen="screen",n.ScreenLow="screen_low"}(it||(it={})),function(n){n.DISCONNECT="disconnect",n.CONNECTION_STATE_CHANGE="connection-state-change",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGE="stream-type-change",n.IS_P2P_DISCONNECTED="is-p2p-dis",n.DISCONNECT_P2P="dis-p2p",n.REQUEST_NEW_GATEWAY_LIST="req-gate-url",n.NEED_RENEW_SESSION="need-sid",n.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",n.JOIN_RESPONSE="join-response",n.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",n.RESET_CONNECTION_EVENTS="reset-connection-events",n.DATACHANNEL_PRECONNECT="datachannel_preconnect",n.DATACHANNEL_FAILBACK="datachannel_failback",n.RESET_SIGNAL="reset-signal"}(Ut||(Ut={})),function(n){n.P2P_DISCONNECTED="P2P_DISCONNECTED",n.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",n.TIMEOUT="TIMEOUT",n.UNKNOWN_REASON="UNKNOWN_REASON"}(yc||(yc={})),function(n){n[n.Nothing=0]="Nothing",n[n.Audio=1]="Audio",n[n.LwoVideo=2]="LwoVideo",n[n.Video=4]="Video",n[n.Data=8]="Data",n[n.DataStream0=256]="DataStream0",n[n.DataStream1=512]="DataStream1",n[n.DataStream2=1024]="DataStream2",n[n.DataStream3=2048]="DataStream3",n[n.DataStream4=4096]="DataStream4",n[n.DataStream5=8192]="DataStream5",n[n.DataStream6=16384]="DataStream6",n[n.DataStream7=32768]="DataStream7"}(en||(en={})),function(n){n[n.websocket=0]="websocket",n[n.datachannel=1]="datachannel"}(kf||(kf={})),function(n){n.CHINA="CHINA",n.ASIA="ASIA",n.NORTH_AMERICA="NORTH_AMERICA",n.EUROPE="EUROPE",n.JAPAN="JAPAN",n.INDIA="INDIA",n.KOREA="KOREA",n.HKMC="HKMC",n.US="US",n.OCEANIA="OCEANIA",n.SOUTH_AMERICA="SOUTH_AMERICA",n.AFRICA="AFRICA",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="EXTENSIONS"}(Qe||(Qe={}));const rN=[Qe.AFRICA,Qe.ASIA,Qe.CHINA,Qe.EUROPE,Qe.GLOBAL,Qe.INDIA,Qe.JAPAN,Qe.NORTH_AMERICA,Qe.OCEANIA,Qe.OVERSEA,Qe.SOUTH_AMERICA];var An;(function(n){n.CHINA="CN",n.ASIA="AS",n.NORTH_AMERICA="NA",n.EUROPE="EU",n.JAPAN="JP",n.INDIA="IN",n.KOREA="KR",n.HKMC="HK",n.US="US",n.OCEANIA="OC",n.SOUTH_AMERICA="SA",n.AFRICA="AF",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="GLOBAL"})(An||(An={}));const Lf={CHINA:{},ASIA:{CODE:An.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:An.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:An.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:An.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:An.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:An.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:An.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:An.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:An.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:An.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:An.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:An.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:An.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var bu,sN,Ee,xn,Ss,te,st,Oe,oN,er,tr,ln,Hs,jt,Wr,aN,xi,yr,ua,xt,ha,Ks,cN,eT;KS&&(Lf.CHINA={CODE:An.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(n){n.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(bu||(bu={}));class dN extends At{constructor(e,t){super(),S(this,"onICEConnectionStateChange",void 0),S(this,"onConnectionStateChange",void 0),S(this,"onDTLSTransportStateChange",void 0),S(this,"onDTLSTransportError",void 0),S(this,"onICETransportStateChange",void 0),S(this,"onFirstAudioReceived",void 0),S(this,"onFirstVideoReceived",void 0),S(this,"onFirstAudioDecoded",void 0),S(this,"onFirstVideoDecoded",void 0),S(this,"onFirstVideoDecodedTimeout",void 0),S(this,"onSelectedLocalCandidateChanged",void 0),S(this,"onSelectedRemoteCandidateChanged",void 0)}}class Mf extends dN{constructor(e,t){super(e,t)}}(function(n){n.SEND="sendonly",n.RECV="recvonly",n.SENDRECV="sendrecv",n.INACTIVE="inactive"})(sN||(sN={})),function(n){n.VIDEO="video",n.AUDIO="audio"}(Ee||(Ee={})),function(n){n[n.UDP=0]="UDP",n[n.TCP=1]="TCP",n[n.RELAY=2]="RELAY"}(xn||(xn={})),function(n){n[n.FIRST_CONNECTION=0]="FIRST_CONNECTION",n[n.TCP_RESTART=1]="TCP_RESTART",n[n.RELAY_RESTART=2]="RELAY_RESTART",n[n.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",n[n.OLD_RESTART=11]="OLD_RESTART",n[n.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Ss||(Ss={})),function(n){n.LocalVideoTrack="videoTrack",n.LocalAudioTrack="audioTrack",n.LocalVideoLowTrack="videoLowTrack"}(te||(te={})),function(n){n.New="new",n.Connected="connected",n.Reconnecting="reconnecting",n.Disconnected="disconnected"}(st||(st={})),function(n){n.StateChange="stateChange",n.IceConnectionStateChange="iceConnectionStateChange",n.RequestMuteLocal="requestMuteLocal",n.RequestUnmuteLocal="requestUnmuteLocal",n.RequestRePublish="requestRePublish",n.RequestRePublishDataChannel="requestRePublishDataChannel",n.RequestReSubscribe="requestReSubscribe",n.RequestUploadStats="requestUploadStats",n.RequestUpload="requestUpload",n.MediaReconnectStart="MediaReconnectStart",n.MediaReconnectEnd="MediaReconnectEnd",n.NeedSignalRTT="NeedSignalRTT",n.RequestRestartICE="RequestRestartIce",n.PeerConnectionStateChange="PeerConnectionStateChange",n.RequestReconnect="RequestReconnect",n.RequestReconnectPC="RequestReconnectPC",n.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",n.P2PLost="P2PLost",n.UpdateVideoEncoder="UpdateVideoEncoder",n.ConnectionTypeChange="ConnectionTypeChange",n.RequestLowStreamParameter="RequestLowStreamParameter",n.QueryClientConnectionState="QueryClientConnectionState",n.LocalCandidate="LocalCandidate",n.RequestP2PMuteLocal="requestP2PMuteLocal",n.RequestP2PUnPublish="RequestP2PUnPublish",n.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",n.RequestP2PMuteRemote="RequestP2PMuteRemote",n.RequestP2PRestartICE="RequestP2PRestartICE"}(Oe||(Oe={})),function(n){n.MUTE_LOCAL_VIDEO="mute_local_video",n.MUTE_LOCAL_AUDIO="mute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.MUTE_REMOTE_VIDEO="mute_remote_video",n.MUTE_REMOTE_AUDIO="mute_remote_audio",n.UNMUTE_REMOTE_VIDEO="unmute_remote_video",n.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(oN||(oN={})),function(n){n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED"}(er||(er={})),function(n){n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED"}(tr||(tr={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(ln||(ln={})),function(n){n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK"}(Hs||(Hs={})),function(n){n.CONNECTED="transmitter:connected",n.RECONNECTING="transmitter:reconnecting",n.WILL_RECONNECT="transmitter:will_reconnect",n.CLOSED="transmitter:closed",n.FAILED="transmitter:failed",n.ON_MESSAGE="transmitter:on_message",n.REQUEST_NEW_URLS="transmitter:request_new_urls",n.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",n.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",n.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",n.FAILBACK="transmitter:failback"}(jt||(jt={})),function(n){n.CAMERA_CHANGED="camera-changed",n.MICROPHONE_CHANGED="microphone-changed",n.PLAYBACK_DEVICE_CHANGED="playback-device-changed",n.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",n.AUTOPLAY_FAILED="autoplay-failed",n.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",n.SECURITY_POLICY_VIOLATION="security-policy-violation"}(Wr||(Wr={})),function(n){n[n.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",n[n.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",n[n.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",n[n.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",n[n.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",n[n.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",n[n.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",n[n.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",n[n.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",n[n.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",n[n.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",n[n.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",n[n.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",n[n.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",n[n.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",n[n.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",n[n.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",n[n.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",n[n.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",n[n.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(aN||(aN={})),function(n){n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED"}(xi||(xi={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(yr||(yr={})),function(n){n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED"}(ua||(ua={})),function(n){n.CALL="call",n.CANDIDATE="candidate",n.PUBLISH="publish",n.UNPUBLISH="unpublish",n.CONTROL="control",n.RESTART_ICE="restart_ice",n.ACK="ack",n.RESPONSE="response",n.JOIN="join",n.CHECK="check"}(xt||(xt={})),function(n){n.ABORT="abort"}(ha||(ha={})),function(n){n.MUTE_LOCAL_AUDIO="mute_local_audio",n.MUTE_LOCAL_VIDEO="mute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(Ks||(Ks={})),function(n){n[n.SUCCESS=1]="SUCCESS",n[n.FAILED=0]="FAILED"}(cN||(cN={})),function(n){n.P2P_TOKEN_TIMEOUT="p2p_token_timeout",n.P2P_TOKEN_CHANGED="p2p_token_changed"}(eT||(eT={}));const _6={[Ud.ACCESS_POINT]:{[Yn.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Yn.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Yn.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Yn.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Yn.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Yn.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Yn.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Yn.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Yn.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Yn.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Yn.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Yn.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Yn.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Yn.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Yn.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Yn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Yn.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Yn.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Ud.UNILBS]:{[Zi.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Zi.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Zi.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Zi.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Zi.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Zi.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Zi.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Zi.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Zi.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Zi.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Zi.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Zi.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Ud.STRING_UID_ALLOCATOR]:{[Ou.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Ou.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Ou.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Uf(n){const e=_6[Math.floor(n/1e4)];if(!e)return{desc:"unkonw error",retry:!1};const t=e[n%1e4];if(!t){if(Math.floor(n/1e4)===Ud.ACCESS_POINT){const i=n%1e4;if(i.toString()[0]==="1")return{desc:n.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:n.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return t}const E6={[Ie.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ie.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ie.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ie.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ie.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ie.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ie.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ie.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ie.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ie.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ie.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ie.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ie.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ie.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ie.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ie.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ie.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ie.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ie.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ie.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ie.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ie.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ie.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ie.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ie.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ie.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ie.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ie.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ie.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ie.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ie.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ie.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ie.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ie.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ie.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ie.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ie.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ie.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ie.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ie.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ie.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ie.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ie.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ie.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ie.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ie.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ie.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ie.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ie.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ie.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ie.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ie.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ie.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ie.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ie.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Rc(n){return E6[n]||{desc:"UNKNOW_ERROR_".concat(n),action:"failed"}}function lN(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function tT(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?lN(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):lN(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function uN(n){return n.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)}function hN(n,e){if(typeof n=="string")return n;const{proxy:t,host:i,port:s}=n;if(e){const a=L("JOIN_GATEWAY_FALLBACK_PORT")||443;return a===443?"wss://".concat(i,"/ws/?p=").concat(Number(s)+150):"wss://".concat(i,":").concat(a,"/ws/?p=").concat(Number(s)+150)}return t?"wss://".concat(t,"/ws/?h=").concat(i,"&p=").concat(s):"wss://".concat(i,":").concat(s)}const g6=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,S6=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,T6=/wss:\/\/(.+):([0-9]+)\/?/,v6=/wss:\/\/(.[^\/]+)\/?/;let y6=0;class R6{constructor(e,t){S(this,"id",0),S(this,"store",void 0),S(this,"recordIndex",void 0),S(this,"websockets",[]),S(this,"try443PortDuration",2e3),S(this,"forceCloseWSDuration",5e3),S(this,"try443PortTimeout",null),S(this,"forceCloseTimeout",null),S(this,"isTry443PortFailed",!1),S(this,"isNormalPortFailed",!1),S(this,"useDoubleDomain",!1),S(this,"useProxy",!1),S(this,"startTime",Date.now()),this.id=++y6,this.try443PortDuration=L("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;const t=Date.now()-this.startTime;for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];v.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...s)}createWebSocket(e,t,i){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:i});const s=L("GATEWAY_DOMAINS"),a=Date.now(),c=[],l=s.find(f=>{var _;return fe(_=e.host).call(_,f)});l||(this.useDoubleDomain=!1);const h=[];if(this.useDoubleDomain)s.forEach(f=>{h.push(hN(tT(tT({},e),{},{host:e.host.replace(l,f)}),t))});else{const f=tT({},e);if(t&&l){const _=s.find(g=>g!==l);_&&(f.host=f.host.replace(l,_))}h.push(hN(f,t))}try{h.forEach(f=>{const _=new WebSocket(f);_.binaryType="arraybuffer",c.push(_),this.logger("ws is connecting:",_.url)})}catch(f){if(this.logger("ws create failed"),c.forEach(_=>_.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,i);if(!t&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new B(O.WS_ERR,"init websocket failed! Error: ".concat(f.toString()))}const p=gu();return this.store&&this.store.recordJoinChannelService({urls:c.map(f=>f.url),service:"gateway"},this.recordIndex),c.forEach(f=>{f.onopen=()=>{this.logger("onopen: ws ".concat(f.url," open cost ").concat(Date.now()-a,"ms")),this.websockets.forEach(_=>{_!==f&&(_.onopen=null,_.onclose=null,_.onmessage=null,_.close(),this.logger("close backup websocket: ".concat(_.url)))}),this.websockets.length=0,p.resolve(f)},f.onclose=_=>{this.logger("onclose: ws ".concat(f.url," closed cost ").concat(Date.now()-a,"ms state: ").concat(f.readyState)),t?this.isTry443PortFailed=uN(c):this.isNormalPortFailed=uN(c),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(t&&this.isTry443PortFailed||!t&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(_.reason)),p.reject({code:_.code,reason:yc.A_ROUND_WS_FAILED}))},f.onmessage=_=>this.logger("".concat(f.url," onmessage: ").concat(_.data))}),this.websockets.push(...c),i||(()=>{const f=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",p.isResolved),this.websockets.forEach(_=>_.readyState!==WebSocket.OPEN&&_.close())};if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(f,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",p.isResolved),p.isResolved)return f();Ze().os===on.MAC_OS&&mt()&&f(),this.createWebSocket(e,!0,!0).then(_=>p.resolve(_)).catch(_=>{this.isNormalPortFailed&&p.reject(_),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(f,this.forceCloseWSDuration)},this.try443PortDuration)})(),p.promise}chooseBestWebsocket(e,t,i,s){return this.useDoubleDomain=!!t,typeof e=="string"&&(e=function(a){let c,l,h;return[,c,l,h]=a.match(g6)||[],c||([,l,h]=a.match(S6)||[]),l&&h||([,l,h]=a.match(T6)||[]),l&&h||([,l]=a.match(v6)||[]),l||v.warning("un-destructible url: ",a),{proxy:c,host:l,port:h||"443"}}(e)),this.recordIndex=s,this.useProxy=!!e.proxy,i&&this.useProxy&&(v.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function pN(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}class fN extends At{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;fe(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(Ne.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ne.CONNECTED):this._state==="closed"?this.emit(Ne.CLOSED):this._state==="failed"&&this.emit(Ne.FAILED))}resetReconnectCount(e){v.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),S(this,"connectionID",0),S(this,"currentURLIndex",0),S(this,"urls",[]),S(this,"_reconnectMode","tryNext"),S(this,"reconnectReason",void 0),S(this,"_initMutex",new Tn("websocket")),S(this,"name",void 0),S(this,"_state","closed"),S(this,"reconnectInterrupter",void 0),S(this,"websocket",void 0),S(this,"retryConfig",void 0),S(this,"reconnectCount",0),S(this,"forceCloseTimeout",5e3),S(this,"onlineReconnectListener",void 0),S(this,"useCompress",void 0),S(this,"tryDoubleDomain",!1),S(this,"use443PortOnly",!1),S(this,"wsInflateLength",0),S(this,"wsDeflateLength",0),S(this,"closeEstablishingWs",()=>{}),S(this,"store",void 0),S(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=e,this.retryConfig=function(_){for(var g=1;g<arguments.length;g++){var T=arguments[g]!=null?arguments[g]:{};g%2?pN(Object(T),!0).forEach(function(w){S(_,w,T[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(T)):pN(Object(T)).forEach(function(w){Object.defineProperty(_,w,Object.getOwnPropertyDescriptor(T,w))})}return _}({},t),this.useCompress=i,this.tryDoubleDomain=s,this.use443PortOnly=a;const{timeout:l,timeoutFactor:h}=t,p=Math.max(300,Math.floor(3*l/5)),f=Math.max(1.2,Math.floor(8*h)/10);ii.ONLINE&&(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=f),Qt.on(So.NETWORK_STATE_CHANGE,(_,g)=>{_!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(_)),_===ii.ONLINE?(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=f):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=h))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{const s=gu(),a=this.urls[this.currentURLIndex];this.createWebSocketConnection(a).then(s.resolve).catch(s.reject),this.once(Ne.CLOSED,()=>{s.reject(new Q(O.WS_DISCONNECT))}),this.once(Ne.CONNECTED,s.resolve),await s.promise}catch{}finally{i()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;t?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void v.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),v.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Q(O.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new Q(O.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;const i=gu();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const s=f=>{var _;(_=this.store)===null||_===void 0||_.signalChannelOpen(),v.debug("[".concat(this.name,"] websocket opened:"),f),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},a=async f=>{var _;if(v.debug("[".concat(this.name,"] websocket close ").concat((_=this.websocket)===null||_===void 0?void 0:_.url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new Q(O.WS_DISCONNECT,"websocket close: ".concat(f.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const g=Ui(this,Ne.WILL_RECONNECT,this.reconnectMode,f.reason)||this.reconnectMode,T=await this.reconnectWithAction(g);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!T)return i.reject(new Q(O.WS_DISCONNECT,"websocket reconnect failed: ".concat(f.code))),this.close(!0);i.resolve()}},c=f=>{this.emit(Ne.ON_MESSAGE,f)},l=f=>{v.warn("[".concat(this.connectionID,"] ws open error ").concat(f))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),L("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=L("GATEWAY_WSS_ADDRESS")),v.debug("[".concat(this.name,"] start connect, url:"),e);const h=(t=this.store)===null||t===void 0?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var p;const f=await this.chooseBestWebsocketConnection(e);this.websocket=f,s&&s(this.websocket.url),this.websocket.onclose=a,this.websocket.onmessage=c,this.websocket.onerror=l,(p=this.store)===null||p===void 0||p.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this.joinGatewayRecordIndex=h}catch(f){const _=this.state==="closed",g=f instanceof Q,T=g&&f.code===O.WS_ABORT,w=g&&f.code===O.WS_ERR,R=g?f.message:f&&(f.reason||f.toString());v.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(R)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:T?"aborted":"error",errors:[f]},h),_||w?(i.reject(_?new Q(O.WS_DISCONNECT,"websocket is closed: ".concat(R)):new Q(O.WS_ERR,"init websocket failed: ".concat(R))),w&&v.error("[".concat(this.name,"] init websocket failed: ").concat(R))):a&&a(f)}return i.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;v.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||Qt.isOnline||!Qt.onlineWaiter||(this.onlineReconnectListener=Qt.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,t){const c=Sf(this.reconnectCount,this.retryConfig);v.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(e)),await W.race([Sn(c),this.onlineReconnectListener||new W(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const s=async(c,l)=>{this.emit(Ne.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(e==="retry")this.emit(Ne.RECONNECT_WAITTING_FINISH,e),await s(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);v.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Ne.RECONNECT_WAITTING_FINISH,e),await s(this.urls[this.currentURLIndex],e)}else e==="recover"&&(v.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Ne.RECONNECT_WAITTING_FINISH,e),this.urls=await Xt(this,Ne.REQUEST_NEW_URLS),this.currentURLIndex=0,await s(this.urls[this.currentURLIndex],e))}catch(c){var a;v.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const l=c==null||(a=c.data)===null||a===void 0?void 0:a.desc;return Array.isArray(l)&&fe(l).call(l,"dynamic key expired")?(this.emit(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class Nu extends fN{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){const i=gu(),s=function(c,l){return new R6(c,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),s.closeAllWebsockets(),i.reject(new Q(O.WS_ABORT,"choose best websocket aborted"))};const a=L("GATEWAY_DOMAINS");return v.debug("[choose-best-ws] currentDomain: ",e,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),s.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Pu extends fN{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new W((i,s)=>{let a=!1;const c=[];this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),c.forEach(w=>{w.onclose=null,w.onopen=null,w.onmessage=null,w.close()}),s(new Q(O.WS_ABORT,"choose best websocket aborted"))};const l=L("GATEWAY_DOMAINS");let h;const p=e.indexOf("?h="),f=l.find(w=>p!==-1?fe(e).call(e,w,p):fe(e).call(e,w));v.debug("[choose-best-ws] currentDomain: ",f,", domains: ",l);let _=!this.tryDoubleDomain||!f;if(!_&&f){var g;const w=Date.now();try{l.forEach(R=>{const I=p===-1?e.replace(f,R):e.substr(0,p)+e.substr(p).replace(f,R),N=new WebSocket(I);N.binaryType="arraybuffer",c.push(N),v.debug("[choose-best-ws] ws is connecting:",N.url)})}catch{for(v.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(I=>I.close());c.length;)c.pop();_=!0}(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:c.map(R=>R.url),service:"gateway"},t),c.forEach(R=>{R.onopen=()=>{if(a)return;const I=Date.now()-w;v.debug("[choose-best-ws] ws open cost ".concat(I,"ms")),c.filter(N=>N!==R).forEach(N=>{v.debug("[choose-best-ws]close backup websocket: ".concat(N.url)),N.close()}),a=!0,i(R)},R.onclose=I=>{h=I,!a&&(c.find(N=>!(N.readyState===WebSocket.CLOSED||N.readyState===WebSocket.CLOSING))||(v.debug("[choose-best-ws] all websocket is closed"),a=!0,s(h)))},R.onmessage=I=>{v.debug("[choose-best-ws]".concat(R.url," onmessage: ").concat(I.data))}}),Sn(this.forceCloseTimeout).then(()=>{c.forEach(R=>{R.readyState!==WebSocket.OPEN&&R.close()})})}if(_){var T;let w;v.debug("[choose-best-ws] use single url: ",e),(T=this.store)===null||T===void 0||T.recordJoinChannelService({urls:[e],service:"gateway"},t);try{w=new WebSocket(e),c.push(w),w.binaryType="arraybuffer"}catch(R){const I=new Q(O.WS_ERR,"init websocket failed! Error: ".concat(R.toString()));return v.error("[".concat(this.name,"]").concat(I)),void s(I)}w.onopen=()=>{i(w)},w.onclose=R=>{s(R)},w.onmessage=R=>{v.debug("[choose-best-ws]".concat(w.url," onmessage: ").concat(R.data))},Sn(this.forceCloseTimeout).then(()=>{w&&w.readyState!==WebSocket.OPEN&&w.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class mN extends At{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===We.CONNECTED?this.emit(pe.WS_CONNECTED):e===We.RECONNECTING?this.emit(pe.WS_RECONNECTING,this._websocketReconnectReason):e===We.CLOSED&&this.emit(pe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",We.CLOSED),S(this,"reconnectToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new wS(5)),S(this,"pingpongTimer",void 0),S(this,"wsInflateDataTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(pe.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const a="res-@".concat(s._id);this.emit(a,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){if(this.emit(s._type,s._message),s._type===De.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===De.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}if(s._type===De.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close(Ye.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close(Ye.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ye.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close(Ye.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ye.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close(Ye.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Nu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,L("JOIN_GATEWAY_USE_DUAL_DOMAIN"),L("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===We.CONNECTED&&this.reconnect("retry",gn.OFFLINE)})}async request(e,t,i,s){const a=Et(6,""),c={_id:a,_type:e,_message:t},l=this.websocket.connectionID,h=()=>new W((w,R)=>{if(this.connectionState===We.CONNECTED)return w();const I=()=>{this.off(pe.WS_CLOSED,N),w()},N=()=>{this.off(pe.WS_CONNECTED,I),R(new B(O.WS_ABORT))};this.once(pe.WS_CONNECTED,I),this.once(pe.WS_CLOSED,N),e!==ve.PUBLISH&&e!==ve.PUBLISH_DATASTREAM&&e!==ve.SUBSCRIBE&&e!==ve.SUBSCRIBE_DATASTREAM&&e!==ve.UNSUBSCRIBE&&e!==ve.UNSUBSCRIBE_DATASTREAM&&e!==ve.UNPUBLISH&&e!==ve.UNPUBLISH_DATASTREAM&&e!==ve.CONTROL&&e!==ve.RESTART_ICE||this.once(pe.DISCONNECT_P2P,()=>{R(new B(O.DISCONNECT_P2P))}),e!==ve.PUBLISH&&e!==ve.RESTART_ICE||this.once(pe.ABORT_P2P_EXECUTION,()=>{R(new B(O.DISCONNECT_P2P))})});if(this.connectionState!==We.CONNECTING&&this.connectionState!==We.RECONNECTING||e===ve.JOIN||e===ve.REJOIN||await h(),this.websocket.sendMessage(c,!0),s)return;const p=new W((w,R)=>{let I=!1;const N=(V,G)=>{I=!0,w({isSuccess:V==="success",message:G||{}}),this.off(pe.WS_CLOSED,D),this.off(pe.WS_RECONNECTING,D),this.emit(pe.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(a),N);const D=()=>{R(new B(O.WS_ABORT,"type: ".concat(e))),this.off(pe.WS_CLOSED,D),this.off(pe.WS_RECONNECTING,D),this.off("res-@".concat(a),N)};this.once(pe.WS_CLOSED,D),this.once(pe.WS_RECONNECTING,D),Sn(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||I||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(pe.REQUEST_TIMEOUT,e,t))})});let f=null;try{f=await p}catch(w){if(this.connectionState===We.CLOSED||e===ve.LEAVE)throw new B(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?w.throw():e===ve.JOIN||e===ve.REJOIN?null:(await h(),await this.request(e,t))}if(f.isSuccess)return f.message;const _=Number(f.message.error_code||f.message.code),g=Rc(_),T=new B(O.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(f.message.error_str),{code:_,data:f.message});return g.action==="success"?f.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(_,", message: ").concat(g.desc,", action: ").concat(g.action)),_===Ie.ERR_TOO_MANY_BROADCASTERS?((e===ve.JOIN||e===ve.REJOIN)&&(this.initError=T,this.close()),T.throw()):g.action==="failed"?T.throw():g.action==="quit"?(this.initError=T,this.close(),T.throw()):(_===Ie.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",gn.MULTI_IP)):this.reconnect(g.action,gn.SERVER_ERROR),e===ve.JOIN||e===ve.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new W(i=>{const s=a=>{(!t||t(a))&&(this.off(e,s),i(a))};this.on(e,s)})}uploadWRTCStats(e){if(!this.store.sessionId)return void v.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Ro.WRTC_STATS,t)}upload(e,t){const i={_type:e,_message:t};try{this.websocket.sendMessage(i)}catch{const a=L("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==We.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},L("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const i={_type:e,_message:t};this.websocket.sendMessage(i)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new W((i,s)=>{this.once(pe.WS_CONNECTED,()=>i(this.joinResponse)),this.once(pe.WS_CLOSED,()=>s(this.initError||new B(O.WS_ABORT))),this.connectionState=We.CONNECTING,this.websocket.init(e).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Ye.LEAVE,this.connectionState=We.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===Ye.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Nu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,L("JOIN_GATEWAY_USE_DUAL_DOMAIN"),L("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(pe.ABORT_P2P_EXECUTION);const e=await Xt(this,pe.REQUEST_JOIN_INFO),t=await this.request(ve.JOIN,e);if(!t)return this.emit(pe.REPORT_JOIN_GATEWAY,yc.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(pe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=We.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new B(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=gc(this,pe.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(ve.REJOIN,e);return!!t&&(this.connectionState=We.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(i=>{this.emit(De.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(De.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(De.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(De.MUTE_AUDIO,{uid:i.uid}):this.emit(De.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(De.MUTE_VIDEO,{uid:i.uid}):this.emit(De.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(De.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(De.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(De.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(De.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(De.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){v.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Rc(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(t.action,gn.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=L("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(v.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>L("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",gn.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-t;this.rttRolling.add(i),L("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();e!==0&&t!==0&&this.upload(Ro.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Ne.RECONNECT_WAITTING_FINISH,e=>{this.emit(pe.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(Ne.RECONNECT_CREATE_CONNECTION,e=>{this.emit(pe.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Ne.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ne.CLOSED,()=>{this.connectionState=We.CLOSED}),this.websocket.on(Ne.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=We.CLOSED}),this.websocket.on(Ne.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===We.CONNECTED?this.connectionState=We.RECONNECTING:this.connectionState=We.CONNECTING}),this.websocket.on(Ne.WILL_RECONNECT,(e,t,i)=>{const s=gc(this,pe.IS_P2P_DISCONNECTED),a=s||e!=="retry";s&&e==="retry"&&(v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=yc.P2P_DISCONNECTED),a&&(v.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(pe.REPORT_JOIN_GATEWAY,t||yc.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(pe.NEED_RENEW_SESSION),this.emit(pe.DISCONNECT_P2P)),i(e)}),this.websocket.on(Ne.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",gn.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(pe.REPORT_JOIN_GATEWAY,e.message||e.code||yc.UNKNOWN_REASON,this.url||""),e instanceof B&&e.code===O.UNEXPECTED_RESPONSE&&e.data.code===Ie.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",gn.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",gn.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Ne.REQUEST_NEW_URLS,(e,t)=>{Xt(this,pe.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(De.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var _N=`	
\v\f\r                　\u2028\u2029\uFEFF`,C6=Ql,I6=Br,nT=_N,EN=M("".replace),w6=RegExp("^["+nT+"]+"),A6=RegExp("(^|[^"+nT+"])["+nT+"]+$"),iT=function(n){return function(e){var t=I6(C6(e));return 1&n&&(t=EN(t,w6,"")),2&n&&(t=EN(t,A6,"$1")),t}},O6={start:iT(1),end:iT(2),trim:iT(3)},b6=Uw.PROPER,N6=E,gN=_N,P6=O6.trim;Nt({target:"String",proto:!0,forced:function(n){return N6(function(){return!!gN[n]()||"​᠎"[n]()!=="​᠎"||b6&&gN[n].name!==n})}("trim")},{trim:function(){return P6(this)}});var vn,Rr,D6=Xo("String").trim,k6=X,L6=D6,rT=String.prototype,sT=m(function(n){var e=n.trim;return typeof n=="string"||n===rT||k6(rT,n)&&e===rT.trim?L6:e});function SN(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function xf(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?SN(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):SN(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function pa(n){return n.match(/^[\.\:\d]+$/)?"".concat(n.replace(/[^\d]/g,"-"),".").concat(L("TURN_DOMAIN")):(v.info("Unidentified as ip: ".concat(n,", use as host")),n)}function TN(n,e){n.addresses||(n.addresses=[]);const t=function(a,c){if(L("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return a.map(p=>{let{ip:f,port:_}=p;return{address:"".concat(f,":").concat(_)}});const l=L("GATEWAY_DOMAINS");let h=l[1]&&fe(c).call(c,l[1])?1:0;return a.map(p=>{let{domain_prefix:f,port:_,ip:g}=p;if(f)return{address:"".concat(f,".").concat(l[h++%l.length],":").concat(_)};const T=/^[\.\:\d]+$/.test(g),w=T?"".concat(g.replace(/[^\d]/g,"-"),".").concat(l[h++%l.length],":").concat(_):"".concat(g,":").concat(_);return T||v.info("Unidentified as ip: ".concat(g,", use as host")),{ip:g,port:_,address:w}})}(n.addresses,e),i=Array.isArray(n.detail)&&n.detail[18];if(i&&typeof i=="string"){const a=i.split(";");for(let c=0;c<a.length;c++){var s;const l=sT(s=a[c]).call(s);t[c]&&l&&(t[c].ip6=l)}}return{gatewayAddrs:t,uid:n.uid,cid:n.cid,cert:n.cert,vid:n.detail&&n.detail[8],uni_lbs_ip:n.detail&&n.detail[1],res:n,csIp:n.detail&&n.detail[502]}}function nr(n){return typeof n=="number"?n:n.exact||n.ideal||n.max||n.min||0}function vN(n){const e=n._encoderConfig;if(!e)return{};const t={resolution:e.width&&e.height?"".concat(nr(e.width),"x").concat(nr(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(t.maxFrameRate=e.frameRate,t.minFrameRate=e.frameRate):e.frameRate&&(t.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,t.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),t}function yN(n){return n>=0&&n<.17?1:n>=.17&&n<.36?2:n>=.36&&n<.59?3:n>=.59&&n<=1?4:n>1?5:0}function oT(n,e){let t,i,s;switch(e){case vn.CHOOSE_SERVER:i=4096,s="choose server";break;case vn.CLOUD_PROXY:i=1048576,s="proxy";break;case vn.CLOUD_PROXY_5:i=4194304,s="proxy5";break;case vn.CLOUD_PROXY_FALLBACK:i=4194310,s="proxy fallback";break;default:throw new B(O.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:n.detail&&n.detail[502],retry:!1})}if(n.response_body.forEach(a=>{a.buffer&&a.buffer.flag===i&&(t={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(c=>xf(xf({},c),{},{ticket:a.buffer.cert})),server_ts:n.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:xf(xf({},a.buffer.detail),n.detail),flag:a.buffer.flag,opid:n.opid,cert:a.buffer.cert})}),!t)throw new B(O.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:n.detail&&n.detail[502]});return t}async function M6(n,e){return await W.all(n.addresses.map(async t=>({address:pa(t.ip),tcpport:t.port,udpport:t.port,username:e&&L("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():di.username,password:e&&L("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await vS(e.toString()):di.password})))}function aT(n,e){const t=e._videoHeight||e.getMediaStreamTrack(!0).getSettings().height;return t?Math.max(t/nr(n.height),1):(v.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function fa(n){let{candidateType:e,relayProtocol:t,type:i,address:s,port:a,protocol:c}=n;return i==="local-candidate"?{candidateType:e,relayProtocol:t,protocol:c}:{candidateType:e,relayProtocol:t,address:s,port:a,protocol:c}}function RN(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}(function(n){n[n.CHOOSE_SERVER=11]="CHOOSE_SERVER",n[n.CLOUD_PROXY=18]="CLOUD_PROXY",n[n.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",n[n.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(vn||(vn={}));class U6 extends At{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;fe(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(jt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(jt.CONNECTED):this._state==="closed"?this.emit(jt.CLOSED):this._state==="failed"&&this.emit(jt.FAILED))}constructor(e,t,i,s){super(),S(this,"connectionID",0),S(this,"currentURLIndex",0),S(this,"reconnectReason",void 0),S(this,"_reconnectMode","tryNext"),S(this,"_name",void 0),S(this,"_state","closed"),S(this,"_retryConfig",void 0),S(this,"_reconnectCount",0),S(this,"_forceCloseTimeout",5e3),S(this,"_onlineReconnectListener",void 0),S(this,"_closeEstablishingTransmitter",()=>{}),S(this,"_store",void 0),S(this,"_joinChannelServiceRecordIndex",void 0),S(this,"_useCompress",void 0),S(this,"_inflateLength",0),S(this,"_deflateLength",0),this._store=s,this._name=e,this._retryConfig=function(a){for(var c=1;c<arguments.length;c++){var l=arguments[c]!=null?arguments[c]:{};c%2?RN(Object(l),!0).forEach(function(h){S(a,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(l)):RN(Object(l)).forEach(function(h){Object.defineProperty(a,h,Object.getOwnPropertyDescriptor(l,h))})}return a}({},t),this._useCompress=i}resetReconnectCount(e){v.debug("".concat(this._name," reset reconnect count, reason: ").concat(e)),this._reconnectCount=0}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const i=this._transmitter;t?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=e?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(e,t){if(!this._transmitter)return void v.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;e!==void 0&&(this.reconnectMode=e),v.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(t)]},this._joinChannelServiceRecordIndex));const s=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),s&&s.bind(this._transmitter)({code:9999,reason:t})}getInflateData(){const e=this._inflateLength,t=this._deflateLength;return this.clearInflateData(),{inflateLength:e,deflateLength:t}}setInflateData(e){this._deflateLength=this._deflateLength+e.originLength,this._inflateLength=this._inflateLength+e.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}(function(n){n[n.Default=0]="Default",n[n.Ack=1]="Ack"})(Rr||(Rr={}));class x6{constructor(e,t,i){S(this,"version",1),S(this,"initialRTO",void 0),S(this,"maxBatchAckCount",void 0),S(this,"maxRTO",void 0),S(this,"initialRTT",void 0),S(this,"ID",void 0),S(this,"rtt",void 0),S(this,"packetNumber",1),S(this,"rtoRatioMap",new Map),S(this,"timeoutMap",new Map),S(this,"unorderedPacketQueue",[]),S(this,"batchAckPacketQueue",[]),S(this,"lastOrderedPacketNumber",0),S(this,"batchAckTimer",void 0),S(this,"sendImpl",void 0),S(this,"receiveImpl",void 0),this.sendImpl=e,this.receiveImpl=t,this.ID=Et(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:L("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:L("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:L("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:L("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:L("TRANSMITTER_MAX_RTO")}packetize(e,t){return{type:Rr.Default,version:this.version,packetNumber:t,payload:e}}serialize(e){switch(e.type){case Rr.Default:{let t;typeof e.payload=="string"?t=new TextEncoder().encode(e.payload):t=e.payload;const i=new ArrayBuffer(t.length+15),s=new DataView(i);return s.setUint16(0,e.version),s.setUint8(2,e.type),s.setUint32(3,e.packetNumber),YO(s,7,BigInt(e.sendTs)),new Uint8Array(s.buffer).set(t,15),i}case Rr.Ack:{const t=new ArrayBuffer(16),i=new DataView(t);return i.setUint16(0,e.version),i.setUint8(2,e.type),i.setUint32(3,e.maxAckPacketNumber),i.setUint8(7,e.shift),YO(i,8,BigInt(e.ackSendTs)),t}}}deserialize(e){const t=new DataView(e),i=t.getUint16(0),s=t.getUint8(2);switch(s){case Rr.Default:{const a=t.getUint32(3),c=zO(t,7),l=e.slice(15),h=new TextDecoder().decode(l);return{version:i,type:s,packetNumber:a,sendTs:Number(c),payload:h}}case Rr.Ack:{const a=t.getUint32(3),c=t.getUint8(7),l=zO(t,8);return{version:i,type:s,maxAckPacketNumber:a,shift:c,ackSendTs:Number(l)}}default:throw v.error("[".concat(this.ID,"] Unrecognized packet type ").concat(s)),new Error("Unrecognized packet type ".concat(s))}}sendMessage(e){const t=this.packetize(e,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const i=this.calculateRTO(t),s=window.setTimeout(()=>{this.resendMessage(t)},i);this.timeoutMap.set(t.packetNumber,s),this.sendPacket(t)}onData(e){const t=this.deserialize(e);t.type===Rr.Default?this.ack(t):t.type===Rr.Ack&&(this.updateRTT(t,Math.round(performance.now())),this.clearRTO(t))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(e=>{let[t,i]=e;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(e){const t=this.calculateRTO(e),i=window.setTimeout(()=>{this.resendMessage(e)},t);this.timeoutMap.set(e.packetNumber,i),this.sendPacket(e)}calculateRTO(e){const t=this.rtoRatioMap.get(e.packetNumber);if(t===void 0)return this.rtoRatioMap.set(e.packetNumber,1),this.initialRTO;{const i=9*this.rtt/8*t;return this.rtoRatioMap.set(e.packetNumber,t+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(e,t){const i=e.ackSendTs;this.rtt=this.rtt*(7/8)+(t-i-this.rtt)/8}ack(e){if(e.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(e):(this.batchAckPacketQueue.push(e),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(e.payload);;){const t=this.unorderedPacketQueue[0];if(!t){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(t.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(e.packetNumber<=this.lastOrderedPacketNumber){const t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:Rr.Ack,version:this.version};this.sendPacket(t)}else if(e.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[e.packetNumber-this.lastOrderedPacketNumber-2]=e;const t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:Rr.Ack,version:this.version};this.sendPacket(t)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const e={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Rr.Ack,version:this.version};this.sendPacket(e),this.batchAckPacketQueue=[]}sendPacket(e){e.type===Rr.Default&&(e.sendTs=Math.round(performance.now()));const t=this.serialize(e);this.sendImpl(t)}clearRTO(e){for(let t=e.maxAckPacketNumber-e.shift;t<=e.maxAckPacketNumber;t++){const i=this.timeoutMap.get(t);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(t),this.rtoRatioMap.delete(t)}}}class CN extends U6{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),S(this,"_initMutex",void 0),S(this,"_reconnectInterrupter",void 0),S(this,"_url",void 0),S(this,"_transmitter",void 0),S(this,"_addresses",void 0),S(this,"_reliableTransmission",void 0),this._initMutex=new Tn("datachannel");const{timeout:i,timeoutFactor:s}=t,a=Math.max(300,Math.floor(3*i/5)),c=Math.max(1.2,Math.floor(8*s)/10);ii.ONLINE&&(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c),Qt.on(So.NETWORK_STATE_CHANGE,(l,h)=>{l!==h&&(this.resetReconnectCount("network state change: ".concat(h," -> ").concat(l)),l===ii.ONLINE?(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=s))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=t;const i=(s,a)=>{this._addresses=e,this.currentURLIndex=this._addresses.findIndex(l=>l.fingerprint||L("FINGERPRINT"));const c=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(c).then(s).catch(a),this.once(jt.CLOSED,()=>a(new B(O.WS_DISCONNECT))),this.once(jt.CONNECTED,()=>s())};return this._initMutex.lock().then(s=>new W((a,c)=>{i(a,c)}).then(()=>{s()}).catch(()=>{s()}))}sendMessage(e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new B(O.WS_ABORT,"datachannel is not ready");try{t||(e=JSON.stringify(e)),this._reliableTransmission.sendMessage(e)}catch(i){throw new B(O.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(e){const t=JSON.stringify(e);return{compressed:t,compressedLength:t.length,origin:e}}sendMessageWithUint8Array(e){return{compressed:e,compressedLength:e.byteLength,origin:e}}createTransmitterConnection(e){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(e.ip,":").concat(e.port),new W((t,i)=>{var s;const a=()=>{v.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),t()},c=async f=>{var _;if((_=this._closeEstablishingTransmitter)===null||_===void 0||_.call(this),v.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const g=Ui(this,jt.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,T=await this.reconnectWithAction(g);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!T)return i(new B(O.WS_DISCONNECT,"datachannel reconnect failed: ".concat(f.code))),void this.close(!0);t()}else i(new B(O.WS_DISCONNECT,"datachannel close: ".concat(f.code))),this.close()},l=f=>{var _;(_=this._reliableTransmission)===null||_===void 0||_.onData(f.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),v.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(e)));const h=(s=this._store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),p=Date.now();Xt(this,jt.TO_CONNECT_DATACHANNEL,e).then(f=>{var _,g;if(!f)throw new Error("transmissonInfo not exist yet");const{transmitter:T,close:w}=f;this._transmitter=T,(_=this._store)===null||_===void 0||_.signalChannelOpen();const R=Date.now()-p;v.debug("[choose dc] dc open cost ".concat(R,"ms")),this._reliableTransmission=new x6(I=>{var N;this._transmitter&&this._transmitter.readyState==="open"&&((N=this._transmitter)===null||N===void 0||N.send(I))},I=>{typeof I=="string"&&this.emit(jt.ON_MESSAGE,I)}),this._closeEstablishingTransmitter=()=>{var I;(I=this._reliableTransmission)===null||I===void 0||I.close(),this._reliableTransmission=void 0,w()},a&&a(),T.onclose=c,T.onmessage=l,(g=this._store)===null||g===void 0||g.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this._joinChannelServiceRecordIndex=h}).catch(f=>{var _;if((_=this._store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:f instanceof B&&f.code===O.WS_ABORT?"aborted":"error",errors:[f]},h),this.state!=="closed"){if(f instanceof B&&f.code===O.WS_ERR){const g=new B(O.WS_ERR,"init datachannel failed! Error: ".concat(f.toString()));return v.error("[".concat(this._name,"]").concat(g)),void i(g)}c&&c(f)}else i(new B(O.WS_DISCONNECT,"datachannel is closed: ".concat(f.toString())))})})}async reconnectWithAction(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Qt.networkState!==ii.OFFLINE||(this._onlineReconnectListener=Qt.onlineWaiter&&Qt.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},t){const l=Sf(this._reconnectCount,this._retryConfig);v.debug("[".concat(this._name,"] wait ").concat(l,"ms to reconnect datachannel, mode: ").concat(e)),await W.race([Sn(l),this._onlineReconnectListener||new W(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;const s=async(l,h)=>{this.emit(jt.RECONNECT_CREATE_CONNECTION,h),await this.createTransmitterConnection(l)};try{if(e==="retry"){const l=this._addresses[this.currentURLIndex];this.emit(jt.RECONNECT_WAITTING_FINISH,e),await s(l,e)}else if(e==="tryNext"){this.currentURLIndex+=1;for(let h=this.currentURLIndex;h<this._addresses.length;h++){if(this._addresses[h].fingerprint||L("FINGERPRINT")){this.currentURLIndex=h;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return v.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);v.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const l=this._addresses[this.currentURLIndex];this.emit(jt.RECONNECT_WAITTING_FINISH,e),await s(l,e)}else e==="recover"&&(v.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(jt.RECONNECT_WAITTING_FINISH,e),this.emit(jt.FAILBACK));return!0}catch(l){var a,c;return v.error("[".concat(this._name,"] reconnect failed"),l.toString()),l!=null&&(a=l.data)!==null&&a!==void 0&&a.desc&&Array.isArray(l.data.desc)&&l.data.desc.length&&fe(c=l.data.desc).call(c,"dynamic key expired")?(this.emit(jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(e,t)}}}class Co extends At{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===We.CONNECTED?this.emit(pe.WS_CONNECTED):e===We.RECONNECTING?this.emit(pe.WS_RECONNECTING,this._websocketReconnectReason):e===We.CLOSED&&this.emit(pe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",We.CLOSED),S(this,"reconnectToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new wS(5)),S(this,"pingpongTimer",void 0),S(this,"inflateDataTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(pe.ON_BINARY_DATA,i);const s=JSON.parse(i);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const a="res-@".concat(s._id);this.emit(a,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")&&(this.emit(s._type,s._message),s._type===De.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===De.ON_USER_BANNED))switch(s._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new CN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===We.CONNECTED&&this.reconnect("retry",Hs.OFFLINE)})}async request(e,t,i,s){const a=Et(6,""),c={_id:a,_type:e,_message:t},l=this.websocket.connectionID,h=()=>new W((w,R)=>{if(this.connectionState===We.CONNECTED)return w();const I=()=>{this.off(pe.WS_CLOSED,N),w()},N=()=>{this.off(pe.WS_CONNECTED,I),R(new B(O.WS_ABORT))};this.once(pe.WS_CONNECTED,I),this.once(pe.WS_CLOSED,N),e!==ve.PUBLISH&&e!==ve.SUBSCRIBE&&e!==ve.UNSUBSCRIBE&&e!==ve.UNPUBLISH&&e!==ve.CONTROL&&e!==ve.RESTART_ICE||this.once(pe.DISCONNECT_P2P,()=>{R(new B(O.DISCONNECT_P2P))}),e!==ve.PUBLISH&&e!==ve.RESTART_ICE||this.once(pe.ABORT_P2P_EXECUTION,()=>{R(new B(O.DISCONNECT_P2P))})});if(this.connectionState!==We.CONNECTING&&this.connectionState!==We.RECONNECTING||e===ve.JOIN||e===ve.REJOIN||await h(),e===ve.LEAVE&&(this.websocket.unbindDcCloseEventListener(),s=!0),this.websocket.sendMessage(c,!0,!1),s)return;const p=new W((w,R)=>{let I=!1;const N=(V,G)=>{I=!0,w({isSuccess:V==="success",message:G||{}}),this.off(pe.WS_CLOSED,D),this.off(pe.WS_RECONNECTING,D),this.emit(pe.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(a),N);const D=()=>{R(new B(O.WS_ABORT,"type: ".concat(e))),this.off(pe.WS_CLOSED,D),this.off(pe.WS_RECONNECTING,D),this.off("res-@".concat(a),N)};this.once(pe.WS_CLOSED,D),this.once(pe.WS_RECONNECTING,D),Sn(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||I||(v.warning("dc request timeout, type: ".concat(e)),this.emit(pe.REQUEST_TIMEOUT,e,t))})});let f=null;try{f=await p}catch(w){if(this.connectionState===We.CLOSED||e===ve.LEAVE)throw new B(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?w.throw():e===ve.JOIN||e===ve.REJOIN?null:(await h(),await this.request(e,t))}if(f.isSuccess)return f.message;const _=Number(f.message.error_code||f.message.code),g=Rc(_),T=new B(O.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(f.message.error_str),{code:_,data:f.message});return g.action==="success"?f.message:(v.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(_,", message: ").concat(g.desc,", action: ").concat(g.action)),_===Ie.ERR_TOO_MANY_BROADCASTERS?((e===ve.JOIN||e===ve.REJOIN)&&(this.initError=T,this.close()),T.throw()):g.action==="failed"?T.throw():g.action==="quit"?(this.initError=T,this.close(),T.throw()):(_===Ie.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Hs.MULTI_IP)):this.reconnect(g.action,Hs.SERVER_ERROR),e===ve.JOIN||e===ve.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new W(i=>{const s=a=>{(!t||t(a))&&(this.off(e,s),i(a))};this.on(e,s)})}uploadWRTCStats(e){if(!this.store.sessionId)return void v.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Ro.WRTC_STATS,t)}upload(e,t){const i={_type:e,_message:t};try{this.websocket.sendMessage(i)}catch{const a=L("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==We.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},L("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const i={_type:e,_message:t};this.websocket.sendMessage(i)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new W((i,s)=>{this.once(pe.WS_CONNECTED,()=>i(this.joinResponse)),this.once(pe.WS_CLOSED,()=>s(this.initError||new B(O.WS_ABORT))),this.connectionState=We.CONNECTING,this.websocket.init(e).catch(s),this.websocket.once(jt.FAILBACK,()=>{this.openConnectionTime===void 0&&s(new B(O.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{t&&this.openConnectionTime===void 0&&(v.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),s(new B(O.INIT_DATACHANNEL_TIMEOUT)))},L("DC_JOIN_WITH_FAILBACK"))})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Ye.LEAVE,this.connectionState=We.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),e===Ye.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new CN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(pe.ABORT_P2P_EXECUTION);const e=await Xt(this,pe.DATACHANNEL_CONNECTING),t=await this.request(ve.JOIN,e);if(!t)return this.emit(pe.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(pe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=We.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new B(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=gc(this,pe.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(ve.REJOIN,e);return!!t&&(this.connectionState=We.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(i=>{this.emit(De.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(De.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(De.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(De.MUTE_AUDIO,{uid:i.uid}):this.emit(De.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(De.MUTE_VIDEO,{uid:i.uid}):this.emit(De.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(De.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(De.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(De.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(De.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(De.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){v.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Rc(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(t.action,Hs.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=L("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(v.warning("PINGPONG Timeout. Last Socket Message: ".concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>L("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Hs.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-t;this.rttRolling.add(i),L("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){const{inflateLength:e,deflateLength:t}=this.websocket.getInflateData();e!==0&&t!==0&&this.upload(Ro.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(jt.RECONNECT_WAITTING_FINISH,e=>{this.emit(pe.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(jt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(pe.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(jt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(jt.CLOSED,()=>{this.connectionState=We.CLOSED}),this.websocket.on(jt.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=We.CLOSED}),this.websocket.on(jt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===We.CONNECTED?this.connectionState=We.RECONNECTING:this.connectionState=We.CONNECTING}),this.websocket.on(jt.WILL_RECONNECT,(e,t)=>{if(gc(this,pe.IS_P2P_DISCONNECTED)&&e==="retry")return v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(pe.NEED_RENEW_SESSION),this.emit(pe.DISCONNECT_P2P),t("tryNext");e!=="retry"&&(v.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(pe.NEED_RENEW_SESSION),this.emit(pe.DISCONNECT_P2P)),t(e)}),this.websocket.on(jt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Hs.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(pe.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof B&&e.code===O.UNEXPECTED_RESPONSE&&e.data.code===Ie.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Hs.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Hs.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(jt.REQUEST_NEW_URLS,(e,t)=>{Xt(this,pe.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(De.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(jt.TO_CONNECT_DATACHANNEL,async(e,t,i)=>Xt(this,pe.DATACHANNEL_PRECONNECT,e).then(t).catch(i)),this.websocket.on(jt.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(pe.DATACHANNEL_FAILBACK)})}}class Cc extends At{constructor(e,t){super(),S(this,"signal",void 0),S(this,"token",void 0),S(this,"tokenTimeout",void 0),S(this,"tokenInterval",void 0),S(this,"_sequence",0),S(this,"userMap",new Map),S(this,"encoder",new TextEncoder),this.signal=e,this.token=t;const i=()=>{this.signal.connectionState===We.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*L("P2P_TOKEN_INTERVAL"))};i()}async send(e,t,i,s,a){var c,l,h;if(this.userMap.size===0)return;const p=Array.from(Es(c=this.userMap).call(c))[0].token;typeof t!="string"&&(t=JSON.stringify(t)),s=(l=s)!==null&&l!==void 0?l:Et(6,""),a=(h=a)!==null&&h!==void 0?h:this._sequence++;const f={_id:s,_type:e,_seq:a,_message:t,token:"".concat(this.token,"_").concat(p)};L("SHOW_P2P_LOG")&&v.debug("send message",f,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(f)).forEach(g=>{this.signal.request(ve.DATA_STREAM,{payload:Pd(this.encoder.encode(g))})});const _=new W((g,T)=>{const w=window.setTimeout(()=>{this.off("res-@".concat(s,"_ack"),R),this.off("res-@".concat(s),N),this.off(ha.ABORT,I),v.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(s)),this.userMap.size===0?T(new Q(O.INVALID_REMOTE_USER)):T(new Q(O.TIMEOUT))},L("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),R=()=>{w&&window.clearTimeout(w),this.off(ha.ABORT,I),i&&g()},I=()=>{w&&window.clearTimeout(w),this.off("res-@".concat(s,"_ack"),R),this.off("res-@".concat(s),N),T(new Q(O.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(s)))};this.once(ha.ABORT,I),this.once("res-@".concat(s,"_ack"),R);const N=(V,G)=>{D=!0,w&&window.clearTimeout(w),this.off("res-@".concat(s,"_ack"),R),this.off(ha.ABORT,I),V==="success"?g(G):T(new Q(O.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(s)))};let D=!1;i||(this.once("res-@".concat(s),N),Sn(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{D||v.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(s,", ").concat(f))}))});try{return await _}catch(g){if(g.code===O.TIMEOUT)return await this.send(e,t,i,s,a);throw g}}onMessage(e){var t;const{_uid:i}=e;let s,a=this.userMap.get(i);if(a)s=a.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==xt.CHECK)return;const{token:p}=e;s=new Map,a={uid:i,isStart:!0,token:p,splitMessageMap:s,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,a),this.signal.emit(De.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var c;const{id:p,total:f}=e,_=(c=s.get(p))!==null&&c!==void 0?c:[];if(_.push(e),s.has(p)||s.set(p,_),_.length!==f)return;{const g=du(_).call(_,(T,w)=>T.index-w.index).map(T=>T.payload).join("");s.delete(p),(e=JSON.parse(g))._uid=i}}const{_type:l,token:h}=e;if(fe(t=[xt.ACK,xt.CHECK]).call(t,l))return l===xt.CHECK&&this.handleCheckToken(a,h),void this.receiveMessage(e);h==="".concat(a.token,"_").concat(this.token)?this.handleReceivedMessage(e):v.debug('Receive unexpected message", '.concat(h,", cur_token: ").concat(a.token,"_").concat(this.token),e)}check(){const e={_id:Et(6,""),token:this.token,_type:xt.CHECK};L("SHOW_P2P_LOG")&&v.debug("send message",e),this.signal.request(ve.DATA_STREAM,{payload:Pd(this.encoder.encode(JSON.stringify(e)))})}ack(e){const t={_id:e,_type:xt.ACK,token:this.token};L("SHOW_P2P_LOG")&&v.debug("send message",t),this.signal.request(ve.DATA_STREAM,{payload:Pd(this.encoder.encode(JSON.stringify(t)))})}response(e,t,i){this.send(xt.RESPONSE,JSON.stringify({success:!i,message:t}),!0,e)}handleReceivedMessage(e){const t=()=>{this.userMap.forEach(p=>{const{receivedMessagesMap:f,nextExpectedSequenceNumber:_}=p;for(;f.has(_);){const g=f.get(_);f.delete(_),this.receiveMessage(g),p.nextExpectedSequenceNumber++}})};if(!e)return void t();const{_uid:i,_seq:s}=e,a=this.userMap.get(i),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:h}=a;if(s<h)return this.ack(e._id),void v.debug("[external-signal] receive old message, seq: ".concat(s,", ").concat(e._message));c.set(s,e),l&&s===h&&(this.receiveMessage(e),c.delete(h),a.nextExpectedSequenceNumber++,t())}receiveMessage(e){const{_id:t,_type:i,_message:s,_uid:a}=e;if(L("SHOW_P2P_LOG")&&v.debug("receive message",e),t){let c;switch(e._type!==xt.ACK&&(s&&(c=JSON.parse(s)),this.ack(e._id)),e._type){case xt.CANDIDATE:case xt.CONTROL:this.signal.emit(i,c,a);break;case xt.PUBLISH:case xt.UNPUBLISH:case xt.RESTART_ICE:case xt.CALL:c.uid=a,Xt(this.signal,i,c).then(l=>{this.response(e._id,l)}).catch(()=>{this.response(e._id,void 0,!0)});break;case xt.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case xt.RESPONSE:{const{success:l,message:h}=c;this.emit("res-@".concat(t),l?"success":"failed",h);break}}}}splitMessage(e){if(e.length<Cc.MAX_MESSAGE_SIZE)return[e];const t=[],{remoteToken:i}=JSON.parse(e),s=Et(6,"");let a=0,c=800;const l=Math.ceil(e.length/c);for(;e.length>0;){a++;const h={id:s,index:a,total:l,payload:e.slice(0,c),token:"".concat(this.token,"_").concat(i)};JSON.stringify(h).length>Cc.MAX_MESSAGE_SIZE?c-=50:(t.push(h),e=e.slice(c))}return t.map(h=>JSON.stringify(h))}handleCheckToken(e,t){return e.token!==t?(v.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{v.debug("token timeout, ".concat(t)),this.reset(e.uid)},L("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await Xt(this.signal,xt.CALL,void 0),t=await this.send(xt.CALL,e);this.signal.emit(pe.P2P_CONNECTION,t,!0)}async reset(e,t){const i=this.userMap.get(e);i&&(this.emit(ha.ABORT),this.signal.emit(De.ON_USER_OFFLINE,{uid:i.uid,reason:eT.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(v.debug("change local token from ".concat(t," to ").concat(t)),this.token=Et(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(ha.ABORT)}}S(Cc,"MAX_SIZE",1),S(Cc,"MAX_MESSAGE_SIZE",1024);class IN extends At{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===We.CONNECTED?this.emit(pe.WS_CONNECTED):e===We.RECONNECTING?this.emit(pe.WS_RECONNECTING,this._websocketReconnectReason):e===We.CLOSED&&this.emit(pe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",We.CLOSED),S(this,"reconnectToken",void 0),S(this,"p2pToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new wS(5)),S(this,"pingpongTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"_external_signal",void 0),S(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(pe.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const a="res-@".concat(s._id);this.emit(a,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){switch(s._type){case De.ON_DATA_STREAM:return void this.handleDataStream(s._message);case De.MUTE_AUDIO:case De.MUTE_VIDEO:case De.ON_P2P_LOST:case De.ON_USER_ONLINE:return;case De.ON_USER_OFFLINE:const{uid:a}=s._message;return v.debug("[".concat(this.clientId,"] user-offline uid: ").concat(a)),void this._external_signal.reset(a)}if(this.emit(s._type,s._message),s._type===De.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===De.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}if(s._type===De.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close(Ye.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close(Ye.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ye.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close(Ye.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ye.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close(Ye.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Nu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,L("JOIN_GATEWAY_USE_DUAL_DOMAIN"),L("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===We.CONNECTED&&this.reconnect("retry",gn.OFFLINE)}),this.p2pToken=Et(6,""),this._external_signal=new Cc(this,this.p2pToken)}async request(e,t,i,s){const a=Et(6,""),c={_id:a,_type:e,_message:t},l=this.websocket.connectionID,h=()=>new W((w,R)=>{if(this.connectionState===We.CONNECTED)return w();const I=()=>{this.off(pe.WS_CLOSED,N),w()},N=()=>{this.off(pe.WS_CONNECTED,I),R(new Q(O.WS_ABORT))};this.once(pe.WS_CONNECTED,I),this.once(pe.WS_CLOSED,N)});if(this.connectionState!==We.CONNECTING&&this.connectionState!==We.RECONNECTING||e===ve.JOIN||e===ve.REJOIN||await h(),this.websocket.sendMessage(c,!0),s)return;const p=new W((w,R)=>{let I=!1;const N=(V,G)=>{I=!0,w({isSuccess:V==="success",message:G||{}}),this.off(pe.WS_CLOSED,D),this.off(pe.WS_RECONNECTING,D),this.emit(pe.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(a),N);const D=()=>{R(new Q(O.WS_ABORT,"type: ".concat(e))),this.off(pe.WS_CLOSED,D),this.off(pe.WS_RECONNECTING,D),this.off("res-@".concat(a),N)};this.once(pe.WS_CLOSED,D),this.once(pe.WS_RECONNECTING,D),Sn(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||I||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(pe.REQUEST_TIMEOUT,e,t))})});let f=null;try{f=await p}catch(w){if(this.connectionState===We.CLOSED||e===ve.LEAVE)throw new Q(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?w.throw():e===ve.JOIN||e===ve.REJOIN?null:(await h(),await this.request(e,t))}if(f.isSuccess)return f.message;const _=Number(f.message.error_code||f.message.code),g=Rc(_),T=new Q(O.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(f.message.error_str),{code:_,data:f.message});return g.action==="success"?f.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(_,", message: ").concat(g.desc,", action: ").concat(g.action)),_===Ie.ERR_TOO_MANY_BROADCASTERS?((e===ve.JOIN||e===ve.REJOIN)&&(this.initError=T,this.close()),T.throw()):g.action==="failed"?T.throw():g.action==="quit"?(this.initError=T,this.close(),T.throw()):(_===Ie.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",gn.MULTI_IP)):this.reconnect(g.action,gn.SERVER_ERROR),e===ve.JOIN||e===ve.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new W(i=>{const s=a=>{(!t||t(a))&&(this.off(e,s),i(a))};this.on(e,s)})}uploadWRTCStats(e){if(!this.store.sessionId)return void v.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Ro.WRTC_STATS,t)}upload(e,t){const i={_type:e,_message:t};try{this.websocket.sendMessage(i)}catch{const a=L("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==We.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},L("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const i={_type:e,_message:t};this.websocket.sendMessage(i)}async sendExtensionMessage(e,t,i){return await this._external_signal.send(e,t,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new W((t,i)=>{this.once(pe.WS_CONNECTED,()=>t(this.joinResponse)),this.once(pe.WS_CLOSED,()=>i(this.initError||new Q(O.WS_ABORT))),this.connectionState=We.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Ye.LEAVE,this.connectionState=We.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===Ye.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Nu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,L("JOIN_GATEWAY_USE_DUAL_DOMAIN"),L("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=Et(6,""),this._external_signal.clear(),this._external_signal=new Cc(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(pe.ABORT_P2P_EXECUTION);const e=await Xt(this,pe.REQUEST_JOIN_INFO),t=await this.request(ve.JOIN,e);if(!t)return this.emit(pe.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(pe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=We.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;const i=vu(e.payload),s=new TextDecoder().decode(i),a=JSON.parse(s);"total"in a&&"id"in a||fe(t=Object.values(xt)).call(t,a._type)?(a._uid=e.uid,this._external_signal.onMessage(a)):this.emit(De.ON_DATA_STREAM,e)}catch{this.emit(De.ON_DATA_STREAM,e)}}handleNotification(e){v.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Rc(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(t.action,gn.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=L("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(v.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>L("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",gn.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-t;this.rttRolling.add(i),L("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(Ne.RECONNECT_WAITTING_FINISH,e=>{this.emit(pe.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(Ne.RECONNECT_CREATE_CONNECTION,e=>{this.emit(pe.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Ne.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ne.CLOSED,()=>{this.connectionState=We.CLOSED}),this.websocket.on(Ne.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=We.CLOSED}),this.websocket.on(Ne.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===We.CONNECTED?this.connectionState=We.RECONNECTING:this.connectionState=We.CONNECTING}),this.websocket.on(Ne.WILL_RECONNECT,(e,t,i)=>{e!=="retry"?(v.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(pe.NEED_RENEW_SESSION)):v.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(Ne.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(pe.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof Q&&e.code===O.UNEXPECTED_RESPONSE&&e.data.code===Ie.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",gn.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",gn.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Ne.REQUEST_NEW_URLS,(e,t)=>{Xt(this,pe.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(De.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function wN(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Hr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wN(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):wN(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const cT=new Map;class V6 extends At{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(Ut.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(Ut.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){v.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){super(),S(this,"store",void 0),S(this,"joinInfo",void 0),S(this,"key",void 0),S(this,"ntpOffset",0),S(this,"signal",void 0),S(this,"role",void 0),S(this,"inChannelInfo",{joinAt:null,duration:0}),S(this,"spec",void 0),S(this,"_state","DISCONNECTED"),S(this,"_statsCollector",void 0),S(this,"_disconnectedReason",void 0),S(this,"isSignalRecover",!1),S(this,"hasChangeBGPAddress",!1),S(this,"trafficStatsInterval",void 0),S(this,"networkQualityInterval",void 0),S(this,"_joinGatewayStartTime",0),S(this,"_signalTimeout",!1),S(this,"_clientRoleOptions",void 0),S(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?new IN(Hr(Hr({},t),{},{retryConfig:t.websocketRetryConfig}),e):this.store.useDataChannel?new Co(Hr(Hr({},t),{},{retryConfig:t.websocketRetryConfig}),e):new mN(Hr(Hr({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,i){if(this.signal instanceof Co){let h=!1;e.cloudProxyServer!=="disabled"?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(e.cloudProxyServer,")")),h=!0):"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length>255||"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length<22?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),h=!0):e.apResponse.addresses.some(p=>p.fingerprint)||L("FINGERPRINT")||(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),h=!0),h&&this.resetSignal()}this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const s=Date.now();let a=cT.get(e.cname);if(a||(a=new Map,cT.set(e.cname,a)),this._isProactiveJoin=!0,a.has(e.uid)){const h=new B(O.UID_CONFLICT);throw Te.joinGateway(e.sid,{lts:s,succ:!1,ec:h.message,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:this.signal instanceof Co?"1":"0"}),this._isProactiveJoin=!1,h}a.set(e.uid,!0),this.joinInfo=e,this.key=t;let c=0;this.joinGatewayStartTime=s;const l=e.proxyServer;try{let h;if(v.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof Co?"datachannel":"websocket"," join uid ").concat(c)),this.signal instanceof Co)h=await this.signal.init(e.apResponse.addresses,i);else{const p=e.gatewayAddrs.map(f=>{let{address:_}=f;const[g,T]=_.split(":"),w={host:g,port:T};return e.proxyServer&&(w.proxy=e.proxyServer),w});h=await this.signal.init(p,i)}c=h.uid,v.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof Co?"datachannel":"websocket"," join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){throw h&&h.code===O.INIT_WEBSOCKET_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join failed"),h.toString()),h):h&&h.code===O.INIT_DATACHANNEL_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join datachannel failed"),h.toString()),this.resetSignal(),h):(v.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),Te.joinGateway(e.sid,{lts:s,succ:!1,ec:h.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:this.signal instanceof Co?"1":"0"}),this._isProactiveJoin=!1,a.delete(e.uid),this.signal.close(),h)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),v.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{v.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Ut.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Ut.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Ut.NETWORK_QUALITY,{uplinkNetworkQuality:yN(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:yN(this._statsCollector.trafficStats.B_dnq)}):this.emit(Ut.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){t!==Ye.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==We.CONNECTED||await function(i,s){return s===1/0?i:W.race([i,AH(s)])}(this.signal.request(ve.LEAVE,void 0,!0),3e3)}catch(i){v.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(t),t!==Ye.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:L("PUB_EXTEND"),twcc:!!L("PUBLISH_TWCC"),rtx:!!L("USE_PUB_RTX")};try{return(await this.signal.request(ve.PUBLISH,s,!0))._message}catch(a){if(i&&a.data&&a.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw a}}async publishDataChannel(e,t,i){var s;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:(s=t.maxRetransmits)!==null&&s!==void 0?s:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(ve.PUBLISH_DATASTREAM,a,!0)}catch(c){if(i&&c.data&&c.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw c}}async unpublish(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ve.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(i){v.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await W.all(e.map(t=>this.signal.request(ve.UNPUBLISH_DATASTREAM,{channel_id:t},!0)))}catch(t){v.warning("unpublish datachannels warning: ",t)}}async presubscribe(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const s={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!L("SUBSCRIBE_TWCC"),rtx:!!L("USE_SUB_RTX")||void 0,extend:L("SUB_EXTEND"),svc:Array.isArray(L("SVC"))&&L("SVC").length!==0?L("SVC"):void 0};try{return await this.signal.request(ve.PRE_SUBSCRIBE,s,!0)}catch(a){if(i&&a.data&&a.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),a.toString()),this.presubscribe(e,t,!1);throw a}}async subscribe(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const s={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!L("SUBSCRIBE_TWCC"),rtx:!!L("USE_SUB_RTX"),extend:L("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(L("SVC"))&&L("SVC").length!==0?L("SVC"):void 0};try{return(await this.signal.request(ve.SUBSCRIBE,s,!0))._message}catch(a){if(i&&a.data&&a.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw a}}async subscribeDataChannel(e,t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const s={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(ve.SUBSCRIBE_DATASTREAM,s,!0)}catch(a){if(i&&a.data&&a.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),a.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw a}}async subscribeAll(e,t){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!L("USE_SUB_RTX")};try{return await this.signal.request(ve.SUBSCRIBE_STREAMS,i,!0)}catch(s){if(t&&s.data&&s.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw s}}async setVideoProfile(e){const t=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let s=i.frameRate,a=i.width,c=i.height,l=!0;return typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(l=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,s||(l=!1)),l?{stream_type:0,width:a,height:c,fps:s,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(t)return this.signal.request(ve.SET_VIDEO_PROFILE,t);v.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(ve.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(i){v.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await W.all(e.map(i=>this.signal.request(ve.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:t},!0)))}catch(i){v.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(ve.UNSUBSCRIBE_STREAMS,e,!0)}catch(t){v.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),t)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:i,rtpCapabilities:s}=e;return{gatewayEstablishParams:await this.signal.request(ve.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:i,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ve.GATEWAY_INFO)}async renewToken(e){await this.signal.request(ve.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),this.state!=="CONNECTED")return void(this.role=e);let i,s=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,s=1):s=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:s=0,await this.signal.request(ve.SET_CLIENT_ROLE,{role:e,level:s,delay:i,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(ve.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(ve.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(ve.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(ve.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(ve.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,i){if(this.signal instanceof IN)return this.signal.sendExtensionMessage(e,t,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Hr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ve.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=cT.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(t){let i;return i=t.startsWith("dc")?t.match(/(dc\:\/\/)?([^:]+):(\d+)/):t.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:di.username,password:di.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Hr(Hr({},di),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(ve.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(t=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(s=>s.peer_uid===t.peer_uid);i&&i.B_st!==t.B_st&&_f(()=>{this.emit(Ut.STREAM_TYPE_CHANGE,t.peer_uid,t.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new B(O.UNEXPECTED_ERROR,"can not generate join message, no join info");const t=Object.assign({},this.joinInfo.apResponse);let i=L("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);const s=Hr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Tr,browser:navigator.userAgent,process_id:L("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:L("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:L("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:L("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof L("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?L("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof L("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?L("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof L("ENABLE_USER_LICENSE_CHECK")=="boolean"?L("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:L("USE_PUB_RTX")===!0||L("USE_SUB_RTX")===!0||void 0,disableFEC:L("DISABLE_FEC"),enableNTPReport:!!L("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!L("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof L("ENABLE_DATASTREAM_2")=="boolean"?L("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!L("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof L("USE_XR")=="boolean"?L("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,L("ENCRYPT_AES")?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),this.joinInfo.defaultVideoStream!==void 0&&(s.default_video_stream=this.joinInfo.defaultVideoStream),s}getRejoinMessage(){if(!this.joinInfo)throw new B(O.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(pe.WS_RECONNECT_WAITTING_FINISH,e=>{var t;fe(t=["tryNext","recover"]).call(t,e)&&this.joinInfo&&Te.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(pe.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(pe.WS_RECONNECTING,e=>{this.joinInfo&&Te.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||gn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Te.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(pe.WS_CLOSED,e=>{let t;switch(e){case Ye.LEAVE:t=gn.LEAVE;break;case Ye.UID_BANNED:case Ye.IP_BANNED:case Ye.CHANNEL_BANNED:case Ye.SERVER_ERROR:t=gn.SERVER_ERROR;break;case Ye.FALLBACK:t=gn.FALLBACK;break;case Ye.LICENSE_MISSING:case Ye.LICENSE_EXPIRED:case Ye.LICENSE_MINUTES_EXCEEDED:case Ye.LICENSE_PERIOD_INVALID:case Ye.LICENSE_MULTIPLE_SDK_SERVICE:case Ye.LICENSE_ILLEGAL:case Ye.TOKEN_EXPIRE:t=e;break;default:t=gn.NETWORK_ERROR}v.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+gn.NETWORK_ERROR)),this.joinInfo&&Te.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Ye.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==Ye.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(pe.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(v.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Te.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Co?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void v.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));ft("EVENT_REPORT_DOMAIN",e[1]),ft("EVENT_REPORT_BACKUP_DOMAIN",e[1]),ft("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}),this.signal.on(De.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(pe.REQUEST_RECOVER,(e,t,i)=>{if(!this.joinInfo)return i(new B(O.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Xt(this,Ut.REQUEST_NEW_GATEWAY_LIST).then(t).catch(i)}),this.signal.on(pe.REQUEST_JOIN_INFO,async e=>{var t;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const{iceParameters:i,dtlsParameters:s,rtpCapabilities:a}=await Xt(this,Ut.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(t=this.joinInfo)===null||t===void 0?void 0:t.turnServer});e(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:s,rtpCapabilities:a,version:"2"}}))}),this.signal.on(pe.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(pe.REPORT_JOIN_GATEWAY,(e,t)=>{this.joinInfo&&(Te.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:e,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Co?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(pe.IS_P2P_DISCONNECTED,e=>{e(gc(this,Ut.IS_P2P_DISCONNECTED))}),this.signal.on(pe.DISCONNECT_P2P,()=>{this.emit(Ut.DISCONNECT_P2P)}),this.signal.on(pe.NEED_RENEW_SESSION,()=>{this.emit(Ut.NEED_RENEW_SESSION)}),this.signal.on(pe.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(pe.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(pe.JOIN_RESPONSE,e=>{const t=this.getCurrentGatewayAddress();this.emit(Ut.JOIN_RESPONSE,e,t)}),this.signal.on(pe.DATACHANNEL_PRECONNECT,async(e,t,i)=>{this.updateTurnConfigFromSignal();const s=this.getCurrentGatewayAddress();return Xt(this,Ut.DATACHANNEL_PRECONNECT,e,s).then(t).catch(i)}),this.signal.on(pe.DATACHANNEL_CONNECTING,async e=>{const{iceParameters:t,dtlsParameters:i,rtpCapabilities:s}=await Xt(this,Ut.REQUEST_DC_CONNECTION_PARAMS);e(this.getJoinMessage({ortc:{iceParameters:t,dtlsParameters:i,rtpCapabilities:s,version:"2"}}))}),this.signal.on(pe.DATACHANNEL_FAILBACK,()=>{v.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Ut.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(ve.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(ve.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(i){throw v.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(ve.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(ve.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(i){throw v.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){const t={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(ve.UNSUBSCRIBE_STREAMS,t,!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,t){const i={action:e.find(s=>s.stream_type===it.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(ve.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),s),s}}async unmuteLocal(e,t){const i={action:e.find(s=>s.stream_type===it.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(ve.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),s),s}}async muteRemote(e,t){const i={action:e===Ee.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(ve.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),s),s}}async unmuteRemote(e,t){const i={action:e===Ee.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(ve.CONTROL,i,!0,!0)}catch(s){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),s),s}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(ve.RESTART_ICE,t,!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,gn.P2P_FAILED)}getCurrentGatewayAddress(){var e;if(!L("GATEWAY_WSS_ADDRESS"))return(e=this.joinInfo)!==null&&e!==void 0&&e.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(ve.SET_PARAMETER,{enablePublishAudioFilter:e})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Ye.FALLBACK)),this.store.useDataChannel=!1,this.signal=new mN(Hr(Hr({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Ut.RESET_SIGNAL,kf.websocket)}}let Vf=0,dT=0;function Io(n,e,t,i){return new W((s,a)=>{e.timeout=e.timeout||L("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!t?(e.data=JSON.stringify(e.data),Vf+=js(e.data)):t&&(e.data.size?Vf+=e.data.size:e.data instanceof FormData?Vf+=rb(e.data):Vf+=js(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=n,vi.request(e).then(c=>{typeof c.data=="string"?dT+=js(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?dT+=c.data.byteLength:dT+=js(JSON.stringify(c.data)),i&&s({data:c.data,headers:c.headers}),s(c.data)}).catch(c=>{vi.isCancel(c)?a(new B(O.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new B(O.NETWORK_TIMEOUT,c.message)):c.response?a(new B(O.NETWORK_RESPONSE_ERROR,c.response.status)):a(new B(O.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var n;function e(ee){var se=0;return function(){return se<ee.length?{done:!1,value:ee[se++]}:{done:!0}}}var t=typeof Object.defineProperties=="function"?Object.defineProperty:function(ee,se,ge){return ee==Array.prototype||ee==Object.prototype||(ee[se]=ge.value),ee},i,s=function(ee){ee=[typeof globalThis=="object"&&globalThis,ee,typeof window=="object"&&window,typeof self=="object"&&self,typeof u=="object"&&u];for(var se=0;se<ee.length;++se){var ge=ee[se];if(ge&&ge.Math==Math)return ge}throw Error("Cannot find global object")}(this);function a(ee,se){if(se)e:{var ge=s;ee=ee.split(".");for(var ke=0;ke<ee.length-1;ke++){var tt=ee[ke];if(!(tt in ge))break e;ge=ge[tt]}(se=se(ke=ge[ee=ee[ee.length-1]]))!=ke&&se!=null&&t(ge,ee,{configurable:!0,writable:!0,value:se})}}function c(ee){return(ee={next:ee})[Symbol.iterator]=function(){return this},ee}function l(ee){var se=typeof Symbol<"u"&&Symbol.iterator&&ee[Symbol.iterator];return se?se.call(ee):{next:e(ee)}}if(a("Symbol",function(ee){function se(tt,de){this.A=tt,t(this,"description",{configurable:!0,writable:!0,value:de})}if(ee)return ee;se.prototype.toString=function(){return this.A};var ge="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ke=0;return function tt(de){if(this instanceof tt)throw new TypeError("Symbol is not a constructor");return new se(ge+(de||"")+"_"+ke++,de)}}),a("Symbol.iterator",function(ee){if(ee)return ee;ee=Symbol("Symbol.iterator");for(var se="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ge=0;ge<se.length;ge++){var ke=s[se[ge]];typeof ke=="function"&&typeof ke.prototype[ee]!="function"&&t(ke.prototype,ee,{configurable:!0,writable:!0,value:function(){return c(e(this))}})}return ee}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var h;e:{var p={};try{p.__proto__={a:!0},h=p.a;break e}catch{}h=!1}i=h?function(ee,se){if(ee.__proto__=se,ee.__proto__!==se)throw new TypeError(ee+" is not extensible");return ee}:null}var f=i;function _(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function g(ee){if(ee.m)throw new TypeError("Generator is already running");ee.m=!0}function T(ee,se){return ee.h=3,{value:se}}function w(ee){this.g=new _,this.G=ee}function R(ee,se,ge,ke){try{var tt=se.call(ee.g.j,ge);if(!(tt instanceof Object))throw new TypeError("Iterator result "+tt+" is not an object");if(!tt.done)return ee.g.m=!1,tt;var de=tt.value}catch(C){return ee.g.j=null,ee.g.s(C),I(ee)}return ee.g.j=null,ke.call(ee.g,de),I(ee)}function I(ee){for(;ee.g.h;)try{var se=ee.G(ee.g);if(se)return ee.g.m=!1,{value:se.value,done:!1}}catch(ge){ee.g.v=void 0,ee.g.s(ge)}if(ee.g.m=!1,ee.g.l){if(se=ee.g.l,ee.g.l=null,se.F)throw se.D;return{value:se.return,done:!0}}return{value:void 0,done:!0}}function N(ee){this.next=function(se){return ee.o(se)},this.throw=function(se){return ee.s(se)},this.return=function(se){return function(ge,ke){g(ge.g);var tt=ge.g.j;return tt?R(ge,"return"in tt?tt.return:function(de){return{value:de,done:!0}},ke,ge.g.return):(ge.g.return(ke),I(ge))}(ee,se)},this[Symbol.iterator]=function(){return this}}function D(ee,se){return se=new N(new w(se)),f&&ee.prototype&&f(se,ee.prototype),se}if(_.prototype.o=function(ee){this.v=ee},_.prototype.s=function(ee){this.l={D:ee,F:!0},this.h=this.C||this.u},_.prototype.return=function(ee){this.l={return:ee},this.h=this.u},w.prototype.o=function(ee){return g(this.g),this.g.j?R(this,this.g.j.next,ee,this.g.o):(this.g.o(ee),I(this))},w.prototype.s=function(ee){return g(this.g),this.g.j?R(this,this.g.j.throw,ee,this.g.o):(this.g.s(ee),I(this))},a("Array.prototype.entries",function(ee){return ee||function(){return function(se,ge){se instanceof String&&(se+="");var ke=0,tt=!1,de={next:function(){if(!tt&&ke<se.length){var C=ke++;return{value:ge(C,se[C]),done:!1}}return tt=!0,{done:!0,value:void 0}}};return de[Symbol.iterator]=function(){return de},de}(this,function(se,ge){return[se,ge]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var V=function(ee,se){for(var ge=0;ge<ee.length;ge++)se(ee[ge])},G=function(ee){return ee.replace(/\r?\n|\r/g,`\r
`)},F=function(ee,se,ge){return se instanceof Blob?(ge=ge!==void 0?ge+"":typeof se.name=="string"?se.name:"blob",se.name===ge&&Object.prototype.toString.call(se)!=="[object Blob]"||(se=new File([se],ge)),[String(ee),se]):[String(ee),String(se)]},j=function(ee,se){if(ee.length<se)throw new TypeError(se+" argument required, but only "+ee.length+" present.")},z=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Y=z.FormData,re=z.XMLHttpRequest&&z.XMLHttpRequest.prototype.send,ae=z.Request&&z.fetch,Ue=z.navigator&&z.navigator.sendBeacon,ze=z.Element&&z.Element.prototype,vt=z.Symbol&&Symbol.toStringTag;vt&&(Blob.prototype[vt]||(Blob.prototype[vt]="Blob"),"File"in z&&!File.prototype[vt]&&(File.prototype[vt]="File"));try{new File([],"")}catch{z.File=function(se,ge,ke){return se=new Blob(se,ke||{}),Object.defineProperties(se,{name:{value:ge},lastModified:{value:+(ke&&ke.lastModified!==void 0?new Date(ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),vt&&Object.defineProperty(se,vt,{value:"File"}),se}}var nn=function(ee){return ee.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},It=function(ee){this.i=[];var se=this;ee&&V(ee.elements,function(ge){if(ge.name&&!ge.disabled&&ge.type!=="submit"&&ge.type!=="button"&&!ge.matches("form fieldset[disabled] *"))if(ge.type==="file"){var ke=ge.files&&ge.files.length?ge.files:[new File([],"",{type:"application/octet-stream"})];V(ke,function(tt){se.append(ge.name,tt)})}else ge.type==="select-multiple"||ge.type==="select-one"?V(ge.options,function(tt){!tt.disabled&&tt.selected&&se.append(ge.name,tt.value)}):ge.type==="checkbox"||ge.type==="radio"?ge.checked&&se.append(ge.name,ge.value):(ke=ge.type==="textarea"?G(ge.value):ge.value,se.append(ge.name,ke))})};if((n=It.prototype).append=function(ee,se,ge){j(arguments,2),this.i.push(F(ee,se,ge))},n.delete=function(ee){j(arguments,1);var se=[];ee=String(ee),V(this.i,function(ge){ge[0]!==ee&&se.push(ge)}),this.i=se},n.entries=function ee(){var se,ge=this;return D(ee,function(ke){if(ke.h==1&&(se=0),ke.h!=3)return se<ge.i.length?ke=T(ke,ge.i[se]):(ke.h=0,ke=void 0),ke;se++,ke.h=2})},n.forEach=function(ee,se){j(arguments,1);for(var ge=l(this),ke=ge.next();!ke.done;ke=ge.next()){var tt=l(ke.value);ke=tt.next().value,tt=tt.next().value,ee.call(se,tt,ke,this)}},n.get=function(ee){j(arguments,1);var se=this.i;ee=String(ee);for(var ge=0;ge<se.length;ge++)if(se[ge][0]===ee)return se[ge][1];return null},n.getAll=function(ee){j(arguments,1);var se=[];return ee=String(ee),V(this.i,function(ge){ge[0]===ee&&se.push(ge[1])}),se},n.has=function(ee){j(arguments,1),ee=String(ee);for(var se=0;se<this.i.length;se++)if(this.i[se][0]===ee)return!0;return!1},n.keys=function ee(){var se,ge,ke,tt,de=this;return D(ee,function(C){if(C.h==1&&(se=l(de),ge=se.next()),C.h!=3)return ge.done?void(C.h=0):(ke=ge.value,tt=l(ke),T(C,tt.next().value));ge=se.next(),C.h=2})},n.set=function(ee,se,ge){j(arguments,2),ee=String(ee);var ke=[],tt=F(ee,se,ge),de=!0;V(this.i,function(C){C[0]===ee?de&&(de=!ke.push(tt)):ke.push(C)}),de&&ke.push(tt),this.i=ke},n.values=function ee(){var se,ge,ke,tt,de=this;return D(ee,function(C){if(C.h==1&&(se=l(de),ge=se.next()),C.h!=3)return ge.done?void(C.h=0):(ke=ge.value,(tt=l(ke)).next(),T(C,tt.next().value));ge=se.next(),C.h=2})},It.prototype._asNative=function(){for(var ee=new Y,se=l(this),ge=se.next();!ge.done;ge=se.next()){var ke=l(ge.value);ge=ke.next().value,ke=ke.next().value,ee.append(ge,ke)}return ee},It.prototype._blob=function(){var ee="----formdata-polyfill-"+Math.random(),se=[],ge="--"+ee+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ke,tt){return typeof ke=="string"?se.push(ge+nn(G(tt))+`"\r
\r
`+G(ke)+`\r
`):se.push(ge+nn(G(tt))+'"; filename="'+nn(ke.name)+`"\r
Content-Type: `+(ke.type||"application/octet-stream")+`\r
\r
`,ke,`\r
`)}),se.push("--"+ee+"--"),new Blob(se,{type:"multipart/form-data; boundary="+ee})},It.prototype[Symbol.iterator]=function(){return this.entries()},It.prototype.toString=function(){return"[object FormData]"},ze&&!ze.matches&&(ze.matches=ze.matchesSelector||ze.mozMatchesSelector||ze.msMatchesSelector||ze.oMatchesSelector||ze.webkitMatchesSelector||function(ee){for(var se=(ee=(this.document||this.ownerDocument).querySelectorAll(ee)).length;0<=--se&&ee.item(se)!==this;);return-1<se}),vt&&(It.prototype[vt]="FormData"),re){var Gi=z.XMLHttpRequest.prototype.setRequestHeader;z.XMLHttpRequest.prototype.setRequestHeader=function(ee,se){Gi.call(this,ee,se),ee.toLowerCase()==="content-type"&&(this.B=!0)},z.XMLHttpRequest.prototype.send=function(ee){ee instanceof It?(ee=ee._blob(),this.B||this.setRequestHeader("Content-Type",ee.type),re.call(this,ee)):re.call(this,ee)}}ae&&(z.fetch=function(ee,se){return se&&se.body&&se.body instanceof It&&(se.body=se.body._blob()),ae.call(this,ee,se)}),Ue&&(z.navigator.sendBeacon=function(ee,se){return se instanceof It&&(se=se._asNative()),Ue.call(this,ee,se)}),z.FormData=It}})();const Ff=()=>{const n=L("AREAS");return n.length===0&&n.push(Qe.GLOBAL),To(n).call(n,(e,t,i)=>{const s=AN(t);return s?i===0?s:"".concat(e,",").concat(s):e},"")},AN=n=>n===Qe.OVERSEA?"".concat(An.ASIA,",").concat(An.EUROPE,",").concat(An.AFRICA,",").concat(An.NORTH_AMERICA,",").concat(An.SOUTH_AMERICA,",").concat(An.OCEANIA):An[n],F6=n=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return n.map(t=>{const i=Lf[t],s=Object.keys(i);s&&s.map(a=>{a!=="CODE"&&(e[a]=e[a].concat(i[a]))})}),e},Bf={GLOBAL:{ASIA:[Qe.CHINA,Qe.JAPAN,Qe.INDIA,Qe.KOREA,Qe.HKMC],EUROPE:[],NORTH_AMERICA:[Qe.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},jf=Object.keys(Bf[Qe.GLOBAL]),lT=[Qe.CHINA,Qe.NORTH_AMERICA,Qe.EUROPE,Qe.ASIA,Qe.JAPAN,Qe.INDIA,Qe.OCEANIA,Qe.SOUTH_AMERICA,Qe.AFRICA,Qe.KOREA,Qe.HKMC,Qe.US],B6=function(n,e){let t=[];if(fe(n).call(n,Qe.GLOBAL)){const a=[Qe.GLOBAL,Qe.OVERSEA],c=Object.keys(Lf);if(e===Qe.GLOBAL)throw new B(O.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===Qe.CHINA)t=[Qe.OVERSEA];else if(s=e,fe(jf).call(jf,s)){const l=(i=e,Bf[Qe.GLOBAL][i]||[]),h=[...a,e,...l];t=c.filter(p=>!fe(h).call(h,p))}else if(function(l){let h=!1;return jf.forEach(p=>{var f;fe(f=Bf[Qe.GLOBAL][p]).call(f,l)&&(h=!0)}),h}(e)){const l=function(p){let f;return jf.forEach(_=>{var g;fe(g=Bf[Qe.GLOBAL][_]).call(g,p)&&(f=_)}),f}(e),h=[...a,l,e];t=c.filter(p=>!fe(h).call(h,p))}else t=n;t=function(l){const h=[];return lT.forEach(p=>{fe(l).call(l,p)&&h.push(p)}),h.concat(l.filter(p=>!fe(lT).call(lT,p)))}(t)}else t=n;var i,s;return t};function ON(n){var e,t;if(!n&&fe(e=L("AREAS")).call(e,Qe.EXTENSIONS))return v.debug("update area from ap : reset"),void uT(o6,!0);if(!fe(t=L("AREAS")).call(t,Qe.GLOBAL)||!n)return;let i=Lf.EXTENSIONS;i&&(i={CODE:AN(Qe.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(n,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(n,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(n,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(n,".agora.io"),"cds-ap-web-2-".concat(n,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(n,".agora.io"),"sua-ap-web-2-".concat(n,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(n,".agora.io"),"uap-ap-web-2-".concat(n,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(n,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(n,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(n,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(n,".agora.io")]},v.debug("update area from ap success: ".concat(n,",config is "),i),ft("AREAS",[Qe.EXTENSIONS],!0),Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?ft(s,i[s][0]):ft(s,i[s])}))}function uT(n){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const t=Te.reportApiInvoke(null,{name:Jt.SET_AREA,options:n,tag:Pt.TRACER});try{let i=[];if(typeof n=="string"&&(i=[n]),Array.isArray(n)&&(n.forEach(a=>{if(!fe(rN).call(rN,a))throw new B(O.INVALID_PARAMS,"invalid area code")}),i=n),Object.prototype.toString.call(n)==="[object Object]"){const{areaCode:a,excludedArea:c}=n;if(!a)throw new B(O.INVALID_PARAMS,"area code is needed");let l=a;typeof a=="string"&&(l=[a]),i=c?B6(l,c):l}if(!e){if(oa.AREAS){const a=new B(O.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return t.onError(a),void v.warning("setArea is prohibited because of config-distribute")}if(fe(i).call(i,Qe.GLOBAL)&&L("AREAS")===Qe.EXTENSIONS){const a=new B(O.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return t.onError(a),void v.warning("setArea is prohibited because of ap extensions")}}ft("AREAS",i,e);const s=F6(i);Object.keys(s).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?ft(a,s[a][0]):ft(a,s[a])}),v.debug("set area success:",i.join(","))}catch(i){throw t.onError(i),i}t.onSuccess()}function bN(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function hT(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bN(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):bN(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let pT=1;function j6(n,e,t,i,s){pT+=1;const a={sid:t.sid,command:"convergeAllocateEdge",uid:"666",appId:t.appId,ts:Math.floor(Date.now()/1e3),seq:pT,requestId:pT,version:Tr,cname:t.cname},c={service_name:e,json_body:JSON.stringify(a)};let l,h,p=n[0];return _s(async()=>{l=Date.now();const f=await Io(p,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(h=Date.now()-l,f.code!==0){const T=new B(O.UNEXPECTED_RESPONSE,"live streaming ap error, code"+f.code,{retry:!0,responseTime:h});throw v.error(T.toString()),T}const _=JSON.parse(f.json_body);if(_.code!==200){const T=new B(O.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(_.code,", reason: ").concat(_.reason),{code:_.code,responseTime:h});throw v.error(T.toString()),T}if(!_.servers||_.servers.length===0){const T=new B(O.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_.code,responseTime:h});throw v.error(T.toString()),T}const g=function(T,w){return{addressList:T.servers.map(R=>"wss://".concat(R.address.replace(/\./g,"-"),".").concat(L("WORKER_DOMAIN"),":").concat(R.wss,"?serviceName=").concat(encodeURIComponent(w))),workerToken:T.workerToken,vid:T.vid}}(_,e);return L("LIVE_STREAMING_ADDRESS")&&(g.addressList=L("LIVE_STREAMING_ADDRESS")instanceof Array?L("LIVE_STREAMING_ADDRESS"):[L("LIVE_STREAMING_ADDRESS")]),hT(hT({},g),{},{responseTime:h})},(f,_)=>(Te.apworkerEvent(t.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(f.addressList),firstSuccess:_===0,responseTime:h,serverIp:n[_%n.length]}),!1),(f,_)=>(Te.apworkerEvent(t.sid,{success:!1,sc:f.data&&f.data.code||200,serviceName:e,responseTime:h,serverIp:n[_%n.length]}),!!(f.code!==O.OPERATION_ABORTED&&f.code!==O.UNEXPECTED_RESPONSE||f.data&&f.data.retry)&&(p=n[(_+1)%n.length],!0)),s)}let fT=1;function NN(n,e,t,i){let{url:s,areaCode:a}=n;const c=Date.now();let l;const[h,p]=LN(e,a,[vn.CHOOSE_SERVER]);let f=Qt.networkState;return _s(async()=>{f&&Qt.networkState===ii.OFFLINE&&Qt.onlineWaiter&&await W.race([Qt.onlineWaiter,Sn(i&&i.maxRetryTimeout||$t.maxRetryTimeout)]),f=Qt.networkState;const{data:_,headers:g}=await Io(s,{data:h,cancelToken:t,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=g.http3==="1"?1:-1,Te.reportResourceTiming(s,e.sid),DN(_,s,e,c,[vn.CHOOSE_SERVER],l);const T=oT(_,vn.CHOOSE_SERVER);return kN(T),TN(T,s)},_=>(_&&Te.joinChooseServer(e.sid,{lts:c,succ:!0,csAddr:s,opid:p,serverList:_.gatewayAddrs.map(g=>g.address),ec:null,cid:_.cid.toString(),uid:_.uid.toString(),csIp:_.csIp,unilbsServerIds:[vn.CHOOSE_SERVER].toString(),isHttp3:l}),!1),_=>_.code!==O.OPERATION_ABORTED&&(_.code===O.CAN_NOT_GET_GATEWAY_SERVER?_.data.retry:(Te.joinChooseServer(e.sid,{lts:c,succ:!1,csAddr:s,serverList:null,opid:p,ec:_.code,csIp:_.data&&_.data.csIp,unilbsServerIds:[vn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:f}),isHttp3:l}),v.warning("[".concat(e.clientId,"] Choose server network error, retry"),_),!0)),i)}function PN(n,e,t,i){let s,{url:a,areaCode:c,serviceIds:l}=n;const h=Date.now(),[p,f]=LN(e,c,l);let _;return _s(async()=>{_&&Qt.networkState===ii.OFFLINE&&Qt.onlineWaiter&&await W.race([Qt.onlineWaiter,Sn(i&&i.maxRetryTimeout||$t.maxRetryTimeout)]),_=Qt.networkState;const{data:g,headers:T}=await Io(a,{data:p,cancelToken:t,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=T.http3==="1"?1:-1,Te.reportResourceTiming(a,e.sid),DN(g,a,e,h,l,s);const w=oT(g,vn.CHOOSE_SERVER),R=oT(g,e.cloudProxyServer==="proxy5"?vn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?vn.CLOUD_PROXY:vn.CLOUD_PROXY_FALLBACK);return kN(w),{gatewayInfo:TN(w,a),proxyInfo:R,url:a}},g=>(g.gatewayInfo&&Te.joinChooseServer(e.sid,{lts:h,succ:!0,csAddr:a,serverList:g.gatewayInfo.gatewayAddrs.map(T=>T.address),ec:null,opid:f,cid:g.gatewayInfo.cid.toString(),uid:g.gatewayInfo.uid.toString(),csIp:g.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:s}),g.proxyInfo&&Te.joinWebProxyAP(e.sid,{lts:h,sucess:1,apServerAddr:a,turnServerAddrList:g.proxyInfo.addresses.map(T=>T.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:l.toString()}),!1),g=>g.code!==O.OPERATION_ABORTED&&(g.code===O.CAN_NOT_GET_GATEWAY_SERVER?g.data.retry:(Te.joinWebProxyAP(e.sid,{lts:h,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:g.code,eventType:e.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:_})}),v.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),g),!0)),i)}const DN=(n,e,t,i,s,a)=>{const c=[],l=h=>{h.flag===4096?Te.joinChooseServer(t.sid,{lts:i,succ:!1,csAddr:e,opid:n.opid,serverList:null,ec:h.error.message,csIp:h.error.data&&h.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:a}):h.flag!==1048576&&h.flag!==4194304&&h.flag!==4194310||Te.joinWebProxyAP(t.sid,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:h.error.code,eventType:t.cloudProxyServer,unilbsServerIds:s.toString()})};if(n.response_body.forEach(h=>{const p=h.buffer.code;if(h.uri===23&&p===0&&!h.buffer.edges_services)if(h.buffer.flag===4194310)v.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),h.buffer.edges_services=[];else{const f={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:n.detail[502]}),flag:h.buffer.flag};c.push(f),l(f)}if(p!==0){const f=Uf(p),_={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,f.desc,{desc:f.desc,retry:f.retry,csIp:n.detail[502]}),flag:h.buffer.flag};h.buffer.flag===4194310?v.warning(_.error.toString()):c.push(_),l(_)}}),c.length)throw v.warning("[".concat(t.clientId,"] multi unilbs ").concat(e," failed, ").concat(c.map(h=>"flag: ".concat(h.flag,", message: ").concat(h.error.message,", retry: ").concat(h.error.data.retry)).join(" | "))),new B(O.CAN_NOT_GET_GATEWAY_SERVER,c.map(h=>"flag: ".concat(h.flag,", message: ").concat(h.error.message)).join(" | "),{retry:!!c.find(h=>h.error.data.retry),csIp:n.detail[502],desc:[...new Set(c.map(h=>{var p;return h==null||(p=h.error)===null||p===void 0||(p=p.data)===null||p===void 0?void 0:p.desc}).filter(h=>!!h))]})},kN=n=>{var e,t,i,s;if(n.addresses&&n.addresses.length===0&&n.code===0)throw new B(O.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:n.detail&&n.detail[502]});if(L("AP_AREA")&&((i=n.detail)!==null&&i!==void 0&&i[23]&&typeof((s=n.detail)===null||s===void 0?void 0:s[23])=="string"?ON(n.detail[23].toLowerCase()):ON()),(e=n.detail)!==null&&e!==void 0&&e[19]&&typeof((t=n.detail)===null||t===void 0?void 0:t[19])=="string"){const c=n.detail[19],l=c==null?void 0:c.split(";");for(let h=0;h<l.length;h++){var a;const p=sT(a=l[h]).call(a);n.addresses[h]&&l&&(n.addresses[h].fingerprint=p)}}if(L("GATEWAY_ADDRESS")&&L("GATEWAY_ADDRESS").length>0){v.debug("assign gateway address to",L("GATEWAY_ADDRESS"));const c=L("GATEWAY_ADDRESS").map(l=>{var h,p;const f=(h=(p=n.addresses.find(_=>_.ip===l.ip&&_.port===l.port))===null||p===void 0?void 0:p.fingerprint)!==null&&h!==void 0?h:"";return{ip:l.ip,port:l.port,ticket:n.addresses[0]&&n.addresses[0].ticket,fingerprint:f}});n.addresses=c}},G6=(n,e)=>{if(n.response_body&&n.response_body.length){const t=n.response_body[0];if(t.buffer.code!==0){const i=Uf(t.buffer.code);throw new B(O.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return t.buffer.ticket}throw v.debug("update ticket request received ap response without response body:",e),new B(O.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},LN=(n,e,t)=>{const i=Math.floor(Math.random()*1e12),s={appid:n.appId,client_ts:Date.now(),opid:i,sid:n.sid,request_bodies:[{uri:22,buffer:{cname:n.cname,detail:hT({6:n.stringUid,11:e,12:L("USE_NEW_TOKEN")?"1":void 0,22:e},n.apRTM?{26:"RTM2"}:{}),key:n.token,service_ids:t,uid:n.uid||0}}]};s.request_bodies.forEach(c=>{n.multiIP&&n.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[n.multiIP.uni_lbs_ip],vos_ip:[n.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(s)),[a,i]},W6=(n,e)=>{const t=Math.floor(Math.random()*1e12),i={appid:n.appId,client_ts:Date.now(),opid:t,sid:n.sid,request_bodies:[{uri:28,buffer:{cname:n.cname,detail:{1:"",6:n.stringUid,12:"1"},token:n.token,service_ids:e,uid:n.uid||0,edges_services:n.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},s=new FormData;return s.append("request",JSON.stringify(i)),[s,t]};let Vd=0;function Fd(n){return W.all(n.map(e=>e.then(t=>{throw t},t=>t))).then(e=>{throw e},e=>e)}const Du=async n=>{let{fragementLength:e,referenceList:t,asyncMapHandler:i,allFailedhandler:s,promisesCollector:a}=n,c=0;const l=e;let h,p=0;const f=async()=>{const _=(()=>{const g=c*l,T=g+l;return t.slice(g,T).map(i)})();a&&a.push(..._);try{h=await Fd(_)}catch(g){if(p+=l,c++,!(p>=t.length))return void await f();s(g)}_.forEach(g=>g.cancel())};return await f(),h};async function mT(n,e,t,i){return{gatewayInfo:await async function(a,c,l,h){let p=null;const f=[],_=async()=>{const T=L("WEBCS_DOMAIN").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(I=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:Ff()})),w=h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(I=>I.url)}),R=await Du({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:I=>(v.debug("[".concat(a.clientId,"] Connect to choose_server:"),I.url),NN(I,a,c,l)),allFailedhandler:I=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},w),I[0]},promisesCollector:f});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},w),R},g=async()=>{if(await Sn(1e3),p!==null)return p;const T=L("WEBCS_DOMAIN_BACKUP_LIST").map(I=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:Ff()})),w=h.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(I=>I.url)}),R=await Du({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:I=>(v.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),I.url),NN(I,a,c,l)),allFailedhandler:I=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},w),I[0]},promisesCollector:f});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},w),R};try{return p=await Fd([_(),g()]),f.length&&f.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),p}catch(T){throw T[0]}}(n,e,t,i)}}async function MN(n,e,t,i,s){const a=n.cloudProxyServer;if(a==="disabled"){if(n.useLocalAccessPoint)return await mT(n,e,t,s);if(L("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:g,proxyInfo:T}=await xN(n,e,t,s);if(n.turnServer&&n.turnServer.mode!=="auto")return{gatewayInfo:g};const w=T.map(R=>({turnServerURL:R.address,tcpport:R.tcpport||di.tcpport,udpport:R.udpport||di.udpport,username:R.username||di.username,password:R.password||di.password,forceturn:!1,security:!0}));if(s.useP2P){var c;const R=(c=n.uid)!==null&&c!==void 0?c:g.uid,I="glb:".concat(R.toString()),N=await vS(I),D=T.map(V=>({turnServerURL:V.address,tcpport:V.tcpport||di.tcpport,udpport:V.udpport||di.udpport,username:I,password:N,forceturn:!1,security:!0}));w.push(...D)}return n.turnServer={mode:"manual",servers:w},{gatewayInfo:g}}return await mT(n,e,t,s)}const{proxyInfo:l,gatewayInfo:h}=await xN(n,e,t,s),p={gatewayInfo:h},f=l.map(g=>({turnServerURL:g.address,tcpport:a==="proxy3"?void 0:g.tcpport?g.tcpport:di.tcpport,udpport:a==="proxy4"?void 0:g.udpport?g.udpport:di.udpport,username:g.username||di.username,password:g.password||di.password,forceturn:a!=="proxy4",security:a==="proxy5"}));if(s.useP2P){var _;const g=(_=n.uid)!==null&&_!==void 0?_:h.uid,T="glb:".concat(g.toString()),w=await vS(T),R=l.map(I=>({turnServerURL:I.address,tcpport:a==="proxy3"?void 0:I.tcpport||di.tcpport,udpport:a==="proxy4"?void 0:I.udpport||di.udpport,username:T,password:w,forceturn:a!=="proxy4",security:a==="proxy5"}));f.push(...R)}return n.turnServer={mode:"manual",servers:f},v.debug("[".concat(n.clientId,"] set proxy server: ").concat(n.proxyServer,", mode: ").concat(a)),p}async function UN(n,e,t,i,s){const a=L("ACCOUNT_REGISTER").slice(0,L("AJAX_REQUEST_CONCURRENT"));let c=[];c=e.proxyServer?a.map(h=>"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v1")):a.map(h=>"https://".concat(h,"/api/v1"));const l=s==null?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const h=await async function(p,f,_,g,T){const w=Date.now(),R={sid:_.sid,opid:10,appid:_.appId,string_uid:f};let I=p[0];const N=await _s(()=>Io(I+"".concat(I.indexOf("?")===-1?"?":"&","action=stringuid"),{data:R,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(D,V)=>{if(D.code===0){if(D.uid<=0||D.uid>=Math.pow(2,32))throw v.error("Invalid Uint Uid ".concat(f," => ").concat(D.uid),D),Te.reqUserAccount(R.sid,{lts:w,success:!1,serverAddr:I,stringUid:R.string_uid,uid:D.uid,errorCode:O.INVALID_UINT_UID_FROM_STRING_UID,extend:R}),new B(O.INVALID_UINT_UID_FROM_STRING_UID);return Te.reqUserAccount(R.sid,{lts:w,success:!0,serverAddr:I,stringUid:R.string_uid,uid:D.uid,errorCode:null,extend:R}),!1}const G=Uf(D.code);return G.retry&&(I=p[(V+1)%p.length]),Te.reqUserAccount(R.sid,{lts:w,success:!1,serverAddr:I,stringUid:R.string_uid,uid:D.uid,errorCode:G.desc,extend:R}),G.retry},(D,V)=>D.code!==O.OPERATION_ABORTED&&(Te.reqUserAccount(R.sid,{lts:w,success:!1,serverAddr:I,stringUid:R.string_uid,uid:null,errorCode:D.code,extend:R}),I=p[(V+1)%p.length],!0),T);if(N.code!==0){const D=Uf(N.code);throw new B(O.UNEXPECTED_RESPONSE,D.desc)}return N}(c,n,e,t,i);return s==null||s.recordJoinChannelService({status:"success",endTs:Date.now()},l),h.uid}catch(h){throw s==null||s.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[h]},l),h}}async function H6(n,e,t){const i=L("CDS_AP").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(h=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(h+"/api/v1"):"https://".concat(h,"/api/v1?action=config")),s=i.map(h=>function(p,f,_,g){const T=Ze(),w={flag:64,cipher_method:0,features:{device:T.name,system:T.os,system_general:navigator.userAgent,vendor:f.appId,version:Tr,cname:f.cname,sid:f.sid,session_id:f.sid,detail:"",proxyServer:f.proxyServer}};return _s(()=>Io(p,{data:w,timeout:1e3,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,R=>R.code!==O.OPERATION_ABORTED,g)}(h,n,e,t));let a=null,c=null,l={};try{a=await Fd(s)}catch(h){if(h.code===O.OPERATION_ABORTED)throw h;c=h}if(s.forEach(h=>h.cancel()),Te.reportApiInvoke(n.sid,{name:Jt.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:a}}).onSuccess(),a&&a.test_tags)try{l=function(h){if(!h.test_tags)return{};const p=h.test_tags,f=Object.keys(p),_={};return f.forEach(g=>{var T;const w=sT(T=g.slice(4)).call(T),R=JSON.parse(p[g])[1];_[w]=R}),_}(a)}catch{}return l}async function xN(n,e,t,i){const s=L("PROXY_SERVER_TYPE3"),a=(T,w,R)=>{let I=R||s;return Array.isArray(I)&&(I=w%2==0?s[1]:s[0]),"https://".concat(I,"/ap/?url=").concat(T)};let c=null;const l=[],h=async()=>{const T=L("WEBCS_DOMAIN").slice(0,L("AJAX_REQUEST_CONCURRENT")).map((I,N)=>{let D;return D=n.cloudProxyServer==="disabled"&&n.proxyServer?a("".concat(I,"/api/v2/transpond/webrtc?v=2"),N,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):a("".concat(I,"/api/v2/transpond/webrtc?v=2"),N),{url:D,areaCode:Ff(),serviceIds:[vn.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?vn.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?vn.CLOUD_PROXY:vn.CLOUD_PROXY_FALLBACK]}}),w=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(I=>I.url)}),R=await Du({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:I=>(v.debug("[".concat(n.clientId,"] Connect to choose_server:"),I.url),PN(I,n,e,t)),allFailedhandler:I=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},w),I[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},w),R},p=async()=>{if(await Sn(1e3),c!==null)return c;const T=L("WEBCS_DOMAIN_BACKUP_LIST").map((I,N)=>{let D;return D=n.cloudProxyServer==="disabled"&&n.proxyServer?a("".concat(I,"/api/v2/transpond/webrtc?v=2"),N,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):a("".concat(I,"/api/v2/transpond/webrtc?v=2"),N),{url:D,areaCode:Ff(),serviceIds:[vn.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?vn.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?vn.CLOUD_PROXY:vn.CLOUD_PROXY_FALLBACK]}}),w=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(I=>I.url)}),R=await Du({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:I=>(v.debug("[".concat(n.clientId,"] Connect to backup choose_server:"),I.url),PN(I,n,e,t)),allFailedhandler:I=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},w),I[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},w),R};let f,_,g;try{({gatewayInfo:f,proxyInfo:_,url:g}=await Fd([h(),p()]))}catch(T){throw T[0]}if(l.length&&l.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),!f||!_)throw new B(O.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(n.apUrl=g,n.cloudProxyServer!=="disabled"&&Array.isArray(s)&&g){const T=/^https?:\/\/(.+?)(\/.*)?$/.exec(g)[1];fe(s).call(s,T)&&(n.proxyServer=T,v.setProxyServer(T),Te.setProxyServer(T))}return c={gatewayInfo:f,proxyInfo:await M6(_,f.uid)},c}async function VN(n,e,t,i){const s=L("UAP_AP").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(a=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap"));return await j6(s,n,e,t,i)}async function K6(n,e,t){const i=L("UAP_AP").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(a=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap")),s=i.map(a=>function(c,l,h,p){const f={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:Tr,cname:l.cname,uid:l.uid.toString(),requestId:fT,seq:fT};fT+=1;const _={service_name:"tele_channel",json_body:JSON.stringify(f)};return _s(async()=>{const g=await Io(c,{data:_,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(g.code!==0){const w=new B(O.UNEXPECTED_RESPONSE,"cross channel ap error, code"+g.code,{retry:!0});throw v.error(w.toString()),w}const T=JSON.parse(g.json_body);if(T.code!==200){const w=new B(O.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw v.error(w.toString()),w}if(!T.servers||T.servers.length===0){const w=new B(O.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw v.error(w.toString()),w}return{vid:T.vid,workerToken:T.workerToken,addressList:(L("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(w=>"wss://".concat(w.address.replace(/\./g,"-"),".").concat(L("WORKER_DOMAIN"),":").concat(w.wss))}},void 0,g=>!!(g.code!==O.OPERATION_ABORTED&&g.code!==O.UNEXPECTED_RESPONSE||g.data&&g.data.retry),p)}(a,n,e,t));try{const a=await Fd(s);return s.forEach(c=>c.cancel()),a}catch(a){throw a[0]}}async function z6(n,e,t){let i=null;const s=[],a=async c=>{const l=L(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(h=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(h,"/api/v2/transpond/webrtc?v=2"));return c&&(await Sn(1e3),i!==null)?i:await Du({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:h=>(v.debug("[".concat(n.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),h),function(p,f,_,g){const[T]=W6(f,[vn.CHOOSE_SERVER]);let w=Qt.networkState;return _s(async()=>{w&&Qt.networkState===ii.OFFLINE&&Qt.onlineWaiter&&await W.race([Qt.onlineWaiter,Sn(g&&g.maxRetryTimeout||$t.maxRetryTimeout)]),w=Qt.networkState;const R=await Io(p,{data:T,cancelToken:_,headers:{"Content-Type":"multipart/form-data;"}},!0);return G6(R,p)},()=>!1,R=>R.code!==O.OPERATION_ABORTED&&(R.code===O.UPDATE_TICKET_FAILED?R.data.retry:(v.warning("[".concat(f.clientId,"] update ticket network error, retry"),R),!0)),g)}(h,n,e,t)),allFailedhandler:h=>{throw h[0]},promisesCollector:s})};try{return i=await Fd([a(!1),a(!0)]),s.length&&s.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function FN(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function BN(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?FN(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):FN(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class Y6 extends At{get isSuccess(){return!!this.configs}constructor(){super(),S(this,"configs",void 0),S(this,"joinInfo",void 0),S(this,"cancelToken",void 0),S(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),S(this,"interval",void 0),S(this,"mutex",new Tn("config-distribute")),S(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),L("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},L("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Te.reportApiInvoke(null,{options:void 0,name:Jt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Pt.TRACER}).onSuccess(JSON.stringify(oa))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void v.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await H6(this.joinInfo,this.cancelToken,this.retryConfig),v.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(i){const s=new B(O.NETWORK_RESPONSE_ERROR,i);v.warning("[config-distribute] ".concat(s.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var t;(t=e)&&t.uplink&&t.id&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(bu.UPDATE_BITRATE_LIMIT,e):this.emit(bu.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&BN({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var t;const i=du(t=Object.keys(e).filter(a=>/^webrtc_ng_global_parameter/.test(a))).call(t);for(let a=0;a<i.length;a++)for(let c=i.length-1;c>a;c--){const l=i[c];if(typeof e[l].__priority=="number"){const h=e[l].__priority,p=i[c-1];if(typeof e[p].__priority=="number"){if(!(h>e[p].__priority))continue;{const f=l;i[c]=i[c-1],i[c-1]=f}}else{const f=l;i[c]=i[c-1],i[c-1]=f}}}const s={};i.forEach(a=>{const c=e[a],l=c.__expires;Object.keys(c).forEach(h=>{h==="__priority"||h==="__expires"||Object.prototype.hasOwnProperty.call(s,h)||(s[h]=BN({value:c[h]},l&&{expires:l}))})});try{(function(l){try{const h=Date.now();Object.keys(l).forEach(p=>{switch(p){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(ri,p)){const{value:f,expires:_}=l[p];if(_&&_<=h)return;oa[p]=f,ri[p]=f,v.debug("Update global parameters from config distribute",p,f)}}})}catch(h){v.error("Error update config immediately: ".concat(l),h.message)}})(s);const a=JSON.stringify(s),c=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",c),v.debug("Caching global parameters ".concat(a))}catch(a){v.error("Error caching global parameters:",a.message)}}}const Xn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function et(){return Xn}var fn;function Bd(n,e,t){return{sampleRate:n,stereo:e,bitrate:t}}function Xe(n,e,t,i,s){return{width:n,height:e,frameRate:t,bitrateMin:i,bitrateMax:s}}function Kr(n,e,t,i,s){return{width:{max:n},height:{max:e},frameRate:t,bitrateMin:i,bitrateMax:s}}function _T(n,e){return{numSpatialLayers:n,numTemporalLayers:e}}(function(n){n.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",n.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",n.IOS_INTERRUPTION_START="ios-interruption-start",n.IOS_INTERRUPTION_END="ios-interruption-end",n.STATE_CHANGE="state-change"})(fn||(fn={}));const q6={"90p":Xe(160,90),"90p_1":Xe(160,90),"120p":Xe(160,120,15,30,65),"120p_1":Xe(160,120,15,30,65),"120p_3":Xe(120,120,15,30,50),"120p_4":Xe(212,120),"180p":Xe(320,180,15,30,140),"180p_1":Xe(320,180,15,30,140),"180p_3":Xe(180,180,15,30,100),"180p_4":Xe(240,180,15,30,120),"240p":Xe(320,240,15,40,200),"240p_1":Xe(320,240,15,40,200),"240p_3":Xe(240,240,15,40,140),"240p_4":Xe(424,240,15,40,220),"360p":Xe(640,360,15,80,400),"360p_1":Xe(640,360,15,80,400),"360p_3":Xe(360,360,15,80,260),"360p_4":Xe(640,360,30,80,600),"360p_6":Xe(360,360,30,80,400),"360p_7":Xe(480,360,15,80,320),"360p_8":Xe(480,360,30,80,490),"360p_9":Xe(640,360,15,80,800),"360p_10":Xe(640,360,24,80,800),"360p_11":Xe(640,360,24,80,1e3),"480p":Xe(640,480,15,100,500),"480p_1":Xe(640,480,15,100,500),"480p_2":Xe(640,480,30,100,1e3),"480p_3":Xe(480,480,15,100,400),"480p_4":Xe(640,480,30,100,750),"480p_6":Xe(480,480,30,100,600),"480p_8":Xe(848,480,15,100,610),"480p_9":Xe(848,480,30,100,930),"480p_10":Xe(640,480,10,100,400),"720p":Xe(1280,720,15,120,1130),"720p_auto":Xe(1280,720,30,900,3e3),"720p_1":Xe(1280,720,15,120,1130),"720p_2":Xe(1280,720,30,120,2e3),"720p_3":Xe(1280,720,30,120,1710),"720p_5":Xe(960,720,15,120,910),"720p_6":Xe(960,720,30,120,1380),"1080p":Xe(1920,1080,15,120,2080),"1080p_1":Xe(1920,1080,15,120,2080),"1080p_2":Xe(1920,1080,30,120,3e3),"1080p_3":Xe(1920,1080,30,120,3150),"1080p_5":Xe(1920,1080,60,120,4780),"1440p":Xe(2560,1440,30,120,4850),"1440p_1":Xe(2560,1440,30,120,4850),"1440p_2":Xe(2560,1440,60,120,7350),"4k":Xe(3840,2160,30,120,8910),"4k_1":Xe(3840,2160,30,120,8910),"4k_3":Xe(3840,2160,60,120,13500)},Gf=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],J6={"480p":Kr(640,480,5),"480p_1":Kr(640,480,5),"480p_2":Kr(640,480,30),"480p_3":Kr(640,480,15),"720p":Kr(1280,720,5),"720p_auto":Xe(1280,720,30,900,3e3),"720p_1":Kr(1280,720,5),"720p_2":Kr(1280,720,30),"720p_3":Kr(1280,720,15),"1080p":Kr(1920,1080,5),"1080p_1":Kr(1920,1080,5),"1080p_2":Kr(1920,1080,30),"1080p_3":Kr(1920,1080,15)},X6={"1SL1TL":_T(1,1),"3SL3TL":_T(3,3),"2SL3TL":_T(2,3)};function zs(n){return n||(n="480p_1"),typeof n=="string"?Object.assign({},q6[n]):n}function ET(n){return typeof n=="string"?Object.assign({},J6[n]):n}function Wf(n){return typeof n=="string"?Object.assign({},X6[n]):n}const Q6={speech_low_quality:Bd(16e3,!1),speech_standard:Bd(32e3,!1,18),music_standard:Bd(48e3,!1),standard_stereo:Bd(48e3,!0,56),high_quality:Bd(48e3,!1,128),high_quality_stereo:Bd(48e3,!0,192)};function Hf(n){return typeof n=="string"?Object.assign({},Q6[n]):n}const jd=[];function jN(n){return an(n,"mediaSource",["screen","window","application"]),!0}var he,Tt,ma,gT,ST,_a,Ea,ga,Ri,GN;(function(n){n.NEED_RENEGOTIATE="@need_renegotiate",n.NEED_REPLACE_TRACK="@need_replace_track",n.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",n.NEED_CLOSE="@need_close",n.NEED_ENABLE_TRACK="@need_enable_track",n.NEED_DISABLE_TRACK="@need_disable_track",n.NEED_SESSION_ID="@need_sid",n.SET_OPTIMIZATION_MODE="@set_optimization_mode",n.GET_STATS="@get_stats",n.GET_RTC_STATS="@get_rtc_stats",n.GET_LOW_VIDEO_TRACK="@get_low_video_track",n.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",n.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",n.NEED_MUTE_TRACK="@need_mute_track",n.NEED_UNMUTE_TRACK="@need_unmute_track"})(he||(he={})),function(n){n.SCREEN_TRACK="screen_track",n.CUSTOM_TRACK="custome_track",n.LOW_STREAM="low_stream"}(Tt||(Tt={})),function(n){n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM"}(ma||(ma={})),function(n){n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM"}(gT||(gT={})),function(n){n[n.DISABLE=0]="DISABLE",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.AUDIO_ONLY=2]="AUDIO_ONLY"}(ST||(ST={})),function(n){n.TRANSCEIVER_UPDATED="transceiver-updated",n.SEI_TO_SEND="sei-to-send",n.SEI_RECEIVED="sei-received"}(_a||(_a={})),function(n){n.SOURCE_STATE_CHANGE="source-state-change",n.TRACK_ENDED="track-ended",n.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.CLOSED="closed"}(Ea||(Ea={})),function(n){n.FIRST_FRAME_DECODED="first-frame-decoded",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.VIDEO_STATE_CHANGED="video-state-changed"}(ga||(ga={})),function(n){n.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",n.RECEIVE_TRACK_BUFFER="receive_track_buffer",n.ON_AUDIO_BUFFER="on_audio_buffer",n.UPDATE_SOURCE="update_source"}(Ri||(Ri={})),function(n){n.UPDATE_TRACK_SOURCE="update-track-source"}(GN||(GN={}));const TT={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},vT={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},WN={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},$6={uplinkNetworkQuality:0,downlinkNetworkQuality:0},HN={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var Qn,Ci,Ic,wo,$n,zr;(function(n){n.ON_TRACK="on_track",n.ON_NODE="on_node"})(Qn||(Qn={})),function(n){n.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",n.REQUEST_CONSTRAINTS="request_constraints"}(Ci||(Ci={})),function(n){n.IDLE="IDLE",n.INITING="INITING",n.INITEND="INITEND"}(Ic||(Ic={})),function(n){n.STATE_CHANGE="state_change",n.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",n.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",n.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(wo||(wo={})),function(n){n.NONE="none",n.INIT="init",n.CANPLAY="canplay",n.PLAYING="playing",n.PAUSED="paused",n.SUSPEND="suspend",n.STALLED="stalled",n.WAITING="waiting",n.ERROR="error",n.DESTROYED="destroyed",n.ABORT="abort",n.ENDED="ended",n.EMPTIED="emptied",n.LOADEDDATA="loadeddata"}($n||($n={})),function(n){n[n.VideoStateStopped=0]="VideoStateStopped",n[n.VideoStateStarting=1]="VideoStateStarting",n[n.VideoStateDecoding=2]="VideoStateDecoding",n[n.VideoStateFrozen=3]="VideoStateFrozen"}(zr||(zr={}));const yT={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var Gd;(function(n){n.OPEN="open",n.MESSAGE="message",n.CLOSE="close",n.CLOSING="closing",n.ERROR="error"})(Gd||(Gd={}));class KN extends At{constructor(e,t){super(),S(this,"_ID",void 0),S(this,"_rtpTransceiver",void 0),S(this,"_lowRtpTransceiver",void 0),S(this,"_hints",[]),S(this,"_isClosed",!1),S(this,"_originMediaStreamTrack",void 0),S(this,"_mediaStreamTrack",void 0),S(this,"_external",{}),this._ID=t||Et(8,"track-"),this._originMediaStreamTrack=e,this._mediaStreamTrack=e,function(i){fe(jd).call(jd,i)||jd.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){if(!e){const t=Te.reportApiInvoke(null,{name:Jt.GET_MEDIA_STREAM_TRACK,options:[],tag:Pt.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?t.onSuccess(this._mediaStreamTrack.label):t.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===ma.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=jd.indexOf(e);t!==-1&&jd.splice(t,1)}(this),this.emit(Ea.CLOSED),this.removeAllListeners(_a.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===ma.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(_a.TRANSCEIVER_UPDATED,e,t)}}class Vn extends KN{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),S(this,"_enabled",!0),S(this,"_muted",!1),S(this,"_isExternalTrack",!1),S(this,"_isClosed",!1),S(this,"_enabledMutex",void 0),S(this,"processor",void 0),S(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Tn("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return(e=(t=this._originMediaStreamTrack)===null||t===void 0?void 0:t.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,v.debug("[".concat(this.getTrackId(),"] close")),this.emit(he.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await _t(this,he.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ea.TRACK_ENDED)}stateCheck(e,t){if(v.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),Eo(t,e),this._enabled&&this._muted&&e==="enabled"&&t===!1)throw new Q(O.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",v);if(!this._enabled&&!this._muted&&e==="muted"&&t===!0)throw new Q(O.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",v)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():W.resolve([])}}function zN(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}const YN=window.AudioContext||window.webkitAudioContext;let ir=null;const dt=new class extends At{constructor(){super(...arguments),S(this,"prevState",void 0),S(this,"curState",void 0),S(this,"currentTime",void 0),S(this,"currentTimeStuckAt",void 0),S(this,"interruptDetectorTrack",void 0),S(this,"onLocalAudioTrackMute",()=>{v.info("ios15-interruption-start"),this.emit(fn.IOS_15_16_INTERRUPTION_START)}),S(this,"onLocalAudioTrackUnmute",async()=>{v.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?v.info("ios15-interruption-end-canceled"):(ir&&await ir.suspend(),this.emit(fn.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(n){v.debug("webaudio bindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=n,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(n){v.debug("webaudio unbindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===n&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Z6(){if(!YN)return void v.error("your browser is not support web audio");v.info("create audio context");const n=function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?zN(Object(i),!0).forEach(function(s){S(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zN(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}({},L("WEBAUDIO_INIT_OPTIONS"));v.debug("audio context init option:",JSON.stringify(n)),ir=new YN(n),dt.curState=ir.state,ir.onstatechange=()=>{dt.prevState=dt.curState,dt.curState=ir?ir.state:void 0;const{prevState:e,curState:t}=dt,i=t==="running",s=t==="interrupted",a=e==="running",c=e==="suspended",l=e==="interrupted",h=Ze().osVersion;(ni()||Bs())&&a&&s&&(v.info("ios".concat(h,"-interruption-start")),dt.emit(fn.IOS_INTERRUPTION_START)),(ni()||Bs())&&(c||l)&&i&&(v.info("ios".concat(h,"-interruption-end")),dt.emit(fn.IOS_INTERRUPTION_END)),e!==t&&dt.emit(fn.STATE_CHANGE,t,e)},setInterval(()=>{var e;const t=(e=ir)===null||e===void 0?void 0:e.currentTime;dt.currentTime!==t?(dt.currentTimeStuckAt&&(v.debug("AudioContext current time resume at ".concat(t)),dt.currentTimeStuckAt=void 0),dt.currentTime=t):(t!==dt.currentTimeStuckAt&&(Te.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:Pt.TRACER}).onSuccess(),v.warning("AudioContext current time stuck at ".concat(t))),dt.currentTimeStuckAt=t)},5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,s=!1,a=!1,c=!1;function l(I){e.state==="running"?h(!1):ni()||Bs()?e.state==="suspended"&&(h(!0),I&&e.resume().then(f,f)):e.state!=="closed"&&(h(!0),I&&e.resume().then(f,f))}function h(I){if(s!==I){s=I;for(let N=0,D=t;N<D.length;N+=1){const V=D[N];I?window.addEventListener(V,_,{capture:!0,passive:!0}):window.removeEventListener(V,_,{capture:!0,passive:!0})}}}function p(){l(!0)}function f(){l(!1)}function _(){l(!0)}function g(I){if(!c)if(i.paused)if(I){let N;T(!1),c=!0;try{N=i.play(),N?N.then(w,w):(i.addEventListener("playing",w),i.addEventListener("abort",w),i.addEventListener("error",w))}catch{w()}}else T(!0);else T(!1)}function T(I){if(a!==I){a=I;for(let N=0,D=t;N<D.length;N++){const V=D[N];I?window.addEventListener(V,R,{capture:!0,passive:!0}):window.removeEventListener(V,R,{capture:!0,passive:!0})}}}function w(){i.removeEventListener("playing",w),i.removeEventListener("abort",w),i.removeEventListener("error",w),c=!1,g(!1)}function R(){g(!0)}if(ni()){const I=e.createMediaStreamDestination(),N=document.createElement("div");N.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=N.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=I.stream,g(!0)}dt.on(fn.STATE_CHANGE,p),l(!1)}(ir)}function Wd(){if(!ir){if(Z6(),!ir)throw new Q(O.NOT_SUPPORTED,"can not create audio context");return ir}return ir}function wc(n){if(function(){if(RT!==null)return RT;const i=Wd(),s=i.createBufferSource(),a=i.createGain(),c=i.createGain();s.connect(a),s.connect(c),s.disconnect(a);let l=!1;try{s.disconnect(a)}catch{l=!0}return s.disconnect(),RT=l,l}())return;const e=n.connect,t=n.disconnect;n.connect=(i,s,a)=>{var c;return n._inputNodes||(n._inputNodes=[]),fe(c=n._inputNodes).call(c,i)||(i instanceof AudioNode?(n._inputNodes.push(i),e.call(n,i,s,a)):e.call(n,i,s)),n},n.disconnect=(i,s,a)=>{t.call(n),i?mf(n._inputNodes,i):n._inputNodes=[];for(const c of n._inputNodes)e.call(n,c)}}let RT=null;function CT(n,e){let t=!1;const i=1/e;if(L("DISABLE_WEBAUDIO")){const s=window.setInterval(()=>{t?window.clearInterval(s):n(performance.now()/1e3)},1e3*i)}else{const s=Wd();let a=s.createGain();a.gain.value=0,a.connect(s.destination);const c=()=>{if(t)return void(a=null);const l=s.createOscillator();l.onended=c,l.connect(a),l.start(0),l.stop(s.currentTime+i),n(s.currentTime)};c()}return()=>{t=!0}}class qN{constructor(){S(this,"context",void 0),S(this,"analyserNode",void 0),S(this,"sourceNode",void 0),this.context=Wd(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ni()||Bs()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let s=0;s<e.length;++s)e[s]=i[s]/128-1}const t=To(e).call(e,(i,s)=>i+s*s,0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(t=this.sourceNode)===null||t===void 0||t.connect(this.analyserNode)}catch{v.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class JN extends At{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(t=this._processedNode)===null||t===void 0||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),S(this,"outputNode",void 0),S(this,"outputTrack",void 0),S(this,"isPlayed",!1),S(this,"context",void 0),S(this,"audioBufferNode",void 0),S(this,"destNode",void 0),S(this,"audioOutputLevel",0),S(this,"volumeLevelAnalyser",void 0),S(this,"_processedNode",void 0),S(this,"playNode",void 0),S(this,"isDestroyed",!1),S(this,"onNoAudioInput",void 0),S(this,"isNoAudioInput",!1),S(this,"_noAudioInputCount",0),this.context=Wd(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),wc(this.outputNode),this.volumeLevelAnalyser=new qN}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=t=>{this.emit(Ri.ON_AUDIO_BUFFER,function(i){for(let s=0;s<i.outputBuffer.numberOfChannels;s+=1){const a=i.outputBuffer.getChannelData(s);for(let c=0;c<a.length;c+=1)a[c]=0}return i.inputBuffer}(t))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!et().webAudioMediaStreamDest)throw new Q(O.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&_f(()=>{dt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ni()||Bs()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let i;t.getFloatTimeDomainData?(i=new Float32Array(t.fftSize),t.getFloatTimeDomainData(i)):(i=new Uint8Array(t.fftSize),t.getByteTimeDomainData(i));let s=!1;for(let a=0;a<i.length;a++)i[a]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await Sn(200),await this.checkHasAudioInput(e?e+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;(e=this.processedNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class XN extends JN{get isFreeze(){return!1}constructor(e,t,i){var s;if(super(),S(this,"sourceNode",void 0),S(this,"track",void 0),S(this,"clonedTrack",void 0),S(this,"audioElement",void 0),S(this,"isCurrentTrackCloned",!1),S(this,"isRemoteTrack",!1),S(this,"originVolumeLevelAnalyser",void 0),S(this,"rebuildWebAudio",async()=>{if(v.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void v.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>v.info("resume success")),v.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),wc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),wc(this.outputNode),this.emit(Ri.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new Q(O.UNEXPECTED_ERROR);this.track=e;const a=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(a),wc(this.sourceNode),i){const l=i.clone();l.enabled=!0,this.clonedTrack=l,v.debug("create an unmuted track ".concat(l.id," from the original track ").concat(i.id," to get the volume"));const h=this.context.createMediaStreamSource(new MediaStream([l]));wc(h),this.originVolumeLevelAnalyser=new qN,this.originVolumeLevelAnalyser.updateSource(h)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;const c=Ze();t&&c.os===on.IOS&&Number((s=c.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(dt.on(fn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),wc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Ri.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),dt.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),v.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([t]));wc(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function QN(n,e,t){const i=(a,c)=>a?typeof a!="number"?a.max||a.exact||a.ideal||a.min||c:a:c,s={audio:!!t&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(s.video.mandatory.maxFrameRate=e.frameRate.max,s.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(s.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function eK(n,e){const t=await $N(n.mediaSource),{sourceId:i,audio:s}=await function(a){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new W((l,h)=>{const p=document.createElement("div");p.innerText="share screen",p.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const f=document.createElement("div");f.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const _=document.createElement("div");_.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",_.setAttribute("style","height: 12%;");const g=document.createElement("div");g.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const w=document.createElement("button");w.innerHTML="cancel",w.setAttribute("style","width: 85px;"),w.onclick=()=>{document.body.removeChild(N);const D=new Error("NotAllowedError");D.name="NotAllowedError",h(D)};let R=c;const I=document.createElement("div");if(c){const D=document.createElement("input");D.setAttribute("type","checkbox");const V=document.createElement("span");D.setAttribute("style","margin-right: 6px;"),V.innerText="Share audio",D.checked=R,D.onchange=()=>{R=D.checked},I.appendChild(D),I.appendChild(V)}T.appendChild(I),T.appendChild(w),f.appendChild(_),f.appendChild(g),f.appendChild(T);const N=document.createElement("div");N.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),N.appendChild(p),N.appendChild(f),document.body.appendChild(N),a.map(D=>{if(D.id){const V=document.createElement("div");V.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let G=D.thumbnail;try{const{width:F}=G.getSize();F>1920&&(G=G.resize({width:1920}))}catch(F){throw F&&F.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),F}V.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+G.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+D.name.replace(/[\u00A0-\u9999<>\&]/g,function(F){return"&#"+F.charCodeAt(0)+";"})+"</span>",V.onclick=()=>{document.body.removeChild(N),l({sourceId:D.id,audio:R})},g.appendChild(V)}})})}(t,e);return await QN(i,n,s)}async function $N(n){let e=["window","screen"];n!=="application"&&n!=="window"||(e=["window"]),n==="screen"&&(e=["screen"]);const t=XO();if(!t)throw console.error("failed to fetch electron, please mount it to window"),new Q(O.ELECTRON_IS_NULL);let i=null;try{var s;i=((s=t.desktopCapturer)===null||s===void 0?void 0:s.getSources({types:e}))||t.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new W((a,c)=>{t.desktopCapturer.getSources({types:e},(l,h)=>{l?c(l):a(h)})}));try{return await i}catch(a){throw new Q(O.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}function ZN(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}const IT=new Tn("safari");let eP=!1,tP=!1;async function rr(n,e){let t=0,i=null;for(;t<2;)try{i=await tK(n,e,t>0);break}catch(s){if(s instanceof Q)throw v.error("[".concat(e,"] ").concat(s.toString())),s;const a=Kf(s.name||s.code||s,s.message);if(a.code===O.MEDIA_OPTION_INVALID){v.debug("[".concat(e,"] detect media option invalid, retry")),t+=1,await Sn(500);continue}throw v.error("[".concat(e,"] ").concat(a.toString())),a}if(!i)throw new Q(O.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function tK(n,e,t){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Q(O.NOT_SUPPORTED,"can not find getUserMedia");t&&(n.video&&(delete n.video.width,delete n.video.height),n.screen&&(delete n.screen.width,delete n.screen.height));const i=et(),s=new MediaStream;if(n.audioSource&&s.addTrack(n.audioSource),n.videoSource&&s.addTrack(n.videoSource),!n.audio&&!n.video&&!n.screen)return v.debug("Using Video Source/ Audio Source"),s;if(n.screen)if(XO())n.screen.sourceId?Hd(s,await QN(n.screen.sourceId,n.screen,n.screenAudio)):Hd(s,await eK(n.screen,n.screenAudio));else if(_o()&&n.screen.extensionId&&n.screen.mandatory){if(!i.getStreamFromExtension)throw new Q(O.NOT_SUPPORTED,"This browser does not support screen sharing");v.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const g=await(c=n.screen.extensionId,l=e,new W((T,w)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},R=>{if(!R||!R.streamId)return v.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),R),void w(new Q(O.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(R.streamId)})}catch(R){v.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),R.toString()),w(new Q(O.CHROME_PLUGIN_NOT_INSTALL))}}));n.screen.mandatory.chromeMediaSourceId=g,Hd(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:n.screen.mandatory}}))}else if(i.getDisplayMedia){var a;n.screen.mediaSource&&jN(n.screen.mediaSource);const g={width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate,displaySurface:(a=n.screen.displaySurface)!==null&&a!==void 0?a:n.screen.mediaSource==="screen"?"monitor":n.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:w,systemAudio:R}=n.screen,I={selfBrowserSurface:T,surfaceSwitching:w,systemAudio:R};!T&&delete I.selfBrowserSurface,!w&&delete I.surfaceSwitching,!R&&delete I.systemAudio,v.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:g,audio:!!n.screenAudio,controls:I}));const N=await navigator.mediaDevices.getDisplayMedia(function(D){for(var V=1;V<arguments.length;V++){var G=arguments[V]!=null?arguments[V]:{};V%2?ZN(Object(G),!0).forEach(function(F){S(D,F,G[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(G)):ZN(Object(G)).forEach(function(F){Object.defineProperty(D,F,Object.getOwnPropertyDescriptor(G,F))})}return D}({video:g,audio:!!n.screenAudio},I));Hd(s,N)}else{if(!mt())throw v.error("[".concat(e,"] This browser does not support screenSharing")),new Q(O.NOT_SUPPORTED,"This browser does not support screen sharing");{n.screen.mediaSource&&jN(n.screen.mediaSource);const g={video:{mediaSource:n.screen.mediaSource,width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate}};v.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(g))),Hd(s,await navigator.mediaDevices.getUserMedia(g))}}var c,l;if(!n.video&&!n.audio)return s;let h={video:n.video,audio:n.audio},p=L("MEDIA_DEVICE_CONSTRAINTS");if(p)try{typeof p=="string"&&(p=JSON.parse(p)),h=IS(h,p)}catch{}v.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(h)),Ze();let f,_=null;(wn()||ni()||hf())&&(_=await IT.lock());try{f=await navigator.mediaDevices.getUserMedia(h)}catch(g){throw _&&_(),g}return h.audio&&(eP=!0),h.video&&(tP=!0),Hd(s,f),_&&_(),s}function Kf(n,e){switch(n){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Q(O.MEDIA_OPTION_INVALID,"".concat(n,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new Q(O.DEVICE_NOT_FOUND,"".concat(n,": ").concat(e));case"NotSupportedError":return new Q(O.NOT_SUPPORTED,"".concat(n,": ").concat(e));case"NotReadableError":return new Q(O.NOT_READABLE,"".concat(n,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Q(O.PERMISSION_DENIED,"".concat(n,": ").concat(e));case"ConstraintNotSatisfiedError":return new Q(O.CONSTRAINT_NOT_SATISFIED,"".concat(n,": ").concat(e));default:return v.error("getUserMedia unexpected error",n),new Q(O.UNEXPECTED_ERROR,"".concat(n,": ").concat(e))}}function Hd(n,e){const t=n.getVideoTracks()[0],i=n.getAudioTracks()[0],s=e.getVideoTracks()[0],a=e.getAudioTracks()[0];a&&(i&&n.removeTrack(i),n.addTrack(a)),s&&(t&&n.removeTrack(t),n.addTrack(s))}const sr=new class extends At{get state(){return this._state}set state(n){n!==this._state&&(this.emit(wo.STATE_CHANGE,n),this._state=n)}constructor(){super(),S(this,"_state",Ic.IDLE),S(this,"isAccessMicrophonePermission",!1),S(this,"isAccessCameraPermission",!1),S(this,"lastAccessMicrophonePermission",!1),S(this,"lastAccessCameraPermission",!1),S(this,"checkdeviceMatched",!1),S(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(L("ENUMERATE_DEVICES_INTERVAL")||(pf()||uf()===on.HARMONY_OS)&&ra())&&this.updateDevicesInfo()},L("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(n=>v.error(n.toString()))}async enumerateDevices(n,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Q(O.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(i);let a=!this.isAccessMicrophonePermission&&n,c=!this.isAccessCameraPermission&&e;s.audio&&(a=!1),s.video&&(c=!1);let l=null,h=null,p=null;if(!t&&(a||c)){if(IT.isLocked&&(v.debug("[device manager] wait GUM lock"),(await IT.lock())(),v.debug("[device manager] GUM unlock")),eP&&(a=!1,this.isAccessMicrophonePermission=!0),tP&&(c=!1,this.isAccessCameraPermission=!0),v.debug("[device manager] check media device permissions",n,e,a,c),a&&c){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(f){const _=Kf(f.name||f.code||f,f.message);if(_.code===O.PERMISSION_DENIED)throw _;v.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{l=await navigator.mediaDevices.getUserMedia({audio:n})}catch(f){const _=Kf(f.name||f.code||f,f.message);if(_.code===O.PERMISSION_DENIED)throw _;v.warning("getUserMedia failed in getDevices",_)}this.isAccessMicrophonePermission=!0}else if(c){try{h=await navigator.mediaDevices.getUserMedia({video:e})}catch(f){const _=Kf(f.name||f.code||f,f.message);if(_.code===O.PERMISSION_DENIED)throw _;v.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0}v.debug("[device manager] mic permission",n,"cam permission",e)}try{const f=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(_=>_.stop()),h&&h.getTracks().forEach(_=>_.stop()),p&&p.getTracks().forEach(_=>_.stop()),l=null,h=null,p=null,f}catch(f){return l&&l.getTracks().forEach(_=>_.stop()),h&&h.getTracks().forEach(_=>_.stop()),p&&p.getTracks().forEach(_=>_.stop()),l=null,h=null,p=null,new Q(O.ENUMERATE_DEVICES_FAILED,f.toString()).throw()}}async getRecordingDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,n)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(n){let e=null;return this.deviceInfoMap.forEach(t=>{t.device.label===n&&(e=t.device.deviceId)}),e}async getDeviceById(n){const e=(await this.enumerateDevices(!0,!0,!0)).find(t=>t.deviceId===n);if(!e)throw new Q(O.DEVICE_NOT_FOUND,"deviceId: ".concat(n));return e}async init(){this.state=Ic.INITING;try{await this.updateDevicesInfo(),this.state=Ic.INITEND}catch(n){throw v.warning("Device Detection functionality cannot start properly.",n.toString()),this.state=Ic.IDLE,!(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")&&new Q(O.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}}async updateDevicesInfo(){const n=await this.enumerateDevices(!0,!0,!0),e=Date.now(),t=[];if(n[0]&&n[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const s=n.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),a=n.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");s&&a?a.groupId===s.groupId?v.debug("[device-check] default input ".concat(s.label," and output ").concat(a.label," is the same group")):v.warning("[device-check] default input ".concat(s.label," and output ").concat(a.label," is not the same group")):v.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(n);if(n.forEach(s=>{if(!s.deviceId)return;const a=this.deviceInfoMap.get("".concat(s.kind,"_").concat(s.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){const c={initAt:e,updateAt:e,device:s,state:"ACTIVE"};this.deviceInfoMap.set("".concat(s.kind,"_").concat(s.deviceId),c),t.push(c)}a&&(a.updateAt=e)}),this.deviceInfoMap.forEach((s,a)=>{s.state==="ACTIVE"&&s.updateAt!==e&&(s.state="INACTIVE",t.push(s))}),this.state!==Ic.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));t.forEach(s=>{switch(s.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(wo.RECORDING_DEVICE_CHANGED,s);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(wo.CAMERA_DEVICE_CHANGED,s);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(wo.PLAYOUT_DEVICE_CHANGED,s)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(n){const e=n.filter(s=>s.kind==="audioinput"),t=n.filter(s=>s.kind==="videoinput"),i={audio:!1,video:!1};for(const s of e)if(s.label&&s.deviceId){i.audio=!0;break}for(const s of t)if(s.label&&s.deviceId){i.video=!0;break}return i}};let wT=!1;const or=new class extends At{constructor(){super(...arguments),S(this,"onAutoplayFailed",void 0),S(this,"onAudioAutoplayFailed",void 0)}};function nP(){if(Ze(),!wT){const n=e=>{e.preventDefault(),wT=!1,Su()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};wT=!0,Su()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),v.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),or.onAutoplayFailed?or.onAutoplayFailed():or.onAudioAutoplayFailed?v.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):v.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),or.emit("autoplay-failed")}}function iP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function rP(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?iP(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):iP(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function sP(n,e,t,i){if(!n)return;const s=Te.getBaseInfoBySessionId(n);if(!s)return;const a=s.info,c=Date.now(),l=rP(rP({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:c,elapse:c-s.startTime,cbRegistered:or.onAutoplayFailed||or.onAudioAutoplayFailed?1:-1,errorMsg:t,mediaType:e,trackId:i,extend:void 0});Te.send({type:Ct.AUTOPLAY_FAILED,data:l},!0)}const nK=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],fi=new class{constructor(){S(this,"onAutoplayFailed",void 0),S(this,"elementMap",new Map),S(this,"elementStateMap",new Map),S(this,"elementsNeedToResume",[]),S(this,"sinkIdMap",new Map),S(this,"autoResumeAfterInterruption",n=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,i]=e;const s=this.elementStateMap.get(t),a=i.srcObject.getAudioTracks()[0],c=a&&a.readyState;if(v.debug("resume after interrupted, ele: ".concat(s," audio: ").concat(c," ").concat(n)),c==="live"){if(n)return i.pause(),void i.play();if(dt.curState==="running")return wd()?(i.pause(),void i.play()):void(s&&s==="paused"&&i.play())}})}),S(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(n=>{let[e,t]=n;const i=t.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(v.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),t.pause(),t.play())})}),this.autoResumeAudioElement(),dt.on(fn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),dt.on(fn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),dt.on(fn.STATE_CHANGE,()=>{ni()&&dt.prevState==="suspended"&&dt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(n,e){const t=this.elementMap.get(n);if(this.sinkIdMap.set(n,e),t)try{await t.setSinkId(e)}catch(i){throw new Q(O.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(n,e,t,i){if(this.elementMap.has(e))return;const s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([n]),this.bindAudioElementEvents(e,s),this.elementMap.set(e,s),this.elementStateMap.set(e,$n.INIT),this.setVolume(e,t);const a=this.sinkIdMap.get(e);if(a)try{s.setSinkId(a).catch(l=>{v.warning("[".concat(e,"] set sink id failed"),l.toString())})}catch(l){v.warning("[".concat(e,"] set sink id failed"),l.toString())}const c=s.play();c&&c.then&&c.catch(l=>{i&&sP(i,"audio",l.message,e),v.warning("audio element play warning",l.toString()),this.elementMap.has(e)&&l.name==="NotAllowedError"&&(v.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),_f(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),nP()}))})}updateTrack(n,e){const t=this.elementMap.get(n);t&&(t.srcObject=new MediaStream([e]))}isPlaying(n){return this.elementMap.has(n)&&this.elementStateMap.get(n)==="playing"}setVolume(n,e){const t=this.elementMap.get(n);t&&(e=Math.max(0,Math.min(100,e)),t.volume=e/100)}stop(n){const e=this.elementMap.get(n);if(this.sinkIdMap.delete(n),!e)return;const t=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(t,1),e.srcObject=null,e.remove(),this.elementMap.delete(n),this.elementStateMap.delete(n)}bindAudioElementEvents(n,e){nK.forEach(t=>{e.addEventListener(t,i=>{const s=this.elementStateMap.get(n),a=i.type==="pause"?"paused":i.type;if(v.debug("[".concat(n,"] audio-element-status change ").concat(s," => ").concat(a)),i.type==="error"){const c=e==null?void 0:e.error;c&&v.error("[".concat(n,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(n,a)})})}getPlayerState(n){return this.elementStateMap.get(n)||"uninit"}autoResumeAudioElement(){const n=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(t=>{v.debug("Auto resume audio element success")}).catch(t=>{v.warning("Auto resume audio element failed!",t)})}),this.elementsNeedToResume=[]};new W(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{Su()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0))})}};function Gt(){return function(n,e,t){const i=t.value;return typeof i=="function"&&(t.value=function(){this._isClosed&&new Q(O.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",v);for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];const l=i.apply(this,a);return l instanceof W?new W((h,p)=>{l.then(h).catch(p)}):l}),t}}function oP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function zf(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?oP(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):oP(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class aP extends At{constructor(e){super(),S(this,"name","VideoProcessorDestination"),S(this,"ID","0"),S(this,"_source",void 0),S(this,"videoContext",void 0),S(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Q(O.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Q(O.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Qn.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Qn.ON_TRACK,void 0)}}class cP extends At{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),S(this,"constraintsMap",new Map),S(this,"statsRegistry",[]),S(this,"usageRegistry",[]),S(this,"trackId",void 0),S(this,"direction",void 0),S(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await Xt(this,Ci.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var i;return v.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),_t(this,Ci.REQUEST_UPDATE_CONSTRAINTS,Array.from(Es(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return v.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),_t(this,Ci.REQUEST_UPDATE_CONSTRAINTS,Array.from(Es(t=this.constraintsMap).call(t)))}registerStats(e,t,i){this.statsRegistry.find(s=>s.processorID===e.ID&&s.processorName===e.name&&s.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:i})}unregisterStats(e,t){const i=this.statsRegistry.findIndex(s=>s.processorID===e.ID&&s.processorName===e.name&&s.type===t);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:i,type:s,cb:a}of this.statsRegistry)try{const c=a();e.push({processorID:t,processorName:i,type:s,stats:c})}catch(c){v.error(new Q(O.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,t){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let i=t();i instanceof W&&(i=await i),e.push(zf(zf({},i),{},{direction:this.direction}))}catch(i){v.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class dP extends At{constructor(e){super(),S(this,"name","AudioProcessorDestination"),S(this,"ID","0"),S(this,"inputTrack",void 0),S(this,"inputNode",void 0),S(this,"audioProcessorContext",void 0),S(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Q(O.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Q(O.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Qn.ON_TRACK,void 0),this.emit(Qn.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Qn.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Qn.ON_NODE,this.inputNode))}}class lP extends At{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,i){super(),S(this,"constraintsMap",new Map),S(this,"statsRegistry",[]),S(this,"audioContext",void 0),S(this,"trackId",void 0),S(this,"direction",void 0),S(this,"usageRegistry",[]),S(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=i}async getConstraints(){return Xt(this,Ci.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var i;return v.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),_t(this,Ci.REQUEST_UPDATE_CONSTRAINTS,Array.from(Es(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),_t(this,Ci.REQUEST_UPDATE_CONSTRAINTS,Array.from(Es(t=this.constraintsMap).call(t)))}registerStats(e,t,i){this.statsRegistry.find(s=>s.processorID===e.ID&&s.processorName===e.name&&s.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:i})}unregisterStats(e,t){const i=this.statsRegistry.findIndex(s=>s.processorID===e.ID&&s.processorName===e.name&&s.type===t);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:i,type:s,cb:a}of this.statsRegistry)try{const c=a();e.push({processorID:t,processorName:i,type:s,stats:c})}catch(c){v.error(new Q(O.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,t){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let i=t();i instanceof W&&(i=await i),e.push(zf(zf({},i),{},{direction:this.direction}))}catch(i){v.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class AT extends At{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),S(this,"context",void 0),S(this,"processSourceNode",void 0),S(this,"outputTrack",void 0),S(this,"processedNode",void 0),S(this,"clonedTrack",void 0),S(this,"outputNode",void 0),this.outputNode=new iK}setVolume(){}createOutputTrack(){throw new Q(O.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class iK{disconnect(){}connect(){}}function uP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function OT(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?uP(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):uP(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class lt extends Vn{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?fi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,i,s){super(e,i),S(this,"trackMediaType","audio"),S(this,"_encoderConfig",void 0),S(this,"_trackSource",void 0),S(this,"_enabled",!0),S(this,"_volume",100),S(this,"_useAudioElement",!0),S(this,"_bypassWebAudio",!1),S(this,"processor",void 0),S(this,"_processorContext",void 0),S(this,"_processorDestination",void 0),S(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!s,this._trackSource=new AT,L("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),L("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),wn()&&!ir?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){pt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&fi.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void v.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,_t(this,he.NEED_REPLACE_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{v.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!_o()&&L("RESTRICTION_SET_PLAYBACK_DEVICE"))throw new Q(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await fi.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,i){return this._setEnabled(e,t,i)}async _setEnabled(e,t,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await _t(this,he.NEED_ENABLE_TRACK,this),v.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(s){throw i||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await _t(this,he.NEED_DISABLE_TRACK,this)}catch(s){throw i||(this._enabled=!0),v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await _t(this,he.NEED_MUTE_TRACK,this):await _t(this,he.NEED_UNMUTE_TRACK,this))}getStats(){return Nd(()=>{v.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ui(this,he.GET_STATS)||OT({},TT)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Ri.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Ri.ON_AUDIO_BUFFER),this._source.on(Ri.ON_AUDIO_BUFFER,i=>e(i))}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] start audio playback in element")),fi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?fi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&fi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await _t(this,he.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return W.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Q(O.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Q(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Qn.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await _t(this,he.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await _t(this,he.NEED_REPLACE_TRACK,this))}),e.on(Qn.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Qn.ON_TRACK),e.removeAllListeners(Qn.ON_NODE)}bindProcessorContextEvents(e){e.on(Ci.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Ci.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof AT&&(this._trackSource=new XN(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new lP(this._source.context,this.getTrackId(),"local"),t=new dP(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Ri.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(fi.stop(this.getTrackId()),this._source.play()),_t(this,he.NEED_REPLACE_MIXING_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{v.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:t}}}$([Ae({argsMap:(n,e)=>[n.getTrackId(),e],throttleTime:300}),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],lt.prototype,"setVolume",null),$([Ae({argsMap:(n,e)=>[n.getTrackId(),e]}),Gt(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],lt.prototype,"setPlaybackDevice",null),$([Dd("LocalAudioTrack","_enabledMutex"),Ae({argsMap:(n,e)=>[n.getTrackId(),e]}),Gt(),A("design:type",Function),A("design:paramtypes",[Boolean,Object,Boolean]),A("design:returntype",W)],lt.prototype,"setEnabled",null),$([Dd("LocalAudioTrack","_enabledMutex"),Ae({argsMap:(n,e)=>[n.getTrackId(),e]}),Gt(),A("design:type",Function),A("design:paramtypes",[Boolean]),A("design:returntype",W)],lt.prototype,"setMuted",null),$([Gt(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Object)],lt.prototype,"getStats",null),$([Gt(),A("design:type",Function),A("design:paramtypes",[Object,Number]),A("design:returntype",void 0)],lt.prototype,"setAudioFrameCallback",null),$([Ae({argsMap:n=>[n.getTrackId()]}),Gt(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],lt.prototype,"play",null),$([Ae({argsMap:n=>[n.getTrackId()]}),Gt(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],lt.prototype,"stop",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],lt.prototype,"close",null),$([Ae({argsMap:(n,e)=>[n.getTrackId(),e.name]}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Object)],lt.prototype,"pipe",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],lt.prototype,"unpipe",null);class Ac extends lt{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,i,s){super(e,t.encoderConfig?Hf(t.encoderConfig):{},s,L("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),S(this,"_config",void 0),S(this,"_deviceName","default"),S(this,"_constraints",void 0),S(this,"_originalConstraints",void 0),S(this,"_enabled",!0),this._config=t,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(wd()||gS())&&dt.bindInterruptDetectorTrack(this)}async setDevice(e){if(v.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await sr.getDeviceById(e),i={};i.audio=OT({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let s=null;try{s=await rr(i,this.getTrackId())}catch(a){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),s=await rr({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await sr.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}v.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,i){if(t)return v.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),i||(this._enabled=!1);try{await _t(this,he.NEED_DISABLE_TRACK,this)}catch(l){throw v.error("[".concat(this.getTrackId(),"] setEnabled false failed"),l.toString()),l}return}const a=OT({},this._constraints),c=sr.searchDeviceIdByName(this._deviceName);c&&!a.deviceId&&(a.deviceId=c);try{i||(this._enabled=!0);const l=await rr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),await _t(this,he.NEED_ENABLE_TRACK,this)}catch(l){throw i||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled true failed"),l.toString()),l}v.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(wd()||gS())&&dt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ni()||Bs())&&this._enabled&&!this._isClosed&&dt.duringInterruption){const e=async()=>{dt.off(fn.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};dt.on(fn.IOS_INTERRUPTION_END,e)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ea.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,i=sr.searchDeviceIdByName(this._deviceName);if(i&&!t.deviceId&&(t.deviceId=i),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const s=await rr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Ci.REQUEST_UPDATE_CONSTRAINTS,async(t,i,s)=>{try{const a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),i()}catch(a){s(a)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Ci.REQUEST_UPDATE_CONSTRAINTS)}}$([Ae({argsMap:(n,e)=>[n.getTrackId(),e]}),Gt(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],Ac.prototype,"setDevice",null),$([Dd("MicrophoneAudioTrack","_enabledMutex"),Ae({argsMap:(n,e,t)=>[n.getTrackId(),e,t]}),Gt(),A("design:type",Function),A("design:paramtypes",[Boolean,Boolean,Boolean]),A("design:returntype",W)],Ac.prototype,"setEnabled",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ac.prototype,"close",null);class Sa extends lt{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,i,s){super(t.createOutputTrack(),i,s),S(this,"source",void 0),S(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Ri.AUDIO_SOURCE_STATE_CHANGE,a=>{this.safeEmit(Ea.SOURCE_STATE_CHANGE,a)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){pt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}$([Ae({argsMap:(n,e)=>[n.getTrackId(),e,n.duration]}),Gt(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",void 0)],Sa.prototype,"startProcessAudioBuffer",null),$([Ae({argsMap:n=>[n.getTrackId()]}),Gt(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Sa.prototype,"pauseProcessAudioBuffer",null),$([Ae({argsMap:n=>[n.getTrackId()]}),Gt(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],Sa.prototype,"seekAudioBuffer",null),$([Ae({argsMap:n=>[n.getTrackId()]}),Gt(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Sa.prototype,"resumeProcessAudioBuffer",null),$([Ae({argsMap:n=>[n.getTrackId()]}),Gt(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Sa.prototype,"stopProcessAudioBuffer",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Sa.prototype,"close",null),$([Ae({argsMap:n=>[n.getTrackId()]}),Gt(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],Sa.prototype,"setAudioBufferPlaybackSpeed",null);class tn extends lt{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Wd().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,Et(8,"track-mix-")),S(this,"trackList",void 0),S(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(v.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):v.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){v.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}mf(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(t=>{t instanceof tn?t.emit(_a.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)}))}}function Yf(n){const e={};n.facingMode&&(e.facingMode=n.facingMode),n.cameraId&&(e.deviceId={exact:n.cameraId});const t=zs(n.encoderConfig);return t.width!=null&&(e.width=t.width),t.height!=null&&(e.height=t.height),!HO()&&t.frameRate&&(e.frameRate=t.frameRate),Ze().name===rt.EDGE&&typeof e.frameRate=="object"&&(e.frameRate.max=60),mt()&&(e.frameRate={ideal:30,max:30}),e}function hP(n){const e={};if(HO()||(n.AGC!==void 0&&(e.autoGainControl=n.AGC),n.AEC!==void 0&&(e.echoCancellation=n.AEC),n.ANS!==void 0&&(e.noiseSuppression=n.ANS,_o()&&n.ANS&&(e.googHighpassFilter=n.ANS))),n.encoderConfig){const t=Hf(n.encoderConfig);e.channelCount=t.stereo?2:1,e.sampleRate=t.sampleRate,e.sampleSize=t.sampleSize}return n.microphoneId&&(e.deviceId={exact:n.microphoneId}),pf()&&(e.sampleRate=void 0),e}class rK extends JN{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(Ri.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),S(this,"audioBuffer",void 0),S(this,"sourceNode",void 0),S(this,"startPlayTime",0),S(this,"startPlayOffset",0),S(this,"pausePlayTime",0),S(this,"options",void 0),S(this,"currentLoopCount",0),S(this,"currentPlaybackSpeed",100),S(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):v.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const pP=new Map;async function sK(n,e){let t=null;if(typeof n=="string"){const s=pP.get(n);if(s)return v.debug("use cached audio resource: ",n),s;try{t=(await _s(()=>vi.get(n,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(a){throw new Q(O.FETCH_AUDIO_FILE_FAILED,a.toString())}}else t=await new W((a,c)=>{const l=new FileReader;l.onload=h=>{h.target?a(h.target.result):c(new Q(O.READ_LOCAL_AUDIO_FILE_ERROR))},l.onerror=()=>{c(new Q(O.READ_LOCAL_AUDIO_FILE_ERROR))},l.readAsArrayBuffer(n)});const i=await function(s){const a=Wd();return new W((c,l)=>{a.decodeAudioData(s,h=>{c(h)},h=>{l(new Q(O.DECODE_AUDIO_FILE_FAILED,h.toString()))})})}(t);return typeof n=="string"&&e&&pP.set(n,i),i}const bT=n=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new W((t,i)=>{e.toBlob(async s=>{if(e.remove(),s){const a=await fP(s);t({buffer:a,width:e.width,height:e.height})}else i(new Q(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,1)})},fP=async n=>{const e=await n.arrayBuffer();return new Uint8Array(e)};function mP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function _P(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mP(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):mP(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class NT{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(v.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(v.debug("[".concat(this.trackId,"] video-status change ").concat(this._videoState," => ").concat(e)),this._videoState=e,(t=this.onVideoStateChanged)===null||t===void 0||t.call(this,this.videoState))}constructor(e){S(this,"trackId",void 0),S(this,"config",void 0),S(this,"onFirstVideoFrameDecoded",void 0),S(this,"onVideoStateChanged",void 0),S(this,"freezeTimeCounterList",[]),S(this,"renderFreezeAccTime",0),S(this,"isKeepLastFrame",!1),S(this,"timeUpdatedCount",0),S(this,"freezeTime",0),S(this,"playbackTime",0),S(this,"lastTimeUpdatedTime",0),S(this,"autoplayFailed",!1),S(this,"videoTrack",void 0),S(this,"videoElement",void 0),S(this,"cacheVideoElement",void 0),S(this,"_videoState",zr.VideoStateStopped),S(this,"videoElementCheckInterval",void 0),S(this,"videoElementFreezeTimeout",void 0),S(this,"_videoElementStatus",$n.NONE),S(this,"isGettingVideoDimensions",!1),S(this,"startGetVideoDimensions",()=>{const t=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return v.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(t,500)};!this.isGettingVideoDimensions&&t()}),S(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&dt.curState==="running"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(xO())),GO()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),S(this,"handleVideoEvents",t=>{switch(t.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=$n.PLAYING;break;case"loadeddata":if(this.videoState=zr.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=$n.CANPLAY;break;case"stalled":this.videoElementStatus=$n.STALLED;break;case"suspend":this.videoElementStatus=$n.SUSPEND;break;case"pause":this.videoElementStatus=$n.PAUSED,ni()||Bs()||wn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=$n.WAITING;break;case"abort":this.videoElementStatus=$n.ABORT;break;case"ended":this.videoElementStatus=$n.ENDED;break;case"emptied":this.videoElementStatus=$n.EMPTIED;break;case"error":{this.videoElementStatus=$n.ERROR;const i=this.videoElement.error;i&&v.error("[".concat(this.trackId,"] media error, code: ").concat(i.code,", message: ").concat(i.message));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const s=i-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Ao.lastVisibleTime<Ao.lastHiddenTime||a<Ao.lastHiddenTime||a<Ao.lastVisibleTime)return;for(s>L("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),S(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(xO())),GO()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),dt.on(fn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),dt.on(fn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch(s=>{e&&sP(e,"video",s.message,this.trackId),s.name==="NotAllowedError"?(v.warning("detected video element autoplay failed",s),this.autoplayFailed=!0,this.handleAutoPlayFailed()):v.warning("[".concat(this.trackId,"] play warning: "),s)});const i=Ze();if((i.name==="Safari"&&Number(i.version)===15||wd())&&t&&t.then){const s=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(s).catch(s)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return v.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const i=t.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const s=i.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,i.width,i.height),new W((a,c)=>{i.toBlob(async l=>{if(i.remove(),l){const h=await fP(l);a({buffer:h,width:i.width,height:i.height})}else c(new Q(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await bT(e)}destroy(){dt.off(fn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),dt.off(fn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=zr.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=$n.INIT,!this.videoElementCheckInterval&&(EP.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)||(this.videoElementStatus=$n.DESTROYED)},1e3),L("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let a;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,L("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===zr.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=zr.VideoStateFrozen:document.addEventListener("visibilitychange",c))},h=(p,f)=>{if(this.videoElementStatus===$n.PLAYING){if(a){const T=f.presentationTime-a.presentationTime;this.videoState===zr.VideoStateStarting&&(this.videoState=zr.VideoStateDecoding),this.videoState===zr.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,L("VIDEO_FREEZE_DURATION"))),T<L("VIDEO_FREEZE_DURATION")&&this.videoState===zr.VideoStateFrozen&&(this.videoState=zr.VideoStateDecoding),T>L("VIDEO_FREEZE_DURATION")&&Ao.lastVisibleTime>=Ao.lastHiddenTime&&a.timestamp>Ao.lastVisibleTime&&a.timestamp>Ao.lastHiddenTime&&(this.renderFreezeAccTime+=T)}a=_P(_P({},f),{},{timestamp:p})}var _,g;L("ENABLE_VIDEO_FRAME_CALLBACK")&&((_=(g=this.videoElement).requestVideoFrameCallback)===null||_===void 0||_.call(g,h))};(e=(t=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(t,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),pf()&&(this.videoElement.poster="noposter");const i=Ze();i.name==="Safari"&&Number(i.version)===15||wd()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,mt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,mt()&&this.videoElement.load());const s=this.videoElement.play();s!==void 0&&s.catch(a=>{v.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){EP.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=$n.NONE}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{v.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{v.error(i)}),this.autoplayFailed=!1,Su()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Su()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),nP()}}const EP=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class gP extends NT{constructor(e){super(e),S(this,"container",void 0),S(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await bT(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",L("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function SP(n){return new W((e,t)=>{let i=!1;const s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);const a=ni()?"canplay":"playing";s.addEventListener(a,()=>{const c=s.videoWidth,l=s.videoHeight;!c&&mt()||(i=!0,s.srcObject=null,s.remove(),e([c,l]))}),s.srcObject=new MediaStream([n]),s.play().catch(Ef),setTimeout(()=>{i||(s.srcObject=null,s.remove(),e([s.videoWidth,s.videoHeight]))},4e3)})}const oK=async(n,e,t)=>{const i=function(c){const l=[];for(let h=0;h<c.length;h+=2)l.push(parseInt(c.slice(h,h+2),16));return Uint8Array.from(l)}(function(c){const l="0123456789abcdef";function h(re){let ae,Ue="";for(ae=0;ae<=3;ae++)Ue+=l.charAt(re>>8*ae+4&15)+l.charAt(re>>8*ae&15);return Ue}function p(re,ae){const Ue=(65535&re)+(65535&ae);return(re>>16)+(ae>>16)+(Ue>>16)<<16|65535&Ue}function f(re,ae,Ue,ze,vt,nn){return p(function(It,Gi){return It<<Gi|It>>>32-Gi}(p(p(ae,re),p(ze,nn)),vt),Ue)}function _(re,ae,Ue,ze,vt,nn,It){return f(ae&Ue|~ae&ze,re,ae,vt,nn,It)}function g(re,ae,Ue,ze,vt,nn,It){return f(ae&ze|Ue&~ze,re,ae,vt,nn,It)}function T(re,ae,Ue,ze,vt,nn,It){return f(ae^Ue^ze,re,ae,vt,nn,It)}function w(re,ae,Ue,ze,vt,nn,It){return f(Ue^(ae|~ze),re,ae,vt,nn,It)}const R=function(re){let ae;const Ue=1+(re.length+8>>6),ze=new Array(16*Ue);for(ae=0;ae<16*Ue;ae++)ze[ae]=0;for(ae=0;ae<re.length;ae++)ze[ae>>2]|=re.charCodeAt(ae)<<ae%4*8;return ze[ae>>2]|=128<<ae%4*8,ze[16*Ue-2]=8*re.length,ze}(c);let I,N,D,V,G,F=1732584193,j=-271733879,z=-1732584194,Y=271733878;for(I=0;I<R.length;I+=16)N=F,D=j,V=z,G=Y,F=_(F,j,z,Y,R[I+0],7,-680876936),Y=_(Y,F,j,z,R[I+1],12,-389564586),z=_(z,Y,F,j,R[I+2],17,606105819),j=_(j,z,Y,F,R[I+3],22,-1044525330),F=_(F,j,z,Y,R[I+4],7,-176418897),Y=_(Y,F,j,z,R[I+5],12,1200080426),z=_(z,Y,F,j,R[I+6],17,-1473231341),j=_(j,z,Y,F,R[I+7],22,-45705983),F=_(F,j,z,Y,R[I+8],7,1770035416),Y=_(Y,F,j,z,R[I+9],12,-1958414417),z=_(z,Y,F,j,R[I+10],17,-42063),j=_(j,z,Y,F,R[I+11],22,-1990404162),F=_(F,j,z,Y,R[I+12],7,1804603682),Y=_(Y,F,j,z,R[I+13],12,-40341101),z=_(z,Y,F,j,R[I+14],17,-1502002290),j=_(j,z,Y,F,R[I+15],22,1236535329),F=g(F,j,z,Y,R[I+1],5,-165796510),Y=g(Y,F,j,z,R[I+6],9,-1069501632),z=g(z,Y,F,j,R[I+11],14,643717713),j=g(j,z,Y,F,R[I+0],20,-373897302),F=g(F,j,z,Y,R[I+5],5,-701558691),Y=g(Y,F,j,z,R[I+10],9,38016083),z=g(z,Y,F,j,R[I+15],14,-660478335),j=g(j,z,Y,F,R[I+4],20,-405537848),F=g(F,j,z,Y,R[I+9],5,568446438),Y=g(Y,F,j,z,R[I+14],9,-1019803690),z=g(z,Y,F,j,R[I+3],14,-187363961),j=g(j,z,Y,F,R[I+8],20,1163531501),F=g(F,j,z,Y,R[I+13],5,-1444681467),Y=g(Y,F,j,z,R[I+2],9,-51403784),z=g(z,Y,F,j,R[I+7],14,1735328473),j=g(j,z,Y,F,R[I+12],20,-1926607734),F=T(F,j,z,Y,R[I+5],4,-378558),Y=T(Y,F,j,z,R[I+8],11,-2022574463),z=T(z,Y,F,j,R[I+11],16,1839030562),j=T(j,z,Y,F,R[I+14],23,-35309556),F=T(F,j,z,Y,R[I+1],4,-1530992060),Y=T(Y,F,j,z,R[I+4],11,1272893353),z=T(z,Y,F,j,R[I+7],16,-155497632),j=T(j,z,Y,F,R[I+10],23,-1094730640),F=T(F,j,z,Y,R[I+13],4,681279174),Y=T(Y,F,j,z,R[I+0],11,-358537222),z=T(z,Y,F,j,R[I+3],16,-722521979),j=T(j,z,Y,F,R[I+6],23,76029189),F=T(F,j,z,Y,R[I+9],4,-640364487),Y=T(Y,F,j,z,R[I+12],11,-421815835),z=T(z,Y,F,j,R[I+15],16,530742520),j=T(j,z,Y,F,R[I+2],23,-995338651),F=w(F,j,z,Y,R[I+0],6,-198630844),Y=w(Y,F,j,z,R[I+7],10,1126891415),z=w(z,Y,F,j,R[I+14],15,-1416354905),j=w(j,z,Y,F,R[I+5],21,-57434055),F=w(F,j,z,Y,R[I+12],6,1700485571),Y=w(Y,F,j,z,R[I+3],10,-1894986606),z=w(z,Y,F,j,R[I+10],15,-1051523),j=w(j,z,Y,F,R[I+1],21,-2054922799),F=w(F,j,z,Y,R[I+8],6,1873313359),Y=w(Y,F,j,z,R[I+15],10,-30611744),z=w(z,Y,F,j,R[I+6],15,-1560198380),j=w(j,z,Y,F,R[I+13],21,1309151649),F=w(F,j,z,Y,R[I+4],6,-145523070),Y=w(Y,F,j,z,R[I+11],10,-1120210379),z=w(z,Y,F,j,R[I+2],15,718787259),j=w(j,z,Y,F,R[I+9],21,-343485551),F=p(F,N),j=p(j,D),z=p(z,V),Y=p(Y,G);return h(F)+h(j)+h(z)+h(Y)}(""+e+t)).slice(0,16),s=i.slice(0,12),a=await window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},a,n))},TP=async(n,e,t)=>await oK(n.buffer,e,t);function vP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function ar(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vP(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):vP(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class Ge extends Vn{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==$n.PLAYING)}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,i,s,a,c){if(super(e,a),S(this,"trackMediaType","video"),S(this,"_player",void 0),S(this,"isUseScaleResolutionDownBy",!1),S(this,"_videoVisibleTimer",null),S(this,"_statsTimer",null),S(this,"_previousVideoVisibleStatus",void 0),S(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),S(this,"_encoderConfig",void 0),S(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),S(this,"_optimizationMode",void 0),S(this,"_videoHeight",void 0),S(this,"_videoWidth",void 0),S(this,"_forceBitrateLimit",void 0),S(this,"_enabled",!0),S(this,"processorDestination",void 0),S(this,"_processorContext",void 0),wn()){const{width:l,height:h}=e.getSettings();this._videoWidth=l,this._videoHeight=h}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=t,this._scalabilityMode=i,this._optimizationMode=s,this._hints=c||[],this._hints.indexOf(Tt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(l,h,p){const f=Ze();return!(f.name!==l||!f.osVersion)&&Number(f.version)===h}(rt.CHROME,115)&&uf().indexOf("Windows")!==-1){const l=function(h,p){if("VideoFrame"in window&&"TransformStream"in window&&et().supportWebRTCInsertableStream){const f=new MediaStreamTrackProcessor(h),_=new MediaStreamTrackGenerator({kind:"video"});let g,T,w=Date.now();const R=()=>{I&&(clearInterval(I),I=void 0),g&&(g.close(),g=void 0),h.stop(),T=void 0,_.removeEventListener("ended",R)};let I=window.setInterval(()=>{if(T&&g&&Date.now()-w>1e3)try{_.readyState==="live"?T.enqueue(g.clone()):R()}catch{R()}},1e3);const N=new TransformStream({transform:(D,V)=>{_.readyState==="live"?(T=V,w=Date.now(),g===void 0?(g=D,V.enqueue(D.clone())):(V.enqueue(g),g=D)):D.close()}});return _.addEventListener("ended",R),f.readable.pipeThrough(N).pipeTo(_.writable),_}}(e);l&&(v.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}t&&this._hints.indexOf(Tt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(t),this._processorContext=new cP(this.getTrackId(),"local"),this.processorDestination=new aP(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const s=document.getElementById(e);s?e=s:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const i=ar(ar(ar({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new NT(i):this._player=new gP(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(Ea.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},L("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await _t(this,he.NEED_DISABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return t||(this._enabled=!1),void v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await _t(this,he.NEED_ENABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await _t(this,he.NEED_MUTE_TRACK,this):await _t(this,he.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,t){if(!this._enabled)throw new Q(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),e=zs(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const i=Yf({encoderConfig:e});(wn()||ni()||Bs())&&(i.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const a=new Q(O.UNEXPECTED_ERROR,s.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=e,this._hints.indexOf(Tt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await _t(this,he.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(v)}}getStats(){return Nd(()=>{v.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ui(this,he.GET_STATS)||ar({},vT)}async setBeautyEffect(e){v.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await bT(e)}async setBitrateLimit(e){if(v.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate);try{await _t(this,he.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(v)}}}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void v.error(O.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await _t(this,he.SET_OPTIMIZATION_MODE,this)}catch(i){throw this._optimizationMode=t,v.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return v.error(O.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,v.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){SP(this._originMediaStreamTrack).then(e=>{let[t,i]=e;this._videoHeight=i,this._videoWidth=t}).catch(Ef)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new Q(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");v.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=zs(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(Tt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await _t(this,he.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(v)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!t||!i)return;const{bitrateMax:s,bitrateMin:a}=this._encoderConfig;if(a==null||s==null){const{max:c,min:l}=function(h,p,f,_,g){const T=L("BITRATE_ADAPTER_TYPE");if(T==="DEFAULT_BITRATE")return{min:_,max:g};if(g===void 0){var w;const I=Math.floor(200*Math.pow(f/15,.6)*Math.pow(h*p/640/360,.75));g=T==="STANDARD_BITRATE"?4*I:2*I,_=(w=_)!==null&&w!==void 0?w:I}else{var R;_=(R=_)!==null&&R!==void 0?R:Math.floor(g/10)}return{min:_,max:g}}(e,t,i,a,s);this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,v.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(i,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]"))}}getVideoElementVisibleStatus(){try{var e,t;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),s={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:c}=s;if(this.isPlaying&&a instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=qO.checkOneElementVisible(a),h=Object.assign({},l);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const p=Te.reportApiInvoke(null,{tag:Pt.TRACER,name:Jt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(i){throw new Q(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new Q(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=ar(ar({},i),zs(e))),i=Tc(i);const s=Et(8,"track-video-cloned-"),a=new Ge(t?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Tc(this._scalabilityMode),this._optimizationMode,s,Tc(this._hints));return e&&i&&a.setEncoderConfiguration(i),v.debug("clone video track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(t)),a}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new Q(O.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new Q(O.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!wn()&&!ni())return;this._statsTimer&&window.clearInterval(this._statsTimer);let e=2,t=Gf[e],i=-1,s=Date.now();const a=c=>{c>2||c<0||(s=Date.now(),t=Gf[c],this.setSenderConfiguration(t))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{const c=this.getStats(),l=Ui(this,he.GET_RTC_STATS);if(c.sendPackets>0&&l){i===-1&&(i=Date.now());const h=Date.now();if(h-i<1e3||h-s<L("PROFILE_SWITCH_INTERVAL"))return;const p=c.sendFrameRate,f=.6*t.frameRate,_=.9*t.frameRate;typeof p=="number"&&p>0&&p<f?e>0&&(e--,a(e),v.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(p,", switchProfile to ").concat(e))):l.OutgoingAvailableBandwidth<t.bitrateMin?e>0&&(e--,a(e),v.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(l.OutgoingAvailableBandwidth,", bitrateMin ").concat(t.bitrateMin,", switchProfile to ").concat(e))):typeof p=="number"&&p>_&&e<Gf.length-1&&l.OutgoingAvailableBandwidth>1.2*Gf[e+1].bitrateMin&&(e++,a(e),v.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(p,", OutgoingAvailableBandwidth ").concat(l.OutgoingAvailableBandwidth,", switchProfile to ").concat(e)))}},L("CHECK_LOCAL_STATS_INTERVAL"))}sendSeiData(e){if(Nd(()=>{Te.reportApiInvoke(null,{name:Jt.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Pt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!L("ENABLE_VIDEO_SEI")||!L("ENABLE_ENCODED_TRANSFORM"))return void v.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(!(e instanceof Uint8Array))return new Q(O.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const t=this.getRTCRtpTransceiver();if(!t)return void v.warning("Video track is not published, SEI can not be send");const i=t.sender.getParameters();if(i.codecs.length===0)return;const s=i.codecs[0].mimeType.toLocaleLowerCase();s==="video/h264"?this.safeEmit("sei-to-send",e):v.warning("SEI is not supported by ".concat(s))}bindProcessorDestinationEvents(){this.processorDestination.on(Qn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await _t(this,he.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await _t(this,he.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Qn.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ci.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ci.REQUEST_CONSTRAINTS)}}$([Ae({argsMap:(n,e,t)=>[n.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",t]}),Gt(),A("design:type",Function),A("design:paramtypes",[Object,Object]),A("design:returntype",void 0)],Ge.prototype,"play",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ge.prototype,"stop",null),$([Dd("LocalVideoTrack","_enabledMutex"),Ae({argsMap:(n,e)=>[n.getTrackId(),e]}),Gt(),A("design:type",Function),A("design:paramtypes",[Boolean,Boolean]),A("design:returntype",W)],Ge.prototype,"setEnabled",null),$([Dd("LocalVideoTrack","_enabledMutex"),Ae({argsMap:(n,e)=>[n.getTrackId(),e]}),Gt(),A("design:type",Function),A("design:paramtypes",[Boolean]),A("design:returntype",W)],Ge.prototype,"setMuted",null),$([Ae({argsMap:(n,e)=>[n.getTrackId(),e]}),Gt(),A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",W)],Ge.prototype,"setEncoderConfiguration",null),$([Gt(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Object)],Ge.prototype,"getStats",null),$([Ae({argsMap:(n,e,t)=>[n.getTrackId(),e,t]}),Gt(),A("design:type",Function),A("design:paramtypes",[Boolean,Object]),A("design:returntype",W)],Ge.prototype,"setBeautyEffect",null),$([Gt(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",ImageData)],Ge.prototype,"getCurrentFrameData",null),$([Gt(),A("design:type",Function),A("design:paramtypes",[String,Number]),A("design:returntype",W)],Ge.prototype,"getCurrentFrameImage",null),$([Gt(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],Ge.prototype,"setBitrateLimit",null),$([Gt(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],Ge.prototype,"setOptimizationMode",null),$([Gt(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",void 0)],Ge.prototype,"setScalabiltyMode",null),$([Gt(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ge.prototype,"updateMediaStreamTrackResolution",null),$([Ae({argsMap:(n,e)=>[n.getTrackId(),e.name]}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Object)],Ge.prototype,"pipe",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ge.prototype,"unpipe",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ge.prototype,"close",null),$([Ae({argsMap:(n,e,t)=>[n.getTrackId(),e.label,t]}),A("design:type",Function),A("design:paramtypes",[MediaStreamTrack,Boolean]),A("design:returntype",W)],Ge.prototype,"replaceTrack",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ge.prototype,"startMonitorStats",null);class Ta extends Ge{get __className__(){return"CameraVideoTrack"}constructor(e,t,i,s,a,c){super(e,zs(t.encoderConfig),s,a,c),S(this,"_config",void 0),S(this,"_originalConstraints",void 0),S(this,"_constraints",void 0),S(this,"_enabled",!0),S(this,"_deviceName","default"),S(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(wd()||gS())&&!function(){const l=Ze();if(l.os!==on.IOS||!l.osVersion)return!1;const h=l.osVersion.split(".");return Number(h[0])===15&&Number(h[1])>=2}()&&WO()&&this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=zs(this._config.encoderConfig),dt.on(fn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),dt.on(fn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(v.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await sr.getDeviceById(e),i={};i.video=ar({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let s=null;try{s=await rr(i,this.getTrackId())}catch(a){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),s=await rr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await sr.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}v.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){v.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const t={video:ar(ar({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await rr(t,this.getTrackId())}catch(s){throw v.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),s.toString()),i=await rr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=ar({},t.video),v.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await rr({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await _t(this,he.NEED_ENABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await _t(this,he.NEED_DISABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new Q(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),e=zs(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin);const i=St(this._config);i.encoderConfig=e;const s=Yf(i);(wn()||ni()||Bs())&&(s.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(a){const c=new Q(O.UNEXPECTED_ERROR,a.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=i,this._constraints=s,this._originalConstraints=s,this._encoderConfig=e,this._hints.indexOf(Tt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await _t(this,he.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(v)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ni()||Bs())&&this._enabled&&!this._isClosed&&dt.duringInterruption){const e=async()=>{dt.off(fn.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};dt.on(fn.IOS_INTERRUPTION_END,e)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ea.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,i=sr.searchDeviceIdByName(this._deviceName);if(i&&!t.deviceId&&(t.deviceId={exact:i}),this._enabled){const s=await rr({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),dt.off(fn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),dt.off(fn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=ar(ar({},i),zs(e))),i=Tc(i);const s=Et(8,"track-cam-cloned-"),a=new Ta(t?this._mediaStreamTrack.clone():this._mediaStreamTrack,Tc(ar(ar({},this._config),{},{encoderConfig:i})),Tc(this._constraints),Tc(this._scalabilityMode),this._optimizationMode,s);return e&&i&&a.setEncoderConfiguration(i),v.debug("clone track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(t)),a}bindProcessorContextEvents(){this.processorContext.on(Ci.REQUEST_UPDATE_CONSTRAINTS,async(e,t,i)=>{try{const s=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(s),t()}catch(s){i(s)}}),this.processorContext.on(Ci.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}function yP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function qf(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?yP(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):yP(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function PT(n,e,t,i){t.optimizationMode&&(i&&i.width&&i.height?(t.encoderConfig=qf(qf({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),t.optimizationMode!=="motion"&&t.optimizationMode!=="detail"||(e.contentHint=t.optimizationMode,e.contentHint===t.optimizationMode?v.debug("[".concat(n,"] set content hint to"),t.optimizationMode):v.debug("[".concat(n,"] set content hint failed")))):v.warning("[".concat(n,"] can not apply optimization mode bitrate config, no encoderConfig")))}function RP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Jf(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?RP(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):RP(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}$([Ae({argsMap:(n,e)=>[n.getTrackId(),e]}),Gt(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],Ta.prototype,"setDevice",null),$([Dd("CameraVideoTrack","_enabledMutex"),Ae({argsMap:(n,e)=>[n.getTrackId(),e]}),Gt(),A("design:type",Function),A("design:paramtypes",[Boolean,Boolean]),A("design:returntype",W)],Ta.prototype,"setEnabled",null),$([Ae({argsMap:(n,e)=>[n.getTrackId(),e]}),Gt(),A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",W)],Ta.prototype,"setEncoderConfiguration",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ta.prototype,"close",null);class CP extends KN{getUserId(){return this._userId}constructor(e,t,i,s){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(s.clientId,"_").concat(Et(5,""))),S(this,"_userId",void 0),S(this,"_uintId",void 0),S(this,"_isDestroyed",!1),S(this,"store",void 0),S(this,"processor",void 0),this._userId=t,this._uintId=i,this.store=s}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,v.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class Ys extends CP{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==$n.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,i,s){super(e,t,i,s),S(this,"_videoVisibleTimer",null),S(this,"_previousVideoVisibleStatus",void 0),S(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),S(this,"trackMediaType","video"),S(this,"_videoWidth",void 0),S(this,"_videoHeight",void 0),S(this,"_player",void 0),S(this,"processorDestination",void 0),S(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new cP(this.getTrackId(),"remote"),this.processorDestination=new aP(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Nd(()=>{v.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ui(this,he.GET_STATS)||Jf({},HN)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const s=document.getElementById(e);s?e=s:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const i=Jf(Jf({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new NT(i):this._player=new gP(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(ga.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=s=>{this.safeEmit(ga.VIDEO_STATE_CHANGED,s)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(ga.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},L("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){SP(this._originMediaStreamTrack).then(e=>{let[t,i]=e;this._videoHeight=i,this._videoWidth=t}).catch(Ef)}_updatePlayerSource(){v.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),s={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:c}=s;if(this.isPlaying&&a instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=qO.checkOneElementVisible(a),h=Object.assign({},l);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const p=Te.reportApiInvoke(null,{tag:Pt.TRACER,name:Jt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(i){throw new Q(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Q(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Qn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Qn.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(_a.SEI_RECEIVED,e)}}$([Ae({argsMap:(n,e,t)=>[n.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",t]}),A("design:type",Function),A("design:paramtypes",[Object,Object]),A("design:returntype",void 0)],Ys.prototype,"play",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ys.prototype,"stop",null),$([Ae({argsMap:(n,e)=>[n.getTrackId(),e.name]}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Object)],Ys.prototype,"pipe",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ys.prototype,"unpipe",null);class Yr extends CP{get isPlaying(){return this._useAudioElement?fi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,i,s){super(e,t,i,s),S(this,"trackMediaType","audio"),S(this,"_source",void 0),S(this,"_useAudioElement",!0),S(this,"_volume",100),S(this,"processorContext",void 0),S(this,"processorDestination",void 0),S(this,"_played",!1),S(this,"_bypassWebAudio",!1),L("DISABLE_WEBAUDIO")?(this._source=new AT,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new XN(e,!0),L("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Ri.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(ga.FIRST_FRAME_DECODED)}),this.processorContext=new lP(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new dP(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Ri.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Ri.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Ri.ON_AUDIO_BUFFER),this._source.on(Ri.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?fi.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!_o()&&L("RESTRICTION_SET_PLAYBACK_DEVICE"))throw new Q(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await fi.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Nd(()=>{v.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ui(this,he.GET_STATS)||Jf({},WN)}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] use audio element to play")),fi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?fi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&fi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Q(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Qn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Qn.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Qn.ON_TRACK),this.processorDestination.removeAllListeners(Qn.ON_NODE)}}$([Ae({argsMap:(n,e)=>[n.getTrackId(),e],throttleTime:300}),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],Yr.prototype,"setVolume",null),$([Ae({argsMap:(n,e)=>[n.getTrackId(),e]}),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],Yr.prototype,"setPlaybackDevice",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Yr.prototype,"play",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Yr.prototype,"stop",null),$([Ae({argsMap:(n,e)=>[n.getTrackId(),e.name]}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Object)],Yr.prototype,"pipe",null),$([Ae({argsMap:n=>[n.getTrackId()]}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Yr.prototype,"unpipe",null);const Ao=new class extends At{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),S(this,"_lastHiddenTime",0),S(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),v.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Kd(n){let e=n.length;for(;--e>=0;)n[e]=0}const DT=256,IP=286,ku=30,Lu=15,kT=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Xf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),aK=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),wP=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Oo=new Array(576);Kd(Oo);const Mu=new Array(60);Kd(Mu);const Uu=new Array(512);Kd(Uu);const xu=new Array(256);Kd(xu);const LT=new Array(29);Kd(LT);const Qf=new Array(ku);function MT(n,e,t,i,s){this.static_tree=n,this.extra_bits=e,this.extra_base=t,this.elems=i,this.max_length=s,this.has_stree=n&&n.length}let AP,OP,bP;function UT(n,e){this.dyn_tree=n,this.max_code=0,this.stat_desc=e}Kd(Qf);const NP=n=>n<256?Uu[n]:Uu[256+(n>>>7)],Vu=(n,e)=>{n.pending_buf[n.pending++]=255&e,n.pending_buf[n.pending++]=e>>>8&255},cr=(n,e,t)=>{n.bi_valid>16-t?(n.bi_buf|=e<<n.bi_valid&65535,Vu(n,n.bi_buf),n.bi_buf=e>>16-n.bi_valid,n.bi_valid+=t-16):(n.bi_buf|=e<<n.bi_valid&65535,n.bi_valid+=t)},qs=(n,e,t)=>{cr(n,t[2*e],t[2*e+1])},PP=(n,e)=>{let t=0;do t|=1&n,n>>>=1,t<<=1;while(--e>0);return t>>>1},DP=(n,e,t)=>{const i=new Array(16);let s,a,c=0;for(s=1;s<=Lu;s++)c=c+t[s-1]<<1,i[s]=c;for(a=0;a<=e;a++){let l=n[2*a+1];l!==0&&(n[2*a]=PP(i[l]++,l))}},kP=n=>{let e;for(e=0;e<IP;e++)n.dyn_ltree[2*e]=0;for(e=0;e<ku;e++)n.dyn_dtree[2*e]=0;for(e=0;e<19;e++)n.bl_tree[2*e]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},LP=n=>{n.bi_valid>8?Vu(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},MP=(n,e,t,i)=>{const s=2*e,a=2*t;return n[s]<n[a]||n[s]===n[a]&&i[e]<=i[t]},xT=(n,e,t)=>{const i=n.heap[t];let s=t<<1;for(;s<=n.heap_len&&(s<n.heap_len&&MP(e,n.heap[s+1],n.heap[s],n.depth)&&s++,!MP(e,i,n.heap[s],n.depth));)n.heap[t]=n.heap[s],t=s,s<<=1;n.heap[t]=i},UP=(n,e,t)=>{let i,s,a,c,l=0;if(n.sym_next!==0)do i=255&n.pending_buf[n.sym_buf+l++],i+=(255&n.pending_buf[n.sym_buf+l++])<<8,s=n.pending_buf[n.sym_buf+l++],i===0?qs(n,s,e):(a=xu[s],qs(n,a+DT+1,e),c=kT[a],c!==0&&(s-=LT[a],cr(n,s,c)),i--,a=NP(i),qs(n,a,t),c=Xf[a],c!==0&&(i-=Qf[a],cr(n,i,c)));while(l<n.sym_next);qs(n,256,e)},VT=(n,e)=>{const t=e.dyn_tree,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,a=e.stat_desc.elems;let c,l,h,p=-1;for(n.heap_len=0,n.heap_max=573,c=0;c<a;c++)t[2*c]!==0?(n.heap[++n.heap_len]=p=c,n.depth[c]=0):t[2*c+1]=0;for(;n.heap_len<2;)h=n.heap[++n.heap_len]=p<2?++p:0,t[2*h]=1,n.depth[h]=0,n.opt_len--,s&&(n.static_len-=i[2*h+1]);for(e.max_code=p,c=n.heap_len>>1;c>=1;c--)xT(n,t,c);h=a;do c=n.heap[1],n.heap[1]=n.heap[n.heap_len--],xT(n,t,1),l=n.heap[1],n.heap[--n.heap_max]=c,n.heap[--n.heap_max]=l,t[2*h]=t[2*c]+t[2*l],n.depth[h]=(n.depth[c]>=n.depth[l]?n.depth[c]:n.depth[l])+1,t[2*c+1]=t[2*l+1]=h,n.heap[1]=h++,xT(n,t,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((f,_)=>{const g=_.dyn_tree,T=_.max_code,w=_.stat_desc.static_tree,R=_.stat_desc.has_stree,I=_.stat_desc.extra_bits,N=_.stat_desc.extra_base,D=_.stat_desc.max_length;let V,G,F,j,z,Y,re=0;for(j=0;j<=Lu;j++)f.bl_count[j]=0;for(g[2*f.heap[f.heap_max]+1]=0,V=f.heap_max+1;V<573;V++)G=f.heap[V],j=g[2*g[2*G+1]+1]+1,j>D&&(j=D,re++),g[2*G+1]=j,G>T||(f.bl_count[j]++,z=0,G>=N&&(z=I[G-N]),Y=g[2*G],f.opt_len+=Y*(j+z),R&&(f.static_len+=Y*(w[2*G+1]+z)));if(re!==0){do{for(j=D-1;f.bl_count[j]===0;)j--;f.bl_count[j]--,f.bl_count[j+1]+=2,f.bl_count[D]--,re-=2}while(re>0);for(j=D;j!==0;j--)for(G=f.bl_count[j];G!==0;)F=f.heap[--V],F>T||(g[2*F+1]!==j&&(f.opt_len+=(j-g[2*F+1])*g[2*F],g[2*F+1]=j),G--)}})(n,e),DP(t,p,n.bl_count)},xP=(n,e,t)=>{let i,s,a=-1,c=e[1],l=0,h=7,p=4;for(c===0&&(h=138,p=3),e[2*(t+1)+1]=65535,i=0;i<=t;i++)s=c,c=e[2*(i+1)+1],++l<h&&s===c||(l<p?n.bl_tree[2*s]+=l:s!==0?(s!==a&&n.bl_tree[2*s]++,n.bl_tree[32]++):l<=10?n.bl_tree[34]++:n.bl_tree[36]++,l=0,a=s,c===0?(h=138,p=3):s===c?(h=6,p=3):(h=7,p=4))},VP=(n,e,t)=>{let i,s,a=-1,c=e[1],l=0,h=7,p=4;for(c===0&&(h=138,p=3),i=0;i<=t;i++)if(s=c,c=e[2*(i+1)+1],!(++l<h&&s===c)){if(l<p)do qs(n,s,n.bl_tree);while(--l!=0);else s!==0?(s!==a&&(qs(n,s,n.bl_tree),l--),qs(n,16,n.bl_tree),cr(n,l-3,2)):l<=10?(qs(n,17,n.bl_tree),cr(n,l-3,3)):(qs(n,18,n.bl_tree),cr(n,l-11,7));l=0,a=s,c===0?(h=138,p=3):s===c?(h=6,p=3):(h=7,p=4)}};let FP=!1;const BP=(n,e,t,i)=>{cr(n,0+(i?1:0),3),LP(n),Vu(n,t),Vu(n,~t),t&&n.pending_buf.set(n.window.subarray(e,e+t),n.pending),n.pending+=t};var cK=n=>{FP||((()=>{let e,t,i,s,a;const c=new Array(16);for(i=0,s=0;s<28;s++)for(LT[s]=i,e=0;e<1<<kT[s];e++)xu[i++]=s;for(xu[i-1]=s,a=0,s=0;s<16;s++)for(Qf[s]=a,e=0;e<1<<Xf[s];e++)Uu[a++]=s;for(a>>=7;s<ku;s++)for(Qf[s]=a<<7,e=0;e<1<<Xf[s]-7;e++)Uu[256+a++]=s;for(t=0;t<=Lu;t++)c[t]=0;for(e=0;e<=143;)Oo[2*e+1]=8,e++,c[8]++;for(;e<=255;)Oo[2*e+1]=9,e++,c[9]++;for(;e<=279;)Oo[2*e+1]=7,e++,c[7]++;for(;e<=287;)Oo[2*e+1]=8,e++,c[8]++;for(DP(Oo,287,c),e=0;e<ku;e++)Mu[2*e+1]=5,Mu[2*e]=PP(e,5);AP=new MT(Oo,kT,257,IP,Lu),OP=new MT(Mu,Xf,0,ku,Lu),bP=new MT(new Array(0),aK,0,19,7)})(),FP=!0),n.l_desc=new UT(n.dyn_ltree,AP),n.d_desc=new UT(n.dyn_dtree,OP),n.bl_desc=new UT(n.bl_tree,bP),n.bi_buf=0,n.bi_valid=0,kP(n)},dK=(n,e,t,i)=>{let s,a,c=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=(l=>{let h,p=4093624447;for(h=0;h<=31;h++,p>>>=1)if(1&p&&l.dyn_ltree[2*h]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(h=32;h<DT;h++)if(l.dyn_ltree[2*h]!==0)return 1;return 0})(n)),VT(n,n.l_desc),VT(n,n.d_desc),c=(l=>{let h;for(xP(l,l.dyn_ltree,l.l_desc.max_code),xP(l,l.dyn_dtree,l.d_desc.max_code),VT(l,l.bl_desc),h=18;h>=3&&l.bl_tree[2*wP[h]+1]===0;h--);return l.opt_len+=3*(h+1)+5+5+4,h})(n),s=n.opt_len+3+7>>>3,a=n.static_len+3+7>>>3,a<=s&&(s=a)):s=a=t+5,t+4<=s&&e!==-1?BP(n,e,t,i):n.strategy===4||a===s?(cr(n,2+(i?1:0),3),UP(n,Oo,Mu)):(cr(n,4+(i?1:0),3),((l,h,p,f)=>{let _;for(cr(l,h-257,5),cr(l,p-1,5),cr(l,f-4,4),_=0;_<f;_++)cr(l,l.bl_tree[2*wP[_]+1],3);VP(l,l.dyn_ltree,h-1),VP(l,l.dyn_dtree,p-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,c+1),UP(n,n.dyn_ltree,n.dyn_dtree)),kP(n),i&&LP(n)},lK=(n,e,t)=>(n.pending_buf[n.sym_buf+n.sym_next++]=e,n.pending_buf[n.sym_buf+n.sym_next++]=e>>8,n.pending_buf[n.sym_buf+n.sym_next++]=t,e===0?n.dyn_ltree[2*t]++:(n.matches++,e--,n.dyn_ltree[2*(xu[t]+DT+1)]++,n.dyn_dtree[2*NP(e)]++),n.sym_next===n.sym_end),uK={_tr_init:cK,_tr_stored_block:BP,_tr_flush_block:dK,_tr_tally:lK,_tr_align:n=>{cr(n,2,3),qs(n,256,Oo),(e=>{e.bi_valid===16?(Vu(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(n)}},Fu=(n,e,t,i)=>{let s=65535&n|0,a=n>>>16&65535|0,c=0;for(;t!==0;){c=t>2e3?2e3:t,t-=c;do s=s+e[i++]|0,a=a+s|0;while(--c);s%=65521,a%=65521}return s|a<<16|0};const hK=new Uint32Array((()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var i=0;i<8;i++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e})());var ui=(n,e,t,i)=>{const s=hK,a=i+t;n^=-1;for(let c=i;c<a;c++)n=n>>>8^s[255&(n^e[c])];return-1^n},Oc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},zd={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:pK,_tr_stored_block:FT,_tr_flush_block:fK,_tr_tally:va,_tr_align:mK}=uK,{Z_NO_FLUSH:ya,Z_PARTIAL_FLUSH:_K,Z_FULL_FLUSH:EK,Z_FINISH:qr,Z_BLOCK:jP,Z_OK:mi,Z_STREAM_END:GP,Z_STREAM_ERROR:Js,Z_DATA_ERROR:gK,Z_BUF_ERROR:BT,Z_DEFAULT_COMPRESSION:SK,Z_FILTERED:TK,Z_HUFFMAN_ONLY:$f,Z_RLE:vK,Z_FIXED:yK,Z_DEFAULT_STRATEGY:RK,Z_UNKNOWN:CK,Z_DEFLATED:Zf}=zd,jT=286,IK=30,wK=19,AK=2*jT+1,OK=15,bc=258,Xs=262,Yd=42,Nc=113,Bu=666,Pc=(n,e)=>(n.msg=Oc[e],e),WP=n=>2*n-(n>4?9:0),Ra=n=>{let e=n.length;for(;--e>=0;)n[e]=0},bK=n=>{let e,t,i,s=n.w_size;e=n.hash_size,i=e;do t=n.head[--i],n.head[i]=t>=s?t-s:0;while(--e);e=s,i=e;do t=n.prev[--i],n.prev[i]=t>=s?t-s:0;while(--e)};let Ca=(n,e,t)=>(e<<n.hash_shift^t)&n.hash_mask;const Cr=n=>{const e=n.state;let t=e.pending;t>n.avail_out&&(t=n.avail_out),t!==0&&(n.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),n.next_out),n.next_out+=t,e.pending_out+=t,n.total_out+=t,n.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},Ir=(n,e)=>{fK(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,e),n.block_start=n.strstart,Cr(n.strm)},Vt=(n,e)=>{n.pending_buf[n.pending++]=e},ju=(n,e)=>{n.pending_buf[n.pending++]=e>>>8&255,n.pending_buf[n.pending++]=255&e},GT=(n,e,t,i)=>{let s=n.avail_in;return s>i&&(s=i),s===0?0:(n.avail_in-=s,e.set(n.input.subarray(n.next_in,n.next_in+s),t),n.state.wrap===1?n.adler=Fu(n.adler,e,s,t):n.state.wrap===2&&(n.adler=ui(n.adler,e,s,t)),n.next_in+=s,n.total_in+=s,s)},HP=(n,e)=>{let t,i,s=n.max_chain_length,a=n.strstart,c=n.prev_length,l=n.nice_match;const h=n.strstart>n.w_size-Xs?n.strstart-(n.w_size-Xs):0,p=n.window,f=n.w_mask,_=n.prev,g=n.strstart+bc;let T=p[a+c-1],w=p[a+c];n.prev_length>=n.good_match&&(s>>=2),l>n.lookahead&&(l=n.lookahead);do if(t=e,p[t+c]===w&&p[t+c-1]===T&&p[t]===p[a]&&p[++t]===p[a+1]){a+=2,t++;do;while(p[++a]===p[++t]&&p[++a]===p[++t]&&p[++a]===p[++t]&&p[++a]===p[++t]&&p[++a]===p[++t]&&p[++a]===p[++t]&&p[++a]===p[++t]&&p[++a]===p[++t]&&a<g);if(i=bc-(g-a),a=g-bc,i>c){if(n.match_start=e,c=i,i>=l)break;T=p[a+c-1],w=p[a+c]}}while((e=_[e&f])>h&&--s!=0);return c<=n.lookahead?c:n.lookahead},qd=n=>{const e=n.w_size;let t,i,s;do{if(i=n.window_size-n.lookahead-n.strstart,n.strstart>=e+(e-Xs)&&(n.window.set(n.window.subarray(e,e+e-i),0),n.match_start-=e,n.strstart-=e,n.block_start-=e,n.insert>n.strstart&&(n.insert=n.strstart),bK(n),i+=e),n.strm.avail_in===0)break;if(t=GT(n.strm,n.window,n.strstart+n.lookahead,i),n.lookahead+=t,n.lookahead+n.insert>=3)for(s=n.strstart-n.insert,n.ins_h=n.window[s],n.ins_h=Ca(n,n.ins_h,n.window[s+1]);n.insert&&(n.ins_h=Ca(n,n.ins_h,n.window[s+3-1]),n.prev[s&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=s,s++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<Xs&&n.strm.avail_in!==0)},KP=(n,e)=>{let t,i,s,a=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,c=0,l=n.strm.avail_in;do{if(t=65535,s=n.bi_valid+42>>3,n.strm.avail_out<s||(s=n.strm.avail_out-s,i=n.strstart-n.block_start,t>i+n.strm.avail_in&&(t=i+n.strm.avail_in),t>s&&(t=s),t<a&&(t===0&&e!==qr||e===ya||t!==i+n.strm.avail_in)))break;c=e===qr&&t===i+n.strm.avail_in?1:0,FT(n,0,0,c),n.pending_buf[n.pending-4]=t,n.pending_buf[n.pending-3]=t>>8,n.pending_buf[n.pending-2]=~t,n.pending_buf[n.pending-1]=~t>>8,Cr(n.strm),i&&(i>t&&(i=t),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+i),n.strm.next_out),n.strm.next_out+=i,n.strm.avail_out-=i,n.strm.total_out+=i,n.block_start+=i,t-=i),t&&(GT(n.strm,n.strm.output,n.strm.next_out,t),n.strm.next_out+=t,n.strm.avail_out-=t,n.strm.total_out+=t)}while(c===0);return l-=n.strm.avail_in,l&&(l>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=l&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-l,n.strm.next_in),n.strstart),n.strstart+=l,n.insert+=l>n.w_size-n.insert?n.w_size-n.insert:l),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),c?4:e!==ya&&e!==qr&&n.strm.avail_in===0&&n.strstart===n.block_start?2:(s=n.window_size-n.strstart,n.strm.avail_in>s&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,s+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),s>n.strm.avail_in&&(s=n.strm.avail_in),s&&(GT(n.strm,n.window,n.strstart,s),n.strstart+=s,n.insert+=s>n.w_size-n.insert?n.w_size-n.insert:s),n.high_water<n.strstart&&(n.high_water=n.strstart),s=n.bi_valid+42>>3,s=n.pending_buf_size-s>65535?65535:n.pending_buf_size-s,a=s>n.w_size?n.w_size:s,i=n.strstart-n.block_start,(i>=a||(i||e===qr)&&e!==ya&&n.strm.avail_in===0&&i<=s)&&(t=i>s?s:i,c=e===qr&&n.strm.avail_in===0&&t===i?1:0,FT(n,n.block_start,t,c),n.block_start+=t,Cr(n.strm)),c?3:1)},WT=(n,e)=>{let t,i;for(;;){if(n.lookahead<Xs){if(qd(n),n.lookahead<Xs&&e===ya)return 1;if(n.lookahead===0)break}if(t=0,n.lookahead>=3&&(n.ins_h=Ca(n,n.ins_h,n.window[n.strstart+3-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),t!==0&&n.strstart-t<=n.w_size-Xs&&(n.match_length=HP(n,t)),n.match_length>=3)if(i=va(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do n.strstart++,n.ins_h=Ca(n,n.ins_h,n.window[n.strstart+3-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=Ca(n,n.ins_h,n.window[n.strstart+1]);else i=va(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(i&&(Ir(n,!1),n.strm.avail_out===0))return 1}return n.insert=n.strstart<2?n.strstart:2,e===qr?(Ir(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(Ir(n,!1),n.strm.avail_out===0)?1:2},Jd=(n,e)=>{let t,i,s;for(;;){if(n.lookahead<Xs){if(qd(n),n.lookahead<Xs&&e===ya)return 1;if(n.lookahead===0)break}if(t=0,n.lookahead>=3&&(n.ins_h=Ca(n,n.ins_h,n.window[n.strstart+3-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,t!==0&&n.prev_length<n.max_lazy_match&&n.strstart-t<=n.w_size-Xs&&(n.match_length=HP(n,t),n.match_length<=5&&(n.strategy===TK||n.match_length===3&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){s=n.strstart+n.lookahead-3,i=va(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=s&&(n.ins_h=Ca(n,n.ins_h,n.window[n.strstart+3-1]),t=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=2,n.strstart++,i&&(Ir(n,!1),n.strm.avail_out===0))return 1}else if(n.match_available){if(i=va(n,0,n.window[n.strstart-1]),i&&Ir(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(i=va(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,e===qr?(Ir(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(Ir(n,!1),n.strm.avail_out===0)?1:2};function Qs(n,e,t,i,s){this.good_length=n,this.max_lazy=e,this.nice_length=t,this.max_chain=i,this.func=s}const Gu=[new Qs(0,0,0,0,KP),new Qs(4,4,8,4,WT),new Qs(4,5,16,8,WT),new Qs(4,6,32,32,WT),new Qs(4,4,16,16,Jd),new Qs(8,16,32,32,Jd),new Qs(8,16,128,128,Jd),new Qs(8,32,128,256,Jd),new Qs(32,128,258,1024,Jd),new Qs(32,258,258,4096,Jd)];function NK(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Zf,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*AK),this.dyn_dtree=new Uint16Array(2*(2*IK+1)),this.bl_tree=new Uint16Array(2*(2*wK+1)),Ra(this.dyn_ltree),Ra(this.dyn_dtree),Ra(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(OK+1),this.heap=new Uint16Array(2*jT+1),Ra(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*jT+1),Ra(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Wu=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.status!==Yd&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Nc&&e.status!==Bu?1:0},zP=n=>{if(Wu(n))return Pc(n,Js);n.total_in=n.total_out=0,n.data_type=CK;const e=n.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?Yd:Nc,n.adler=e.wrap===2?0:1,e.last_flush=-2,pK(e),mi},YP=n=>{const e=zP(n);var t;return e===mi&&((t=n.state).window_size=2*t.w_size,Ra(t.head),t.max_lazy_match=Gu[t.level].max_lazy,t.good_match=Gu[t.level].good_length,t.nice_match=Gu[t.level].nice_length,t.max_chain_length=Gu[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),e},qP=(n,e,t,i,s,a)=>{if(!n)return Js;let c=1;if(e===SK&&(e=6),i<0?(c=0,i=-i):i>15&&(c=2,i-=16),s<1||s>9||t!==Zf||i<8||i>15||e<0||e>9||a<0||a>yK||i===8&&c!==1)return Pc(n,Js);i===8&&(i=9);const l=new NK;return n.state=l,l.strm=n,l.status=Yd,l.wrap=c,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=e,l.strategy=a,l.method=t,YP(n)};var PK=(n,e)=>{if(Wu(n)||e>jP||e<0)return n?Pc(n,Js):Js;const t=n.state;if(!n.output||n.avail_in!==0&&!n.input||t.status===Bu&&e!==qr)return Pc(n,n.avail_out===0?BT:Js);const i=t.last_flush;if(t.last_flush=e,t.pending!==0){if(Cr(n),n.avail_out===0)return t.last_flush=-1,mi}else if(n.avail_in===0&&WP(e)<=WP(i)&&e!==qr)return Pc(n,BT);if(t.status===Bu&&n.avail_in!==0)return Pc(n,BT);if(t.status===Yd&&t.wrap===0&&(t.status=Nc),t.status===Yd){let s=Zf+(t.w_bits-8<<4)<<8,a=-1;if(a=t.strategy>=$f||t.level<2?0:t.level<6?1:t.level===6?2:3,s|=a<<6,t.strstart!==0&&(s|=32),s+=31-s%31,ju(t,s),t.strstart!==0&&(ju(t,n.adler>>>16),ju(t,65535&n.adler)),n.adler=1,t.status=Nc,Cr(n),t.pending!==0)return t.last_flush=-1,mi}if(t.status===57){if(n.adler=0,Vt(t,31),Vt(t,139),Vt(t,8),t.gzhead)Vt(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),Vt(t,255&t.gzhead.time),Vt(t,t.gzhead.time>>8&255),Vt(t,t.gzhead.time>>16&255),Vt(t,t.gzhead.time>>24&255),Vt(t,t.level===9?2:t.strategy>=$f||t.level<2?4:0),Vt(t,255&t.gzhead.os),t.gzhead.extra&&t.gzhead.extra.length&&(Vt(t,255&t.gzhead.extra.length),Vt(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(n.adler=ui(n.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=69;else if(Vt(t,0),Vt(t,0),Vt(t,0),Vt(t,0),Vt(t,0),Vt(t,t.level===9?2:t.strategy>=$f||t.level<2?4:0),Vt(t,3),t.status=Nc,Cr(n),t.pending!==0)return t.last_flush=-1,mi}if(t.status===69){if(t.gzhead.extra){let s=t.pending,a=(65535&t.gzhead.extra.length)-t.gzindex;for(;t.pending+a>t.pending_buf_size;){let l=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+l),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>s&&(n.adler=ui(n.adler,t.pending_buf,t.pending-s,s)),t.gzindex+=l,Cr(n),t.pending!==0)return t.last_flush=-1,mi;s=0,a-=l}let c=new Uint8Array(t.gzhead.extra);t.pending_buf.set(c.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending+=a,t.gzhead.hcrc&&t.pending>s&&(n.adler=ui(n.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=73}if(t.status===73){if(t.gzhead.name){let s,a=t.pending;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>a&&(n.adler=ui(n.adler,t.pending_buf,t.pending-a,a)),Cr(n),t.pending!==0)return t.last_flush=-1,mi;a=0}s=t.gzindex<t.gzhead.name.length?255&t.gzhead.name.charCodeAt(t.gzindex++):0,Vt(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>a&&(n.adler=ui(n.adler,t.pending_buf,t.pending-a,a)),t.gzindex=0}t.status=91}if(t.status===91){if(t.gzhead.comment){let s,a=t.pending;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>a&&(n.adler=ui(n.adler,t.pending_buf,t.pending-a,a)),Cr(n),t.pending!==0)return t.last_flush=-1,mi;a=0}s=t.gzindex<t.gzhead.comment.length?255&t.gzhead.comment.charCodeAt(t.gzindex++):0,Vt(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>a&&(n.adler=ui(n.adler,t.pending_buf,t.pending-a,a))}t.status=103}if(t.status===103){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(Cr(n),t.pending!==0))return t.last_flush=-1,mi;Vt(t,255&n.adler),Vt(t,n.adler>>8&255),n.adler=0}if(t.status=Nc,Cr(n),t.pending!==0)return t.last_flush=-1,mi}if(n.avail_in!==0||t.lookahead!==0||e!==ya&&t.status!==Bu){let s=t.level===0?KP(t,e):t.strategy===$f?((a,c)=>{let l;for(;;){if(a.lookahead===0&&(qd(a),a.lookahead===0)){if(c===ya)return 1;break}if(a.match_length=0,l=va(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,l&&(Ir(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,c===qr?(Ir(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(Ir(a,!1),a.strm.avail_out===0)?1:2})(t,e):t.strategy===vK?((a,c)=>{let l,h,p,f;const _=a.window;for(;;){if(a.lookahead<=bc){if(qd(a),a.lookahead<=bc&&c===ya)return 1;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(p=a.strstart-1,h=_[p],h===_[++p]&&h===_[++p]&&h===_[++p])){f=a.strstart+bc;do;while(h===_[++p]&&h===_[++p]&&h===_[++p]&&h===_[++p]&&h===_[++p]&&h===_[++p]&&h===_[++p]&&h===_[++p]&&p<f);a.match_length=bc-(f-p),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(l=va(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(l=va(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),l&&(Ir(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,c===qr?(Ir(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(Ir(a,!1),a.strm.avail_out===0)?1:2})(t,e):Gu[t.level].func(t,e);if(s!==3&&s!==4||(t.status=Bu),s===1||s===3)return n.avail_out===0&&(t.last_flush=-1),mi;if(s===2&&(e===_K?mK(t):e!==jP&&(FT(t,0,0,!1),e===EK&&(Ra(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),Cr(n),n.avail_out===0))return t.last_flush=-1,mi}return e!==qr?mi:t.wrap<=0?GP:(t.wrap===2?(Vt(t,255&n.adler),Vt(t,n.adler>>8&255),Vt(t,n.adler>>16&255),Vt(t,n.adler>>24&255),Vt(t,255&n.total_in),Vt(t,n.total_in>>8&255),Vt(t,n.total_in>>16&255),Vt(t,n.total_in>>24&255)):(ju(t,n.adler>>>16),ju(t,65535&n.adler)),Cr(n),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?mi:GP)},DK=(n,e)=>{let t=e.length;if(Wu(n))return Js;const i=n.state,s=i.wrap;if(s===2||s===1&&i.status!==Yd||i.lookahead)return Js;if(s===1&&(n.adler=Fu(n.adler,e,t,0)),i.wrap=0,t>=i.w_size){s===0&&(Ra(i.head),i.strstart=0,i.block_start=0,i.insert=0);let h=new Uint8Array(i.w_size);h.set(e.subarray(t-i.w_size,t),0),e=h,t=i.w_size}const a=n.avail_in,c=n.next_in,l=n.input;for(n.avail_in=t,n.next_in=0,n.input=e,qd(i);i.lookahead>=3;){let h=i.strstart,p=i.lookahead-2;do i.ins_h=Ca(i,i.ins_h,i.window[h+3-1]),i.prev[h&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=h,h++;while(--p);i.strstart=h,i.lookahead=2,qd(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,n.next_in=c,n.input=l,n.avail_in=a,i.wrap=s,mi},Hu={deflateInit:(n,e)=>qP(n,e,Zf,15,8,RK),deflateInit2:qP,deflateReset:YP,deflateResetKeep:zP,deflateSetHeader:(n,e)=>Wu(n)||n.state.wrap!==2?Js:(n.state.gzhead=e,mi),deflate:PK,deflateEnd:n=>{if(Wu(n))return Js;const e=n.state.status;return n.state=null,e===Nc?Pc(n,gK):mi},deflateSetDictionary:DK,deflateInfo:"pako deflate (from Nodeca project)"};const kK=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var em={assign:function(n){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)kK(t,i)&&(n[i]=t[i])}}return n},flattenChunks:n=>{let e=0;for(let i=0,s=n.length;i<s;i++)e+=n[i].length;const t=new Uint8Array(e);for(let i=0,s=0,a=n.length;i<a;i++){let c=n[i];t.set(c,s),s+=c.length}return t}};let JP=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{JP=!1}const Ku=new Uint8Array(256);for(let n=0;n<256;n++)Ku[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Ku[254]=Ku[254]=1;var zu={string2buf:n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,i,s,a,c=n.length,l=0;for(s=0;s<c;s++)t=n.charCodeAt(s),(64512&t)==55296&&s+1<c&&(i=n.charCodeAt(s+1),(64512&i)==56320&&(t=65536+(t-55296<<10)+(i-56320),s++)),l+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(l),a=0,s=0;a<l;s++)t=n.charCodeAt(s),(64512&t)==55296&&s+1<c&&(i=n.charCodeAt(s+1),(64512&i)==56320&&(t=65536+(t-55296<<10)+(i-56320),s++)),t<128?e[a++]=t:t<2048?(e[a++]=192|t>>>6,e[a++]=128|63&t):t<65536?(e[a++]=224|t>>>12,e[a++]=128|t>>>6&63,e[a++]=128|63&t):(e[a++]=240|t>>>18,e[a++]=128|t>>>12&63,e[a++]=128|t>>>6&63,e[a++]=128|63&t);return e},buf2string:(n,e)=>{const t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let i,s;const a=new Array(2*t);for(s=0,i=0;i<t;){let c=n[i++];if(c<128){a[s++]=c;continue}let l=Ku[c];if(l>4)a[s++]=65533,i+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&i<t;)c=c<<6|63&n[i++],l--;l>1?a[s++]=65533:c<65536?a[s++]=c:(c-=65536,a[s++]=55296|c>>10&1023,a[s++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&JP)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let h="";for(let p=0;p<l;p++)h+=String.fromCharCode(c[p]);return h})(a,s)},utf8border:(n,e)=>{(e=e||n.length)>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(192&n[t])==128;)t--;return t<0||t===0?e:t+Ku[n[t]]>e?t:e}},XP=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const QP=Object.prototype.toString,{Z_NO_FLUSH:LK,Z_SYNC_FLUSH:MK,Z_FULL_FLUSH:UK,Z_FINISH:xK,Z_OK:tm,Z_STREAM_END:VK,Z_DEFAULT_COMPRESSION:FK,Z_DEFAULT_STRATEGY:BK,Z_DEFLATED:jK}=zd;function Yu(n){this.options=em.assign({level:FK,method:jK,chunkSize:16384,windowBits:15,memLevel:8,strategy:BK},n||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new XP,this.strm.avail_out=0;let t=Hu.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==tm)throw new Error(Oc[t]);if(e.header&&Hu.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?zu.string2buf(e.dictionary):QP.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,t=Hu.deflateSetDictionary(this.strm,i),t!==tm)throw new Error(Oc[t]);this._dict_set=!0}}function HT(n,e){const t=new Yu(e);if(t.push(n,!0),t.err)throw t.msg||Oc[t.err];return t.result}Yu.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize;let s,a;if(this.ended)return!1;for(a=e===~~e?e:e===!0?xK:LK,typeof n=="string"?t.input=zu.string2buf(n):QP.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;)if(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),(a===MK||a===UK)&&t.avail_out<=6)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else{if(s=Hu.deflate(t,a),s===VK)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),s=Hu.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===tm;if(t.avail_out!==0){if(a>0&&t.next_out>0)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else if(t.avail_in===0)break}else this.onData(t.output)}return!0},Yu.prototype.onData=function(n){this.chunks.push(n)},Yu.prototype.onEnd=function(n){n===tm&&(this.result=em.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var GK={Deflate:Yu,deflate:HT,deflateRaw:function(n,e){return(e=e||{}).raw=!0,HT(n,e)},gzip:function(n,e){return(e=e||{}).gzip=!0,HT(n,e)},constants:zd};const nm=16209;var WK=function(n,e){let t,i,s,a,c,l,h,p,f,_,g,T,w,R,I,N,D,V,G,F,j,z,Y,re;const ae=n.state;t=n.next_in,Y=n.input,i=t+(n.avail_in-5),s=n.next_out,re=n.output,a=s-(e-n.avail_out),c=s+(n.avail_out-257),l=ae.dmax,h=ae.wsize,p=ae.whave,f=ae.wnext,_=ae.window,g=ae.hold,T=ae.bits,w=ae.lencode,R=ae.distcode,I=(1<<ae.lenbits)-1,N=(1<<ae.distbits)-1;e:do{T<15&&(g+=Y[t++]<<T,T+=8,g+=Y[t++]<<T,T+=8),D=w[g&I];t:for(;;){if(V=D>>>24,g>>>=V,T-=V,V=D>>>16&255,V===0)re[s++]=65535&D;else{if(!(16&V)){if(!(64&V)){D=w[(65535&D)+(g&(1<<V)-1)];continue t}if(32&V){ae.mode=16191;break e}n.msg="invalid literal/length code",ae.mode=nm;break e}G=65535&D,V&=15,V&&(T<V&&(g+=Y[t++]<<T,T+=8),G+=g&(1<<V)-1,g>>>=V,T-=V),T<15&&(g+=Y[t++]<<T,T+=8,g+=Y[t++]<<T,T+=8),D=R[g&N];n:for(;;){if(V=D>>>24,g>>>=V,T-=V,V=D>>>16&255,!(16&V)){if(!(64&V)){D=R[(65535&D)+(g&(1<<V)-1)];continue n}n.msg="invalid distance code",ae.mode=nm;break e}if(F=65535&D,V&=15,T<V&&(g+=Y[t++]<<T,T+=8,T<V&&(g+=Y[t++]<<T,T+=8)),F+=g&(1<<V)-1,F>l){n.msg="invalid distance too far back",ae.mode=nm;break e}if(g>>>=V,T-=V,V=s-a,F>V){if(V=F-V,V>p&&ae.sane){n.msg="invalid distance too far back",ae.mode=nm;break e}if(j=0,z=_,f===0){if(j+=h-V,V<G){G-=V;do re[s++]=_[j++];while(--V);j=s-F,z=re}}else if(f<V){if(j+=h+f-V,V-=f,V<G){G-=V;do re[s++]=_[j++];while(--V);if(j=0,f<G){V=f,G-=V;do re[s++]=_[j++];while(--V);j=s-F,z=re}}}else if(j+=f-V,V<G){G-=V;do re[s++]=_[j++];while(--V);j=s-F,z=re}for(;G>2;)re[s++]=z[j++],re[s++]=z[j++],re[s++]=z[j++],G-=3;G&&(re[s++]=z[j++],G>1&&(re[s++]=z[j++]))}else{j=s-F;do re[s++]=re[j++],re[s++]=re[j++],re[s++]=re[j++],G-=3;while(G>2);G&&(re[s++]=re[j++],G>1&&(re[s++]=re[j++]))}break}}break}}while(t<i&&s<c);G=T>>3,t-=G,T-=G<<3,g&=(1<<T)-1,n.next_in=t,n.next_out=s,n.avail_in=t<i?i-t+5:5-(t-i),n.avail_out=s<c?c-s+257:257-(s-c),ae.hold=g,ae.bits=T};const im=15,HK=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),KK=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),zK=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),YK=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var qu=(n,e,t,i,s,a,c,l)=>{const h=l.bits;let p,f,_,g,T,w,R=0,I=0,N=0,D=0,V=0,G=0,F=0,j=0,z=0,Y=0,re=null;const ae=new Uint16Array(16),Ue=new Uint16Array(16);let ze,vt,nn,It=null;for(R=0;R<=im;R++)ae[R]=0;for(I=0;I<i;I++)ae[e[t+I]]++;for(V=h,D=im;D>=1&&ae[D]===0;D--);if(V>D&&(V=D),D===0)return s[a++]=20971520,s[a++]=20971520,l.bits=1,0;for(N=1;N<D&&ae[N]===0;N++);for(V<N&&(V=N),j=1,R=1;R<=im;R++)if(j<<=1,j-=ae[R],j<0)return-1;if(j>0&&(n===0||D!==1))return-1;for(Ue[1]=0,R=1;R<im;R++)Ue[R+1]=Ue[R]+ae[R];for(I=0;I<i;I++)e[t+I]!==0&&(c[Ue[e[t+I]]++]=I);if(n===0?(re=It=c,w=20):n===1?(re=HK,It=KK,w=257):(re=zK,It=YK,w=0),Y=0,I=0,R=N,T=a,G=V,F=0,_=-1,z=1<<V,g=z-1,n===1&&z>852||n===2&&z>592)return 1;for(;;){ze=R-F,c[I]+1<w?(vt=0,nn=c[I]):c[I]>=w?(vt=It[c[I]-w],nn=re[c[I]-w]):(vt=96,nn=0),p=1<<R-F,f=1<<G,N=f;do f-=p,s[T+(Y>>F)+f]=ze<<24|vt<<16|nn|0;while(f!==0);for(p=1<<R-1;Y&p;)p>>=1;if(p!==0?(Y&=p-1,Y+=p):Y=0,I++,--ae[R]==0){if(R===D)break;R=e[t+c[I]]}if(R>V&&(Y&g)!==_){for(F===0&&(F=V),T+=N,G=R-F,j=1<<G;G+F<D&&(j-=ae[G+F],!(j<=0));)G++,j<<=1;if(z+=1<<G,n===1&&z>852||n===2&&z>592)return 1;_=Y&g,s[_]=V<<24|G<<16|T-a|0}}return Y!==0&&(s[T+Y]=R-F<<24|64<<16|0),l.bits=V,0};const{Z_FINISH:$P,Z_BLOCK:qK,Z_TREES:rm,Z_OK:Dc,Z_STREAM_END:JK,Z_NEED_DICT:XK,Z_STREAM_ERROR:Jr,Z_DATA_ERROR:ZP,Z_MEM_ERROR:eD,Z_BUF_ERROR:QK,Z_DEFLATED:tD}=zd,sm=16180,om=16190,bo=16191,KT=16192,zT=16194,am=16199,cm=16200,YT=16206,yn=16209,nD=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function $K(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const kc=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.mode<sm||e.mode>16211?1:0},iD=n=>{if(kc(n))return Jr;const e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=1&e.wrap),e.mode=sm,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,Dc},rD=n=>{if(kc(n))return Jr;const e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,iD(n)},sD=(n,e)=>{let t;if(kc(n))return Jr;const i=n.state;return e<0?(t=0,e=-e):(t=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Jr:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,rD(n))},oD=(n,e)=>{if(!n)return Jr;const t=new $K;n.state=t,t.strm=n,t.window=null,t.mode=sm;const i=sD(n,e);return i!==Dc&&(n.state=null),i};let qT,JT,aD=!0;const ZK=n=>{if(aD){qT=new Int32Array(512),JT=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(qu(1,n.lens,0,288,qT,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;qu(2,n.lens,0,32,JT,0,n.work,{bits:5}),aD=!1}n.lencode=qT,n.lenbits=9,n.distcode=JT,n.distbits=5},cD=(n,e,t,i)=>{let s;const a=n.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(e.subarray(t-a.wsize,t),0),a.wnext=0,a.whave=a.wsize):(s=a.wsize-a.wnext,s>i&&(s=i),a.window.set(e.subarray(t-i,t-i+s),a.wnext),(i-=s)?(a.window.set(e.subarray(t-i,t),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0};var e8=(n,e)=>{let t,i,s,a,c,l,h,p,f,_,g,T,w,R,I,N,D,V,G,F,j,z,Y=0;const re=new Uint8Array(4);let ae,Ue;const ze=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(kc(n)||!n.output||!n.input&&n.avail_in!==0)return Jr;t=n.state,t.mode===bo&&(t.mode=KT),c=n.next_out,s=n.output,h=n.avail_out,a=n.next_in,i=n.input,l=n.avail_in,p=t.hold,f=t.bits,_=l,g=h,z=Dc;e:for(;;)switch(t.mode){case sm:if(t.wrap===0){t.mode=KT;break}for(;f<16;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}if(2&t.wrap&&p===35615){t.wbits===0&&(t.wbits=15),t.check=0,re[0]=255&p,re[1]=p>>>8&255,t.check=ui(t.check,re,2,0),p=0,f=0,t.mode=16181;break}if(t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&p)<<8)+(p>>8))%31){n.msg="incorrect header check",t.mode=yn;break}if((15&p)!==tD){n.msg="unknown compression method",t.mode=yn;break}if(p>>>=4,f-=4,j=8+(15&p),t.wbits===0&&(t.wbits=j),j>15||j>t.wbits){n.msg="invalid window size",t.mode=yn;break}t.dmax=1<<t.wbits,t.flags=0,n.adler=t.check=1,t.mode=512&p?16189:bo,p=0,f=0;break;case 16181:for(;f<16;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}if(t.flags=p,(255&t.flags)!==tD){n.msg="unknown compression method",t.mode=yn;break}if(57344&t.flags){n.msg="unknown header flags set",t.mode=yn;break}t.head&&(t.head.text=p>>8&1),512&t.flags&&4&t.wrap&&(re[0]=255&p,re[1]=p>>>8&255,t.check=ui(t.check,re,2,0)),p=0,f=0,t.mode=16182;case 16182:for(;f<32;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}t.head&&(t.head.time=p),512&t.flags&&4&t.wrap&&(re[0]=255&p,re[1]=p>>>8&255,re[2]=p>>>16&255,re[3]=p>>>24&255,t.check=ui(t.check,re,4,0)),p=0,f=0,t.mode=16183;case 16183:for(;f<16;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}t.head&&(t.head.xflags=255&p,t.head.os=p>>8),512&t.flags&&4&t.wrap&&(re[0]=255&p,re[1]=p>>>8&255,t.check=ui(t.check,re,2,0)),p=0,f=0,t.mode=16184;case 16184:if(1024&t.flags){for(;f<16;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}t.length=p,t.head&&(t.head.extra_len=p),512&t.flags&&4&t.wrap&&(re[0]=255&p,re[1]=p>>>8&255,t.check=ui(t.check,re,2,0)),p=0,f=0}else t.head&&(t.head.extra=null);t.mode=16185;case 16185:if(1024&t.flags&&(T=t.length,T>l&&(T=l),T&&(t.head&&(j=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(a,a+T),j)),512&t.flags&&4&t.wrap&&(t.check=ui(t.check,i,T,a)),l-=T,a+=T,t.length-=T),t.length))break e;t.length=0,t.mode=16186;case 16186:if(2048&t.flags){if(l===0)break e;T=0;do j=i[a+T++],t.head&&j&&t.length<65536&&(t.head.name+=String.fromCharCode(j));while(j&&T<l);if(512&t.flags&&4&t.wrap&&(t.check=ui(t.check,i,T,a)),l-=T,a+=T,j)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=16187;case 16187:if(4096&t.flags){if(l===0)break e;T=0;do j=i[a+T++],t.head&&j&&t.length<65536&&(t.head.comment+=String.fromCharCode(j));while(j&&T<l);if(512&t.flags&&4&t.wrap&&(t.check=ui(t.check,i,T,a)),l-=T,a+=T,j)break e}else t.head&&(t.head.comment=null);t.mode=16188;case 16188:if(512&t.flags){for(;f<16;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}if(4&t.wrap&&p!==(65535&t.check)){n.msg="header crc mismatch",t.mode=yn;break}p=0,f=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=bo;break;case 16189:for(;f<32;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}n.adler=t.check=nD(p),p=0,f=0,t.mode=om;case om:if(t.havedict===0)return n.next_out=c,n.avail_out=h,n.next_in=a,n.avail_in=l,t.hold=p,t.bits=f,XK;n.adler=t.check=1,t.mode=bo;case bo:if(e===qK||e===rm)break e;case KT:if(t.last){p>>>=7&f,f-=7&f,t.mode=YT;break}for(;f<3;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}switch(t.last=1&p,p>>>=1,f-=1,3&p){case 0:t.mode=16193;break;case 1:if(ZK(t),t.mode=am,e===rm){p>>>=2,f-=2;break e}break;case 2:t.mode=16196;break;case 3:n.msg="invalid block type",t.mode=yn}p>>>=2,f-=2;break;case 16193:for(p>>>=7&f,f-=7&f;f<32;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}if((65535&p)!=(p>>>16^65535)){n.msg="invalid stored block lengths",t.mode=yn;break}if(t.length=65535&p,p=0,f=0,t.mode=zT,e===rm)break e;case zT:t.mode=16195;case 16195:if(T=t.length,T){if(T>l&&(T=l),T>h&&(T=h),T===0)break e;s.set(i.subarray(a,a+T),c),l-=T,a+=T,h-=T,c+=T,t.length-=T;break}t.mode=bo;break;case 16196:for(;f<14;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}if(t.nlen=257+(31&p),p>>>=5,f-=5,t.ndist=1+(31&p),p>>>=5,f-=5,t.ncode=4+(15&p),p>>>=4,f-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=yn;break}t.have=0,t.mode=16197;case 16197:for(;t.have<t.ncode;){for(;f<3;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}t.lens[ze[t.have++]]=7&p,p>>>=3,f-=3}for(;t.have<19;)t.lens[ze[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,ae={bits:t.lenbits},z=qu(0,t.lens,0,19,t.lencode,0,t.work,ae),t.lenbits=ae.bits,z){n.msg="invalid code lengths set",t.mode=yn;break}t.have=0,t.mode=16198;case 16198:for(;t.have<t.nlen+t.ndist;){for(;Y=t.lencode[p&(1<<t.lenbits)-1],I=Y>>>24,N=Y>>>16&255,D=65535&Y,!(I<=f);){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}if(D<16)p>>>=I,f-=I,t.lens[t.have++]=D;else{if(D===16){for(Ue=I+2;f<Ue;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}if(p>>>=I,f-=I,t.have===0){n.msg="invalid bit length repeat",t.mode=yn;break}j=t.lens[t.have-1],T=3+(3&p),p>>>=2,f-=2}else if(D===17){for(Ue=I+3;f<Ue;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}p>>>=I,f-=I,j=0,T=3+(7&p),p>>>=3,f-=3}else{for(Ue=I+7;f<Ue;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}p>>>=I,f-=I,j=0,T=11+(127&p),p>>>=7,f-=7}if(t.have+T>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=yn;break}for(;T--;)t.lens[t.have++]=j}}if(t.mode===yn)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=yn;break}if(t.lenbits=9,ae={bits:t.lenbits},z=qu(1,t.lens,0,t.nlen,t.lencode,0,t.work,ae),t.lenbits=ae.bits,z){n.msg="invalid literal/lengths set",t.mode=yn;break}if(t.distbits=6,t.distcode=t.distdyn,ae={bits:t.distbits},z=qu(2,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,ae),t.distbits=ae.bits,z){n.msg="invalid distances set",t.mode=yn;break}if(t.mode=am,e===rm)break e;case am:t.mode=cm;case cm:if(l>=6&&h>=258){n.next_out=c,n.avail_out=h,n.next_in=a,n.avail_in=l,t.hold=p,t.bits=f,WK(n,g),c=n.next_out,s=n.output,h=n.avail_out,a=n.next_in,i=n.input,l=n.avail_in,p=t.hold,f=t.bits,t.mode===bo&&(t.back=-1);break}for(t.back=0;Y=t.lencode[p&(1<<t.lenbits)-1],I=Y>>>24,N=Y>>>16&255,D=65535&Y,!(I<=f);){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}if(N&&!(240&N)){for(V=I,G=N,F=D;Y=t.lencode[F+((p&(1<<V+G)-1)>>V)],I=Y>>>24,N=Y>>>16&255,D=65535&Y,!(V+I<=f);){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}p>>>=V,f-=V,t.back+=V}if(p>>>=I,f-=I,t.back+=I,t.length=D,N===0){t.mode=16205;break}if(32&N){t.back=-1,t.mode=bo;break}if(64&N){n.msg="invalid literal/length code",t.mode=yn;break}t.extra=15&N,t.mode=16201;case 16201:if(t.extra){for(Ue=t.extra;f<Ue;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}t.length+=p&(1<<t.extra)-1,p>>>=t.extra,f-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=16202;case 16202:for(;Y=t.distcode[p&(1<<t.distbits)-1],I=Y>>>24,N=Y>>>16&255,D=65535&Y,!(I<=f);){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}if(!(240&N)){for(V=I,G=N,F=D;Y=t.distcode[F+((p&(1<<V+G)-1)>>V)],I=Y>>>24,N=Y>>>16&255,D=65535&Y,!(V+I<=f);){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}p>>>=V,f-=V,t.back+=V}if(p>>>=I,f-=I,t.back+=I,64&N){n.msg="invalid distance code",t.mode=yn;break}t.offset=D,t.extra=15&N,t.mode=16203;case 16203:if(t.extra){for(Ue=t.extra;f<Ue;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}t.offset+=p&(1<<t.extra)-1,p>>>=t.extra,f-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=yn;break}t.mode=16204;case 16204:if(h===0)break e;if(T=g-h,t.offset>T){if(T=t.offset-T,T>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=yn;break}T>t.wnext?(T-=t.wnext,w=t.wsize-T):w=t.wnext-T,T>t.length&&(T=t.length),R=t.window}else R=s,w=c-t.offset,T=t.length;T>h&&(T=h),h-=T,t.length-=T;do s[c++]=R[w++];while(--T);t.length===0&&(t.mode=cm);break;case 16205:if(h===0)break e;s[c++]=t.length,h--,t.mode=cm;break;case YT:if(t.wrap){for(;f<32;){if(l===0)break e;l--,p|=i[a++]<<f,f+=8}if(g-=h,n.total_out+=g,t.total+=g,4&t.wrap&&g&&(n.adler=t.check=t.flags?ui(t.check,s,g,c-g):Fu(t.check,s,g,c-g)),g=h,4&t.wrap&&(t.flags?p:nD(p))!==t.check){n.msg="incorrect data check",t.mode=yn;break}p=0,f=0}t.mode=16207;case 16207:if(t.wrap&&t.flags){for(;f<32;){if(l===0)break e;l--,p+=i[a++]<<f,f+=8}if(4&t.wrap&&p!==(4294967295&t.total)){n.msg="incorrect length check",t.mode=yn;break}p=0,f=0}t.mode=16208;case 16208:z=JK;break e;case yn:z=ZP;break e;case 16210:return eD;default:return Jr}return n.next_out=c,n.avail_out=h,n.next_in=a,n.avail_in=l,t.hold=p,t.bits=f,(t.wsize||g!==n.avail_out&&t.mode<yn&&(t.mode<YT||e!==$P))&&cD(n,n.output,n.next_out,g-n.avail_out),_-=n.avail_in,g-=n.avail_out,n.total_in+=_,n.total_out+=g,t.total+=g,4&t.wrap&&g&&(n.adler=t.check=t.flags?ui(t.check,s,g,n.next_out-g):Fu(t.check,s,g,n.next_out-g)),n.data_type=t.bits+(t.last?64:0)+(t.mode===bo?128:0)+(t.mode===am||t.mode===zT?256:0),(_===0&&g===0||e===$P)&&z===Dc&&(z=QK),z},No={inflateReset:rD,inflateReset2:sD,inflateResetKeep:iD,inflateInit:n=>oD(n,15),inflateInit2:oD,inflate:e8,inflateEnd:n=>{if(kc(n))return Jr;let e=n.state;return e.window&&(e.window=null),n.state=null,Dc},inflateGetHeader:(n,e)=>{if(kc(n))return Jr;const t=n.state;return 2&t.wrap?(t.head=e,e.done=!1,Dc):Jr},inflateSetDictionary:(n,e)=>{const t=e.length;let i,s,a;return kc(n)?Jr:(i=n.state,i.wrap!==0&&i.mode!==om?Jr:i.mode===om&&(s=1,s=Fu(s,e,t,0),s!==i.check)?ZP:(a=cD(n,e,t,t),a?(i.mode=16210,eD):(i.havedict=1,Dc)))},inflateInfo:"pako inflate (from Nodeca project)"},t8=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const dD=Object.prototype.toString,{Z_NO_FLUSH:n8,Z_FINISH:i8,Z_OK:Ju,Z_STREAM_END:XT,Z_NEED_DICT:QT,Z_STREAM_ERROR:r8,Z_DATA_ERROR:lD,Z_MEM_ERROR:s8}=zd;function Xu(n){this.options=em.assign({chunkSize:65536,windowBits:15,to:""},n||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||n&&n.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&!(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new XP,this.strm.avail_out=0;let t=No.inflateInit2(this.strm,e.windowBits);if(t!==Ju)throw new Error(Oc[t]);if(this.header=new t8,No.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=zu.string2buf(e.dictionary):dD.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=No.inflateSetDictionary(this.strm,e.dictionary),t!==Ju)))throw new Error(Oc[t])}function $T(n,e){const t=new Xu(e);if(t.push(n),t.err)throw t.msg||Oc[t.err];return t.result}Xu.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let a,c,l;if(this.ended)return!1;for(c=e===~~e?e:e===!0?i8:n8,dD.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),a=No.inflate(t,c),a===QT&&s&&(a=No.inflateSetDictionary(t,s),a===Ju?a=No.inflate(t,c):a===lD&&(a=QT));t.avail_in>0&&a===XT&&t.state.wrap>0&&n[t.next_in]!==0;)No.inflateReset(t),a=No.inflate(t,c);switch(a){case r8:case lD:case QT:case s8:return this.onEnd(a),this.ended=!0,!1}if(l=t.avail_out,t.next_out&&(t.avail_out===0||a===XT))if(this.options.to==="string"){let h=zu.utf8border(t.output,t.next_out),p=t.next_out-h,f=zu.buf2string(t.output,h);t.next_out=p,t.avail_out=i-p,p&&t.output.set(t.output.subarray(h,h+p),0),this.onData(f)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(a!==Ju||l!==0){if(a===XT)return a=No.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(t.avail_in===0)break}}return!0},Xu.prototype.onData=function(n){this.chunks.push(n)},Xu.prototype.onEnd=function(n){n===Ju&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=em.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var o8={Inflate:Xu,inflate:$T,inflateRaw:function(n,e){return(e=e||{}).raw=!0,$T(n,e)},ungzip:$T,constants:zd};const{Deflate:X$,deflate:a8,deflateRaw:Q$,gzip:$$}=GK,{Inflate:Z$,inflate:c8,inflateRaw:eZ,ungzip:tZ}=o8;var ZT,d8=a8,l8=c8;(function(n){n[n.ONE_BYTE=0]="ONE_BYTE",n[n.TWO_BYTE=1]="TWO_BYTE"})(ZT||(ZT={}));class u8{constructor(){S(this,"_sequence",0),S(this,"_startTime",Date.now()),S(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const l=new Uint8Array(4);l.set([1,0,0,0]);const h={id:0,length:4,data:l.buffer},p={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[h]};t.commonPacketHeader.extension=1,t.extension=p,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;L("SHOW_DATASTREAM2_LOG")&&v.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));const i=new ArrayBuffer(t.commonPacketHeader.length),s=new Uint8Array(i),a=new DataView(i);let c=0;if(a.setUint16(c,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),c+=2,a.setUint32(c,t.commonPacketHeader.sequence,!0),c+=4,a.setUint16(c,t.commonStreamHeader,!0),c+=2,t.extension){const l=this.serializeExtension(t.extension);s.set(new Uint8Array(l),c),c+=l.byteLength}if(s.set(new Uint8Array(t.payload),c),c+=t.payload.byteLength,c!==t.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const t=new DataView(e);let i=0;const s=t.getUint16(i,!0);i+=2;const a={length:16383&s,reserved:(16384&s)>>14,extension:(32768&s)>>15,sequence:t.getUint16(i+2,!0)<<16|t.getUint16(i,!0)};let c,l;if(i+=4,L("SHOW_DATASTREAM2_LOG")&&v.debug("receive data header: ".concat(JSON.stringify(a))),t.getUint16(i,!0),i+=2,a.extension){l=this.deserializeExtension(e.slice(i)),i+=2+l.length,c=e.slice(i);let h=!1;if(l.datas.length>0){const p=l.datas.find(f=>f.id===0);p&&(h=(1&new DataView(p.data).getUint32(0,!0))==1)}c=h?this.decompress(c):c}else c=e.slice(8);return c}serializeExtension(e){const{profile:t,length:i,datas:s}=e,a=new ArrayBuffer(i+2),c=new Uint8Array(a),l=new DataView(a);let h=0;if(l.setUint8(h++,t),l.setUint8(h++,i),s.forEach(p=>{t?(l.setUint8(h++,p.id),l.setUint8(h++,p.length),c.set(new Uint8Array(p.data),h),h+=p.data.byteLength):(l.setUint8(h++,p.id|p.length<<4),c.set(new Uint8Array(p.data),h),h+=p.data.byteLength)}),h!==i+2)throw Error("serialize extension error, is ".concat(h,"!==").concat(i+2));return a}deserializeExtension(e){const t=new DataView(e);let i=0;const s=t.getUint8(i);i++;const a=t.getUint8(i);i++;const c=s===ZT.TWO_BYTE,l=[],h=new DataView(e,2);let p=0;for(;p<a;){let f=0,_=0,g=new ArrayBuffer(0);c?(f=h.getUint8(p),p++,_=h.getUint8(p),p++):(f=15&h.getUint8(p),_=h.getUint8(p)>>4,p++),_>0&&(g=h.buffer.slice(p+2,p+2+_),p+=g.byteLength),l.push({id:f,length:_,data:g})}if(p!==a)throw Error("parse error");return{profile:s,length:a,datas:l}}decompress(e){return l8(new Uint8Array(e))}compress(e){return d8(new Uint8Array(e))}}class uD extends At{constructor(e,t){super(),S(this,"_version",1),S(this,"_type",3),S(this,"_config",void 0),S(this,"_originDataChannel",void 0),S(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),S(this,"_dataStreamPacketHandler",void 0),S(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader(),this._dataStreamPacketHandler=new u8}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return L("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new W((e,t)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const i=setTimeout(()=>{var s;t(new Q(O.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((s=this._originDataChannel)===null||s===void 0?void 0:s.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new Q(O.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new Q(O.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[Gd.OPEN,Gd.CLOSE,Gd.ERROR].forEach(t=>{const i=()=>{this.emit(t)};this._datachannelEventMap.set(t,i),e.addEventListener(t,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[i,s]=t;e.removeEventListener(i,s)}),this._datachannelEventMap.clear()}}class h8 extends uD{constructor(e){super(e),S(this,"_messageListener",void 0),this._messageListener=t=>{if(t.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=t.data.slice(0,this._dataStreamPacketHeader.byteLength),s=new DataView(i).getUint8(3);if(s!==this.id)return void(L("SHOW_DATASTREAM2_LOG")&&v.debug("invalid datachannel id: ".concat(s," !== ").concat(this.id)));let a=t.data.slice(this._dataStreamPacketHeader.byteLength);a=this._dataStreamPacketHandler.deserialize(a),this.emit(Gd.MESSAGE,a)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class hD extends uD{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}var p8=E,f8=sn("iterator"),ev=!p8(function(){var n=new URL("b?a=1&b=2&c=3","http://a"),e=n.searchParams,t=new URLSearchParams("a=1&a=2"),i="";return n.pathname="c%20d",e.forEach(function(s,a){e.delete("b"),i+=a+s}),t.delete("a",2),!n.toJSON||!t.has("a",1)||t.has("a",2)||!e.size&&!0||!e.sort||n.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[f8]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||i!=="a1c3"||new URL("http://x",void 0).host!=="x"}),m8=$o,tv=Nt,Xd=Z,dm=Me,$s=M,Qd=ht,pD=ev,fD=$o,_8=Vp,E8=function(n,e,t){for(var i in e)t&&t.unsafe&&n[i]?n[i]=e[i]:m8(n,i,e[i],t);return n},g8=Zo,S8=jw,nv=md,mD=Hg,iv=Bt,T8=ai,v8=Yo,y8=Qo,R8=gr,_D=Er,Vi=Br,C8=tu,ED=Ti,rv=Fg,I8=Qp,$d=tf,w8=TA,A8=sn("iterator"),Qu="URLSearchParams",gD=Qu+"Iterator",SD=nv.set,Xr=nv.getterFor(Qu),O8=nv.getterFor(gD),b8=Object.getOwnPropertyDescriptor,sv=function(n){if(!Qd)return Xd[n];var e=b8(Xd,n);return e&&e.value},TD=sv("fetch"),lm=sv("Request"),$u=sv("Headers"),ov=lm&&lm.prototype,vD=$u&&$u.prototype,N8=Xd.RegExp,P8=Xd.TypeError,yD=Xd.decodeURIComponent,D8=Xd.encodeURIComponent,k8=$s("".charAt),RD=$s([].join),Lc=$s([].push),av=$s("".replace),L8=$s([].shift),CD=$s([].splice),ID=$s("".split),M8=$s("".slice),U8=/\+/g,wD=Array(4),x8=function(n){return wD[n-1]||(wD[n-1]=N8("((?:%[\\da-f]{2}){"+n+"})","gi"))},V8=function(n){try{return yD(n)}catch{return n}},AD=function(n){var e=av(n,U8," "),t=4;try{return yD(e)}catch{for(;t;)e=av(e,x8(t--),V8);return e}},F8=/[!'()~]|%20/g,B8={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},j8=function(n){return B8[n]},OD=function(n){return av(D8(n),F8,j8)},cv=S8(function(n,e){SD(this,{type:gD,iterator:rv(Xr(n).entries),kind:e})},"Iterator",function(){var n=O8(this),e=n.kind,t=n.iterator.next(),i=t.value;return t.done||(t.value=e==="keys"?i.key:e==="values"?i.value:[i.key,i.value]),t},!0),bD=function(n){this.entries=[],this.url=null,n!==void 0&&(_D(n)?this.parseObject(n):this.parseQuery(typeof n=="string"?k8(n,0)==="?"?M8(n,1):n:Vi(n)))};bD.prototype={type:Qu,bindURL:function(n){this.url=n,this.update()},parseObject:function(n){var e,t,i,s,a,c,l,h=I8(n);if(h)for(t=(e=rv(n,h)).next;!(i=dm(t,e)).done;){if(a=(s=rv(R8(i.value))).next,(c=dm(a,s)).done||(l=dm(a,s)).done||!dm(a,s).done)throw P8("Expected sequence with length 2");Lc(this.entries,{key:Vi(c.value),value:Vi(l.value)})}else for(var p in n)T8(n,p)&&Lc(this.entries,{key:p,value:Vi(n[p])})},parseQuery:function(n){if(n)for(var e,t,i=ID(n,"&"),s=0;s<i.length;)(e=i[s++]).length&&(t=ID(e,"="),Lc(this.entries,{key:AD(L8(t)),value:AD(RD(t,"="))}))},serialize:function(){for(var n,e=this.entries,t=[],i=0;i<e.length;)n=e[i++],Lc(t,OD(n.key)+"="+OD(n.value));return RD(t,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var um=function(){mD(this,Zd);var n=SD(this,new bD(arguments.length>0?arguments[0]:void 0));Qd||(this.size=n.entries.length)},Zd=um.prototype;if(E8(Zd,{append:function(n,e){var t=Xr(this);$d(arguments.length,2),Lc(t.entries,{key:Vi(n),value:Vi(e)}),Qd||this.length++,t.updateURL()},delete:function(n){for(var e=Xr(this),t=$d(arguments.length,1),i=e.entries,s=Vi(n),a=t<2?void 0:arguments[1],c=a===void 0?a:Vi(a),l=0;l<i.length;){var h=i[l];if(h.key!==s||c!==void 0&&h.value!==c)l++;else if(CD(i,l,1),c!==void 0)break}Qd||(this.size=i.length),e.updateURL()},get:function(n){var e=Xr(this).entries;$d(arguments.length,1);for(var t=Vi(n),i=0;i<e.length;i++)if(e[i].key===t)return e[i].value;return null},getAll:function(n){var e=Xr(this).entries;$d(arguments.length,1);for(var t=Vi(n),i=[],s=0;s<e.length;s++)e[s].key===t&&Lc(i,e[s].value);return i},has:function(n){for(var e=Xr(this).entries,t=$d(arguments.length,1),i=Vi(n),s=t<2?void 0:arguments[1],a=s===void 0?s:Vi(s),c=0;c<e.length;){var l=e[c++];if(l.key===i&&(a===void 0||l.value===a))return!0}return!1},set:function(n,e){var t=Xr(this);$d(arguments.length,1);for(var i,s=t.entries,a=!1,c=Vi(n),l=Vi(e),h=0;h<s.length;h++)(i=s[h]).key===c&&(a?CD(s,h--,1):(a=!0,i.value=l));a||Lc(s,{key:c,value:l}),Qd||(this.size=s.length),t.updateURL()},sort:function(){var n=Xr(this);w8(n.entries,function(e,t){return e.key>t.key?1:-1}),n.updateURL()},forEach:function(n){for(var e,t=Xr(this).entries,i=v8(n,arguments.length>1?arguments[1]:void 0),s=0;s<t.length;)i((e=t[s++]).value,e.key,this)},keys:function(){return new cv(this,"keys")},values:function(){return new cv(this,"values")},entries:function(){return new cv(this,"entries")}},{enumerable:!0}),fD(Zd,A8,Zd.entries,{name:"entries"}),fD(Zd,"toString",function(){return Xr(this).serialize()},{enumerable:!0}),Qd&&_8(Zd,"size",{get:function(){return Xr(this).entries.length},configurable:!0,enumerable:!0}),g8(um,Qu),tv({global:!0,constructor:!0,forced:!pD},{URLSearchParams:um}),!pD&&iv($u)){var G8=$s(vD.has),W8=$s(vD.set),ND=function(n){if(_D(n)){var e,t=n.body;if(y8(t)===Qu)return e=n.headers?new $u(n.headers):new $u,G8(e,"content-type")||W8(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),C8(n,{body:ED(0,Vi(t)),headers:ED(0,e)})}return n};if(iv(TD)&&tv({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(n){return TD(n,arguments.length>1?ND(arguments[1]):{})}}),iv(lm)){var dv=function(n){return mD(this,ov),new lm(n,arguments.length>1?ND(arguments[1]):{})};ov.constructor=dv,dv.prototype=ov,tv({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:dv})}}var Qr,H8={URLSearchParams:um,getState:Xr},PD=ht,K8=M,z8=Me,Y8=E,lv=kp,q8=nu,J8=ot,X8=Us,Q8=Tp,el=Object.assign,DD=Object.defineProperty,$8=K8([].concat),Z8=!el||Y8(function(){if(PD&&el({b:1},el(DD({},"a",{enumerable:!0,get:function(){DD(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var n={},e={},t=Symbol(),i="abcdefghijklmnopqrst";return n[t]=7,i.split("").forEach(function(s){e[s]=s}),el({},n)[t]!=7||lv(el({},e)).join("")!=i})?function(n,e){for(var t=X8(n),i=arguments.length,s=1,a=q8.f,c=J8.f;i>s;)for(var l,h=Q8(arguments[s++]),p=a?$8(lv(h),a(h)):lv(h),f=p.length,_=0;f>_;)l=p[_++],PD&&!z8(c,h,l)||(t[l]=h[l]);return t}:el,ez=gr,tz=VA,nz=Yo,iz=Me,rz=Us,sz=function(n,e,t,i){try{return i?e(ez(t)[0],t[1]):e(t)}catch(s){tz(n,"throw",s)}},oz=MA,az=eg,cz=Jo,kD=QE,dz=Fg,lz=Qp,LD=Array,Mc=M,uv=2147483647,uz=/[^\0-\u007E]/,MD=/[.\u3002\uFF0E\uFF61]/g,UD="Overflow: input needs wider integers to process",xD=RangeError,hz=Mc(MD.exec),tl=Math.floor,hv=String.fromCharCode,VD=Mc("".charCodeAt),FD=Mc([].join),Ia=Mc([].push),pz=Mc("".replace),fz=Mc("".split),mz=Mc("".toLowerCase),BD=function(n){return n+22+75*(n<26)},_z=function(n,e,t){var i=0;for(n=t?tl(n/700):n>>1,n+=tl(n/e);n>455;)n=tl(n/35),i+=36;return tl(i+36*n/(n+38))},Ez=function(n){var e=[];n=function(N){for(var D=[],V=0,G=N.length;V<G;){var F=VD(N,V++);if(F>=55296&&F<=56319&&V<G){var j=VD(N,V++);(64512&j)==56320?Ia(D,((1023&F)<<10)+(1023&j)+65536):(Ia(D,F),V--)}else Ia(D,F)}return D}(n);var t,i,s=n.length,a=128,c=0,l=72;for(t=0;t<n.length;t++)(i=n[t])<128&&Ia(e,hv(i));var h=e.length,p=h;for(h&&Ia(e,"-");p<s;){var f=uv;for(t=0;t<n.length;t++)(i=n[t])>=a&&i<f&&(f=i);var _=p+1;if(f-a>tl((uv-c)/_))throw xD(UD);for(c+=(f-a)*_,a=f,t=0;t<n.length;t++){if((i=n[t])<a&&++c>uv)throw xD(UD);if(i==a){for(var g=c,T=36;;){var w=T<=l?1:T>=l+26?26:T-l;if(g<w)break;var R=g-w,I=36-w;Ia(e,hv(BD(w+R%I))),g=tl(R/I),T+=36}Ia(e,hv(BD(g))),l=_z(c,_,p==h),c=0,p++}}c++,a++}return FD(e,"")},gz=Nt,pv=ht,Sz=ev,fv=Z,jD=Yo,$r=M,hm=$o,Zr=Vp,Tz=Hg,mv=ai,_v=Z8,nl=function(n){var e=rz(n),t=az(this),i=arguments.length,s=i>1?arguments[1]:void 0,a=s!==void 0;a&&(s=nz(s,i>2?arguments[2]:void 0));var c,l,h,p,f,_,g=lz(e),T=0;if(!g||this===LD&&oz(g))for(c=cz(e),l=t?new this(c):LD(c);c>T;T++)_=a?s(e[T],T):e[T],kD(l,T,_);else for(f=(p=dz(e,g)).next,l=t?new this:[];!(h=iz(f,p)).done;T++)_=a?sz(p,s,[h.value,T],!0):h.value,kD(l,T,_);return l.length=T,l},Ts=ag,vz=pA.codeAt,yz=function(n){var e,t,i=[],s=fz(pz(mz(n),MD,"."),".");for(e=0;e<s.length;e++)t=s[e],Ia(i,hz(uz,t)?"xn--"+Ez(t):t);return FD(i,".")},Po=Br,Rz=Zo,Cz=tf,GD=H8,WD=md,Iz=WD.set,pm=WD.getterFor("URL"),wz=GD.URLSearchParams,Az=GD.getState,Zu=fv.URL,Ev=fv.TypeError,fm=fv.parseInt,Oz=Math.floor,HD=Math.pow,es=$r("".charAt),vs=$r(/./.exec),eh=$r([].join),bz=$r(1 .toString),Nz=$r([].pop),il=$r([].push),gv=$r("".replace),Pz=$r([].shift),Dz=$r("".split),th=$r("".slice),mm=$r("".toLowerCase),kz=$r([].unshift),Sv="Invalid scheme",Uc="Invalid host",KD="Invalid port",zD=/[a-z]/i,Lz=/[\d+-.a-z]/i,Tv=/\d/,Mz=/^0x/i,Uz=/^[0-7]+$/,xz=/^\d+$/,YD=/^[\da-f]+$/i,Vz=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Fz=/[\0\t\n\r #/:<>?@[\\\]^|]/,Bz=/^[\u0000-\u0020]+/,jz=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Gz=/[\t\n\r]/g,nh=function(n){var e,t,i,s;if(typeof n=="number"){for(e=[],t=0;t<4;t++)kz(e,n%256),n=Oz(n/256);return eh(e,".")}if(typeof n=="object"){for(e="",i=function(a){for(var c=null,l=1,h=null,p=0,f=0;f<8;f++)a[f]!==0?(p>l&&(c=h,l=p),h=null,p=0):(h===null&&(h=f),++p);return p>l&&(c=h,l=p),c}(n),t=0;t<8;t++)s&&n[t]===0||(s&&(s=!1),i===t?(e+=t?":":"::",s=!0):(e+=bz(n[t],16),t<7&&(e+=":")));return"["+e+"]"}return n},_m={},qD=_v({},_m,{" ":1,'"':1,"<":1,">":1,"`":1}),JD=_v({},qD,{"#":1,"?":1,"{":1,"}":1}),vv=_v({},JD,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),wa=function(n,e){var t=vz(n,0);return t>32&&t<127&&!mv(e,n)?n:encodeURIComponent(n)},Em={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ih=function(n,e){var t;return n.length==2&&vs(zD,es(n,0))&&((t=es(n,1))==":"||!e&&t=="|")},XD=function(n){var e;return n.length>1&&ih(th(n,0,2))&&(n.length==2||(e=es(n,2))==="/"||e==="\\"||e==="?"||e==="#")},Wz=function(n){return n==="."||mm(n)==="%2e"},yv={},QD={},Rv={},$D={},ZD={},Cv={},ek={},tk={},gm={},Sm={},Iv={},wv={},Av={},Ov={},nk={},bv={},rl={},Zs={},ik={},xc={},Do={},Nv=function(n,e,t){var i,s,a,c=Po(n);if(e){if(s=this.parse(c))throw Ev(s);this.searchParams=null}else{if(t!==void 0&&(i=new Nv(t,!0)),s=this.parse(c,null,i))throw Ev(s);(a=Az(new wz)).bindURL(this),this.searchParams=a}};Nv.prototype={type:"URL",parse:function(n,e,t){var i,s,a,c,l,h=this,p=e||yv,f=0,_="",g=!1,T=!1,w=!1;for(n=Po(n),e||(h.scheme="",h.username="",h.password="",h.host=null,h.port=null,h.path=[],h.query=null,h.fragment=null,h.cannotBeABaseURL=!1,n=gv(n,Bz,""),n=gv(n,jz,"$1")),n=gv(n,Gz,""),i=nl(n);f<=i.length;){switch(s=i[f],p){case yv:if(!s||!vs(zD,s)){if(e)return Sv;p=Rv;continue}_+=mm(s),p=QD;break;case QD:if(s&&(vs(Lz,s)||s=="+"||s=="-"||s=="."))_+=mm(s);else{if(s!=":"){if(e)return Sv;_="",p=Rv,f=0;continue}if(e&&(h.isSpecial()!=mv(Em,_)||_=="file"&&(h.includesCredentials()||h.port!==null)||h.scheme=="file"&&!h.host))return;if(h.scheme=_,e)return void(h.isSpecial()&&Em[h.scheme]==h.port&&(h.port=null));_="",h.scheme=="file"?p=Ov:h.isSpecial()&&t&&t.scheme==h.scheme?p=$D:h.isSpecial()?p=tk:i[f+1]=="/"?(p=ZD,f++):(h.cannotBeABaseURL=!0,il(h.path,""),p=ik)}break;case Rv:if(!t||t.cannotBeABaseURL&&s!="#")return Sv;if(t.cannotBeABaseURL&&s=="#"){h.scheme=t.scheme,h.path=Ts(t.path),h.query=t.query,h.fragment="",h.cannotBeABaseURL=!0,p=Do;break}p=t.scheme=="file"?Ov:Cv;continue;case $D:if(s!="/"||i[f+1]!="/"){p=Cv;continue}p=gm,f++;break;case ZD:if(s=="/"){p=Sm;break}p=Zs;continue;case Cv:if(h.scheme=t.scheme,s==Qr)h.username=t.username,h.password=t.password,h.host=t.host,h.port=t.port,h.path=Ts(t.path),h.query=t.query;else if(s=="/"||s=="\\"&&h.isSpecial())p=ek;else if(s=="?")h.username=t.username,h.password=t.password,h.host=t.host,h.port=t.port,h.path=Ts(t.path),h.query="",p=xc;else{if(s!="#"){h.username=t.username,h.password=t.password,h.host=t.host,h.port=t.port,h.path=Ts(t.path),h.path.length--,p=Zs;continue}h.username=t.username,h.password=t.password,h.host=t.host,h.port=t.port,h.path=Ts(t.path),h.query=t.query,h.fragment="",p=Do}break;case ek:if(!h.isSpecial()||s!="/"&&s!="\\"){if(s!="/"){h.username=t.username,h.password=t.password,h.host=t.host,h.port=t.port,p=Zs;continue}p=Sm}else p=gm;break;case tk:if(p=gm,s!="/"||es(_,f+1)!="/")continue;f++;break;case gm:if(s!="/"&&s!="\\"){p=Sm;continue}break;case Sm:if(s=="@"){g&&(_="%40"+_),g=!0,a=nl(_);for(var R=0;R<a.length;R++){var I=a[R];if(I!=":"||w){var N=wa(I,vv);w?h.password+=N:h.username+=N}else w=!0}_=""}else if(s==Qr||s=="/"||s=="?"||s=="#"||s=="\\"&&h.isSpecial()){if(g&&_=="")return"Invalid authority";f-=nl(_).length+1,_="",p=Iv}else _+=s;break;case Iv:case wv:if(e&&h.scheme=="file"){p=bv;continue}if(s!=":"||T){if(s==Qr||s=="/"||s=="?"||s=="#"||s=="\\"&&h.isSpecial()){if(h.isSpecial()&&_=="")return Uc;if(e&&_==""&&(h.includesCredentials()||h.port!==null))return;if(c=h.parseHost(_))return c;if(_="",p=rl,e)return;continue}s=="["?T=!0:s=="]"&&(T=!1),_+=s}else{if(_=="")return Uc;if(c=h.parseHost(_))return c;if(_="",p=Av,e==wv)return}break;case Av:if(!vs(Tv,s)){if(s==Qr||s=="/"||s=="?"||s=="#"||s=="\\"&&h.isSpecial()||e){if(_!=""){var D=fm(_,10);if(D>65535)return KD;h.port=h.isSpecial()&&D===Em[h.scheme]?null:D,_=""}if(e)return;p=rl;continue}return KD}_+=s;break;case Ov:if(h.scheme="file",s=="/"||s=="\\")p=nk;else{if(!t||t.scheme!="file"){p=Zs;continue}if(s==Qr)h.host=t.host,h.path=Ts(t.path),h.query=t.query;else if(s=="?")h.host=t.host,h.path=Ts(t.path),h.query="",p=xc;else{if(s!="#"){XD(eh(Ts(i,f),""))||(h.host=t.host,h.path=Ts(t.path),h.shortenPath()),p=Zs;continue}h.host=t.host,h.path=Ts(t.path),h.query=t.query,h.fragment="",p=Do}}break;case nk:if(s=="/"||s=="\\"){p=bv;break}t&&t.scheme=="file"&&!XD(eh(Ts(i,f),""))&&(ih(t.path[0],!0)?il(h.path,t.path[0]):h.host=t.host),p=Zs;continue;case bv:if(s==Qr||s=="/"||s=="\\"||s=="?"||s=="#"){if(!e&&ih(_))p=Zs;else if(_==""){if(h.host="",e)return;p=rl}else{if(c=h.parseHost(_))return c;if(h.host=="localhost"&&(h.host=""),e)return;_="",p=rl}continue}_+=s;break;case rl:if(h.isSpecial()){if(p=Zs,s!="/"&&s!="\\")continue}else if(e||s!="?")if(e||s!="#"){if(s!=Qr&&(p=Zs,s!="/"))continue}else h.fragment="",p=Do;else h.query="",p=xc;break;case Zs:if(s==Qr||s=="/"||s=="\\"&&h.isSpecial()||!e&&(s=="?"||s=="#")){if((l=mm(l=_))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(h.shortenPath(),s=="/"||s=="\\"&&h.isSpecial()||il(h.path,"")):Wz(_)?s=="/"||s=="\\"&&h.isSpecial()||il(h.path,""):(h.scheme=="file"&&!h.path.length&&ih(_)&&(h.host&&(h.host=""),_=es(_,0)+":"),il(h.path,_)),_="",h.scheme=="file"&&(s==Qr||s=="?"||s=="#"))for(;h.path.length>1&&h.path[0]==="";)Pz(h.path);s=="?"?(h.query="",p=xc):s=="#"&&(h.fragment="",p=Do)}else _+=wa(s,JD);break;case ik:s=="?"?(h.query="",p=xc):s=="#"?(h.fragment="",p=Do):s!=Qr&&(h.path[0]+=wa(s,_m));break;case xc:e||s!="#"?s!=Qr&&(s=="'"&&h.isSpecial()?h.query+="%27":h.query+=s=="#"?"%23":wa(s,_m)):(h.fragment="",p=Do);break;case Do:s!=Qr&&(h.fragment+=wa(s,qD))}f++}},parseHost:function(n){var e,t,i;if(es(n,0)=="["){if(es(n,n.length-1)!="]"||(e=function(s){var a,c,l,h,p,f,_,g=[0,0,0,0,0,0,0,0],T=0,w=null,R=0,I=function(){return es(s,R)};if(I()==":"){if(es(s,1)!=":")return;R+=2,w=++T}for(;I();){if(T==8)return;if(I()!=":"){for(a=c=0;c<4&&vs(YD,I());)a=16*a+fm(I(),16),R++,c++;if(I()=="."){if(c==0||(R-=c,T>6))return;for(l=0;I();){if(h=null,l>0){if(!(I()=="."&&l<4))return;R++}if(!vs(Tv,I()))return;for(;vs(Tv,I());){if(p=fm(I(),10),h===null)h=p;else{if(h==0)return;h=10*h+p}if(h>255)return;R++}g[T]=256*g[T]+h,++l!=2&&l!=4||T++}if(l!=4)return;break}if(I()==":"){if(R++,!I())return}else if(I())return;g[T++]=a}else{if(w!==null)return;R++,w=++T}}if(w!==null)for(f=T-w,T=7;T!=0&&f>0;)_=g[T],g[T--]=g[w+f-1],g[w+--f]=_;else if(T!=8)return;return g}(th(n,1,-1)),!e))return Uc;this.host=e}else if(this.isSpecial()){if(n=yz(n),vs(Vz,n)||(e=function(s){var a,c,l,h,p,f,_,g=Dz(s,".");if(g.length&&g[g.length-1]==""&&g.length--,(a=g.length)>4)return s;for(c=[],l=0;l<a;l++){if((h=g[l])=="")return s;if(p=10,h.length>1&&es(h,0)=="0"&&(p=vs(Mz,h)?16:8,h=th(h,p==8?1:2)),h==="")f=0;else{if(!vs(p==10?xz:p==8?Uz:YD,h))return s;f=fm(h,p)}il(c,f)}for(l=0;l<a;l++)if(f=c[l],l==a-1){if(f>=HD(256,5-a))return null}else if(f>255)return null;for(_=Nz(c),l=0;l<c.length;l++)_+=c[l]*HD(256,3-l);return _}(n),e===null))return Uc;this.host=e}else{if(vs(Fz,n))return Uc;for(e="",t=nl(n),i=0;i<t.length;i++)e+=wa(t[i],_m);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return mv(Em,this.scheme)},shortenPath:function(){var n=this.path,e=n.length;!e||this.scheme=="file"&&e==1&&ih(n[0],!0)||n.length--},serialize:function(){var n=this,e=n.scheme,t=n.username,i=n.password,s=n.host,a=n.port,c=n.path,l=n.query,h=n.fragment,p=e+":";return s!==null?(p+="//",n.includesCredentials()&&(p+=t+(i?":"+i:"")+"@"),p+=nh(s),a!==null&&(p+=":"+a)):e=="file"&&(p+="//"),p+=n.cannotBeABaseURL?c[0]:c.length?"/"+eh(c,"/"):"",l!==null&&(p+="?"+l),h!==null&&(p+="#"+h),p},setHref:function(n){var e=this.parse(n);if(e)throw Ev(e);this.searchParams.update()},getOrigin:function(){var n=this.scheme,e=this.port;if(n=="blob")try{return new sl(n.path[0]).origin}catch{return"null"}return n!="file"&&this.isSpecial()?n+"://"+nh(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(n){this.parse(Po(n)+":",yv)},getUsername:function(){return this.username},setUsername:function(n){var e=nl(Po(n));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var t=0;t<e.length;t++)this.username+=wa(e[t],vv)}},getPassword:function(){return this.password},setPassword:function(n){var e=nl(Po(n));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var t=0;t<e.length;t++)this.password+=wa(e[t],vv)}},getHost:function(){var n=this.host,e=this.port;return n===null?"":e===null?nh(n):nh(n)+":"+e},setHost:function(n){this.cannotBeABaseURL||this.parse(n,Iv)},getHostname:function(){var n=this.host;return n===null?"":nh(n)},setHostname:function(n){this.cannotBeABaseURL||this.parse(n,wv)},getPort:function(){var n=this.port;return n===null?"":Po(n)},setPort:function(n){this.cannotHaveUsernamePasswordPort()||((n=Po(n))==""?this.port=null:this.parse(n,Av))},getPathname:function(){var n=this.path;return this.cannotBeABaseURL?n[0]:n.length?"/"+eh(n,"/"):""},setPathname:function(n){this.cannotBeABaseURL||(this.path=[],this.parse(n,rl))},getSearch:function(){var n=this.query;return n?"?"+n:""},setSearch:function(n){(n=Po(n))==""?this.query=null:(es(n,0)=="?"&&(n=th(n,1)),this.query="",this.parse(n,xc)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var n=this.fragment;return n?"#"+n:""},setHash:function(n){(n=Po(n))!=""?(es(n,0)=="#"&&(n=th(n,1)),this.fragment="",this.parse(n,Do)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var sl=function(n){var e=Tz(this,Fi),t=Cz(arguments.length,1)>1?arguments[1]:void 0,i=Iz(e,new Nv(n,!1,t));pv||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},Fi=sl.prototype,ts=function(n,e){return{get:function(){return pm(this)[n]()},set:e&&function(t){return pm(this)[e](t)},configurable:!0,enumerable:!0}};if(pv&&(Zr(Fi,"href",ts("serialize","setHref")),Zr(Fi,"origin",ts("getOrigin")),Zr(Fi,"protocol",ts("getProtocol","setProtocol")),Zr(Fi,"username",ts("getUsername","setUsername")),Zr(Fi,"password",ts("getPassword","setPassword")),Zr(Fi,"host",ts("getHost","setHost")),Zr(Fi,"hostname",ts("getHostname","setHostname")),Zr(Fi,"port",ts("getPort","setPort")),Zr(Fi,"pathname",ts("getPathname","setPathname")),Zr(Fi,"search",ts("getSearch","setSearch")),Zr(Fi,"searchParams",ts("getSearchParams")),Zr(Fi,"hash",ts("getHash","setHash"))),hm(Fi,"toJSON",function(){return pm(this).serialize()},{enumerable:!0}),hm(Fi,"toString",function(){return pm(this).serialize()},{enumerable:!0}),Zu){var rk=Zu.createObjectURL,sk=Zu.revokeObjectURL;rk&&hm(sl,"createObjectURL",jD(rk,Zu)),sk&&hm(sl,"revokeObjectURL",jD(sk,Zu))}Rz(sl,"URL"),gz({global:!0,constructor:!0,forced:!Sz,sham:!pv},{URL:sl});var Hz=Nt,Kz=E,zz=tf,ok=Br,Yz=ev,ak=Mi("URL");Hz({target:"URL",stat:!0,forced:!(Yz&&Kz(function(){ak.canParse()}))},{canParse:function(n){var e=zz(arguments.length,1),t=ok(n),i=e<2||arguments[1]===void 0?void 0:ok(arguments[1]);try{return!!new ak(t,i)}catch{return!1}}});var ck=m(Ms.URL);function Tm(){const n=new Blob([atob("ZnVuY3Rpb24gZShlKXtjb25zdCB0PW5ldyBEYXRhVmlldyhlLmRhdGEpO2lmKDA9PT10LmdldFVpbnQ4KDApJiYwPT09dC5nZXRVaW50OCgxKSYmMD09PXQuZ2V0VWludDgoMikmJjE9PT10LmdldFVpbnQ4KDMpJiY2PT09dC5nZXRVaW50OCg0KSl7bGV0IG49NixyPTAsbz0wO2Zvcig7MjU1PT09KG89dC5nZXRVaW50OChuKyspKTspcis9MjU1O3IrPW87Y29uc3QgYT1mdW5jdGlvbihlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLG89W10sYT0wO2Zvcig7YTxuOylhKzM8biYmMD09PXJbYV0mJjA9PT1yW2ErMV0mJjM9PT1yW2ErMl0mJigwPT09clthKzNdfHwxPT09clthKzNdfHwyPT09clthKzNdfHwzPT09clthKzNdKT8oby5wdXNoKHJbYV0sclthKzFdLHJbYSszXSksYSs9NCk6KG8ucHVzaChyW2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShvKX0oZS5kYXRhLG4scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIHQoZSx0KXtjb25zdCBuPWZ1bmN0aW9uKGUpe2NvbnN0IHQ9ZS5sZW5ndGg7bGV0IG49W10scj0wO2Zvcig7cjx0OylyKzI8dCYmMD09PWVbcl0mJjA9PT1lW3IrMV0mJigwPT09ZVtyKzJdfHwxPT09ZVtyKzJdfHwyPT09ZVtyKzJdfHwzPT09ZVtyKzJdKT8obi5wdXNoKGVbcl0sZVtyKzFdLDMsZVtyKzJdKSxyKz0zKToobi5wdXNoKGVbcl0pLHIrKyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KG4pfSh0KSxyPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihyLzI1NSksYT1yJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK3IrZS5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBpPTA7Zm9yKDtpPG87KXNbNitpXT0yNTUsaSsrO3JldHVybiBzWzYraV09YSxpKysscy5zZXQobiw2K2kpLHMuc2V0KG5ldyBVaW50OEFycmF5KGUpLDYraStyKSxzLmJ1ZmZlcn1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlNhZmFyaSIpPi0xJiYtMT09PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiQ2hyb21lIikmJihzZWxmLm9ucnRjdHJhbnNmb3JtPW49Pntjb25zdCByPW4udHJhbnNmb3JtZXI7bGV0IG89W107ci5vcHRpb25zLnBvcnQub25tZXNzYWdlPWU9PntlLmRhdGEuc2VpJiZvLnB1c2goZS5kYXRhLnNlaSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBhPXIucmVhZGFibGUuZ2V0UmVhZGVyKCkscz1yLndyaXRhYmxlLmdldFdyaXRlcigpOyJyeCI9PT1yLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2EucmVhZCgpLnRoZW4oKHI9PntpZighci5kb25lKXtpZihyLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7YS5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1vLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>ck.revokeObjectURL(n),0),new Worker(ck.createObjectURL(n))}const vm=new Map,ym=new Map;async function qz(n){if(!et().supportWebRTCEncodedTransform)return void v.warning("browser not support audio encoded transform");if(ym.has(n))return;const e={track:n.track};if(_o()){if(!n.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let i=null;try{i=n.createEncodedStreams()}catch(a){return void v.error("create audio-encoded-streams error",a&&a.message)}const s=new TransformStream({transform(a,c){e.controller||(e.controller=c),n.track&&n.track.id!==e.track.id&&(v.debug("audio track changed: ".concat(e.track.id," => ").concat(n.track.id)),e.track.removeEventListener("ended",t),e.track=n.track,e.track.addEventListener("ended",t)),c.enqueue(a)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(wn()){if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");const i=Tm(),s=new MessageChannel;await new W(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const a=new RTCRtpScriptTransform(i,{name:"rx",port:s.port2},[s.port2]);n.transform=a,await new W(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var l;c.data.transformed&&n.track&&((l=n.track)===null||l===void 0?void 0:l.id)!==e.track.id&&(v.debug("audio track changed: ".concat(e.track.id," => ").concat(n.track.id)),e.track.removeEventListener("ended",t),e.track=n.track,e.track.addEventListener("ended",t))},e.worker=i}function t(){n.track.removeEventListener("ended",t),function(i){const s=ym.get(i);if(s){ym.delete(i);try{var a,c;(a=s.controller)===null||a===void 0||a.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(l){v.warning(l&&l.message)}}}(n)}ym.set(n,e),n.track.addEventListener("ended",t)}function Jz(n){const e=new DataView(n.data);if(e.getUint8(0)===0&&e.getUint8(1)===0&&e.getUint8(2)===0&&e.getUint8(3)===1&&e.getUint8(4)===6){let t=6,i=0,s=0;for(;(s=e.getUint8(t++))===255;)i+=255;i+=s;const a=function(c,l,h){let p=new Uint8Array(c,l,h),f=[],_=0;for(;_<h;)_+3<h&&p[_]===0&&p[_+1]===0&&p[_+2]===3&&(p[_+3]===0||p[_+3]===1||p[_+3]===2||p[_+3]===3)?(f.push(p[_],p[_+1],p[_+3]),_+=4):(f.push(p[_]),_++);return new Uint8Array(f)}(n.data,t,i);return new Uint8Array(a)}return null}function Xz(n,e){const t=function(h){const p=h.length;let f=[],_=0;for(;_<p;)_+2<p&&h[_]===0&&h[_+1]===0&&(h[_+2]===0||h[_+2]===1||h[_+2]===2||h[_+2]===3)?(f.push(h[_],h[_+1],3,h[_+2]),_+=3):(f.push(h[_]),_++);return new Uint8Array(f)}(e),i=t.length,s=Math.floor(i/255),a=i%255,c=new Uint8Array(6+s+1+i+n.byteLength);c[0]=0,c[1]=0,c[2]=0,c[3]=1,c[4]=6,c[5]=101;let l=0;for(;l<s;)c[6+l]=255,l++;return c[6+l]=a,l++,c.set(t,6+l),c.set(new Uint8Array(n),6+l+i),c.buffer}const Rm=new Map,rh=new Map;async function Qz(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!et().supportWebRTCEncodedTransform)return void v.warning("browser not support video encoded transform");if(!n.track)return;if(rh.has(n)){const s=rh.get(n);return void(s&&(s.onSei=e.onSei))}const t={track:n.track,onSei:e.onSei};if(_o()){if(!n.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let s=null;try{s=n.createEncodedStreams()}catch(c){return void v.error("create video-encoded-streams error",c&&c.message)}const a=new TransformStream({transform(c,l){t.controller||(t.controller=l),n.track&&n.track.id!==t.track.id&&(v.debug("video track changed: ".concat(t.track.id," => ").concat(n.track.id)),t.track.removeEventListener("ended",i),t.track=n.track,t.track.addEventListener("ended",i));const h=Jz(c);h&&t.onSei&&t.onSei(h),l.enqueue(c)}});s.readable.pipeThrough(a).pipeTo(s.writable)}else if(wn()){if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");const s=Tm(),a=new MessageChannel;await new W(l=>s.onmessage=h=>{h.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(s,{name:"rx",port:a.port2},[a.port2]);n.transform=c,await new W(l=>s.onmessage=h=>{h.data==="started"&&l(void 0)}),a.port1.onmessage=l=>{var h;l.data.transformed&&n.track&&((h=n.track)===null||h===void 0?void 0:h.id)!==t.track.id?(v.debug("video track changed: ".concat(t.track.id," => ").concat(n.track.id)),t.track.removeEventListener("ended",i),t.track=n.track,t.track.addEventListener("ended",i)):l.data.sei&&t.onSei&&t.onSei(l.data.sei)},t.worker=s}function i(){if(n.track){if(this.id!==n.track.id)return;n.track.removeEventListener("ended",i)}(function(s){const a=rh.get(s);if(a){rh.delete(s);try{var c,l;(c=a.controller)===null||c===void 0||c.terminate(),(l=a.worker)===null||l===void 0||l.terminate()}catch(h){v.warning(h&&h.message)}}})(n)}rh.set(n,t),n.track.addEventListener("ended",i)}(function(){const n=Ze();Xn.getDisplayMedia=function(e){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),Xn.getStreamFromExtension=n.name===rt.CHROME&&Number(n.version)>34,Xn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch{}return e.close(),t}(),Xn.supportMinBitrate=n.name===rt.CHROME||n.name===rt.EDGE,Xn.supportSetRtpSenderParameters=function(){const e=Ze();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!ra()||!(!wn()&&!hf())||e.name===rt.FIREFOX&&Number(e.version)>=64}(),n.name===rt.SAFARI&&(Number(n.version)>=14?Xn.supportDualStream=!0:Xn.supportDualStream=!1),Xn.webAudioMediaStreamDest=function(){const e=Ze();return!(e.name===rt.SAFARI&&Number(e.version)<12)}(),Xn.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),Xn.supportWebGL=typeof WebGLRenderingContext<"u",Xn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ra()||(Xn.webAudioWithAEC=!0),Xn.supportShareAudio=function(){const e=Ze();return(e.os===on.WIN_10||e.os===on.WIN_81||e.os===on.WIN_7||e.os===on.LINUX||e.os===on.MAC_OS||e.os===on.CHROMIUM_OS)&&e.name===rt.CHROME&&Number(e.version)>=74}(),Xn.supportDataChannel=function(){return!!(ES(76)||function(e){const t=Ze();return!(t.name!==rt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}(68)||function(e){const t=Ze();return!(t.name!==rt.SAFARI||!t.osVersion)&&Number(t.version)>=e}(14))}(),Xn.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!mt()&&!!e&&e.prototype.setConfiguration instanceof Function}(),Xn.supportWebRTCEncodedTransform=function(){const e=Ze();return e.name==="Chrome"&&Number(e.version)>=86||e.name==="Safari"&&Number(e.version)>=15}(),Xn.supportWebRTCInsertableStream=function(){const e=Ze();return(e.name===rt.CHROME||e.name===rt.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),_f(()=>{Xn.supportDualStreamEncoding=function(){const e=Ze();return L("DISABLE_WEBAUDIO")?!0:e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&L("CHROME_DUAL_STREAM_USE_ENCODING"))}(),v.info("browser compatibility",JSON.stringify(Xn),JSON.stringify(n))})})();class $z extends At{constructor(){super(...arguments),S(this,"resultStorage",new Map)}setLocalAudioStats(e,t,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,t))}setLocalVideoStats(e,t,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i))}setRemoteAudioStats(e,t){const i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(t))}record(e,t,i){if(L("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(e);if(s&&(s.result.push(i),s.result.length>=5)){var a;const c=fe(a=s.result).call(a,!0);s.isPrevNormal&&!c&&this.emit("exception",dk[e],e,t),!s.isPrevNormal&&c&&this.emit("exception",dk[e]+2e3,e+"_RECOVER",t),s.isPrevNormal=c,s.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,t){return t instanceof tn&&!t.isActive||!!t.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,t){let i=null;t._encoderConfig&&t._encoderConfig.frameRate&&(i=nr(t._encoderConfig.frameRate));const s=e.captureFrameRate;return!i||!s||!(i>10&&s<5||i<10&&i>=5&&s<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,t){return t instanceof tn&&!t.isActive||!!t.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const dk={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Fn=new class{markSubscribeStart(n,e){performance.mark("agora-web-sdk/".concat(n,"/subscribe-").concat(e))}markPublishStart(n,e){performance.mark("agora-web-sdk/".concat(n,"/publish-").concat(e))}measureFromSubscribeStart(n,e){const t=performance.getEntriesByName("agora-web-sdk/".concat(n,"/subscribe-").concat(e));if(t.length>0){const i=t[t.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(n,e){const t=performance.getEntriesByName("agora-web-sdk/".concat(n,"/publish-").concat(e));if(t.length>0){const i=t[t.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function Pv(n,e){this.v=n,this.k=e}function Be(n){return new Pv(n,0)}var Zz=MO,eY=Vs;Nt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var n=eY.f(this);return{promise:n.promise,resolve:n.resolve,reject:n.reject}}});var tY=Vs,nY=Rd;Nt({target:"Promise",stat:!0,forced:!0},{try:function(n){var e=tY.f(this),t=nY(n);return(t.error?e.reject:e.resolve)(t.value),e.promise}});var Dv=m(Zz),lk=pd.f("asyncIterator"),iY=m(lk);function sh(n){var e,t;function i(a,c){try{var l=n[a](c),h=l.value,p=h instanceof Pv;Dv.resolve(p?h.v:h).then(function(f){if(p){var _=a==="return"?"return":"next";if(!h.k||f.done)return i(_,f);f=n[_](f).value}s(l.done?"return":"normal",f)},function(f){i("throw",f)})}catch(f){s("throw",f)}}function s(a,c){switch(a){case"return":e.resolve({value:c,done:!0});break;case"throw":e.reject(c);break;default:e.resolve({value:c,done:!1})}(e=e.next)?i(e.key,e.arg):t=null}this._invoke=function(a,c){return new Dv(function(l,h){var p={key:a,arg:c,resolve:l,reject:h,next:null};t?t=t.next=p:(e=t=p,i(a,c))})},typeof n.return!="function"&&(this.return=void 0)}function Bi(n){return function(){return new sh(n.apply(this,arguments))}}sh.prototype[typeof Sd=="function"&&iY||"@@asyncIterator"]=function(){return this},sh.prototype.next=function(n){return this._invoke("next",n)},sh.prototype.throw=function(n){return this._invoke("throw",n)},sh.prototype.return=function(n){return this._invoke("return",n)};var uk=m(Ms.Object.getOwnPropertySymbols),rY=Nt,sY=FE.indexOf,oY=Ug,kv=Le([].indexOf),hk=!!kv&&1/kv([1],1,-0)<0;rY({target:"Array",proto:!0,forced:hk||!oY("indexOf")},{indexOf:function(n){var e=arguments.length>1?arguments[1]:void 0;return hk?kv(this,n,e)||0:sY(this,n,e)}});var aY=Xo("Array").indexOf,cY=X,dY=aY,Lv=Array.prototype,pk=m(function(n){var e=n.indexOf;return n===Lv||cY(Lv,n)&&e===Lv.indexOf?dY:e}),lY=Us,fk=kp;Nt({target:"Object",stat:!0,forced:E(function(){fk(1)})},{keys:function(n){return fk(lY(n))}});var uY=m(Ms.Object.keys);function hY(n,e){if(n==null)return{};var t,i,s=function(c,l){if(c==null)return{};var h,p,f={},_=uY(c);for(p=0;p<_.length;p++)h=_[p],pk(l).call(l,h)>=0||(f[h]=c[h]);return f}(n,e);if(uk){var a=uk(n);for(i=0;i<a.length;i++)t=a[i],pk(e).call(e,t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(s[t]=n[t])}return s}var mk={exports:{}};(function(n,e){n.exports=(()=>{var t={8:(a,c,l)=>{l.r(c),l.d(c,{Parser:()=>Ue,Printer:()=>Gi,parse:()=>ke,print:()=>tt});const h=`
`,p="".concat("\r").concat(h),f=" ";let _;function g(de){return de>="0"&&de<="9"}function T(de){return de>="!"&&de<="~"}function w(de){return T(de)||de>=""&&de<="ÿ"}function R(de){return de==="!"||de>="#"&&de<="'"||de>="*"&&de<="+"||de>="-"&&de<="."||de>="0"&&de<="9"||de>="A"&&de<="Z"||de>="^"&&de<="~"}function I(de){return de>="1"&&de<="9"}function N(de){return de>="A"&&de<="Z"||de>="a"&&de<="z"}function D(de){return de==="d"||de==="h"||de==="m"||de==="s"}function V(de){return de>""&&de<"	"||de>"\v"&&de<"\f"||de>""&&de<"ÿ"}function G(de){return N(de)||g(de)||de==="+"||de==="/"}function F(de){return g(de)||N(de)||de==="+"||de==="/"||de==="-"||de==="_"}function j(de){return N(de)||g(de)||de==="+"||de==="/"}function z(de,C){var k=Object.keys(de);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(de);C&&(x=x.filter(function(ie){return Object.getOwnPropertyDescriptor(de,ie).enumerable})),k.push.apply(k,x)}return k}function Y(de){for(var C=1;C<arguments.length;C++){var k=arguments[C]!=null?arguments[C]:{};C%2?z(Object(k),!0).forEach(function(x){re(de,x,k[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(de,Object.getOwnPropertyDescriptors(k)):z(Object(k)).forEach(function(x){Object.defineProperty(de,x,Object.getOwnPropertyDescriptor(k,x))})}return de}function re(de,C,k){return C in de?Object.defineProperty(de,C,{value:k,enumerable:!0,configurable:!0,writable:!0}):de[C]=k,de}(function(de){de.VERSION="v",de.ORIGIN="o",de.SESSION_NAME="s",de.INFORMATION="i",de.URI="u",de.EMAIL="e",de.PHONE="p",de.CONNECTION="c",de.BANDWIDTH="b",de.TIME="t",de.REPEAT="r",de.ZONE_ADJUSTMENTS="z",de.KEY="k",de.ATTRIBUTE="a",de.MEDIA="m"})(_||(_={}));class ae{consumeText(C,k){let x=k;for(;x<C.length;){const ie=C[x];if(ie==="\0"||ie==="\r"||ie===h)break;x+=1}if(x-k==0)throw new Error("Invalid text, at ".concat(C));return x}consumeUnicastAddress(C,k,x){return this.consumeTill(C,k,f)}consumeOneOrMore(C,k,x){let ie=k;for(;x(C[ie]);)ie++;if(ie-k==0)throw new Error("Invalid rule at ".concat(k,"."));return ie}consumeSpace(C,k){if(C[k]===f)return k+1;throw new Error("Invalid space at ".concat(k,"."))}consumeIP4Address(C,k){let x=k;for(let ie=0;ie<4;ie++)if(x=this.consumeDecimalUChar(C,x),ie!==3){if(C[x]!==".")throw new Error("Invalid IP4 address.");x++}return x}consumeDecimalUChar(C,k){let x=k;for(let xe=0;xe<3&&g(C[x]);xe++,x++);if(x-k==0)throw new Error("Invalid decimal uchar.");const ie=parseInt(C.slice(k,x));if(ie>=0&&ie<=255)return x;throw new Error("Invalid decimal uchar")}consumeIP6Address(C,k){let x=this.consumeHexpart(C,k);return C[x]===":"&&(x+=1,x=this.consumeIP4Address(C,x)),x}consumeHexpart(C,k){let x=k;if(C[x]===":"&&C[x+1]===":"){x+=2;try{x=this.consumeHexseq(C,x)}catch{}return x}if(x=this.consumeHexseq(C,x),C[x]===":"&&C[x+1]===":"){x+=2;try{x=this.consumeHexseq(C,x)}catch{}return x}return x}consumeHexseq(C,k){let x=k;for(;x=this.consumeHex4(C,x),C[x]===":"&&C[x+1]!==":";)x+=1;return x}consumeHex4(C,k){let x=0;for(;x<4;x++)if(!((ie=C[k+x])>="0"&&ie<="9"||ie>="a"&&ie<="f"||ie>="A"&&ie<="F")){if(x===0)throw new Error("Invalid hex 4");break}var ie;return k+x}consumeFQDN(C,k){let x=k;for(;g(C[x])||N(C[x])||C[x]==="-"||C[x]===".";)x+=1;if(x-k<4)throw new Error("Invalid FQDN");return x}consumeExtnAddr(C,k){return this.consumeOneOrMore(C,k,w)}consumeMulticastAddress(C,k,x){switch(x){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(C,k);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(C,k);default:try{return this.consumeFQDN(C,k)}catch{return this.consumeExtnAddr(C,k)}}}consumeIP6MulticastAddress(C,k){const x=this.consumeHexpart(C,k);return C[x]==="/"?this.consumeInteger(C,x+1):x}consumeIP4MulticastAddress(C,k){let x=k+3;const ie=C.slice(k,x),xe=parseInt(ie);if(xe<224||xe>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let yt=0;yt<3;yt++){if(C[x]!==".")throw new Error("Invalid IP4 multicast address.");x+=1,x=this.consumeDecimalUChar(C,x)}return C[x]==="/"&&(x+=1),x=this.consumeTTL(C,x),C[x]==="/"&&(x=this.consumeInteger(C,x)),x}consumeInteger(C,k){if(!I(C[k]))throw new Error("Invalid integer.");for(k+=1;g(C[k]);)k+=1;return k}consumeTTL(C,k){if(C[k]==="0")return k+1;if(!I(C[k]))throw new Error("Invalid TTL.");k+=1;for(let x=0;x<2&&g(C[k]);x++)k+=1;return k}consumeToken(C,k){return this.consumeOneOrMore(C,k,R)}consumeTime(C,k){let x=k;if(C[x]==="0")return x+1;for(I(C[x])&&(x+=1);g(C[x]);)x++;if(x-k<10)throw new Error("Invalid time");return x}consumeAddress(C,k){return this.consumeTill(C,k,f)}consumeTypedTime(C,k){let x=k;return x=this.consumeOneOrMore(C,x,g),D(C[x])?x+1:x}consumeRepeatInterval(C,k){if(!I(C[k]))throw new Error("Invalid repeat interval");for(k+=1;g(C[k]);)k+=1;return D(C[k])&&(k+=1),k}consumePort(C,k){return this.consumeOneOrMore(C,k,g)}consume(C,k,x){for(let ie=0;ie<x.length;ie++){if(k+ie>=C.length)throw new Error("consume exceeding value length");if(C[k+ie]!==x[ie])throw new Error("consume ".concat(x," failed at ").concat(ie))}return k+x.length}consumeTill(C,k,x){let ie=k;for(;ie<C.length&&(typeof x!="string"||C[ie]!==x)&&(typeof x!="function"||!x(C[ie]));)ie++;return ie}}class Ue extends ae{constructor(){super(),re(this,"records",[]),re(this,"currentLine",0)}parse(C){const k=this.probeEOL(C);this.records=C.split(k).filter(rn=>!!rn.trim()).map(this.parseLine),this.currentLine=0;const x=this.parseVersion(),ie=this.parseOrigin(),xe=this.parseSessionName(),yt=this.parseInformation(),Gn=this.parseUri(),Wi=this.parseEmail(),Mo=this.parsePhone(),Vm=this.parseConnection(),Fm=this.parseBandWidth(),br=this.parseTimeFields(),Ma=this.parseKey(),pl=this.parseSessionAttribute(),Wt=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:x,origin:ie,sessionName:xe,information:yt,uri:Gn,emails:Wi,phones:Mo,connection:Vm,bandwidths:Fm,timeFields:br,key:Ma,attributes:pl,mediaDescriptions:Wt}}getCurrentRecord(){const C=this.records[this.currentLine];if(!C)throw new Error("Record doesn't exit.");return C}probeEOL(C){for(let k=0;k<C.length;k++)if(C[k]===h)return C[k-1]==="\r"?p:h;throw new Error("Invalid newline character.")}parseLine(C,k){if(C.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const x=C[0];if(C[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:x,value:C.slice(2),line:k,cur:0}}parseSessionAttribute(){const C=new vt;for(;this.currentLine<this.records.length;){const k=this.getCurrentRecord();if(k.type!==_.ATTRIBUTE)break;const x={attField:this.extractOneOrMore(k,ie=>R(ie)&&ie!==":"),_cur:0};k.value[k.cur]===":"&&(k.cur+=1,x.attValue=this.extractOneOrMore(k,V)),C.parse(x),this.currentLine++}return C.digest()}parseMediaAttributes(C){const k=new nn(C);for(;this.currentLine<this.records.length;){const x=this.getCurrentRecord();if(x.type!==_.ATTRIBUTE)break;const ie={attField:this.extractOneOrMore(x,xe=>R(xe)&&xe!==":"),_cur:0};x.value[x.cur]===":"&&(x.cur+=1,ie.attValue=this.extractOneOrMore(x,V)),k.parse(ie),this.currentLine++}return k.digest()}parseKey(){const C=this.getCurrentRecord();if(C.type===_.KEY){if(C.value==="prompt"||C.value==="clear:"||C.value==="base64:"||C.value==="uri:")return C.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const C=this.getCurrentRecord();if(C.type===_.ZONE_ADJUSTMENTS){const k=[];for(;;)try{const x=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);let ie=!1;C.value[C.cur]==="-"&&(ie=!0,C.cur+=1);const xe=this.extract(C,this.consumeTypedTime);k.push({time:x,typedTime:xe,back:ie})}catch{break}if(k.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,k}return[]}parseRepeat(){const C=[];for(;;){const k=this.getCurrentRecord();if(k.type!==_.REPEAT)break;{const x=this.extract(k,this.consumeRepeatInterval),ie=this.parseTypedTime(k);C.push({repeatInterval:x,typedTimes:ie}),this.currentLine++}}return C}parseTypedTime(C){const k=[];for(;;)try{this.consumeSpaceForRecord(C),k.push(this.extract(C,this.consumeTypedTime))}catch{break}if(k.length===0)throw new Error("Invalid typed time.");return k}parseTime(){const C=this.getCurrentRecord(),k=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);const x=this.extract(C,this.consumeTime);return this.currentLine++,{startTime:k,stopTime:x}}parseBandWidth(){const C=[];for(;this.currentLine<this.records.length;){const k=this.getCurrentRecord();if(k.type!==_.BANDWIDTH)break;{const x=this.extractOneOrMore(k,R);if(k.value[k.cur]!==":")throw new Error("Invalid bandwidth field.");k.cur++;const ie=this.extractOneOrMore(k,g);C.push({bwtype:x,bandwidth:ie}),this.currentLine++}}return C}parseVersion(){const C=this.getCurrentRecord();if(C.type!==_.VERSION)throw new Error("first sdp record must be version");const k=C.value.slice(0,this.consumeOneOrMore(C.value,0,g));if(k.length!==C.value.length)throw new Error('invalid proto version, "v='.concat(C.value,'"'));return this.currentLine++,k}parseOrigin(){const C=this.getCurrentRecord();if(C.type!==_.ORIGIN)throw new Error("second line of sdp must be origin");const k=this.extractOneOrMore(C,w);this.consumeSpaceForRecord(C);const x=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const ie=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const xe=this.extractOneOrMore(C,R);this.consumeSpaceForRecord(C);const yt=this.extractOneOrMore(C,R);this.consumeSpaceForRecord(C);const Gn=this.extract(C,this.consumeUnicastAddress);return this.currentLine++,{username:k,sessId:x,sessVersion:ie,nettype:xe,addrtype:yt,unicastAddress:Gn}}parseSessionName(){const C=this.getCurrentRecord();if(C.type===_.SESSION_NAME){const k=this.extract(C,this.consumeText);return this.currentLine++,k}}parseInformation(){const C=this.getCurrentRecord();if(C.type!==_.INFORMATION)return;const k=this.extract(C,this.consumeText);return this.currentLine++,k}parseUri(){const C=this.getCurrentRecord();if(C.type===_.URI)return this.currentLine++,C.value}parseEmail(){const C=[];for(;;){const k=this.getCurrentRecord();if(k.type!==_.EMAIL)break;C.push(k.value),this.currentLine++}return C}parsePhone(){const C=[];for(;;){const k=this.getCurrentRecord();if(k.type!==_.PHONE)break;C.push(k.value),this.currentLine++}return C}parseConnection(){const C=this.getCurrentRecord();if(C.type===_.CONNECTION){const k=this.extractOneOrMore(C,R);this.consumeSpaceForRecord(C);const x=this.extractOneOrMore(C,R);this.consumeSpaceForRecord(C);const ie=this.extract(C,this.consumeAddress);return this.currentLine++,{nettype:k,addrtype:x,address:ie}}}parseMedia(){const C=this.getCurrentRecord(),k=this.extract(C,this.consumeToken);this.consumeSpaceForRecord(C);let x=this.extract(C,this.consumePort);C.value[C.cur]==="/"&&(C.cur+=1,x+=this.extract(C,this.consumeInteger)),this.consumeSpaceForRecord(C);const ie=[];for(ie.push(this.extract(C,this.consumeToken));C.value[C.cur]==="/";)C.cur+=1,ie.push(this.extract(C,this.consumeToken));if(ie.length===0)throw new Error("Invalid proto");const xe=this.parseFmt(C);return this.currentLine++,{mediaType:k,port:x,protos:ie,fmts:xe}}parseTimeFields(){const C=[];for(;this.getCurrentRecord().type===_.TIME;){const k=this.parseTime(),x=this.parseRepeat(),ie=this.parseZone();C.push({time:k,repeats:x,zones:ie})}return C}parseMediaDescription(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.MEDIA;){const k=this.parseMedia(),x=this.parseInformation(),ie=this.parseConnections(),xe=this.parseBandWidth(),yt=this.parseKey(),Gn=this.parseMediaAttributes(k);C.push({media:k,information:x,connections:ie,bandwidths:xe,key:yt,attributes:Gn})}return C}parseConnections(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.CONNECTION;)C.push(this.parseConnection());return C}parseFmt(C){const k=[];for(;;)try{this.consumeSpaceForRecord(C),k.push(this.extract(C,this.consumeToken))}catch{break}if(k.length===0)throw new Error("Invalid fmts");return k}extract(C,k,...x){const ie=k.call(this,C.value,C.cur,...x),xe=C.value.slice(C.cur,ie);return C.cur=ie,xe}extractOneOrMore(C,k){const x=this.consumeOneOrMore(C.value,C.cur,k),ie=C.value.slice(C.cur,x);return C.cur=x,ie}consumeSpaceForRecord(C){if(C.value[C.cur]!==f)throw new Error("Invalid space at ".concat(C.cur,"."));C.cur+=1}}class ze extends ae{constructor(...C){super(...C),re(this,"attributes",void 0),re(this,"digested",!1)}extractOneOrMore(C,k,x){const ie=this.consumeOneOrMore(C.attValue,C._cur,k),xe=C.attValue.slice(C._cur,ie),[yt,Gn]=x||[];if(typeof yt=="number"&&xe.length<yt)throw new Error("error in length, should be more or equal than ".concat(yt," characters."));if(typeof Gn=="number"&&xe.length>Gn)throw new Error("error in length, should be less or equal than ".concat(Gn," characters."));return C._cur=ie,xe}consumeAttributeSpace(C){if(C.attValue[C._cur]!==f)throw new Error("Invalid space at ".concat(C._cur,"."));C._cur+=1}extract(C,k,...x){if(!C.attValue)throw new Error("Nothing to extract from attValue.");const ie=k.call(this,C.attValue,C._cur,...x),xe=C.attValue.slice(C._cur,ie);return C._cur=ie,xe}atEnd(C){if(!C.attValue)throw new Error;return C._cur>=C.attValue.length}peekChar(C){if(!C.attValue)throw new Error;return C.attValue[C._cur]}peek(C,k){if(!C.attValue)throw new Error;for(let x=0;x<k.length;x++)if(k[x]!==C.attValue[C._cur+x])return!1;return!0}parseIceUfrag(C){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(C,G,[4,256])}parseIcePwd(C){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(C,G,[22,256])}parseIceOptions(C){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const k=[];for(;!this.atEnd(C);){k.push(this.extractOneOrMore(C,G));try{this.consumeAttributeSpace(C)}catch(x){if(this.atEnd(C))break;throw x}}this.attributes.iceOptions=k}parseFingerprint(C){const k=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const x=this.extract(C,this.consumeTill);this.attributes.fingerprints.push({hashFunction:k,fingerprint:x})}parseExtmap(C){const k=this.extractOneOrMore(C,g);let x;this.peekChar(C)==="/"&&(this.extract(C,this.consume,"/"),x=this.extract(C,this.consumeToken)),this.consumeAttributeSpace(C);const ie=this.extract(C,this.consumeTill,f),xe=Y(Y({entry:parseInt(k,10)},x&&{direction:x}),{},{extensionName:ie});this.peekChar(C)===f&&(this.consumeAttributeSpace(C),xe.extensionAttributes=this.extract(C,this.consumeTill)),this.attributes.extmaps.push(xe)}parseSetup(C){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const k=this.extract(C,this.consumeTill);if(k!=="active"&&k!=="passive"&&k!=="actpass"&&k!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=k}}class vt extends ze{constructor(...C){super(...C),re(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"group":this.parseGroup(C);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"fingerprint":this.parseFingerprint(C);break;case"setup":this.parseSetup(C);break;case"tls-id":this.parseTlsId(C);break;case"identity":this.parseIdentity(C);break;case"extmap":this.parseExtmap(C);break;case"msid-semantic":this.parseMsidSemantic(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(k){throw console.error("parsing session attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),k}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(C){const k=this.extract(C,this.consumeToken),x=[];for(;!this.atEnd(C)&&this.peekChar(C)===f;)this.consumeAttributeSpace(C),x.push(this.extract(C,this.consumeToken));this.attributes.groups.push({semantic:k,identificationTag:x})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(C){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(C,F)}parseIdentity(C){const k=this.extractOneOrMore(C,j),x=[];for(;!this.atEnd(C)&&this.peekChar(C)===f;){this.consumeAttributeSpace(C);const ie=this.extract(C,this.consumeToken);this.extract(C,this.consume,"=");const xe=this.extractOneOrMore(C,yt=>yt!==f&&V(yt));x.push({name:ie,value:xe})}this.attributes.identities.push({assertionValue:k,extensions:x})}parseMsidSemantic(C){this.peekChar(C)===f&&this.consumeAttributeSpace(C);const k={semantic:this.extract(C,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(C)}catch{break}if(this.peekChar(C)==="*"){this.extract(C,this.consume,"*"),k.applyForAll=!0;break}{const x=this.extract(C,this.consumeTill,f);k.identifierList.push(x)}}this.attributes.msidSemantic=k}}class nn extends ze{constructor(C){super(),re(this,"attributes",void 0),C.protos.indexOf("RTP")!==-1||C.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"extmap":this.parseExtmap(C);break;case"setup":this.parseSetup(C);break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"candidate":this.parseCandidate(C);break;case"remote-candidate":this.parseRemoteCandidate(C);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(C);break;case"rtpmap":this.parseRtpmap(C);break;case"ptime":this.parsePtime(C);break;case"maxptime":this.parseMaxPtime(C);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(C);break;case"ssrc":this.parseSSRC(C);break;case"fmtp":this.parseFmtp(C);break;case"rtcp-fb":this.parseRtcpFb(C);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(C);break;case"mid":this.parseMid(C);break;case"msid":this.parseMsid(C);break;case"imageattr":this.parseImageAttr(C);break;case"rid":this.parseRid(C);break;case"simulcast":this.parseSimulcast(C);break;case"sctp-port":this.parseSctpPort(C);break;case"max-message-size":this.parseMaxMessageSize(C);break;case"ssrc-group":this.parseSSRCGroup(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(k){throw console.error("parsing media attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),k}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}parseCandidate(C){const k=this.extractOneOrMore(C,G,[1,32]);this.consumeAttributeSpace(C);const x=this.extractOneOrMore(C,g,[1,5]);this.consumeAttributeSpace(C);const ie=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const xe=this.extractOneOrMore(C,g,[1,10]);this.consumeAttributeSpace(C);const yt=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const Gn=this.extract(C,this.consumePort);this.consumeAttributeSpace(C),this.extract(C,this.consume,"typ"),this.consumeAttributeSpace(C);const Wi={foundation:k,componentId:x,transport:ie,priority:xe,connectionAddress:yt,port:Gn,type:this.extract(C,this.consumeToken),extension:{}};for(this.peek(C," raddr")&&(this.extract(C,this.consume," raddr"),this.consumeAttributeSpace(C),Wi.relAddr=this.extract(C,this.consumeAddress)),this.peek(C," rport")&&(this.extract(C,this.consume," rport"),this.consumeAttributeSpace(C),Wi.relPort=this.extract(C,this.consumePort));this.peekChar(C)===f;){this.consumeAttributeSpace(C);const Mo=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C),Wi.extension[Mo]=this.extractOneOrMore(C,T)}this.attributes.candidates.push(Wi)}parseRemoteCandidate(C){const k=[];for(;;){const x=this.extractOneOrMore(C,g,[1,5]);this.consumeAttributeSpace(C);const ie=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const xe=this.extract(C,this.consumePort);k.push({componentId:x,connectionAddress:ie,port:xe});try{this.consumeAttributeSpace(C)}catch{break}}this.attributes.remoteCandidatesList.push(k)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(C){const k=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const x=this.extract(C,this.consumeTill,"/");this.extract(C,this.consume,"/");const ie={encodingName:x,clockRate:this.extractOneOrMore(C,g)};this.atEnd(C)||this.peekChar(C)!=="/"||(this.extract(C,this.consume,"/"),ie.encodingParameters=parseInt(this.extract(C,this.consumeTill),10));const xe=this.attributes.payloads.find(yt=>yt.payloadType===parseInt(k,10));xe?xe.rtpMap=ie:this.attributes.payloads.push({payloadType:parseInt(k,10),rtpMap:ie,rtcpFeedbacks:[]})}parsePtime(C){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(C,this.consumeTill)}parseMaxPtime(C){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(C,this.consumeTill)}parseDirection(C){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=C.attField}parseSSRC(C){const k=this.extractOneOrMore(C,g);this.consumeAttributeSpace(C);const x=this.extract(C,this.consumeTill,":");let ie;this.peekChar(C)===":"&&(this.extract(C,this.consume,":"),ie=this.extract(C,this.consumeTill));const xe=this.attributes.ssrcs.find(yt=>yt.ssrcId===parseInt(k,10));xe?xe.attributes[x]=ie:this.attributes.ssrcs.push({ssrcId:parseInt(k,10),attributes:{[x]:ie}})}parseFmtp(C){const k=this.extract(C,this.consumeTill,f);this.consumeAttributeSpace(C);const x=this.extract(C,this.consumeTill),ie={};x.split(";").forEach(yt=>{let[Gn,Wi]=yt.split("=");Gn=Gn.trim();const Mo=typeof Wi=="string"?Wi.trim():null;typeof Gn=="string"&&Gn.length>0&&(ie[Gn]=Mo)});const xe=this.attributes.payloads.find(yt=>yt.payloadType===parseInt(k,10));xe?xe.fmtp={parameters:ie}:this.attributes.payloads.push({payloadType:parseInt(k,10),rtcpFeedbacks:[],fmtp:{parameters:ie}})}parseFmtParameters(C){const k={},x=this.extract(C,this.consumeTill,"=");C._cur++;const ie=this.extract(C,this.consumeTill,";");for(k[x]=ie;C.attValue[C._cur]===";";){const xe=this.extract(C,this.consumeTill,"=");C._cur++;const yt=this.extract(C,this.consumeTill,";");k[xe]=yt}return k}parseRtcpFb(C){let k="";k=this.peekChar(C)==="*"?this.extract(C,this.consume,"*"):this.extract(C,this.consumeTill,f),this.consumeAttributeSpace(C);const x=this.extract(C,this.consumeTill,f);let ie;if(x==="trr-int")ie={type:x,interval:this.extract(C,this.consumeTill)};else{const xe={type:x};this.peekChar(C)===f&&(this.consumeAttributeSpace(C),xe.parameter=this.extract(C,this.consumeToken),this.peekChar(C)===f&&(xe.additional=this.extract(C,this.consumeTill))),ie=xe}if(k==="*")this.attributes.rtcpFeedbackWildcards.push(ie);else{const xe=this.attributes.payloads.find(yt=>yt.payloadType===parseInt(k,10));xe?xe.rtcpFeedbacks.push(ie):this.attributes.payloads.push({payloadType:parseInt(k,10),rtcpFeedbacks:[ie]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(C){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const k={port:this.extract(C,this.consumePort)};this.peekChar(C)===f&&(this.consumeAttributeSpace(C),k.netType=this.extractOneOrMore(C,R),this.consumeAttributeSpace(C),k.addressType=this.extractOneOrMore(C,R),this.consumeAttributeSpace(C),k.address=this.extract(C,this.consumeAddress)),this.attributes.rtcp=k}parseMsid(C){const k={id:this.extractOneOrMore(C,R,[1,64])};this.peekChar(C)===f&&(this.consumeAttributeSpace(C),k.appdata=this.extractOneOrMore(C,R,[1,64])),this.attributes.msids.push(k)}parseImageAttr(C){this.attributes.imageattr.push(C.attValue)}parseRid(C){const k=this.extractOneOrMore(C,ie=>N(ie)||g(ie)||ie==="_"||ie==="-");this.consumeAttributeSpace(C);const x={id:k,direction:this.extract(C,this.consumeToken),params:[]};if(this.peekChar(C)===f){if(this.consumeAttributeSpace(C),this.peek(C,"pt=")){this.extract(C,this.consume,"pt=");const ie=[];for(;;){const xe=this.extract(C,this.consumeToken);ie.push(xe);try{this.extract(C,this.consume,",")}catch{break}}x.payloads=ie,this.peekChar(C)===f&&this.extract(C,this.consume,f)}for(;;){const ie=this.extract(C,this.consumeToken);switch(ie){case"depend":{const xe={type:ie,rids:this.extract(C,this.consume,"=").split(",")};x.params.push(xe);break}default:{const xe={type:ie};this.peekChar(C)==="="&&(this.extract(C,this.consume,"="),xe.val=this.extract(C,this.consumeTill,";")),x.params.push(xe)}}try{this.extract(C,this.consume,";")}catch{break}}}this.attributes.rids.push(x)}parseSimulcast(C){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=C.attValue,this.extract(C,this.consumeTill)}parseSctpPort(C){this.attributes.sctpPort=this.extractOneOrMore(C,g,[1,5])}parseMaxMessageSize(C){this.attributes.maxMessageSize=this.extractOneOrMore(C,g,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(C){this.attributes.mid=this.extract(C,this.consumeToken)}parseSSRCGroup(C){const k=this.extract(C,this.consumeToken),x=[];for(;;)try{this.consumeAttributeSpace(C);const ie=this.extract(C,this.consumeInteger);x.push(parseInt(ie,10))}catch{break}this.attributes.ssrcGroups.push({semantic:k,ssrcIds:x})}}function It(de,C,k){return C in de?Object.defineProperty(de,C,{value:k,enumerable:!0,configurable:!0,writable:!0}):de[C]=k,de}class Gi{constructor(){It(this,"eol",p)}print(C,k){let x="";return k&&(this.eol=k),x+=this.printVersion(C.version),x+=this.printOrigin(C.origin),x+=this.printSessionName(C.sessionName),x+=this.printInformation(C.information),x+=this.printUri(C.uri),x+=this.printEmail(C.emails),x+=this.printPhone(C.phones),x+=this.printConnection(C.connection),x+=this.printBandwidth(C.bandwidths),x+=this.printTimeFields(C.timeFields),x+=this.printKey(C.key),x+=this.printSessionAttributes(C.attributes),x+=this.printMediaDescription(C.mediaDescriptions),x}printVersion(C){return"v=".concat(C).concat(this.eol)}printOrigin(C){return"o=".concat(C.username," ").concat(C.sessId," ").concat(C.sessVersion," ").concat(C.nettype," ").concat(C.addrtype," ").concat(C.unicastAddress).concat(this.eol)}printSessionName(C){return C?"s=".concat(C).concat(this.eol):""}printInformation(C){return C?"i=".concat(C).concat(this.eol):""}printUri(C){return C?"u=".concat(C).concat(this.eol):""}printEmail(C){let k="";for(const x of C)k+="e=".concat(x).concat(this.eol);return k}printPhone(C){let k="";for(const x of C)k+="e=".concat(x).concat(this.eol);return k}printConnection(C){return C?"c=".concat(C.nettype," ").concat(C.addrtype," ").concat(C.address).concat(this.eol):""}printBandwidth(C){let k="";for(const x of C)k+="b=".concat(x.bwtype,":").concat(x.bandwidth).concat(this.eol);return k}printTimeFields(C){let k="";for(const x of C){k+="t=".concat(x.time.startTime," ").concat(x.time.startTime).concat(this.eol);for(const ie of x.repeats)k+="r=".concat(ie.repeatInterval," ").concat(ie.typedTimes.join(" ")).concat(this.eol);x.zoneAdjustments&&(k+="z=",k+="z=".concat(x.zoneAdjustments.map(ie=>"".concat(ie.time," ").concat(ie.back?"-":""," ").concat(ie.typedTime)).join(" ")).concat(this.eol),k+=this.eol)}return k}printKey(C){return C?"k=".concat(C).concat(this.eol):""}printAttributes(C){let k="";for(const x of C)k+="a=".concat(x.attField).concat(x.attValue?":".concat(x.attValue):"").concat(this.eol);return k}printMediaDescription(C){let k="";for(const x of C)k+=this.printMedia(x.media),k+=this.printInformation(x.information),k+=this.printConnections(x.connections),k+=this.printBandwidth(x.bandwidths),k+=this.printKey(x.key),k+=this.printMediaAttributes(x);return k}printConnections(C){let k="";for(const x of C)k+=this.printConnection(x);return k}printMedia(C){return"m=".concat(C.mediaType," ").concat(C.port," ").concat(C.protos.join("/")," ").concat(C.fmts.join(" ")).concat(this.eol)}printSessionAttributes(C){return new se(this.eol).print(C)}printMediaAttributes(C){return new ge(this.eol).print(C)}}class ee{constructor(C){It(this,"eol",void 0),this.eol=C}printIceUfrag(C){return C===void 0?"":"a=ice-ufrag:".concat(C).concat(this.eol)}printIcePwd(C){return C===void 0?"":"a=ice-pwd:".concat(C).concat(this.eol)}printIceOptions(C){return C===void 0?"":"a=ice-options:".concat(C.join(f)).concat(this.eol)}printFingerprints(C){return C.length>0?C.map(k=>"a=fingerprint:".concat(k.hashFunction).concat(f).concat(k.fingerprint)).join(this.eol)+this.eol:""}printExtmap(C){return C.map(k=>"a=extmap:".concat(k.entry).concat(k.direction?"/".concat(k.direction):"").concat(f).concat(k.extensionName).concat(k.extensionAttributes?"".concat(f).concat(k.extensionAttributes):"").concat(this.eol)).join("")}printSetup(C){return C===void 0?"":"a=setup:".concat(C).concat(this.eol)}printUnrecognized(C){return C.map(k=>"a=".concat(k.attField).concat(k.attValue?":".concat(k.attValue):"").concat(this.eol)).join("")}}class se extends ee{print(C){let k="";return k+=this.printGroups(C.groups),k+=this.printMsidSemantic(C.msidSemantic),k+=this.printIceLite(C.iceLite),k+=this.printIceUfrag(C.iceUfrag),k+=this.printIcePwd(C.icePwd),k+=this.printIceOptions(C.iceOptions),k+=this.printFingerprints(C.fingerprints),k+=this.printSetup(C.setup),k+=this.printTlsId(C.tlsId),k+=this.printIdentity(C.identities),k+=this.printExtmap(C.extmaps),k+=this.printUnrecognized(C.unrecognized),k}printGroups(C){let k="";return C.length>0&&(k+=C.map(x=>"a=group:".concat(x.semantic).concat(x.identificationTag.map(ie=>"".concat(f).concat(ie)).join("")).concat(this.eol)).join("")),k}printIceLite(C){return C===void 0?"":"a=ice-lite"+this.eol}printTlsId(C){return C?"a=tls-id:".concat(C).concat(this.eol):""}printIdentity(C){return C.length===0?"":C.map(k=>"a=identity:".concat(k.assertionValue).concat(k.extensions.map(x=>"".concat(f).concat(x.name).concat(x.value?"=".concat(x.value):"")))).join(this.eol)+this.eol}printMsidSemantic(C){if(!C)return"";let k="a=msid-semantic:".concat(C.semantic);return C.applyForAll?k+="".concat(f,"*"):C.identifierList.length>0&&(k+=C.identifierList.map(x=>"".concat(f).concat(x))),k+this.eol}}class ge extends ee{print(C){const k=C.attributes;let x="";return x+=this.printRTCP(k.rtcp),x+=this.printIceUfrag(k.iceUfrag),x+=this.printIcePwd(k.icePwd),x+=this.printIceOptions(k.iceOptions),x+=this.printCandidates(k.candidates),x+=this.printRemoteCandidatesList(k.remoteCandidatesList),x+=this.printEndOfCandidates(k.endOfCandidates),x+=this.printFingerprints(k.fingerprints),x+=this.printSetup(k.setup),x+=this.printMid(k.mid),x+=this.printExtmap(k.extmaps),x+=this.printRTPRelated(k),x+=this.printPtime(k.ptime),x+=this.printMaxPtime(k.maxPtime),x+=this.printDirection(k.direction),x+=this.printSSRCGroups(k.ssrcGroups),x+=this.printSSRC(k.ssrcs),x+=this.printRTCPMux(k.rtcpMux),x+=this.printRTCPMuxOnly(k.rtcpMuxOnly),x+=this.printRTCPRsize(k.rtcpRsize),x+=this.printMSId(k.msids),x+=this.printImageattr(k.imageattr),x+=this.printRid(k.rids),x+=this.printSimulcast(k.simulcast),x+=this.printSCTPPort(k.sctpPort),x+=this.printMaxMessageSize(k.maxMessageSize),x+=this.printUnrecognized(k.unrecognized),x}printCandidates(C){return C.map(k=>"a=candidate:".concat(k.foundation).concat(f).concat(k.componentId).concat(f).concat(k.transport).concat(f).concat(k.priority).concat(f).concat(k.connectionAddress).concat(f).concat(k.port).concat(f,"typ").concat(f).concat(k.type).concat(k.relAddr?"".concat(f,"raddr").concat(f).concat(k.relAddr):"").concat(k.relPort?"".concat(f,"rport").concat(f).concat(k.relPort):"").concat(Object.keys(k.extension).map(x=>"".concat(f).concat(x).concat(f).concat(k.extension[x])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(C){return C.map(k=>"a=remote-candidates:".concat(k.join(f)).concat(this.eol)).join("")}printEndOfCandidates(C){return C===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(C){if(!C.payloads)return"";const k=C.payloads;let x="";x+=C.rtcpFeedbackWildcards.map(ie=>this.printRTCPFeedback("*",ie)).join("");for(const ie of k)x+=this.printRtpMap(ie.payloadType,ie.rtpMap),x+=this.printFmtp(ie.payloadType,ie.fmtp),x+=ie.rtcpFeedbacks.map(xe=>this.printRTCPFeedback(ie.payloadType,xe)).join("");return x}printFmtp(C,k){if(!k)return"";const x=Object.keys(k.parameters);return x.length===1&&k.parameters[x[0]]===null?"a=fmtp:".concat(C).concat(f).concat(x[0]).concat(this.eol):"a=fmtp:".concat(C).concat(f).concat(Object.keys(k.parameters).map(ie=>"".concat(ie,"=").concat(k.parameters[ie])).join(";")).concat(this.eol)}printRtpMap(C,k){return k?"a=rtpmap:".concat(C).concat(f).concat(k.encodingName,"/").concat(k.clockRate).concat(k.encodingParameters?"/".concat(k.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(C,k){let x="a=rtcp-fb:".concat(C).concat(f),ie=k;return ie.type==="trr-int"?x+="ttr-int".concat(f).concat(ie.interval):(x+="".concat(ie.type),ie.parameter&&(x+="".concat(f).concat(ie.parameter),ie.additional&&(x+="".concat(f).concat(ie.additional)))),x+this.eol}printPtime(C){return C===void 0?"":"a=ptime:".concat(C).concat(this.eol)}printMaxPtime(C){return C===void 0?"":"a=maxptime:".concat(C).concat(this.eol)}printDirection(C){return C===void 0?"":"a=".concat(C).concat(this.eol)}printSSRC(C){return C.map(k=>Object.keys(k.attributes).map(x=>"a=ssrc:".concat(k.ssrcId.toString(10)).concat(f).concat(x).concat(k.attributes[x]?":".concat(k.attributes[x]):"").concat(this.eol)).join("")).join("")}printRTCPMux(C){return C===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(C){return C===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(C){return C===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(C){if(C===void 0)return"";let k="a=rtcp:".concat(C.port);return C.netType&&(k+="".concat(f).concat(C.netType)),C.addressType&&(k+="".concat(f).concat(C.addressType)),C.address&&(k+="".concat(f).concat(C.address)),k+this.eol}printMSId(C){return C.map(k=>"a=msid:".concat(k.id).concat(k.appdata?"".concat(f).concat(k.appdata):"").concat(this.eol)).join("")}printImageattr(C){return C.map(k=>"a=imageattr:".concat(k).concat(this.eol)).join("")}printRid(C){return C.map(k=>{let x="a=rid:".concat(k.id).concat(f).concat(k.direction);return k.payloads&&(x+="".concat(f,"pt=").concat(k.payloads.join(","))),k.params.length>0&&(x+="".concat(f).concat(k.params.map(ie=>ie.type==="depend"?"depend=".concat(ie.rids.join(",")):"".concat(ie.type,"=").concat(ie.val)).join(";"))),x+this.eol}).join("")}printSimulcast(C){return C===void 0?"":"a=simulcast:".concat(C).concat(this.eol)}printSCTPPort(C){return C===void 0?"":"a=sctp-port:".concat(C).concat(this.eol)}printMaxMessageSize(C){return C===void 0?"":"a=max-message-size:".concat(C).concat(this.eol)}printMid(C){return C===void 0?"":"a=mid:".concat(C).concat(this.eol)}printSSRCGroups(C){return C.map(k=>"a=ssrc-group:".concat(k.semantic).concat(k.ssrcIds.map(x=>"".concat(f).concat(x.toString(10))).join("")).concat(this.eol)).join("")}}function ke(de){return new Ue().parse(de)}function tt(de,C){return new Gi().print(de,C)}}},i={};function s(a){if(i[a])return i[a].exports;var c=i[a]={exports:{}};return t[a](c,c.exports,s),c.exports}return s.d=(a,c)=>{for(var l in c)s.o(c,l)&&!s.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:c[l]})},s.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(8)})()})(mk);var Ot=mk.exports;function ns(n){if(Array.isArray(n))return n.map(t=>t);if(!_k(n))return n;const e={};for(const t in n){const i=n[t];_k(i)||Array.isArray(i)?e[t]=ns(i):e[t]=i}return e}function _k(n){return!(typeof n!="object"||Array.isArray(n)||!n)}class Mv{constructor(e){S(this,"input",[]),S(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const eo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},oh={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:eo,remoteCandidate:eo}},Ek={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},gk={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Sk={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},Tk={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function vk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function yk(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):vk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class Uv{constructor(e,t){S(this,"onFirstVideoReceived",void 0),S(this,"onFirstVideoDecoded",void 0),S(this,"onFirstAudioReceived",void 0),S(this,"onFirstVideoDecodedTimeout",void 0),S(this,"onFirstAudioDecoded",void 0),S(this,"onSelectedLocalCandidateChanged",void 0),S(this,"onSelectedRemoteCandidateChanged",void 0),S(this,"videoIsReady",!1),S(this,"videoIsReady2",{}),S(this,"pc",void 0),S(this,"options",void 0),S(this,"intervalTimer",void 0),S(this,"stats",ns(oh)),S(this,"isFirstVideoReceived",{}),S(this,"isFirstVideoDecoded",{}),S(this,"isFirstAudioReceived",{}),S(this,"isFirstAudioDecoded",{}),S(this,"isFirstVideoDecodedTimeout",{}),S(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new W(e=>{e({local:yk({},eo),remote:yk({},eo)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,a=0,c=0,l=0;for(const h of i)e[h].forEach((p,f)=>{if(!this.lossRateWindowStats[t-1][h][f]||!this.lossRateWindowStats[0][h][f])return;const _=this.lossRateWindowStats[t-1][h][f].packets-this.lossRateWindowStats[0][h][f].packets,g=this.lossRateWindowStats[t-1][h][f].packetsLost-this.lossRateWindowStats[0][h][f].packetsLost;h==="videoSend"||h==="audioSend"?(s+=_,c+=g):(a+=_,l+=g),Number.isNaN(_)||Number.isNaN(_)?p.packetLostRate=0:p.packetLostRate=_<=0||g<=0?0:g/(_+g)});e.sendPacketLossRate=s<=0||c<=0?0:c/(s+c),e.recvPacketLossRate=a<=0||l<=0?0:l/(a+l)}}function Rk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function pY(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Rk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Rk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class fY extends Uv{constructor(){super(...arguments),S(this,"_stats",oh),S(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=ns(oh);const i=t.filter(a=>a.type==="ssrc");this.processSSRCStats(i);const s=t.find(a=>a.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var i;const s=fe(i=t.id).call(i,"send");switch("".concat(t.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const a=ns(gk);a.codec=t.googCodecName,a.adaptionChangeReason="none",t.googCpuLimitedResolution&&(a.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(a.adaptionChangeReason="bandwidth"),a.avgEncodeMs=Number(t.googAvgEncodeMs),a.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.firsCount=Number(t.googFirReceived),a.nacksCount=Number(t.googNacksReceived),a.plisCount=Number(t.googPlisReceived),a.frameCount=Number(t.framesEncoded),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(a),this._stats.rtt=a.rttMs;break}case"video_recv":{const a=ns(Ek),c=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(a.codec=t.googCodecName,a.targetDelayMs=Number(t.googTargetDelayMs),a.renderDelayMs=Number(t.googRenderDelayMs),a.currentDelayMs=Number(t.googCurrentDelayMs),a.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),a.decodeMs=Number(t.googDecodeMs),a.maxDecodeMs=Number(t.googMaxDecodeMs),a.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},a.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},a.decodeFrameRate=Number(t.googFrameRateDecoded),a.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},a.jitterBufferMs=Number(t.googJitterBufferMs),a.firsCount=Number(t.googFirsSent),a.nacksCount=Number(t.googNacksSent),a.plisCount=Number(t.googPlisSent),a.framesDecodeCount=Number(t.framesDecoded),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.packets>0&&!this.isFirstVideoReceived[a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(a.ssrc),this.isFirstVideoReceived[a.ssrc]=!0),a.framesDecodeCount>0&&!this.isFirstVideoDecoded[a.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(a.ssrc,a.decodedFrame.width,a.decodedFrame.height),this.isFirstVideoDecoded[a.ssrc]=!0),c){const l=c.stats,h=Date.now()-c.lts;a.framesDecodeFreezeTime=l.framesDecodeFreezeTime,a.framesDecodeInterval=l.framesDecodeInterval,a.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[a.ssrc]?(c.lts=Date.now(),a.framesDecodeInterval=h,a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):a.framesDecodeCount<c.stats.framesDecodeCount&&(a.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:pY({},a),lts:Date.now()}),this._stats.videoRecv.push(a);break}case"audio_recv":{const a=ns(Tk);a.codec=t.googCodecName,a.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,a.decodingCNG=Number(t.googDecodingCNG),a.decodingCTN=Number(t.googDecodingCTN),a.decodingCTSG=Number(t.googDecodingCTSG),a.decodingNormal=Number(t.googDecodingNormal),a.decodingPLC=Number(t.googDecodingPLC),a.decodingPLCCNG=Number(t.googDecodingPLCCNG),a.expandRate=Number(t.googExpandRate),a.accelerateRate=Number(t.googAccelerateRate),a.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),a.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),a.speechExpandRate=Number(t.googSpeechExpandRate),a.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),a.jitterBufferMs=Number(t.googJitterBufferMs),a.jitterMs=Number(t.googJitterReceived),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),a.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),a.receivedFrames>0&&!this.isFirstAudioReceived[a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(a.ssrc),this.isFirstAudioReceived[a.ssrc]=!0),a.decodingNormal>0&&!this.isFirstAudioDecoded[a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(a.ssrc),this.isFirstAudioDecoded[a.ssrc]=!0),this._stats.audioRecv.push(a);break}case"audio_send":{const a=ns(Sk);a.codec=t.googCodecName,a.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,a.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),a.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),a.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),a.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.rtt=a.rttMs,this._stats.audioSend.push(a);break}}})}_getStats(){return new W((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(i=>{const s={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(a=>{s[a]=i.stat(a)}),t.push(s)}),t}}function Ck(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Vc(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ck(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ck(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class Ik extends Uv{constructor(){super(...arguments),S(this,"_stats",oh),S(this,"report",void 0),S(this,"lastDecodeVideoReceiverStats",new Map),S(this,"lastVideoFramesRecv",new Map),S(this,"lastVideoFramesSent",new Map),S(this,"lastVideoFramesDecode",new Map),S(this,"lastVideoJBDelay",new Map),S(this,"lastAudioJBDelay",new Map),S(this,"mediaBytesSent",new Map),S(this,"mediaBytesRetransmit",new Map),S(this,"mediaBytesTargetEncode",new Map),S(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ns(oh),this.report.forEach(e=>{switch(e.type){case yi.OUTBOUND:case yi.INBOUND:{const t=e.mediaType||e.kind,i=!t&&"frameWidth"in e,s=!t&&!("frameWidth"in e);e.type===yi.OUTBOUND?t==="audio"||s?this.processAudioOutboundStats(e):(t==="video"||i)&&this.processVideoOutboundStats(e):e.type===yi.INBOUND&&(t==="audio"||s?this.processAudioInboundStats(e):(t==="video"||i)&&this.processVideoInboundStats(e));break}case yi.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case yi.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:Vc({},eo),remote:Vc({},eo)};return e.forEach(i=>{let s;if(i.type===yi.TRANSPORT&&(s=e.get(i.selectedCandidatePairId)),i.type===yi.CANDIDATE_PAIR&&i.selected&&(s=i),s){const a=(c,l)=>{c.type=l.type,c.id=l.id,l.address&&(c.address=l.address),l.candidateType&&(c.candidateType=l.candidateType),l.port&&(c.port=l.port),l.priority&&(c.priority=l.priority),l.protocol&&(c.protocol=l.protocol),l.relayProtocol&&(c.relayProtocol=l.relayProtocol)};if(s.localCandidateId){const c=e.get(s.localCandidateId);c&&a(t.local,c)}if(s.remoteCandidateId){const c=e.get(s.remoteCandidateId);c&&a(t.remote,c)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===yi.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===yi.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===yi.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Vc({},t),Vc({},this.stats.selectedCandidatePair.localCandidate)),e.type===yi.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Vc({},t),Vc({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(i=>i.ssrc===e.ssrc);t||(t=ns(Tk),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let t=this._stats.videoRecv.find(c=>c.ssrc===e.ssrc);t||(t=ns(Ek),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay;const i=this.lastDecodeVideoReceiverStats.get(t.ssrc),s=this.lastVideoFramesDecode.get(t.ssrc),a=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const c=t.decodedFrame?t.decodedFrame.width:0,l=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,c,l),this.isFirstVideoDecoded[t.ssrc]=!0}if(i){const c=i.stats,l=a-i.lts;t.framesDecodeFreezeTime=c.framesDecodeFreezeTime,t.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(i.lts=Date.now(),t.framesDecodeInterval=l,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<c.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}s&&a-s.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-s.count)/((a-s.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:a,rate:t.decodeFrameRate})):s?t.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:a,rate:0}),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Vc({},t),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(s=>s.ssrc===e.ssrc);t||(t=ns(gk),this._stats.videoSend.push(t));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const s=new Mv(10);s.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,s)}if(e.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(e.ssrc);if(s)s.add(e.retransmittedBytesSent);else{const a=new Mv(10);a.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,a)}}if(e.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(e.ssrc);if(s)s.add(e.totalEncodedBytesTarget);else{const a=new Mv(10);a.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,a)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){const s=this.lastEncoderMs.get(e.ssrc);if(!s||s.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const a=e.framesEncoded-s.lastFrameCount,c=e.totalEncodeTime-s.lastEncoderTime;t.avgEncodeMs=1e3*c/a}}if(e.framesEncoded&&e.qpSum){const s=this.lastEncoderMs.get(e.ssrc);!s||s.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-s.lastQpSum)/(e.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const s=this.findRemoteStatsId(e.ssrc,yi.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(t||(t=ns(Sk),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const i=this.findRemoteStatsId(e.ssrc,yi.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}findRemoteStatsId(e,t){var i;const s=Array.from(Es(i=this.report).call(i)).find(a=>a.type===t&&a.ssrc===e);return s?s.id:null}processVideoMediaSource(e,t){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(t.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,t){const i=this.report.get(e);i&&(t.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,t,i){var s,a,c,l;const h=t?this.report.get(t):void 0,p=(s=h==null?void 0:h.framesSent)!==null&&s!==void 0?s:e.framesSent;if(typeof p!="number")return;let f=(a=h==null?void 0:h.frameWidth)!==null&&a!==void 0?a:e.frameWidth,_=(c=h==null?void 0:h.frameHeight)!==null&&c!==void 0?c:e.frameHeight,g=(l=h==null?void 0:h.framesPerSecond)!==null&&l!==void 0?l:e.framesPerSecond;if(typeof f=="number"&&typeof _=="number"||(f=0,_=0),g==null){const T=Date.now(),w=this.lastVideoFramesSent.get(i.ssrc);w&&T-w.lts>=800?(g=Math.round((p-w.count)/((T-w.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:p,lts:T,rate:g})):w?g=w.rate:this.lastVideoFramesSent.set(i.ssrc,{count:p,lts:T,rate:0})}i.sentFrame={width:f,height:_,frameRate:Math.max(0,g)}}processVideoTrackReceiverStats(e,t,i){var s,a,c,l,h;const p=t?this.report.get(t):void 0,f=(s=p==null?void 0:p.framesReceived)!==null&&s!==void 0?s:e.framesReceived,_=(a=p==null?void 0:p.frameWidth)!==null&&a!==void 0?a:e.frameWidth,g=(c=p==null?void 0:p.frameHeight)!==null&&c!==void 0?c:e.frameHeight,T=(l=p==null?void 0:p.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,w=(h=p==null?void 0:p.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount;if(typeof f=="number"){const R=this.lastVideoFramesRecv.get(i.ssrc),I=Date.now();i.framesReceivedCount=f;let N=0;R&&I-R.lts>=800?(N=Math.round((f-R.count)/((I-R.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:f,lts:I,rate:N})):R?N=R.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:f,lts:I,rate:0}),i.receivedFrame={width:_||0,height:g||0,frameRate:N||0},i.decodedFrame={width:_||0,height:g||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:_||0,height:g||0,frameRate:i.decodeFrameRate||0}}if(T&&w){const R=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let I=R.jitterBufferMs;const N=w-R.jitterBufferEmittedCount;N>0&&(I=1e3*(T-R.jitterBufferDelay)/N),i.jitterBufferMs=I,i.currentDelayMs=Math.round(I),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:T,jitterBufferEmittedCount:w,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,t,i){var s,a,c,l;const h=t?this.report.get(t):void 0,p=(s=(a=h==null?void 0:h.echoReturnLoss)!==null&&a!==void 0?a:e.echoReturnLoss)!==null&&s!==void 0?s:0,f=(c=(l=h==null?void 0:h.echoReturnLossEnhancement)!==null&&l!==void 0?l:e.echoReturnLossEnhancement)!==null&&c!==void 0?c:0;i.aecReturnLoss=p,i.aecReturnLossEnhancement=f}processAudioTrackReceiverStats(e,t,i){var s,a,c,l,h,p,f;const _=t?this.report.get(t):void 0,g=(s=_==null?void 0:_.removedSamplesForAcceleration)!==null&&s!==void 0?s:e.removedSamplesForAcceleration,T=(a=_==null?void 0:_.totalSamplesReceived)!==null&&a!==void 0?a:e.totalSamplesReceived,w=(c=_==null?void 0:_.jitterBufferDelay)!==null&&c!==void 0?c:e.jitterBufferDelay,R=(l=_==null?void 0:_.jitterBufferEmittedCount)!==null&&l!==void 0?l:e.jitterBufferEmittedCount,I=(h=_==null?void 0:_.audioLevel)!==null&&h!==void 0?h:e==null?void 0:e.audioLevel,N=(p=_==null?void 0:_.totalSamplesDuration)!==null&&p!==void 0?p:e==null?void 0:e.totalSamplesDuration,D=(f=_==null?void 0:_.concealedSamples)!==null&&f!==void 0?f:e.concealedSamples;if(g&&T&&(i.accelerateRate=g/T),w&&R){const G=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let F=G.jitterBufferMs;const j=R-G.jitterBufferEmittedCount;j>0&&(F=1e3*(w-G.jitterBufferDelay)/j),i.jitterBufferMs=Math.round(F),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:w,jitterBufferEmittedCount:R,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=I;let V=1920;N&&T&&(V=T/N/50,i.receivedFrames=Math.round(T/V)),D&&(i.droppedFrames=Math.round(D/V))}processRemoteInboundStats(e,t){const i=this.report.get(e);i&&(t.packetsLost=i.packetsLost,i.roundTripTime&&(t.rttMs=1e3*i.roundTripTime),i.jitter&&(t.jitterMs=1e3*i.jitter),i.timestamp&&(t.timestamp=i.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const i=t.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,t=null,i=null;this.mediaBytesSent.forEach(a=>{e+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{t=t===null?a.diffMean():t+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{i=i===null?a.diffMean():i+a.diffMean()});const s=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}}class mY extends Uv{updateStats(){return W.resolve()}}function Cm(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const a=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return a?a<76?new fY(n,{updateInterval:e,lossRateInterval:t,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new Ik(n,{updateInterval:e,lossRateInterval:t,freezeRateLimit:i,firstVideoDecodedTimeout:s}):function(c){return!!window.RTCStatsReport&&c.getStats()instanceof W}(n)?new Ik(n,{updateInterval:e,lossRateInterval:t,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new mY(n,{updateInterval:e,lossRateInterval:t,freezeRateLimit:i,firstVideoDecodedTimeout:s})}function wk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Ak(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):wk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function ah(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:s,filterVideoFec:a,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:h}=e,{useXR:p}=t;let f=[],_=[],g=[],T=[],w=!1,R=!1;if(Ot.parse(n).mediaDescriptions.forEach(N=>{i&&i!==N.attributes.direction||(N.media.mediaType!=="video"||w||(_=N.attributes.payloads,T=N.attributes.extmaps,w=!0),N.media.mediaType!=="audio"||R||(f=N.attributes.payloads,g=N.attributes.extmaps,R=!0))}),!T||_.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!g||f.length===0)throw new Error("Cannot get audio capabilities from SDP.");_.forEach(N=>{var D;(D=N.rtpMap)!==null&&D!==void 0&&D.clockRate&&(N.rtpMap.clockRate=parseInt(N.rtpMap.clockRate)),p&&N.rtcpFeedbacks.push({type:"rrtr"})}),f.forEach(N=>{var D;(D=N.rtpMap)!==null&&D!==void 0&&D.clockRate&&(N.rtpMap.clockRate=parseInt(N.rtpMap.clockRate)),p&&N.rtcpFeedbacks.push({type:"rrtr"})}),s&&(f=f.filter(N=>{var D;return((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())!=="rtx"}),_=_.filter(N=>{var D;return((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())!=="rtx"})),a&&(_=_.filter(N=>{var D;return!/(red)|(ulpfec)|(flexfec)/i.test(((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName)||"")})),c&&(f=f.filter(N=>{var D;return!/(red)|(ulpfec)|(flexfec)/i.test(((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(f=f.filter(N=>{var D;return fe(l).call(l,((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())||"")})),h&&(h==null?void 0:h.length)>0&&(_=_.filter(N=>{var D;return fe(h).call(h,((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())||"")}));const I=L("UNSUPPORTED_VIDEO_CODEC");return I&&I.length>0&&(_=_.filter(N=>!(N.rtpMap&&fe(I).call(I,N.rtpMap.encodingName.toLowerCase())))),{audioCodecs:f,videoCodecs:_,audioExtensions:g,videoExtensions:T}}function ys(n){const e=Ot.parse(n);let t,i;for(const s of e.mediaDescriptions){if(!t){const a=s.attributes.iceUfrag,c=s.attributes.icePwd;if(!a||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");t={iceUfrag:a,icePwd:c}}if(!i){const a=s.attributes.fingerprints;a.length>0&&(i={fingerprints:a})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!t)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:t,dtlsParameters:i}}function xv(n,e){const t=[],i=n.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),s=n.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),a=n.attributes.ssrcs;if(s)s.ssrcIds.forEach(c=>{var l;const h=(l=i.find(p=>p.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];t.push({ssrcId:c,rtx:e?h:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],l=i[0].ssrcIds[1];t.push({ssrcId:c,rtx:e?l:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");t.push({ssrcId:a[0].ssrcId})}return t}function Ok(n,e){const{cname:t}=n;let i;e&&e.ip&&typeof e.port=="number"?(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))):i=n.iceParameters.candidates.map(l=>({foundation:l.foundation,componentId:"1",transport:l.protocol,priority:l.priority.toString(),connectionAddress:l.ip,port:l.port.toString(),type:l.type,extension:{}}));const s={fingerprints:n.dtlsParameters.fingerprints.map(l=>({hashFunction:l.algorithm,fingerprint:l.fingerprint}))},a={iceUfrag:n.iceParameters.iceUfrag,icePwd:n.iceParameters.icePwd};let c;switch(n.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}return{dtlsParameters:s,iceParameters:a,candidates:i,rtpCapabilities:al(n.rtpCapabilities),setup:c,cname:t}}function Ii(n,e,t){const i=[],s=[];return n.forEach(a=>{let{ssrcId:c,rtx:l}=a;const h=Et(8,"track-"),p={ssrcId:c,attributes:Ak({label:h,mslabel:t=t||Et(10,""),msid:"".concat(t," ").concat(h)},e&&{cname:e})};if(i.push(p),l!==void 0){const f={ssrcId:l,attributes:Ak({label:h,mslabel:t,msid:"".concat(t," ").concat(h)},e&&{cname:e})};i.push(f),s.push({semantic:"FID",ssrcIds:[c,l]})}}),n.length>1&&s.push({semantic:"SIM",ssrcIds:n.map(a=>{let{ssrcId:c}=a;return c})}),{ssrcs:i,ssrcGroups:s}}function Aa(n,e){e instanceof lt&&n.attributes.payloads.forEach(t=>{var i;const s=(i=t.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!s||["opus","pcmu","pcma","g722"].indexOf(s)===-1)return;t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.minptime="10",t.fmtp.parameters.useinbandfec="1";const a=e._encoderConfig;a&&s!=="pcmu"&&s!=="pcma"&&s!=="g722"&&(a.bitrate&&!mt()&&(t.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(t.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),t.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"))})}function Im(n){const e=n.attributes.unrecognized.findIndex(t=>t.attField==="x-google-flag"&&t.attValue==="conference");e!==-1&&n.attributes.unrecognized.splice(e,1)}function wm(n,e){var t;if(!(e instanceof Ge&&e._encoderConfig&&e._hints.indexOf(Tt.SCREEN_TRACK)===-1))return;const i=e._encoderConfig;et().supportMinBitrate&&i.bitrateMin&&n.attributes.payloads.forEach(s=>{var a,c;fe(a=["h264","h265","vp8","vp9","av1"]).call(a,((c=s.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),et().supportMinBitrate&&!fe(t=e._hints).call(t,Tt.LOW_STREAM)&&i.bitrateMax&&n.attributes.payloads.forEach(s=>{var a,c;fe(a=["h264","h265","vp8","vp9","av1"]).call(a,((c=s.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-start-bitrate"]="".concat(L("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function Vv(n){if(n.media.mediaType!=="video")return;const e=Ze();if(e.name!==rt.SAFARI&&e.os!==on.IOS)return;const t=n.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));t!==-1&&n.attributes.extmaps.splice(t,1)}function ol(n,e,t){if(!e)return;let i,s;if(n.media.mediaType==="video"?(i=t.videoExtensions,s=t.videoCodecs):(i=t.audioExtensions,s=t.audioCodecs),e.twcc===!0){const a=i.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a&&(n.attributes.extmaps.find(l=>l.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||n.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(l,h){return h.filter(p=>!!l.find(f=>f.payloadType===p.payloadType&&!!f.rtcpFeedbacks.find(_=>_.type==="transport-cc")))}(s,n.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(h=>h.type==="transport-cc")||l.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(e.twcc===!1){const a=n.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a!==-1&&n.attributes.extmaps.splice(a,1),n.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(e.remb===!0){const a=i.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a&&(n.attributes.extmaps.find(l=>l.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||n.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(l,h){return h.filter(p=>!!l.find(f=>f.payloadType===p.payloadType&&!!f.rtcpFeedbacks.find(_=>_.type==="goog-remb")))}(s,n.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(h=>h.type==="goog-remb")||l.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(e.remb===!1){const a=n.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a!==-1&&n.attributes.extmaps.splice(a,1),n.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(h=>h.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function Fv(n,e,t){if(mt()||n.media.mediaType!=="video"||!(e instanceof Ge)||t!=="vp9"&&t!=="vp8"||t==="vp8"&&!L("SIMULCAST")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const i=t==="vp8"?2:e._scalabilityMode.numSpatialLayers,s=n.attributes.ssrcs[0],a=n.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===s.ssrcId),c={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let l=1;l<i;l++)n.attributes.ssrcs.push({ssrcId:s.ssrcId+l,attributes:St(s.attributes)}),c.ssrcIds.push(s.ssrcId+l),a&&(n.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+l,attributes:St(s.attributes)}),n.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+l,a.ssrcIds[1]+l]}));n.attributes.ssrcGroups.unshift(c)}async function Bv(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new RTCPeerConnection;t.addTransceiver("video",{direction:"sendonly"}),t.addTransceiver("audio",{direction:"sendonly"}),t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const i=(await t.createOffer()).sdp,{send:s,recv:a,sendrecv:c}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const f=ah(p,l,h,"sendonly"),_=ah(p,l,h,"recvonly"),g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(is(f,_,"videoExtensions",g,T,w),is(f,_,"videoCodecs",g,T,w),is(f,_,"audioExtensions",g,T,w),is(f,_,"audioCodecs",g,T,w),L("RAISE_H264_BASELINE_PRIORITY")){const R=w.videoCodecs.findIndex(I=>{var N,D;return((N=I.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"&&((D=I.fmtp)===null||D===void 0?void 0:D.parameters["profile-level-id"])==="42001f"});if(R!==-1){const I=w.videoCodecs.findIndex(N=>{var D;return((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"});if(I<R){v.debug("raising H264 baseline profile priority");const N=w.videoCodecs[R];w.videoCodecs.splice(R,1),w.videoCodecs.splice(I,0,N)}I!==-1&&(T.videoCodecs=T.videoCodecs.filter(N=>{var D,V;return!(((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"&&((V=N.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!=="42001f")})),I!==-1&&L("FILTER_SEND_H264_BASELINE")&&(g.videoCodecs=g.videoCodecs.filter(N=>{var D,V;return!(((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"&&((V=N.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!=="42001f")}))}}return{send:g,recv:T,sendrecv:w}}(n,e,i);try{t.close()}catch{}return{send:s,recv:a,sendrecv:c}}function bk(){const n={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=ah(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(is(n,e,"videoExtensions",t,i,s),is(n,e,"videoCodecs",t,i,s),is(n,e,"audioExtensions",t,i,s),is(n,e,"audioCodecs",t,i,s),L("RAISE_H264_BASELINE_PRIORITY")){const a=s.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(a!==-1){const c=s.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<a){v.debug("raising H264 baseline profile priority");const l=s.videoCodecs[a];s.videoCodecs.splice(a,1),s.videoCodecs.splice(c,0,l)}c!==-1&&(i.videoCodecs=i.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:t,recv:i,sendrecv:s}}function is(n,e,t,i,s,a){if(t==="videoExtensions"||t==="audioExtensions"){const c=[];return n[t].forEach(l=>{e[t].some((h,p)=>{if(l.entry===h.entry&&l.extensionName===h.extensionName)return c.push(p),!0})?a[t].push(l):i[t].push(l)}),void e[t].forEach((l,h)=>{c.indexOf(h)===-1&&s[t].push(l)})}if(t==="videoCodecs"||t==="audioCodecs"){const c=[];return n[t].forEach(l=>{e[t].some((h,p)=>{if(l.payloadType===h.payloadType&&JSON.stringify(l)===JSON.stringify(h))return c.push(p),!0})?a[t].push(l):i[t].push(l)}),void e[t].forEach((l,h)=>{c.indexOf(h)===-1&&s[t].push(l)})}}function al(n){const{send:e,recv:t,sendrecv:i}=n;if(!i){if(!e||!t)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:t}}let s,a;return e?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...e.audioCodecs,...i.audioCodecs],s.videoCodecs=[...e.videoCodecs,...i.videoCodecs],s.audioExtensions=[...e.audioExtensions,...i.audioExtensions],s.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):s=i,t?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...t.audioCodecs,...i.audioCodecs],a.videoCodecs=[...t.videoCodecs,...i.videoCodecs],a.audioExtensions=[...t.audioExtensions,...i.audioExtensions],a.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):a=i,{send:s,recv:a}}function Rs(n){n.media.mediaType==="audio"&&n.attributes.payloads.filter(e=>{var t;return((t=e.rtpMap)===null||t===void 0?void 0:t.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function ch(n){n.mediaDescriptions.forEach(e=>{e.media.mediaType!=="video"&&e.media.mediaType!=="audio"||e.attributes.payloads.forEach(t=>{t.rtcpFeedbacks.findIndex(i=>i.type==="rrtr")===-1&&t.rtcpFeedbacks.push({type:"rrtr"})})})}function Fc(n,e,t,i){let s=[];if(n===Ee.VIDEO){if(L("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(s=e.videoCodecs.filter(a=>{var c;return fe(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,i)&&a&&a.fmtp&&a.fmtp.parameters["profile-level-id"]===L("H264_PROFILE_LEVEL_ID")})),!Array.isArray(s)||s.length===0){let a=[];const c=[],l=[];t.videoCodecs.forEach(h=>{var p,f,_;fe(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,i)&&a.push(h),fe(f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(f,"vp8")&&c.push(h),fe(_=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(_,"h264")&&l.push(h)}),a.length===0&&(c.length!==0?(a=c,v.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: vp8"))):l.length!==0&&(a=l,v.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: h264")))),a.length!==0&&(s=e.videoCodecs.filter(h=>a.some(p=>p.payloadType===h.payloadType)))}if(L("USE_PUB_RTX")){const a=s.map(l=>l.payloadType.toString()),c=e.videoCodecs.filter(l=>l.rtpMap&&l.rtpMap.encodingName==="rtx"&&fe(a).call(a,l.fmtp&&l.fmtp.parameters.apt||""));s=[...s,...c]}s.length===0&&(v.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),s=e.videoCodecs)}else s=e.audioCodecs.filter(a=>{var c;return fe(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,i)}),s.length===0&&(v.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),s=e.audioCodecs.filter(a=>{var c;return fe(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}));return s}let Nk=class{get localCapabilities(){return St(this._localCapabilities)}get rtpCapabilities(){return St(this._rtpCapabilities)}get candidates(){return St(this._candidates)}get iceParameters(){return St(this._iceParameters)}get dtlsParameters(){return St(this._dtlsParameters)}constructor(n){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname","o/i14u9pJrxRKAsu"),S(this,"firefoxSsrcMidMap",new Map),n=St(n);const{remoteIceParameters:e,remoteDtlsParameters:t,candidates:i,remoteRTPCapabilities:s,localCapabilities:a,direction:c,setup:l,videoCodec:h,audioCodec:p}=n;let f;this.setup=l,f=c===qn.RECEIVE_ONLY?Ot.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ot.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=s,this._candidates=i,this._iceParameters=e,this._dtlsParameters=t,this._localCapabilities=a;const _=c===qn.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,g=c===qn.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,T=c===qn.RECEIVE_ONLY?s.send.videoCodecs:Fc(Ee.VIDEO,_,g,h),w=c===qn.RECEIVE_ONLY?s.send.audioCodecs:Fc(Ee.AUDIO,_,g,p);for(const R of f.mediaDescriptions){if(R.attributes.iceUfrag=e.iceUfrag,R.attributes.icePwd=e.icePwd,R.attributes.fingerprints=t.fingerprints,R.attributes.candidates=i,R.attributes.setup=this.setup,R.media.mediaType==="application"&&(R.attributes.sctpPort="5000"),R.media.mediaType==="video"&&(R.media.fmts=T.map(I=>I.payloadType.toString(10)),R.attributes.payloads=T,R.attributes.extmaps=_.videoExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:I,ssrcGroups:N}=Ii([{ssrcId:4e4,rtx:L("USE_SUB_RTX")?40001:void 0}],this.cname);R.attributes.ssrcs=I,R.attributes.ssrcGroups=N}if(R.media.mediaType==="audio"&&(R.media.fmts=w.map(I=>I.payloadType.toString(10)),R.attributes.payloads=w,R.attributes.extmaps=_.audioExtensions,Rs(R),L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:I,ssrcGroups:N}=Ii([{ssrcId:2e4}],this.cname);R.attributes.ssrcs=I,R.attributes.ssrcGroups=N}}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}toString(){return Ot.print(this.sessionDesc)}hasMid(n){return Array.isArray(n)?n.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===n)}send(n,e,t,i,s){t=t.replace(/ /g,"-");const{ssrcs:a,ssrcGroups:c}=Ii(e,this.cname,L("SYNC_GROUP")?t:void 0),l=this.findPreloadMediaDesc(a);if(l){if(mt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,l.attributes.mid),s&&(s.twcc||s.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(l,s),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(n,a,i);let p;return h===-1?(p=this.createOrRecycleSendMedia(n,a,c,"sendonly",i,s),this.updateBundleMids()):(p=St(this.sessionDesc.mediaDescriptions[h]),p.attributes.direction="sendonly",p.attributes.ssrcs=a,p.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(p,s)),mt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,p.attributes.mid),{needExchangeSDP:!0,mid:p.attributes.mid}}}stopSending(n){const e=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&n.indexOf(t.attributes.mid)!==-1);if(e.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(t=>{t.attributes.ssrcs=[]}),this.updateBundleMids()}receive(n,e,t){const i=[];return n.forEach(s=>{const a=s._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(a);let l,h=!1;c===-1?(h=!0,l=this.createOrRecycleRecvMedia(s,[],"recvonly",e,t),this.updateBundleMids()):(l=St(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),i.push({mid:l.attributes.mid,needCreateTransceiver:h})}),i}stopReceiving(n){const e=this.sessionDesc.mediaDescriptions.filter(t=>n.indexOf(t.attributes.mid)!==-1);if(e.length!==n.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(t=>{t.media.port="0",t.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(n){const{foundation:e,protocol:t,address:i,port:s,type:a,relatedAddress:c,relatedPort:l,priority:h}=new RTCIceCandidate(n),p={foundation:e??"",componentId:"1",transport:t??"",priority:h?h+"":"",connectionAddress:i??"",port:s?s+"":"",type:a?a+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(f=>f.priority===p.priority&&f.connectionAddress===p.connectionAddress&&f.port===p.port)||(this._candidates.push(p),this.sessionDesc.mediaDescriptions.forEach(f=>{f.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(n,e,t,i,s){const a=n._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=Fc(a,c,this.localCapabilities.send,a===Ee.AUDIO?s:i),h=a===Ee.VIDEO?c.videoExtensions:c.audioExtensions,p="".concat(++this.currentMidIndex);let f={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:t,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};f=this.mungRecvMediaDsec(f,n);const _=this.findFirstClosedMedia(a);if(_){const g=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[g]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}muteRemote(n){const e=this.sessionDesc.mediaDescriptions.filter(t=>fe(n).call(n,t.attributes.mid||""));if(e.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(t=>{t.attributes.direction="inactive"})}unmuteRemote(n){const e=this.sessionDesc.mediaDescriptions.filter(t=>fe(n).call(n,t.attributes.mid||""));if(e.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(t=>{t.attributes.direction="recvonly"})}findAvailableMediaIndex(n,e,t){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===n&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(mt()){if(s){const a=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return s&&i.attributes.mid===t})}findAvailableRecvMediaIndex(n){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const t=e.media.mediaType===n&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&t})}predictReceivingMids(n){const e=[];for(let t=0;t<n;t++)e.push((this.currentMidIndex+t+1).toString(10));return e}restartICE(n){n=St(n),this._iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=n.iceUfrag,e.attributes.icePwd=n.icePwd})}createOrRecycleSendMedia(n,e,t,i,s,a){const c=this.rtpCapabilities.send,l=n===Ee.VIDEO?c.videoCodecs:c.audioCodecs,h=n===Ee.VIDEO?c.videoExtensions:c.audioExtensions;mt()&&(s="".concat(++this.currentMidIndex));let p={media:{mediaType:n,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:t,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:s}};p=this.mungSendMediaDesc(p,a);const f=this.findFirstClosedMedia(n);if(f){const _=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[_]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}mungRecvMediaDsec(n,e,t){const i=St(n);return Im(i),Aa(i,e),wm(i,e),Vv(i),ol(i,t,this.localCapabilities.send),i}mungSendMediaDesc(n,e){const t=St(n);return ol(t,e,this.localCapabilities.recv),Rs(t),t}updateRecvMedia(n,e){const t=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===n);if(t!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[t],e);this.sessionDesc.mediaDescriptions[t]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(n=>n.media.port!=="0").map(n=>n.attributes.mid)}findPreloadMediaDesc(n){return this.sessionDesc.mediaDescriptions.find(e=>{var t;return((t=e.attributes)===null||t===void 0||(t=t.ssrcs[0])===null||t===void 0?void 0:t.ssrcId)===n[0].ssrcId})}findFirstClosedMedia(n){return this.sessionDesc.mediaDescriptions.find(e=>mt()?e.media.port==="0"&&e.media.mediaType===n:e.media.port==="0")}};const _Y=["sdp"];function Pk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Oa(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Pk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Pk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}let dr=class _l extends dN{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return(e=(t=this.peerConnection.getReceivers()[0])===null||t===void 0||(t=t.transport)===null||t===void 0?void 0:t.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,t,i){super(e,t),S(this,"direction",void 0),S(this,"name",void 0),S(this,"store",void 0),S(this,"spec",void 0),S(this,"peerConnection",void 0),S(this,"initialOffer",void 0),S(this,"transport",void 0),S(this,"statsFilter",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"localCandidateAddress",null),S(this,"useXR",L("USE_XR")),S(this,"filter",{filterRTX:!L("USE_PUB_RTX")&&!L("USE_SUB_RTX"),filterVideoFec:L("FILTER_VIDEO_FEC"),filterAudioFec:L("FILTER_AUDIO_FEC")}),S(this,"extension",{useXR:this.useXR}),S(this,"_isInRestartIce",!1),S(this,"mutex",new Tn("P2PConnection-mutex")),S(this,"onLocalCandidate",void 0),S(this,"remoteSDP",void 0),S(this,"pendingCandidates",[]),S(this,"localCapabilities",void 0),S(this,"isReady",!1),S(this,"restartCnt",0),S(this,"curTurnServerIndex",0),this.store=t,this.spec=e,this.peerConnection=new RTCPeerConnection(_l.resolvePCConfiguration(e,t.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??qn.SEND_ONLY,this.name=this.direction===qn.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Cm(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,mt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const t=await Bv(this.filter,this.extension);if(this.localCapabilities=al(t),e){const{sdp:i}=e,s=hY(e,_Y),a=function(){const f={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},_=ah(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(is(_,f,"videoExtensions",g,T,w),is(_,f,"videoCodecs",g,T,w),is(_,f,"audioExtensions",g,T,w),is(_,f,"audioCodecs",g,T,w),L("RAISE_H264_BASELINE_PRIORITY")){const R=w.videoCodecs.findIndex(I=>I.rtpMap&&I.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&I.fmtp&&I.fmtp.parameters["profile-level-id"]==="42001f");if(R!==-1){const I=w.videoCodecs.findIndex(N=>N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(I<R){v.debug("raising H264 baseline profile priority");const N=w.videoCodecs[R];w.videoCodecs.splice(R,1),w.videoCodecs.splice(I,0,N)}I!==-1&&L("FILTER_SEND_H264_BASELINE")&&(g.videoCodecs=g.videoCodecs.filter(N=>!(N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&N.fmtp&&N.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:g,recv:T,sendrecv:w}}(this.filter,this.extension,i);this.remoteSDP=new Nk({remoteIceParameters:s.iceParameters,remoteDtlsParameters:s.dtlsParameters,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const l=ys(c.sdp);await this.peerConnection.setLocalDescription(c);const h=await bk(this.filter,this.extension,c.sdp);this.localCapabilities=al(h);const p=this.peerConnection.getTransceivers()[0];return p!=null&&p.receiver&&p.receiver.transport&&this.tryBindTransportEvents(p.receiver.transport),Oa(Oa({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=ys(i.sdp);return this.initialOffer=i,Oa(Oa({},s),{},{sdp:i.sdp})}}catch(t){throw new Q(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:t,iceParameters:i,dtlsParameters:s}=e,a=await bk(this.filter,this.extension,t);this.remoteSDP=new Nk({remoteIceParameters:i,remoteDtlsParameters:s,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(t.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(t=>{this.peerConnection.addIceCandidate(t)}),this.pendingCandidates=[])}catch(t){throw new Q(O.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(t.toString()))}}send(e,t,i){var s=this;return Bi(function*(){const a=yield Be(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=s.remoteSDP.receive(e,t,i);e.forEach((I,N)=>{if(l[N].needCreateTransceiver){const D=s.peerConnection.addTransceiver(I._mediaStreamTrack,{direction:"sendonly"});c.push(D),I._updateRtpTransceiver(D)}else{const D=s.peerConnection.getTransceivers().find(V=>V.mid===l[N].mid);if(!D)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[N].mid));c.push(D),I._updateRtpTransceiver(D)}}),mt()&&L("SIMULCAST")===!0&&(yield Be(s.applySimulcastForFirefox(c,e)));const h=l.map(I=>I.mid),p=yield Be(s.peerConnection.createOffer()),f=s.mungSendOfferSDP(p.sdp,e,h),_=Ot.parse(f),g=h.map(I=>{const N=_.mediaDescriptions.find(D=>D.attributes.mid===I);if(!N)throw new Error("Cannot extract ssrc from mediaDescription.");return xv(N,L("USE_PUB_RTX"))}),T=c.map((I,N)=>{const D=h[N];return{localSSRC:g[N],id:D}});yield Be(s.peerConnection.setLocalDescription({type:"offer",sdp:f}));try{yield T}catch(I){const N=s.remoteSDP.toString();throw yield Be(s.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Be(s.peerConnection.setRemoteDescription({type:"answer",sdp:N})),yield Be(s.stopSending(h,!0)),I}yield Be(s.applySimulcastEncodings(c,e)),yield Be(s.applySendEncodings(c,e));const w=s.remoteSDP.toString(),R=s.logSDPExchange(f,"offer","local","send");return R==null||R(w),yield Be(s.setRemoteDescription({type:"answer",sdp:w})),c.map((I,N)=>{const D=h[N];return{localSSRC:g[N],id:D}})}catch(c){throw c instanceof Q?c:new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(e,t){const i=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(h=>e.indexOf(h.mid)!==-1);if(s.length!==e.length)throw new Error("Transceivers' length (".concat(s.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));s.map(h=>{var p;h.direction="inactive",(p=h.stop)===null||p===void 0||p.call(h)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(e,t,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(e,t,i,s);if(c){const h=this.remoteSDP.toString(),p=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});const f=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(f.sdp,a,e);p==null||p(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(a){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async mockReceive(e,t,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(e,t,i,s);if(c){const l=this.remoteSDP.toString(),h=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const p=await this.peerConnection.createAnswer(),f=this.mungReceiveAnswerSDP(p.sdp,a,e);h==null||h(f||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:f}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(a){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===yo.Auto&&(this.store.p2pTransport=yo.SdRtn,et().supportPCSetConfiguration&&this.peerConnection.setConfiguration(_l.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,et().supportPCSetConfiguration&&this.peerConnection.setConfiguration(_l.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=ys(t.sdp);return this.store.descriptionStart(),this.direction===qn.SEND_ONLY&&await this.peerConnection.setLocalDescription(t),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===qn.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const t=await this.peerConnection.createAnswer();if(!t.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=ys(t.sdp);return await this.peerConnection.setLocalDescription(t),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const a=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new Q(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,t){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===e);i.length===1&&(this.isVP8Simulcast(t)?mt()||await this.applySimulcastEncodings(i,[t]):await this.applySendEncodings(i,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const i=this.peerConnection.getTransceivers().find(s=>s.mid===t);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:i,remote:s}=t.getSelectedCandidatePair();return{local:Oa(Oa({},eo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Oa(Oa({},eo),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;fe(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var t;e.candidate.candidate&&(this.localCandidateAddress=e.candidate.address,(t=this.onLocalCandidate)===null||t===void 0||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s={iceServers:[]};var a;return e.iceServers?s.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Od(e.turnServer.servers)?s.iceServers=e.turnServer.servers:(s.iceServers&&s.iceServers.push(..._l.turnServerConfigToIceServers(e.turnServer.servers,t,i)),L("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&e.turnServer.serversFromGateway&&s.iceServers.push(..._l.turnServerConfigToIceServers(e.turnServer.serversFromGateway,t,i)),fe(a=[yo.Relay,yo.SdRtn]).call(a,t)&&(s.iceTransportPolicy="relay"),L("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(s.iceTransportPolicy="relay")}))),L("ENABLE_ENCODED_TRANSFORM")&&et().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),v.debug("P2PConnection p2pTransport is ".concat(t)),s}static turnServerConfigToIceServers(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=[],a=e.filter(l=>l.tcpport);v.debug("P2PConnection turnServers is ".concat(a,", current index is ").concat(i));const c=a.length>i?a[i]:a[0];switch(t){case yo.SdRtn:const l=e.filter(p=>{var f;return fe(f=p.username).call(f,"glb:")&&p.turnServerURL==p.turnServerURL}),h=l.length>i?l[i]:l[0];h&&(s.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(pa(h.turnServerURL),":").concat(h.tcpport,"?transport=udp")}),s.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(pa(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;case yo.Relay:c&&(s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(pa(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(pa(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),s.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return s}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const t=e.iceTransport;t&&(t.onstatechange=()=>{const i=e==null?void 0:e.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){const{local:i,remote:s}=t.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var i;if(t||(t=this.peerConnection.getSenders().find(f=>f.track===e._mediaStreamTrack)),!t)return v.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return v.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!et().supportSetRtpSenderParameters)return v.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},a={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(e._encoderConfig){var c;const{bitrateMax:f,frameRate:_,scaleResolutionDownBy:g}=e._encoderConfig;f&&(a.maxBitrate=1e3*f),fe(c=e._hints).call(c,Tt.LOW_STREAM)&&(_&&(a.maxFramerate=nr(_)),g&&g>=1&&(a.scaleResolutionDownBy=g))}if(L("DSCP_TYPE")&&ra()){var l;const f=L("DSCP_TYPE");fe(l=["very-low","low","medium","high"]).call(l,f)&&(a.networkPriority=f)}const h=t.getParameters(),p=(i=h.encodings)===null||i===void 0?void 0:i[0];mt()&&!p&&(s.encodings=[a]),p&&Object.assign(p,a),Object.assign(h,s),v.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h)}async applySendEncodings(e,t){try{if(!et().supportSetRtpSenderParameters||e.length!==t.length)return;for(let i=0;i<e.length;i++){const s=e[i],a=t[i];a instanceof Ge&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,s.sender)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,i){const s=Ot.parse(e);return t.forEach((a,c)=>{const l=i[c],h=s.mediaDescriptions.find(p=>p.attributes.mid===l);h&&(Aa(h,a),Fv(h,a,this.store.codec))}),Ot.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,e,t,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;(t=this.onFirstVideoDecodedTimeout)===null||t===void 0||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let h=0;h<e.length;h++){var i,s,a,c,l;const p=e[h],f=t[h];if(f instanceof Ge&&!fe(i=f._hints).call(i,Tt.LOW_STREAM)&&(s=f._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((a=f._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=f._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},g={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const T=p.sender.getParameters();await p.sender.setParameters(Object.assign(T,_))}}}async applySimulcastEncodings(e,t){if(!mt()&&e.length===t.length)for(let i=0;i<e.length;i++){const s=t[i];if(s instanceof Ge&&this.isVP8Simulcast(s)){const a=e[i],c={},l={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,c))}}}isVP8Simulcast(e){var t,i,s,a,c;return!!(e instanceof Ge&&L("SIMULCAST")&&this.store.codec==="vp8"&&!fe(t=e._hints).call(t,Tt.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=e._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(a=e._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,t,i,s){if(L("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(t," SDP during P2PConnection.").concat(s,`
`),e),t==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",s)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const a=this.remoteSDP.toString();s==null||s(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async c=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const a=this.remoteSDP.toString();s==null||s(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}async getRemoteSSRC(e,t){var i,s;if(t=(i=t)!==null&&i!==void 0?i:(s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp){var a;const c=(a=Ot.parse(t).mediaDescriptions.find(l=>l.attributes.mid===e))===null||a===void 0?void 0:a.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),fe(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,i){const s=Ot.parse(e),a=s.mediaDescriptions.find(c=>c.attributes.mid===t);return a&&(i===Ee.AUDIO&&a.media.mediaType==="audio"&&Rs(a),this.useXR&&ch(s)),Ot.print(s)}};function rs(n,e,t){const i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){const s=this.mutex,a=await s.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await i.apply(this,l)}finally{a()}},t}function jv(n,e){let t=document.createElement("video"),i=document.createElement("canvas");t.setAttribute("style","display:none"),i.setAttribute("style","display:none"),t.setAttribute("muted",""),t.muted=!0,t.setAttribute("autoplay",""),t.autoplay=!0,t.setAttribute("playsinline",""),i.width=nr(e.width),i.height=nr(e.height);const s=nr(e.framerate||15);document.body.append(t),document.body.append(i);let a=n._mediaStreamTrack;t.srcObject=new MediaStream([a]),t.play();const c=i.getContext("2d");if(!c)throw new B(O.UNEXPECTED_ERROR,"can not get canvas context");const l=et(),h=i.captureStream(l.supportRequestFrame?0:s).getVideoTracks()[0];h.canvas||(h.canvas=i),i.startCapture=()=>{if(!t)return i.stopCapture&&i.stopCapture();if(t.paused&&t.play(),t.videoHeight>2&&t.videoWidth>2){const f=t.videoWidth,_=t.videoHeight/f,g=i.width*_;Math.abs(g-i.height)>=2&&(v.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(g)),i.height=g)}c.drawImage(t,0,0,i.width,i.height),h.requestFrame&&h.requestFrame(),a!==n._mediaStreamTrack&&(a=n._mediaStreamTrack,t.srcObject=new MediaStream([a]))},i.stopCapture=CT(()=>i.startCapture&&i.startCapture(),s);const p=h.stop;return h.stop=()=>{p.call(h),t&&(t.remove(),t.srcObject=null,t=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),v.debug("clean low stream renderer")},h}var dh,Dk,mn,ba,Bn,cl,Gv,ko,wr,Wv,lr;$([rs,A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],dr.prototype,"establish",null),$([rs,A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],dr.prototype,"connect",null),$([rs,A("design:type",Function),A("design:paramtypes",[String,Array,String,String]),A("design:returntype",W)],dr.prototype,"receive",null),$([rs,A("design:type",Function),A("design:paramtypes",[String,Array,String,String]),A("design:returntype",W)],dr.prototype,"mockReceive",null),$([rs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],dr.prototype,"stopReceiving",null),$([rs,A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],dr.prototype,"restartICE",null),$([rs,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],dr.prototype,"close",null),$([rs,A("design:type",Function),A("design:paramtypes",[String,Vn]),A("design:returntype",W)],dr.prototype,"updateEncoderConfig",null),$([rs,A("design:type",Function),A("design:paramtypes",[String,Vn]),A("design:returntype",W)],dr.prototype,"updateSendParameters",null),$([rs,A("design:type",Function),A("design:paramtypes",[Vn,String]),A("design:returntype",W)],dr.prototype,"replaceTrack",null),$([rs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],dr.prototype,"muteLocal",null),$([rs,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],dr.prototype,"unmuteLocal",null),function(n){n[n.HEIGHT=2033]="HEIGHT",n[n.FRAME_RATE=2034]="FRAME_RATE",n[n.WIDTH=2035]="WIDTH"}(dh||(dh={})),function(n){n[n.HEIGHT=2072]="HEIGHT",n[n.FRAME_RATE=2074]="FRAME_RATE",n[n.WIDTH=2076]="WIDTH"}(Dk||(Dk={})),function(n){n[n.FRAME_RATE=2002]="FRAME_RATE",n[n.WIDTH=2003]="WIDTH",n[n.HEIGHT=2004]="HEIGHT",n[n.PACKAGE_LOST=2005]="PACKAGE_LOST",n[n.AVG_ENCODE=2007]="AVG_ENCODE",n[n.NACKS=2009]="NACKS",n[n.PLIS=2010]="PLIS",n[n.FIRS=2011]="FIRS",n[n.BITRATE=2012]="BITRATE",n[n.PACKAGE_RATE=2031]="PACKAGE_RATE",n[n.ADAPTATION=2032]="ADAPTATION",n[n.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",n[n.BANDWIDTH=2061]="BANDWIDTH",n[n.RETRANSMIT=2062]="RETRANSMIT",n[n.TARGET_ENCODED=2064]="TARGET_ENCODED",n[n.TRANSMIT=2066]="TRANSMIT",n[n.FREEZE=2082]="FREEZE",n[n.DISABLED=2095]="DISABLED",n[n.PLAYER_STATUS=2128]="PLAYER_STATUS",n[n.QP_SUM=2143]="QP_SUM"}(mn||(mn={})),function(n){n[n.BITRATE=2069]="BITRATE",n[n.PACKAGE_LOST=2070]="PACKAGE_LOST",n[n.PACKAGE_RATE=2071]="PACKAGE_RATE",n[n.HEIGHT=2073]="HEIGHT",n[n.FRAME_RATE=2075]="FRAME_RATE",n[n.WIDTH=2077]="WIDTH"}(ba||(ba={})),function(n){n[n.JITTER=-1]="JITTER",n[n.PACKAGE_LOST=2014]="PACKAGE_LOST",n[n.WIDTH=2018]="WIDTH",n[n.HEIGHT=2019]="HEIGHT",n[n.FRAME_RATE=2020]="FRAME_RATE",n[n.JITTER_BUFFER=2023]="JITTER_BUFFER",n[n.CURRENT_DELAY=2024]="CURRENT_DELAY",n[n.NACKS=2026]="NACKS",n[n.PLIS=2027]="PLIS",n[n.FIRS=2028]="FIRS",n[n.BITRATE=2029]="BITRATE",n[n.PACKAGE_RATE=2078]="PACKAGE_RATE",n[n.FREEZE=2084]="FREEZE",n[n.DISABLED=2101]="DISABLED",n[n.PLAYER_STATUS=2129]="PLAYER_STATUS",n[n.QP_SUM=2144]="QP_SUM",n[n.I_FRAME_DELAY=2149]="I_FRAME_DELAY"}(Bn||(Bn={})),function(n){n[n.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",n[n.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",n[n.FREEZE_TIME=2109]="FREEZE_TIME",n[n.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER"}(cl||(cl={})),function(n){n[n.PCM_LEVEL=2104]="PCM_LEVEL"}(Gv||(Gv={})),function(n){n[n.PACKAGE_LOST=-1]="PACKAGE_LOST",n[n.LEVEL=2038]="LEVEL",n[n.BITRATE=2039]="BITRATE",n[n.PACKAGE_RATE=2040]="PACKAGE_RATE",n[n.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",n[n.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",n[n.FREEZE=2081]="FREEZE",n[n.DISABLED=2096]="DISABLED"}(ko||(ko={})),function(n){n[n.BITRATE=2044]="BITRATE",n[n.PACKAGE_LOST=2045]="PACKAGE_LOST",n[n.PACKAGE_RATE=2046]="PACKAGE_RATE",n[n.CURRENT_DELAY=2047]="CURRENT_DELAY",n[n.JITTER_BUFFER=2054]="JITTER_BUFFER",n[n.JITTER=2055]="JITTER",n[n.FREEZE=2083]="FREEZE",n[n.DISABLED=2102]="DISABLED",n[n.PCM_LEVEL=2105]="PCM_LEVEL",n[n.PLAYER_STATUS=2130]="PLAYER_STATUS",n[n.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES"}(wr||(wr={})),function(n){n[n.FREEZE_TIME=-1]="FREEZE_TIME",n[n.LEVEL=2043]="LEVEL"}(Wv||(Wv={})),function(n){n[n.RTT=2006]="RTT",n[n.CONN_TYPE=801]="CONN_TYPE"}(lr||(lr={}));const Lo=1e3,Bc=3;function Ke(n,e,t){t!=null&&Number.isFinite(t)&&(n[e]=Math.round(Math.max(0,t)))}function kk(n){const e={[lr.CONN_TYPE]:0,[lr.RTT]:n.rtt};switch(n.selectedCandidatePair.localCandidate.candidateType){case"relay":{const t=n.selectedCandidatePair.localCandidate.relayProtocol;t==="udp"&&(e[lr.CONN_TYPE]=1),t==="tcp"&&(e[lr.CONN_TYPE]=3),t==="tls"&&(e[lr.CONN_TYPE]=4);break}case"srflx":e[lr.CONN_TYPE]=2}return e}class Lk extends At{constructor(e){super(),S(this,"store",void 0),S(this,"uploadWRTCStatsTimer",void 0),S(this,"uploadOutboundDenoiserStatsTimer",void 0),S(this,"uploadExtStatsTimer",void 0),S(this,"uploadExtUsageStatsTimer",void 0),S(this,"uploadInboundExtStatsTimer",void 0),S(this,"requestStats",void 0),S(this,"requestTransportStats",void 0),S(this,"requestLocalMedia",void 0),S(this,"requestRemoteMedia",void 0),S(this,"requestAllTracks",void 0),S(this,"requestVideoIsReady",void 0),S(this,"requestUploadStats",void 0),S(this,"requestUpload",void 0),S(this,"uploadOutboundStarted",!1),S(this,"uploadInboundStarted",!1),S(this,"uploadTransportStarted",!1),S(this,"uploadExtensionUsageStarted",!1),S(this,"lastRecvStats",void 0),S(this,"lastSendStats",void 0),S(this,"lastFullRecvStats",void 0),S(this,"lastFullSendStats",void 0),S(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let t,i;if(this.uploadTransportStarted&&(t=this.requestStats(),this.store.useP2P&&(i=this.requestStats(!0))),!t&&this.uploadOutboundStarted&&(t=this.requestStats()),!i&&this.uploadInboundStarted&&(i=this.requestStats(!0)),t||i){const s={};if(this.uploadTransportStarted&&t){const a=this.getTransportStats(t,i,e);a&&(s.misc=[a])}if(this.uploadOutboundStarted&&t){const a=this.getOutboundStats(t,e?this.lastSendStats:this.lastFullSendStats,e);a&&(s.outbound=[a])}if(this.uploadInboundStarted&&i){const a=this.getInboundStats(i,e?this.lastRecvStats:this.lastFullRecvStats,e);a&&(s.inbound=a)}this.requestUploadStats(s)}this.lastRecvStats=i,this.lastSendStats=t,e||(this.lastFullRecvStats=i,this.lastFullSendStats=t)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e!==Bc),++e===Bc+1&&(e=1)},Lo)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,t,i){if(!this.requestStats)return;if(i)return e.rtt==null?void 0:{addition:{[lr.RTT]:e.rtt,[lr.CONN_TYPE]:void 0}};const s=kk(e);if(this.store.useP2P){if(t){const a=kk(t);s[lr.CONN_TYPE]+=a[lr.CONN_TYPE]<<3}s[lr.CONN_TYPE]+=110}else s[lr.CONN_TYPE]+=100;return{addition:s}}getOutboundStats(e,t,i){if(!this.requestUploadStats||!this.requestLocalMedia)return;const s=this.requestLocalMedia();if(!s||s.length===0)return;let a,c,l;return s.forEach(h=>{let[p,{track:f,ssrcs:_}]=h;switch(p){case te.LocalVideoLowTrack:case te.LocalVideoTrack:if(p===te.LocalVideoTrack){const g=function(R,I,N,D,V){const G=I.videoSend.find(re=>re.ssrc===R);if(!G)return;const F={},{sentFrame:j,inputFrame:z}=G;if(z&&j){const re=z.frameRate,ae=j.frameRate;F[mn.FREEZE]=function(Ue,ze){let vt=!0;return vt=!(Ue<=5)&&(Ue<=10?ze<3:Ue<=20?ze<4:ze<5),vt}(re,ae)?1:0}if(Ke(F,mn.QP_SUM,G.qpSumPerFrame),V)return F;switch(j&&(Ke(F,mn.HEIGHT,j.height),Ke(F,mn.WIDTH,j.width),Ke(F,mn.FRAME_RATE,j.frameRate)),F[mn.DISABLED]=D._originMediaStreamTrack&&!D._originMediaStreamTrack.enabled||D._mediaStreamTrack&&!D._mediaStreamTrack.enabled?1:0,G.adaptionChangeReason){case"none":F[mn.ADAPTATION]=0;break;case"cpu":F[mn.ADAPTATION]=1;break;case"bandwidth":F[mn.ADAPTATION]=2;break;case"other":F[mn.ADAPTATION]=3}F[mn.PLAYER_STATUS]=yT[D._player?D._player.videoElementStatus:"uninit"],Ke(F,mn.NACKS,G.nacksCount),Ke(F,mn.PLIS,G.plisCount),Ke(F,mn.FIRS,G.firsCount),Ke(F,mn.AVG_ENCODE,G.avgEncodeMs);const Y=N&&N.videoSend.find(re=>re.ssrc===R);if(Y){let re=V?Lo:Lo*Bc;Y.timestamp&&G.timestamp&&(re=G.timestamp-Y.timestamp),Y.packets!=null&&G.packets!=null&&Ke(F,mn.PACKAGE_RATE,1e3*(G.packets-Y.packets)/re),G.packetsLost!=null&&Y.packetsLost!=null&&Ke(F,mn.PACKAGE_LOST,G.packetsLost-Y.packetsLost),Y.bytes!=null&&G.bytes!=null&&Ke(F,mn.BITRATE,8*(G.bytes-Y.bytes)/re)}return F}(_[0].ssrcId,e,t,f,i),T=i?null:function(R,I,N){const D=I.videoSend.find(Y=>Y.ssrc===R);if(!D)return null;const V={},G=D.inputFrame,F=G&&G.height||N&&N._videoHeight||0,j=G&&G.width||N&&N._videoWidth||0,z=G&&G.frameRate||0;return Ke(V,dh.HEIGHT,F),Ke(V,dh.WIDTH,j),Ke(V,dh.FRAME_RATE,z),V}(_[0].ssrcId,e,f),w=i?null:function(R){const I={};return Ke(I,mn.RETRANSMIT,R.bitrate.retransmit),Ke(I,mn.TARGET_ENCODED,R.bitrate.targetEncoded),Ke(I,mn.ACTUAL_ENCODED,R.bitrate.actualEncoded),Ke(I,mn.TRANSMIT,R.bitrate.transmit),Ke(I,mn.BANDWIDTH,R.sendBandwidth),I}(e);c=Object.assign({},g,T,w)}else l=i?void 0:function(g,T,w){const R=T.videoSend.find(D=>D.ssrc===g);if(!R)return;const I={},N=R.sentFrame;if(N&&(Ke(I,ba.HEIGHT,N.height),Ke(I,ba.WIDTH,N.width),Ke(I,ba.FRAME_RATE,N.frameRate)),w){const D=w.videoSend.find(V=>V.ssrc===g);if(D){let V=Lo*Bc;D.timestamp&&R.timestamp&&(V=R.timestamp-D.timestamp),D.packets!=null&&R.packets!=null&&Ke(I,ba.PACKAGE_RATE,1e3*(R.packets-D.packets)/V),R.packetsLost!=null&&D.packetsLost!=null&&Ke(I,ba.PACKAGE_LOST,R.packetsLost-D.packetsLost),D.bytes!=null&&R.bytes!=null&&Ke(I,ba.BITRATE,8*(R.bytes-D.bytes)/V)}}return I}(_[0].ssrcId,e,t);break;case te.LocalAudioTrack:a=i?void 0:function(g,T,w,R){const I=T.audioSend.find(F=>F.ssrc===g);if(!I)return;const N={};N[ko.DISABLED]=R._originMediaStreamTrack&&!R._originMediaStreamTrack.enabled||R._mediaStreamTrack&&!R._mediaStreamTrack.enabled?1:0;const D=R._source.getAccurateVolumeLevel(),V=I.inputLevel;Ke(N,ko.LEVEL,100*(V??D)),Ke(N,Gv.PCM_LEVEL,100*D),Ke(N,ko.AEC_RETURN_LOSS,I.aecReturnLoss),Ke(N,ko.AEC_RETURN_LOSS_ENH,I.aecReturnLossEnhancement),N[ko.FREEZE]=0;const G=w&&w.audioSend.find(F=>F.ssrc===g);if(G){let F=Lo*Bc;G.timestamp&&I.timestamp&&(F=I.timestamp-G.timestamp),G.bytes!=null&&I.bytes!=null&&Ke(N,ko.BITRATE,8*(I.bytes-G.bytes)/F),G.packets!=null&&I.packets!=null&&Ke(N,ko.PACKAGE_RATE,1e3*(I.packets-G.packets)/F)}return N}(_[0].ssrcId,e,t,f)}}),{high:c,low:l,audio:a}}getInboundStats(e,t,i){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],a=[];return s.forEach(c=>{let[l,h]=c;const p={peer:l.uid};if(h.has(Ee.VIDEO)&&l.videoTrack){const f=l._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(l._videoSSRC)||!1,_=l.videoTrack?function(g,T,w,R,I,N,D){const V=T.videoRecv.find(re=>re.ssrc===g);if(!V)return;const G={},{receivedFrame:F,outputFrame:j,decodeFrameRate:z}=V,Y=w&&w.videoRecv.find(re=>re.ssrc===g);if(G[Bn.FREEZE]=I&&lh.isRemoteVideoFreeze(R,V,Y)?1:0,Ke(G,cl.FRAME_RATE_DECODE,z),Ke(G,Bn.QP_SUM,V.qpSumPerFrame),V.framesRateFirefox&&Ke(G,Bn.FRAME_RATE,V.framesRateFirefox),F&&Ke(G,Bn.FRAME_RATE,F.frameRate),Y){const re=T.timestamp-w.timestamp||(D?Lo:Bc*Lo);V.packetsLost!=null&&Y.packetsLost!=null&&Ke(G,Bn.PACKAGE_LOST,V.packetsLost-Y.packetsLost),Y.bytes!=null&&V.bytes!=null&&Ke(G,Bn.BITRATE,8*(V.bytes-Y.bytes)/re),Y.packets!=null&&V.packets!=null&&Ke(G,Bn.PACKAGE_RATE,1e3*(V.packets-Y.packets)/re)}if(D)return G;if(F?(Ke(G,Bn.HEIGHT,F.height),Ke(G,Bn.WIDTH,F.width)):R&&(Ke(G,Bn.HEIGHT,R._videoHeight||0),Ke(G,Bn.WIDTH,R._videoWidth||0)),j&&Ke(G,cl.FRAME_RATE_RENDER,j.frameRate),Ke(G,Bn.JITTER_BUFFER,V.jitterBufferMs),Ke(G,Bn.CURRENT_DELAY,V.currentDelayMs),Ke(G,Bn.FIRS,V.firsCount),Ke(G,Bn.NACKS,V.nacksCount),Ke(G,Bn.PLIS,V.plisCount),R){G[Bn.DISABLED]=R._originMediaStreamTrack.enabled&&R._mediaStreamTrack.enabled?0:1;const re=R._player;if(re){const{freezeTimeCounterList:ae,renderFreezeAccTime:Ue}=re;if(ae&&ae.length>0&&Ke(G,cl.FREEZE_TIME,ae.splice(0,1)[0]),N&&Ao.visibility==="visible"){const ze=Math.min(6e3,Ue);re.renderFreezeAccTime=Math.max(0,Ue-ze),Ke(G,cl.FREEZE_TIME_RENDER,ze)}}}if(G[Bn.PLAYER_STATUS]=yT[R._player?R._player.videoElementStatus:"uninit"],Y&&V.totalInterFrameDelay!==void 0&&V.totalSquaredInterFrameDelay!==void 0&&Y.totalInterFrameDelay!==void 0&&Y.totalSquaredInterFrameDelay!==void 0){const re=V.totalInterFrameDelay-Y.totalInterFrameDelay,ae=V.totalSquaredInterFrameDelay-Y.totalSquaredInterFrameDelay,Ue=V.framesDecodeCount-Y.framesDecodeCount,ze=re/Ue*1e3,vt=Math.round(1e3*Math.sqrt((ae-Math.pow(re,2)/Ue)/Ue));!isNaN(vt)&&ze+vt>Math.max(3*ze,ze+150)&&(G[Bn.I_FRAME_DELAY]=vt)}return G}(l._videoSSRC,e,t,l.videoTrack,f===!0,this.needUploadRenderFreezeTime,i):void 0;_&&(p.video=_)}if(h.has(Ee.AUDIO)&&l.audioTrack){const f=l.audioTrack?function(_,g,T,w,R){const I=g.audioRecv.find(re=>re.ssrc===_);if(!I)return;const N={},D=T&&T.audioRecv.find(re=>re.ssrc===_),{receivedFrames:V,droppedFrames:G}=I;var F,j;if(Ke(N,wr.JITTER,I.jitterMs),V!=null&&G!=null&&(N[wr.FREEZE]=(j=G,(F=V)===0||100*j/F>20?1:0)),D){const re=g.timestamp-T.timestamp||(R?Lo:Lo*Bc);I.packets!=null&&D.packets!=null&&Ke(N,wr.PACKAGE_RATE,1e3*(I.packets-D.packets)/re),D.bytes!=null&&I.bytes!=null&&Ke(N,wr.BITRATE,8*(I.bytes-D.bytes)/re),I.packetsLost!=null&&D.packetsLost!=null&&Ke(N,wr.PACKAGE_LOST,I.packetsLost-D.packetsLost)}if(R)return N;const z=w._source.getAccurateVolumeLevel(),Y=I.outputLevel;if(Ke(N,Wv.LEVEL,100*(Y??z)),Ke(N,wr.PCM_LEVEL,100*z),w&&(N[wr.DISABLED]=w._originMediaStreamTrack.enabled&&w._mediaStreamTrack.enabled?0:1),Ke(N,wr.JITTER_BUFFER,I.jitterBufferMs),Ke(N,wr.CURRENT_DELAY,I.jitterBufferMs),N[wr.PLAYER_STATUS]=yT[fi.getPlayerState(w.getTrackId())],D){const re=I.concealedSamples-D.concealedSamples;re>0&&Ke(N,wr.CONCEALED_SAMPLES,re)}return N}(l._audioSSRC,e,t,l.audioTrack,i):void 0;f&&(p.audio=f)}(p.video||p.audio)&&a.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,a}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(t=>t instanceof Ac);if(e&&e._external.getDenoiserStats){const t=e._external.getDenoiserStats();t&&this.requestUpload(Ro.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(t=>{this.requestUpload&&this.requestUpload(t.type,t.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[t,i]=e;i.has(Ee.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)}),i.has(Ee.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const t=Date.now(),i={connectionInterval:L("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t};let s=[];const a=this.requestAllTracks&&this.requestAllTracks()||[];for(const p of a)!p.muted&&p.enabled&&(s=s.concat(await p.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[p,f]of c)f.has(Ee.VIDEO)&&p.videoTrack&&(s=s.concat(await p.videoTrack.getProcessorUsage())),f.has(Ee.AUDIO)&&p.audioTrack&&(s=s.concat(await p.audioTrack.getProcessorUsage()));if(s.length===0)return;i.details=function(p,f){const _={};for(const{id:R,value:I,level:N,direction:D}of p){var g;const V=(g=f.get(R))!==null&&g!==void 0?g:0,G=I===2?V+L("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:V;var T,w;f.set(R,G),_[R]?(I===2&&(_[R].value=I),N>_[R].level&&(_[R].level=N),D==="remote"&&(_[R].remoteUidCount+=1),_[R].totalTs=(T=f.get(R))!==null&&T!==void 0?T:0):_[R]={value:I,level:N,remoteUidCount:D==="local"?0:1,totalTs:(w=f.get(R))!==null&&w!==void 0?w:0}}return Object.keys(_).map(R=>{const{level:I,value:N,totalTs:D}=_[R];return{id:R,level:I,value:N,totalTs:D}})}(s,e);const l=Date.now(),h=l>t?l:t+1;this.requestUpload&&this.requestUpload(Ro.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:h})},L("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class On{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){S(this,"uid",void 0),S(this,"_uintid",void 0),S(this,"_trust_in_room_",!0),S(this,"_trust_audio_enabled_state_",!0),S(this,"_trust_video_enabled_state_",!0),S(this,"_trust_audio_mute_state_",!0),S(this,"_trust_video_mute_state_",!0),S(this,"_audio_muted_",!1),S(this,"_video_muted_",!1),S(this,"_audio_enabled_",!0),S(this,"_video_enabled_",!0),S(this,"_audio_added_",!1),S(this,"_video_added_",!1),S(this,"_is_pre_created",!1),S(this,"_video_pre_subscribed",!1),S(this,"_audio_pre_subscribed",!1),S(this,"_trust_video_stream_added_state_",!0),S(this,"_trust_audio_stream_added_state_",!0),S(this,"_audioTrack",void 0),S(this,"_videoTrack",void 0),S(this,"_dataChannels",[]),S(this,"_audioSSRC",void 0),S(this,"_videoSSRC",void 0),S(this,"_audioOrtc",void 0),S(this,"_videoOrtc",void 0),S(this,"_cname",void 0),S(this,"_rtxSsrcId",void 0),S(this,"_videoMid",void 0),S(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}var Ar;function EY(n,e){var t;let i;switch(e){case te.LocalAudioTrack:i=it.Audio;break;case te.LocalVideoTrack:i=fe(t=n._hints).call(t,Tt.SCREEN_TRACK)?it.Screen:it.High;break;case te.LocalVideoLowTrack:i=it.Low}return i}function Hv(n){const e=et();if(n.some(t=>t._bypassWebAudio))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function Kv(n,e){Hv(n);const t=new tn;return n.forEach(i=>t.addAudioTrack(i)),t}function Mk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Am(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Mk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Mk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}(function(n){n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY"})(Ar||(Ar={}));class un extends At{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Oe.StateChange,t,this._state)}constructor(e,t){super(),S(this,"store",void 0),S(this,"statsUploader",void 0),S(this,"sendConnection",void 0),S(this,"recvConnection",void 0),S(this,"localTrackMap",new Map),S(this,"remoteUserMap",new Map),S(this,"localDataChannels",[]),S(this,"pendingLocalTracks",[]),S(this,"pendingRemoteTracks",[]),S(this,"statsCollector",void 0),S(this,"dtlsFailedCount",0),S(this,"sendMutex",new Tn("P2PChannel2-send-mutex")),S(this,"recvMutex",new Tn("P2PChannel2-recv-mutex")),S(this,"_state",st.Disconnected),S(this,"_restartStates",["disconnected","failed"]),S(this,"reconnectInterval",void 0),S(this,"uploadUnplinkStarted",!1),S(this,"uploadDownlinkStarted",!1),S(this,"uplinkStateUploadInterval",void 0),S(this,"downlinkStatsUploadInterval",void 0),S(this,"handleMuteLocalTrack",async(i,s,a)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==st.Connected)return void a(new Q(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const p=this.filterTobeMutedTracks(i);if(p.length===0)return void s();const f=p.find(w=>w[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(p.map(w=>{let[,{id:R}]=w;return R}));let _=!1;var l,h;i.trackMediaType==="video"?_=!((l=this.localTrackMap.get(te.LocalAudioTrack))===null||l===void 0||!l.track._muted):_=((h=this.localTrackMap.get(te.LocalVideoTrack))===null||h===void 0?void 0:h.id)===void 0;const g=this.createMuteMessage(p);await _t(this,Oe.RequestMuteLocal,g);const T=i.trackMediaType==="video"?Ks.MUTE_LOCAL_VIDEO:Ks.MUTE_LOCAL_AUDIO;await _t(this,Oe.RequestP2PMuteLocal,{action:T,message:g,isMuteAll:_}),s()}catch(p){a(p)}finally{c()}}),S(this,"handleUnmuteLocalTrack",async(i,s,a)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==st.Connected)return void a(new Q(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const l=this.filterTobeUnmutedTracks(i);if(l.length===0)return void s();await this.sendConnection.unmuteLocal(l.map(f=>{let[,{id:_}]=f;return _}));const h=this.createUnmuteMessage(l),p=i.trackMediaType==="video"?Ks.UNMUTE_LOCAL_VIDEO:Ks.UNMUTE_LOCAL_AUDIO;await _t(this,Oe.RequestP2PMuteLocal,{action:p,message:h}),s()}catch(l){a(l)}finally{c()}}),S(this,"handleUpdateVideoEncoder",async(i,s,a)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const l=this.localTrackMap.get(te.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==i||this.state!==st.Connected)return void s();const{id:h,track:p}=l;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(Oe.UpdateVideoEncoder,p)),s()}catch(l){a(l)}finally{c()}}),S(this,"handleSetOptimizationMode",async(i,s,a)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const l=this.localTrackMap.get(te.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==i||this.state!==st.Connected)return;const{id:h,track:p}=l;h&&await this.sendConnection.updateSendParameters(h,p),s()}catch(l){a(l)}finally{c()}}),S(this,"handleReplaceTrack",async(i,s,a,c)=>{let l;v.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof c=="boolean"&&c||(l=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var h;const f=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:g}]=_;return i===g});if(!this.sendConnection||!f||f[1].id===void 0||this.state!==st.Connected)return void s();if(await((h=this.sendConnection)===null||h===void 0?void 0:h.replaceTrack(i,f[1].id)),f[0]===te.LocalVideoTrack&&et().supportDualStreamEncoding){const _=this.localTrackMap.get(te.LocalVideoLowTrack);if(_){const g=i._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=g,_.track._originMediaStreamTrack=g,await new W((T,w)=>{this.handleReplaceTrack(_.track,T,w,!0)})}}s()}catch(f){a(f)}finally{var p;(p=l)===null||p===void 0||p()}}),S(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),S(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),S(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),S(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new Lk(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},L("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e,t,i,s,a,c){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let i;try{if(t){this.recvConnection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new dr(e,this.store,qn.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const s=await this.recvConnection.establish(t);return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}{this.state=st.New,this.sendConnection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new dr(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const s=await this.sendConnection.establish();return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=st.Connected}async addRemoteCandidate(e,t){if(t===qn.RECEIVE_ONLY){if(!this.sendConnection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,i){var s=this;return Bi(function*(){const a=yield Be(s.sendMutex.lock("From P2PChannel.publish"));try{if(!s.sendConnection||s.state!==st.Connected){s.throwIfTrackTypeNotMatch(e);const f=e.filter(_=>s.pendingLocalTracks.indexOf(_)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(f))}s.store.pubId=s.store.pubId+1,Fn.markPublishStart(s.store.clientId,s.store.pubId);const c=s.filterTobePublishedTracks(e,t,i);if(c.length===0)return void(yield Be(s.tryToUnmuteAudio(e)));c.forEach(f=>{let{track:_,type:g}=f;const T=Date.now();s.store.publish(_.getTrackId(),g===te.LocalAudioTrack?"audio":"video",T)}),s.bindLocalTrackEvents(c);const l=yield Be(s.sendConnection.send(c.map(f=>{let{track:_}=f;return _}),s.store.codec,s.store.audioCodec)),h=(yield Be(l.next())).value,p=s.createGatewayPublishMessage(c,h);try{yield p}catch(f){throw l.throw(f),(f==null?void 0:f.code)===O.WS_ABORT&&c.forEach(_=>{let{track:g}=_;s.pendingLocalTracks.indexOf(g)===-1&&s.pendingLocalTracks.push(g)}),s.unbindLocalTrackEvents(c),f}yield Be(l.next()),c.forEach(f=>{let{type:_}=f;s.statsCollector.addLocalStats(_)}),s.statsUploader.startUploadOutboundStats(),s.assignLocalTracks(c,h),c.forEach(f=>{let{track:_,type:g}=f;const T=Date.now();s.store.publish(_.getTrackId(),g===te.LocalAudioTrack?"audio":"video",void 0,T)}),s.startUploadUplinkState()}finally{a()}})()}async unpublish(e){if(!this.sendConnection||this.state!==st.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(a=>!fe(e).call(e,a)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const i=t.find(a=>a[0]==="videoLowTrack");i&&i[1].track.close();const s=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(a=>{let[,{id:c}]=a;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(a=>{let[c,{track:l}]=a;return{type:c,track:l}})),t.forEach(a=>{let[c]=a;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===st.Connected)return i&&i[1].track.close(),s;e.forEach(a=>{const c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],i=[];Array.from(this.localTrackMap.entries()).forEach(s=>{let[a,{track:c,ssrcs:l}]=s;const h={stream_type:EY(c,a),ssrcs:l};c._muted||!c._enabled?t.push(h):i.push(h)}),t.length>0&&t.forEach(s=>{_t(this,Oe.RequestMuteLocal,[s])}),i.length>0&&i.forEach(s=>{_t(this,Oe.RequestUnmuteLocal,[s])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Bi(function*(){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Xt(this,Oe.RequestRePublish,this.pendingLocalTracks),this.emit(Oe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,i,s){var a;if(!this.recvConnection)throw new Q(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;const{track:c,mid:l,transceiver:h}=await this.recvConnection.receive(t,[{ssrcId:i}],String(e.uid),s);t===Ee.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new Yr(c,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new Ys(c,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack));const p=this.remoteUserMap.get(e);p?p.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const f=this.pendingRemoteTracks.findIndex(_=>{let{user:g,kind:T}=_;return g.uid===e.uid&&t===T});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Oe.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,i,s){if(!this.recvConnection)throw new Q(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:i}],String(e.uid),s)}async unsubscribe(e,t,i){const s=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:h}=c;return t!==void 0?l.uid===e.uid&&t===h:l.uid===e.uid});if(s.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.recvConnection||i||s.forEach(c=>{let{kind:l}=c;var h;if(l===Ee.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(l===Ee.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const a=this.filterTobeUnSubscribedTracks(e,t);a.length!==0&&(await this.recvConnection.stopReceiving(a.map(c=>{let[,{id:l}]=c;return l})),this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),a.forEach(c=>{let[l,{kind:h}]=c;var p,f;if(h===Ee.VIDEO&&l._videoSSRC&&((p=this.recvConnection)===null||p===void 0||p.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),h===Ee.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),i||((f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0);else if(h===Ee.AUDIO){var _;this.unbindRemoteTrackEvents(l._audioTrack),!i&&((_=l._audioTrack)===null||_===void 0||_._destroy(),l._audioTrack=void 0)}}),a.forEach(c=>{let[,{kind:l}]=c;_t(this,Oe.RequestP2PMuteRemote,l)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,i]=t;[Ee.VIDEO,Ee.AUDIO].forEach(s=>{i.has(s)?_t(this,Oe.RequestP2PUnmuteRemote,s):_t(this,Oe.RequestP2PMuteRemote,s)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Q(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const s=t===Ee.VIDEO?e._videoSSRC:e._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||v.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(te.LocalAudioTrack);if((t==null?void 0:t.track)instanceof tn){const i=t.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return a!==te.LocalAudioTrack}).filter(s=>{let[a]=s;return!(e&&a===te.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(e&&s===te.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}reportPublishEvent(e,t,i,s,a){if(e){const l=this.localTrackMap.get(te.LocalAudioTrack),h=s?this.localTrackMap.get(te.LocalVideoLowTrack):this.localTrackMap.get(te.LocalVideoTrack);Te.publish(this.store.sessionId,{eventElapse:Fn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(Tt.SCREEN_TRACK))!==-1,audio:!!l,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var c;i||(i=[]);const l=i.find(p=>p instanceof lt),h=s?(c=this.localTrackMap.get(te.LocalVideoTrack))===null||c===void 0?void 0:c.track:i.find(p=>p instanceof Ge);Te.publish(this.store.sessionId,{eventElapse:Fn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(Tt.SCREEN_TRACK))!==-1,audio:!!l,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,i,s){const a=s===Ee.VIDEO?i._videoSSRC:i._audioSSRC;a&&Te.subscribe(this.store.sessionId,{succ:e,ec:t,video:s===Ee.VIDEO,audio:s===Ee.AUDIO,peerid:i.uid,subscribeRequestid:s===Ee.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Fn.measureFromSubscribeStart(this.store.clientId,a)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Tn("P2PChannel2-send-mutex"),this.sendMutex=new Tn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(te.LocalAudioTrack);if((e==null?void 0:e.track)instanceof tn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=st.Disconnected}getStats(e){var t,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(te.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(te.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Ge||t&&t.track instanceof lt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;const i=Array.from($i(t=this.remoteUserMap).call(t)).find(s=>s.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(te.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=du(e).call(e,(i,s)=>i.level-s.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=st.Reconnecting,L("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:s}]=e;switch(i){case te.LocalVideoTrack:fe(t=s._hints).call(t,Tt.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case te.LocalAudioTrack:s instanceof tn?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case te.LocalVideoLowTrack:}}),this.emit(Oe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from($i(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(t,s)}),this.emit(Oe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const i of this.pendingRemoteTracks){const{user:s,kind:a}=i;if((e instanceof On?e.uid:e)===s.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let i,s;if(e===qn.SEND_ONLY){if(!this.sendConnection)throw new Q(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection}else{if(!this.recvConnection)throw new Q(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection}try{if(t){const a=await s.restartICE(t);return s.isInRestartIce=!1,a}{const a=await s.restartICE();if(a){const c=await Xt(this,Oe.RequestP2PRestartICE,{direction:qn.RECEIVE_ONLY,iceParameter:a});await s.restartICE(c),s.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(te.LocalVideoTrack),i=this.localTrackMap.get(te.LocalAudioTrack),s=e.videoSend.find(w=>{var R;return w.ssrc===(t==null||(R=t.ssrcs)===null||R===void 0?void 0:R[0].ssrcId)}),a=e.audioSend.find(w=>{var R;return w.ssrc===(i==null||(R=i.ssrcs)===null||R===void 0?void 0:R[0].ssrcId)});if(!s||!a)return 1;const c=Ui(this,Oe.NeedSignalRTT),l=s?s.rttMs:void 0,h=a?a.rttMs:void 0,p=l&&h?(l+h)/2:l||h,f=(p&&c?(p+c)/2:p||c)||0,_=100*e.sendPacketLossRate*.7/50+.3*f/1500,g=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,T=t==null?void 0:t.track;if(T&&T._encoderConfig&&T._hints.indexOf(Tt.SCREEN_TRACK)===-1){const w=T._encoderConfig.bitrateMax,R=e.bitrate.actualEncoded;if(w&&R){const I=(1e3*w-R)/(1e3*w);return eN[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const a=s._audioSSRC,c=s._videoSSRC,l=e.audioRecv.find(R=>R.ssrc===a),h=e.videoRecv.find(R=>R.ssrc===c);if(!l&&!h)return void(t+=1);const p=Ui(this,Oe.NeedSignalRTT),f=e.rtt,_=(f&&p?(f+p)/2:f||p)||0,g=l?l.jitterMs:void 0,T=e.recvPacketLossRate;let w=.7*T*100/50+.3*_/1500;g&&(w=.6*T*100/50+.2*_/1500+.2*g/400),t+=w<.1?1:w<.17?2:w<.36?3:w<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new W((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}filterTobePublishedTracks(e,t,i){const s=[],a=et(),c=this.getAllTracks();e=bd(e=e.filter(p=>c.indexOf(p)===-1));let l=!1,h=!1;for(const p of e){if(p instanceof Ge&&(this.localTrackMap.has(te.LocalVideoTrack)||l?new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:p,type:te.LocalVideoTrack}),l=!0),t)){const f=this.getLowVideoTrack(p,i);s.push({track:f,type:te.LocalVideoLowTrack})}if(p instanceof lt){const f=this.localTrackMap.get(te.LocalAudioTrack);if(f){if(!(f.track instanceof tn))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0)}else if(h){const _=s.find(g=>{let{type:T}=g;return T===te.LocalAudioTrack});if(!(_.track instanceof tn))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(p)}else{if(!a.webAudioMediaStreamDest||p instanceof tn||p._bypassWebAudio)s.push({track:p,type:te.LocalAudioTrack});else{const _=new tn;_.addAudioTrack(p),s.push({track:_,type:te.LocalAudioTrack})}h=!0}}}return s}filterTobeUnpublishedTracks(e){const t=[],i=this.getAllTracks();e=bd(e=e.filter(s=>i.indexOf(s)!==-1));for(const s of e){if(s instanceof lt){const a=this.localTrackMap.get(te.LocalAudioTrack);if(!a)continue;a.track instanceof tn?(a.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),a.track.trackList.length===0&&(t.push([te.LocalAudioTrack,a]),a.track.close())):t.push([te.LocalAudioTrack,a])}if(s instanceof Ge){const a=this.localTrackMap.get(te.LocalVideoTrack);if(!a)continue;t.push([te.LocalVideoTrack,a]);const c=this.localTrackMap.get(te.LocalVideoLowTrack);c&&t.push([te.LocalVideoLowTrack,c])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:s}=t;switch(s){case te.LocalVideoTrack:i.addListener(he.GET_STATS,this.handleGetLocalVideoStats),i.addListener(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(he.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(he.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.addListener(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case te.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case te.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof tn?e.trackList.forEach(i=>{i.addListener(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(he.GET_STATS,this.handleGetLocalAudioStats),i.addListener(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(he.GET_STATS,this.handleGetLocalAudioStats),e.addListener(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(he.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:s}]=t;return{track:s,type:i}})),e.forEach(t=>{let{track:i,type:s}=t;switch(s){case te.LocalVideoTrack:i.off(he.GET_STATS,this.handleGetLocalVideoStats),i.off(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(he.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(he.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.off(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case te.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof tn?e.trackList.forEach(t=>{t.off(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(he.GET_STATS,this.handleGetLocalAudioStats),t.off(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(he.GET_STATS,this.handleGetLocalAudioStats),e.off(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Ys&&t.addListener(he.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof Yr&&t.addListener(he.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(he.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(Ee.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(Ee.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,s)=>{var a;let c,{track:l,type:h}=i;switch(h){case te.LocalAudioTrack:c=it.Audio;break;case te.LocalVideoTrack:c=fe(a=l._hints).call(a,Tt.SCREEN_TRACK)?it.Screen:it.High;break;case te.LocalVideoLowTrack:c=it.Low}return{kind:h===te.LocalAudioTrack?Ee.AUDIO:Ee.VIDEO,stream_type:c,mid:t[s].id,ssrcs:t[s].localSSRC,isMuted:l.muted||!l.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let s,[a,{track:c,ssrcs:l,id:h}]=t;switch(a){case te.LocalVideoTrack:s=fe(i=c._hints).call(i,Tt.SCREEN_TRACK)?it.Screen:it.High;break;case te.LocalAudioTrack:s=it.Audio;break;case te.LocalVideoLowTrack:s=it.Low}return{stream_type:s,ssrcs:l,mid:h}})}assignLocalTracks(e,t){e.forEach((i,s)=>{let{track:a,type:c}=i;this.localTrackMap.set(c,{track:a,id:t[s].id,ssrcs:t[s].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var i;v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Oe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),fe(i=this._restartStates).call(i,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Sn(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Te.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Pt.TRACER}).onSuccess(),this.emit(Oe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;const s=Array.from($i(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===t);var a;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(a=s.audioTrack)===null||a===void 0||a.emit(ga.FIRST_FRAME_DECODED),Te.firstRemoteFrame(this.store.sessionId,cn.FIRST_AUDIO_DECODE,Ct.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Fn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;const s=Array.from($i(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===t);s&&Te.firstRemoteFrame(this.store.sessionId,cn.FIRST_AUDIO_RECEIVED,Ct.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Fn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,s)=>{this.reportVideoFirstFrameDecoded(t,i,s)},e.onFirstVideoReceived=t=>{var i;const s=Array.from($i(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===t);s&&Te.firstRemoteFrame(this.store.sessionId,cn.FIRST_VIDEO_RECEIVED,Ct.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Fn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{const s=t.candidateType==="relay",a=i.candidateType==="relay";i.candidateType!=="unknown"&&s===a||this.emit(Oe.ConnectionTypeChange,s),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(fa(i))," -> ").concat(JSON.stringify(fa(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(fa(i))," -> ").concat(JSON.stringify(fa(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Oe.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===qn.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,v.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===qn.SEND_ONLY?this.restartICE(e):Xt(this,Oe.RequestP2PRestartICE,{direction:qn.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const i=this.localTrackMap.get(te.LocalAudioTrack);if(e instanceof lt&&(i==null?void 0:i.track)instanceof tn)return i.track.isActive||t.push([te.LocalAudioTrack,i]),t;const s=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:c}]=a;return e===c});if(s&&(t.push(s),s[0]===te.LocalVideoTrack)){const a=this.localTrackMap.get(te.LocalVideoLowTrack);a&&t.push([te.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){const t=[],i=this.localTrackMap.get(te.LocalAudioTrack);if(e instanceof lt&&(i==null?void 0:i.track)instanceof tn)return i.track.isActive&&t.push([te.LocalAudioTrack,i]),t;const s=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:c}]=a;return e===c});if(s)if(s[0]===te.LocalVideoTrack){t.push(s);const a=this.localTrackMap.get(te.LocalVideoLowTrack);a&&t.push([te.LocalVideoLowTrack,a])}else t.push(s);return t}createMuteMessage(e){return e.map(t=>{var i;let s,[a,{track:c,ssrcs:l,id:h}]=t;switch(a){case te.LocalAudioTrack:s=it.Audio;break;case te.LocalVideoTrack:s=fe(i=c._hints).call(i,Tt.SCREEN_TRACK)?it.Screen:it.High;break;case te.LocalVideoLowTrack:s=it.Low}return{stream_type:s,ssrcs:l,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var i;let s,[a,{track:c,ssrcs:l,id:h}]=t;switch(a){case te.LocalAudioTrack:s=it.Audio;break;case te.LocalVideoTrack:s=fe(i=c._hints).call(i,Tt.SCREEN_TRACK)?it.Screen:it.High;break;case te.LocalVideoLowTrack:s=it.Low}return{stream_type:s,ssrcs:l,mid:h}})}filterTobeUnSubscribedTracks(e,t){const i=[],s=this.remoteUserMap.get(e);if(!s)return i;if(t){const a=s.get(t);if(!a)return i;i.push([e,{kind:t,id:a}])}else Array.from(s.entries()).forEach(a=>{let[c,l]=a;i.push([e,{kind:c,id:l}])});return i}createUnsubscribeMessage(e){const t=[];return e.forEach(i=>{let[s,{kind:a,id:c}]=i;switch(a){case Ee.VIDEO:return void(s._videoSSRC&&t.push({stream_type:Ee.VIDEO,ssrcId:s._videoSSRC}));case Ee.AUDIO:return void(s._audioSSRC&&t.push({stream_type:Ee.AUDIO,ssrcId:s._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:s}]=t;const a=this.remoteUserMap.get(i);a&&(a.delete(s),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(te.LocalVideoTrack),i=this.localTrackMap.get(te.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof lt){const i=this.filterTobeUnmutedTracks(e[t]);if(i.length===0)continue;const s=this.createUnmuteMessage(i);return void await _t(this,Oe.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Oe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Oe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Sn(Sf(this.dtlsFailedCount,$t)),this.emit(Oe.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(te.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Ge)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Ge).length>1)throw new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof lt).length>1&&(e.some(t=>t instanceof lt&&t._bypassWebAudio)||!et().webAudioMediaStreamDest))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Ge&&this.pendingLocalTracks.some(i=>i instanceof Ge))throw new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof lt&&this.pendingLocalTracks.some(i=>i instanceof lt)&&(!et().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof lt&&i._bypassWebAudio)))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const i=!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&et().supportDualStreamEncoding,s=Am(Am({},{width:160,height:120,framerate:15,bitrate:50}),t);let a;a=i?e._mediaStreamTrack.clone():jv(e,s);const c=Et(8,"track-low-"),l=new Ge(a,Am(Am({},i&&{scaleResolutionDownBy:aT(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,c);return l.on(_a.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,ma.LOW_STREAM)}),l._hints.push(Tt.LOW_STREAM),e.addListener(he.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,i,s){var a;const c=Array.from($i(a=this.remoteUserMap).call(a)).find(l=>l._videoSSRC===e);if(c){s||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());const l=this.store.keyMetrics,h=l.subscribe.find(p=>p.userId===c.uid&&p.type==="video");Te.firstRemoteVideoDecode(this.store.sessionId,cn.FIRST_VIDEO_DECODE,Ct.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:i,subscribeElapse:Fn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(e);if(!s)return!1;const a=s.get(t);if(!a)return!1;const c=await this.recvConnection.getRemoteSSRC(a);return c!==void 0&&c!==i}resetConnection(e){v.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(e)),this.state===st.Connected?(v.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(e){throw new Q(O.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Q(O.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new Q(O.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new Q(O.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new Q(O.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new Q(O.NOT_SUPPORTED)}async preConnect(e,t,i,s,a,c){throw new Q(O.NOT_SUPPORTED)}getEstablishParams(){throw new Q(O.NOT_SUPPORTED)}async reSubscribe(e){throw new Q(O.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new Q(O.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===te.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,ma.LOW_STREAM):i._updateRtpTransceiver(void 0)})}}function Cs(n){return function(e,t,i){const s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];switch(n){case Ar.SEND_ONLY:{const h=await this.sendMutex.lock("From P2PChannel2.".concat(t));try{return await s.apply(this,c)}finally{h()}}case Ar.RECEIVE_ONLY:{const h=await this.recvMutex.lock("From P2PChannel2.".concat(t));try{return await s.apply(this,c)}finally{h()}}default:{const h=await this.sendMutex.lock("From P2PChannel2.".concat(t)),p=await this.recvMutex.lock("From P2PChannel2.".concat(t));try{return await s.apply(this,c)}finally{h(),p()}}}},i}}function Uk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function jc(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Uk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Uk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}$([Cs(Ar.SEND_ONLY),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],un.prototype,"p2pConnect",null),$([Cs(Ar.SEND_ONLY),A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],un.prototype,"unpublish",null),$([Cs(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",W)],un.prototype,"unpublishLowStream",null),$([Cs(Ar.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[On,String,Number,String]),A("design:returntype",W)],un.prototype,"subscribe",null),$([Cs(Ar.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[On,String,Number,String]),A("design:returntype",W)],un.prototype,"mockSubscribe",null),$([Cs(Ar.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[On,String,Boolean]),A("design:returntype",W)],un.prototype,"unsubscribe",null),$([Cs(Ar.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[On,String]),A("design:returntype",W)],un.prototype,"muteRemote",null),$([Cs(Ar.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[On,String]),A("design:returntype",W)],un.prototype,"unmuteRemote",null),$([Cs(Ar.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[On,String]),A("design:returntype",W)],un.prototype,"hasRemoteMediaWithLock",null),$([Cs(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",W)],un.prototype,"disconnectForReconnect",null),$([Cs(Ar.RECEIVE_ONLY),A("design:type",Function),A("design:paramtypes",[On,String,Number]),A("design:returntype",W)],un.prototype,"remoteMediaSsrcChanged",null);class lh{constructor(e){S(this,"store",void 0),S(this,"onStatsException",void 0),S(this,"onUploadPublishDuration",void 0),S(this,"onStatsChanged",void 0),S(this,"localStats",new Map),S(this,"remoteStats",new Map),S(this,"updateStatsInterval",void 0),S(this,"trafficStats",void 0),S(this,"trafficStatsPeerList",[]),S(this,"uplinkStats",void 0),S(this,"exceptionMonitor",void 0),S(this,"p2pChannel",void 0),S(this,"scalabilityMode",qS.L1T1),S(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new $z,this.exceptionMonitor.on("exception",(t,i,s)=>{this.onStatsException&&this.onStatsException(t,i,s)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(te.LocalAudioTrack)||jc({},TT)}getLocalVideoTrackStats(){return this.localStats.get(te.LocalVideoTrack)||jc({},vT)}getRemoteAudioTrackStats(e){const t=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(h=>h.peer_uid===a);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var s;const a=(s=this.remoteStats.get(e))===null||s===void 0?void 0:s.audioStats;a&&(i[e]=t(e,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{audioStats:l}]=a;l&&(i[c]=t(c,l))});return i}getRemoteNetworkQualityStats(e){const t={};if(e){var i;const s=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;s&&(t[e]=s)}else Array.from(this.remoteStats.entries()).forEach(s=>{let[a,{networkStats:c}]=s;c&&(t[a]=c)});return t}getRemoteVideoTrackStats(e){const t=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(h=>h.peer_uid===a);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var s;const a=(s=this.remoteStats.get(e))===null||s===void 0?void 0:s.videoStats;a&&(i[e]=t(e,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{videoStats:l}]=a;l&&(i[c]=t(c,l))});return i}getRTCStats(){let e=0,t=0,i=0,s=0;const a=this.localStats.get(te.LocalAudioTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate);const c=this.localStats.get(te.LocalVideoTrack);c&&(e+=c.sendBytes,t+=c.sendBitrate);const l=this.localStats.get(te.LocalVideoLowTrack);l&&(e+=l.sendBytes,t+=l.sendBitrate),this.remoteStats.forEach(p=>{let{audioStats:f,videoStats:_}=p;f&&(i+=f.receiveBytes,s+=f.receiveBitrate),_&&(i+=_.receiveBytes,s+=_.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:t,SendBytes:e,RecvBytes:i,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(t=>t.B_ppad!==void 0||t.B_ppvd!==void 0),e.peer_delay.filter(t=>this.trafficStatsPeerList.indexOf(t.peer_uid)===-1).forEach(t=>{var i;const s=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(t.peer_uid),a=s!=null&&s.videoSSRC?Fn.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,c=s!=null&&s.audioSSRC?Fn.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;t.B_ppad!==void 0&&t.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(t.peer_uid,t.B_ppad,t.B_ppvd,a>c?a:c),this.trafficStatsPeerList.push(t.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&v.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,i){if(!e)return!1;const s=!!i&&t.framesDecodeFreezeTime>i.framesDecodeFreezeTime,a=!i||t.framesDecodeCount>i.framesDecodeCount;return s||!a}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(t=>{let[i,s]=t;switch(i){case te.LocalVideoTrack:case te.LocalVideoLowTrack:{const c=s,l=jc({},vT),h=e.getStats(),p=e.getLocalMedia(i);if(h){const f=h.videoSend.find(_=>_.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(f){const _=e.getLocalVideoSize(),g=e.getEncoderConfig(te.LocalVideoTrack);f.codec!=="H264"&&f.codec!=="H265"&&f.codec!=="VP8"&&f.codec!=="VP9"&&f.codec!=="AV1X"&&f.codec!=="AV1"||(l.codecType=f.codec),l.sendBytes=f.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,f.inputFrame?(l.captureFrameRate=f.inputFrame.frameRate,l.captureResolutionHeight=f.inputFrame.height,l.captureResolutionWidth=f.inputFrame.width):_&&(l.captureResolutionWidth=_.width,l.captureResolutionHeight=_.height),f.sentFrame?(l.sendFrameRate=f.sentFrame.frameRate,l.sendResolutionHeight=f.sentFrame.height,l.sendResolutionWidth=f.sentFrame.width):_&&(l.sendResolutionWidth=_.width,l.sendResolutionHeight=_.height),f.avgEncodeMs&&(l.encodeDelay=f.avgEncodeMs),g&&g.bitrateMax&&(l.targetSendBitrate=1e3*g.bitrateMax),l.sendPackets=f.packets,l.sendPacketsLost=f.packetsLost,l.sendJitterMs=f.jitterMs,l.sendRttMs=f.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(f)&&(l.totalFreezeTime+=1),f.scalabilityMode&&this.scalabilityMode!==f.scalabilityMode&&(v.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(f.scalabilityMode)),this.scalabilityMode=f.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var a;this.localStats.set(i,l),((c==null?void 0:c.sendResolutionWidth)!==l.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==l.sendResolutionHeight)&&((a=this.onStatsChanged)===null||a===void 0||a.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,l);break}case te.LocalAudioTrack:{const c=s,l=jc({},TT),h=e.getStats(),p=e.getLocalMedia(i);if(h){const f=h.audioSend.find(_=>_.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(f){if(f.codec!=="opus"&&f.codec!=="aac"&&f.codec!=="PCMU"&&f.codec!=="PCMA"&&f.codec!=="G722"||(l.codecType=f.codec),f.inputLevel)l.sendVolumeLevel=Math.round(32767*f.inputLevel);else{const _=e.getLocalAudioVolume();_&&(l.sendVolumeLevel=Math.round(32767*_))}l.sendBytes=f.bytes,l.sendPackets=f.packets,l.sendPacketsLost=f.packetsLost,l.sendJitterMs=f.jitterMs,l.sendRttMs=f.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(te.LocalAudioTrack,l),l&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,l);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(t=>{var i,s;let[a,{videoStats:c,audioStats:l,videoPcStats:h}]=t;const p=l,f=c,_=h,g=jc({},WN),T=jc({},HN),w=jc({},$6),{audioTrack:R,videoTrack:I,audioSSRC:N,videoSSRC:D}=e.getRemoteMedia(a);let V;V=e instanceof un?e.getStats(!0):e.getStats();const G=(i=V)===null||i===void 0?void 0:i.audioRecv.find(z=>z.ssrc===N),F=(s=V)===null||s===void 0?void 0:s.videoRecv.find(z=>z.ssrc===D),j=this.trafficStats&&this.trafficStats.peer_delay.find(z=>z.peer_uid===a);if(G&&(G.codec!=="opus"&&G.codec!=="aac"&&G.codec!=="PCMU"&&G.codec!=="PCMA"&&G.codec!=="G722"||(g.codecType=G.codec),G.outputLevel?g.receiveLevel=Math.round(32767*G.outputLevel):R&&(g.receiveLevel=Math.round(32767*R.getVolumeLevel())),g.receiveBytes=G.bytes,g.receivePackets=G.packets,g.receivePacketsLost=G.packetsLost,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost),g.receiveBitrate=p?8*Math.max(0,g.receiveBytes-p.receiveBytes):0,g.totalDuration=p?p.totalDuration+1:1,g.totalFreezeTime=p?p.totalFreezeTime:0,g.freezeRate=g.totalFreezeTime/g.totalDuration,g.receiveDelay=G.jitterBufferMs,g.totalDuration>10&&lh.isRemoteAudioFreeze(R)&&(g.totalFreezeTime+=1)),F){F.codec!=="H264"&&F.codec!=="H265"&&F.codec!=="VP8"&&F.codec!=="VP9"&&F.codec!=="AV1X"&&F.codec!=="AV1"||(T.codecType=F.codec),T.receiveBytes=F.bytes,T.receiveBitrate=f?8*Math.max(0,T.receiveBytes-f.receiveBytes):0,T.decodeFrameRate=F.decodeFrameRate<0?0:F.decodeFrameRate,T.renderFrameRate=F.decodeFrameRate<0?0:F.decodeFrameRate,F.outputFrame&&(T.renderFrameRate=F.outputFrame.frameRate),F.receivedFrame?(T.receiveFrameRate=F.receivedFrame.frameRate,T.receiveResolutionHeight=F.receivedFrame.height,T.receiveResolutionWidth=F.receivedFrame.width):I&&(T.receiveResolutionHeight=I._videoHeight||0,T.receiveResolutionWidth=I._videoWidth||0),F.framesRateFirefox!==void 0&&(T.receiveFrameRate=Math.round(F.framesRateFirefox)),T.receivePackets=F.packets,T.receivePacketsLost=F.packetsLost,T.packetLossRate=T.receivePacketsLost/(T.receivePackets+T.receivePacketsLost),T.totalDuration=f?f.totalDuration+1:1,T.totalFreezeTime=f?f.totalFreezeTime:0,T.receiveDelay=F.jitterBufferMs||0;const z=!!D&&e.getRemoteVideoIsReady(D);I&&z&&lh.isRemoteVideoFreeze(I,F,_)&&(T.totalFreezeTime+=1),T.freezeRate=T.totalFreezeTime/T.totalDuration}j&&(g.end2EndDelay=j.B_ad,T.end2EndDelay=j.B_vd,g.transportDelay=j.B_ed,T.transportDelay=j.B_ed,g.currentPacketLossRate=j.B_ealr4/100,T.currentPacketLossRate=j.B_evlr4/100,w.uplinkNetworkQuality=j.B_punq?j.B_punq:0,w.downlinkNetworkQuality=j.B_pdnq?j.B_pdnq:0),this.remoteStats.set(a,{audioStats:g,videoStats:T,videoPcStats:F,networkStats:w}),R&&this.exceptionMonitor.setRemoteAudioStats(R,g),I&&this.exceptionMonitor.setRemoteVideoStats(I,T)})}}function xk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function uh(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?xk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):xk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class gY extends At{constructor(e,t,i,s){super(),S(this,"spec",void 0),S(this,"token",void 0),S(this,"websocket",void 0),S(this,"pingpongTimer",void 0),S(this,"reconnectMode","retry"),S(this,"serviceMode",void 0),S(this,"reqId",0),S(this,"commandReqId",0),S(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),S(this,"handleWebSocketMessage",a=>{if(!a.data)return;const c=JSON.parse(a.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):this.serviceMode===dn.INJECT?this.emit(Gr.INJECT_STREAM_STATUS,c):(Te.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===dn.TRANSCODE?1:2}),this.emit(Gr.PUBLISH_STREAM_STATUS,c))}),this.spec=t,this.token=e,this.serviceMode=s,this.websocket=new Pu("live-streaming",i),this.websocket.on(Ne.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ne.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ne.REQUEST_NEW_URLS,(a,c)=>{Xt(this,Gr.REQUEST_NEW_ADDRESS).then(a).catch(c)}),this.websocket.on(Ne.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,i,s){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const a=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new B(O.UNEXPECTED_ERROR);const l=uh({command:e,sdkVersion:Tr==="4.20.2"?"0.0.1":Tr,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if(this.websocket.state==="closed")throw new B(O.WS_DISCONNECT);const h=()=>new W((g,T)=>{this.websocket.once(Ne.CLOSED,()=>T(new B(O.WS_ABORT))),this.websocket.once(Ne.CONNECTED,g)});this.websocket.state!=="connected"&&await h(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const p=new W((g,T)=>{const w=()=>{T(new B(O.WS_ABORT))};this.websocket.once(Ne.RECONNECTING,w),this.websocket.once(Ne.CLOSED,w),this.once("@".concat(c,"-").concat(this.spec.sid),R=>{g(R)})});s&&Te.workerEvent(this.spec.sid,uh(uh({},s),{},{requestId:a,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const f=Date.now();this.websocket.sendMessage(l);let _=null;try{_=await p}catch(g){if(this.websocket.state==="closed")throw g;return await h(),await this.request(e,t,i)}return s&&Te.workerEvent(this.spec.sid,uh(uh({},s),{},{requestId:a,actionType:"response",payload:JSON.stringify(_.serverResponse),serverCode:_.code,success:_.code===200,responseTime:Date.now()-f})),_.code!==200&&this.handleResponseError(_),_}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=Tr==="4.20.2"?"0.0.1":Tr;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case zt.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void v.warning("live stream response already exists stream");case zt.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case zt.LIVE_STREAM_RESPONSE_BAD_STREAM:case zt.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new B(O.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case zt.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream"||e.serverResponse.command==="UninjectStream")return;throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case zt.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new B(O.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case zt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new B(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Gr.WARNING,t,e.serverResponse.url)}case zt.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new B(O.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Gr.WARNING,t,e.serverResponse.url)}case zt.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case zt.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new B(O.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case zt.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new B(O.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Gr.WARNING,t,e.serverResponse.url)}case zt.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case zt.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case zt.LIVE_STREAM_RESPONSE_WORKER_LOST:case zt.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream"||e.serverResponse.command==="UninjectStream")return;throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case zt.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream"||e.serverResponse.command==="UninjectStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case zt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case zt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case zt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case zt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new B(O.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Ef)},6e3)}}function Vk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function _i(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Vk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Vk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class SY extends At{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$t,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:$t;super(),S(this,"onLiveStreamWarning",void 0),S(this,"onLiveStreamError",void 0),S(this,"onInjectStatusChange",void 0),S(this,"spec",void 0),S(this,"retryTimeout",1e4),S(this,"connection",void 0),S(this,"httpRetryConfig",void 0),S(this,"wsRetryConfig",void 0),S(this,"streamingTasks",new Map),S(this,"isStartingStreamingTask",!1),S(this,"taskMutex",new Tn("live-streaming")),S(this,"cancelToken",vi.CancelToken.source()),S(this,"transcodingConfig",void 0),S(this,"injectConfig",_i({},m6)),S(this,"injectLoopTimes",0),S(this,"uapResponse",void 0),S(this,"lastTaskId",1),S(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=_i(_i({},f6),e);t.videoCodecProfile!==66&&t.videoCodecProfile!==77&&t.videoCodecProfile!==100&&(v.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map(c=>_i(_i(_i({},p6),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){Lt(c.width)||pt(c.width,"config.width",0,1e4),Lt(c.height)||pt(c.height,"config.height",0,1e4),Lt(c.videoBitrate)||pt(c.videoBitrate,"config.videoBitrate",1,1e6),Lt(c.videoFrameRate)||pt(c.videoFrameRate,"config.videoFrameRate"),Lt(c.lowLatency)||Eo(c.lowLatency,"config.lowLatency"),Lt(c.audioSampleRate)||an(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Lt(c.audioBitrate)||pt(c.audioBitrate,"config.audioBitrate",1,128),Lt(c.audioChannels)||an(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),Lt(c.videoGop)||pt(c.videoGop,"config.videoGop"),Lt(c.videoCodecProfile)||an(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Lt(c.userCount)||pt(c.userCount,"config.userCount",0,17),Lt(c.backgroundColor)||pt(c.backgroundColor,"config.backgroundColor",0,16777215),Lt(c.userConfigExtraInfo)||Un(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!Lt(c.transcodingUsers)&&(go(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,h)=>{QS(l.uid),Lt(l.x)||pt(l.x,"transcodingUser[".concat(h,"].x"),0,1e4),Lt(l.y)||pt(l.y,"transcodingUser[".concat(h,"].y"),0,1e4),Lt(l.width)||pt(l.width,"transcodingUser[".concat(h,"].width"),0,1e4),Lt(l.height)||pt(l.height,"transcodingUser[".concat(h,"].height"),0,1e4),Lt(l.zOrder)||pt(l.zOrder-1,"transcodingUser[".concat(h,"].zOrder"),0,100),Lt(l.alpha)||pt(l.alpha,"transcodingUser[".concat(h,"].alpha"),0,1,!1)})),Lt(c.watermark)||ZS(c.watermark,"watermark"),Lt(c.backgroundImage)||ZS(c.backgroundImage,"backgroundImage"),c.images&&!Lt(c.images)&&(go(c.images,"config.images"),c.images.forEach((l,h)=>{ZS(l,"images[".concat(h,"]"))}))}(t);const i=[];t.images&&i.push(...t.images.map(c=>_i(_i(_i({},$S),c),{},{zOrder:255}))),t.backgroundImage&&(i.push(_i(_i(_i({},$S),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(i.push(_i(_i(_i({},$S),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=i,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map(c=>_i({},c)),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const s=(t.userConfigs||[]).map(c=>typeof c.uid=="number"?W.resolve(c.uid):UN(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await W.all(s)).forEach((c,l)=>{t.userConfigs&&t.userConfigs[l]&&(t.userConfigs[l].uid=c)}),this.transcodingConfig=t,this.connection)try{var a;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Es(a=this.streamingTasks).call(a)).map(l=>l.taskId).join("#")});v.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{v.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{v.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(h=>{v.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,h.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,h)})})}}setInjectStreamConfig(e,t){this.injectConfig=Object.assign({},this.injectConfig,e),this.injectLoopTimes=t}async startLiveStreamingTask(e,t,i){var s;if(Array.from(Es(s=this.streamingTasks).call(s)).find(h=>h.mode===dn.INJECT)&&t===dn.INJECT)return new B(O.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&t===dn.TRANSCODE)throw new B(O.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let a={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};v.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const c=await this.taskMutex.lock();if(!this.connection&&i)return void c();if(this.streamingTasks.get(e)&&!i)return c(),new B(O.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(h){throw c(),h}switch(t){case dn.TRANSCODE:a.transcodingConfig=_i({},this.transcodingConfig);break;case dn.RAW:break;case dn.INJECT:a={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:e,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(a.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const l=this.lastTaskId++;try{const h=new W((f,_)=>{Sn(this.retryTimeout).then(()=>{if(i)return _(i);const g=this.statusError.get(e);return g?(this.statusError.delete(e),_(g)):void 0})}),p=await W.race([this.connection.request("request",{clientRequest:a},!0,{url:e,command:"PublishStream",workerType:t===dn.TRANSCODE?1:2,requestByUser:!i,tid:l.toString()}),h]);this.isStartingStreamingTask=!1,v.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(p.code)),this.streamingTasks.set(e,{clientRequest:a,mode:t,url:e,taskId:l}),c()}catch(h){if(c(),this.isStartingStreamingTask=!1,!h.data||!h.data.retry||i)throw h;return h.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,h)):await this.startLiveStreamingTask(e,t,h)}}stopLiveStreamingTask(e){return new W((t,i)=>{const s=this.streamingTasks.get(e);if(!s||!this.connection)return new B(O.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const a=s.mode;s.abortTask=()=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:a===dn.INJECT?"UninjectStream":"UnpublishStream",url:s.url}},!1,{url:e,command:"UnPublishStream",workerType:a===dn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&a!==dn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),t(),a===dn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(da.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,e)}).catch(i)})}async controlInjectStream(e,t,i,s){const a=this.streamingTasks.get(e);if(!a||!this.connection||a.mode!==dn.INJECT)throw new B(O.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:t,audioVolume:i,position:s}})).serverResponse}resetAllTask(){var e;const t=Array.from(Es(e=this.streamingTasks).call(e));this.terminate();for(const i of t)this.startLiveStreamingTask(i.url,i.mode).catch(s=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,s)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=vi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new B(O.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await Xt(this,xd.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new gY(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Gr.WARNING,(i,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,i)),this.connection.on(Gr.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Gr.INJECT_STREAM_STATUS,i=>this.handleInjectStreamServerStatus(i)),this.connection.on(Gr.REQUEST_NEW_ADDRESS,(i,s)=>{if(!this.connection)return s(new B(O.UNEXPECTED_ERROR,"can not get new live streaming address list"));Xt(this,xd.REQUEST_WORKER_MANAGER_LIST,e).then(a=>{this.uapResponse=a,i(a.addressList)}).catch(s)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(t),s=e.reason;switch(e.code){case zt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case zt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case zt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case zt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new B(O.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return v.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,c);if(!this.isStartingStreamingTask)return;this.statusError.set(t,c)}case zt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new B(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,c)}case zt.LIVE_STREAM_RESPONSE_WORKER_LOST:case zt.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(Es(a=this.streamingTasks).call(a));for(const l of c)l.abortTask?l.abortTask():(v.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{v.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(h=>{v.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,h)}));return}}}handleInjectStreamServerStatus(e){const t=Number(e.uid),i=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(da.INJECT_STREAM_STATUS_START_SUCCESS,t,i));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(da.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,t,i),void this.streamingTasks.delete(i);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(da.INJECT_STREAM_STATUS_START_UNAUTHORIZED,t,i),void this.streamingTasks.delete(i);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(da.INJECT_STREAM_STATUS_BROKEN,t,i),void this.streamingTasks.delete(i);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(da.INJECT_STREAM_STATUS_START_TIMEOUT,t,i),void this.streamingTasks.delete(i);default:return void v.debug("inject stream server status",e)}}hasUrl(e){return this.streamingTasks.has(e)}}class Om{constructor(){S(this,"destChannelMediaInfos",new Map),S(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){iN(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){iN(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){XS(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Fk(n){if(!(n instanceof Om))return new B(O.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=n.getSrcChannelMediaInfo(),t=n.getDestChannelMediaInfo();if(!e)return new B(O.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(t.size===0)return new B(O.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class TY extends At{constructor(e,t,i){super(),S(this,"ws",void 0),S(this,"requestId",1),S(this,"heartBeatTimer",void 0),S(this,"joinInfo",void 0),S(this,"clientId",void 0),S(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),S(this,"onClose",s=>{this.emit("close"),this.dispose()}),S(this,"onMessage",s=>{const a=JSON.parse(s.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=e,this.clientId=t,this.ws=new Pu("cross-channel-".concat(this.clientId),i),this.ws.on(Ne.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ne.CONNECTED,this.onOpen),this.ws.on(Ne.ON_MESSAGE,this.onMessage),this.ws.on(Ne.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new W((t,i)=>{const s=window.setTimeout(()=>{i(new B(O.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,a=>{window.clearTimeout(s),a.state&&a.state!==0?i(new B(O.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),i(new B(O.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new B(O.WS_DISCONNECT);const t=()=>new W((c,l)=>{this.ws.once(Ne.CLOSED,()=>l(new B(O.WS_ABORT))),this.ws.once(Ne.CONNECTED,c)});this.ws.state!=="connected"&&await t();const i=this.sendMessage(e),s=new W((c,l)=>{const h=()=>{l(new B(O.WS_ABORT))};this.ws.once(Ne.RECONNECTING,h),this.ws.once(Ne.CLOSED,h),this.once("req_".concat(i),c),Sn(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Ne.RECONNECTING,h),this.ws.off(Ne.CLOSED,h),l(new B(O.TIMEOUT,"cross channel ws request timeout"))})}),a=await s;if(!a||a.code!==200)throw new B(O.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(e){this.ws.removeAllListeners(Ne.REQUEST_NEW_URLS),this.ws.on(Ne.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class vY extends At{set state(e){e!==this._state&&(e!==li.RELAY_STATE_FAILURE&&(this.errorCode=la.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,i,s,a){super(),S(this,"joinInfo",void 0),S(this,"sid",void 0),S(this,"clientId",void 0),S(this,"cancelToken",vi.CancelToken.source()),S(this,"workerToken",void 0),S(this,"requestId",0),S(this,"signal",void 0),S(this,"prevChannelMediaConfig",void 0),S(this,"httpRetryConfig",void 0),S(this,"_resolution",void 0),S(this,"_state",li.RELAY_STATE_IDLE),S(this,"errorCode",la.RELAY_OK),S(this,"onStatus",c=>{v.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",gs.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",gs.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=la.SRC_TOKEN_EXPIRED,this.state=li.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=la.DEST_TOKEN_EXPIRED,this.state=li.RELAY_STATE_FAILURE))}),S(this,"onReconnect",async()=>{v.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",gs.NETWORK_DISCONNECTED),this.state=li.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==li.RELAY_STATE_IDLE&&(v.error("auto restart channel media relay failed",c.toString()),this.errorCode=la.SERVER_CONNECTION_LOST,this.state=li.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=CS(),this.signal=new TY(this.joinInfo,this.clientId,i),this.httpRetryConfig=s,this._resolution=a}async startChannelMediaRelay(e){if(this.state!==li.RELAY_STATE_IDLE)throw new B(O.INVALID_OPERATION);this.state=li.RELAY_STATE_CONNECTING,await this.connect(),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(t){throw t.data&&t.data.serverResponse&&t.data.serverResponse.command==="SetSourceChannel"?new B(O.CROSS_CHANNEL_FAILED_JOIN_SRC):t.data&&t.data.serverResponse&&t.serverResponse.command==="SetDestChannelStatus"?new B(O.CROSS_CHANNEL_FAILED_JOIN_DEST):t.data&&t.data.serverResponse&&t.serverResponse.command==="StartPacketTransfer"?new B(O.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):t}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==li.RELAY_STATE_RUNNING)throw new B(O.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==li.RELAY_STATE_RUNNING)throw new B(O.INVALID_OPERATION);const t=this.genMessage(Jn.SetVideoProfile);await this.signal.request(t),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),v.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=li.RELAY_STATE_IDLE,this.dispose()}dispose(){v.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=vi.CancelToken.source(),this.state=li.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await K6(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",gs.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage(Jn.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Jn.SetSdkProfile,e);await this.signal.request(i),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(Jn.SetSourceChannel,e);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",gs.PACKET_JOINED_SRC_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(Jn.SetSourceUserId,e);await this.signal.request(a),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(Jn.SetDestChannel,e);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",gs.PACKET_JOINED_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(Jn.StartPacketTransfer,e);await this.signal.request(l),this.emit("event",gs.PACKET_SENT_TO_DEST_CHANNEL),this.state=li.RELAY_STATE_RUNNING,v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage(Jn.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",gs.PACKET_UPDATE_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(Jn.StopPacketTransfer);await this.signal.request(e),v.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const i=[],s=[],a=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Tr,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.20.2"&&(c.sdkVersion="0.0.1");let l=null,h=null;switch(e){case Jn.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case Jn.SetSourceChannel:if(h=t&&t.getSrcChannelMediaInfo(),!h)throw new B(O.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:h.channelName,token:h.token||this.joinInfo.appId},c;case Jn.SetSourceUserId:if(h=t&&t.getSrcChannelMediaInfo(),!h)throw new B(O.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:h.uid+""},c;case Jn.SetDestChannel:if(l=t&&t.getDestChannelMediaInfo(),!l)throw new B(O.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(p=>{i.push(p.channelName),s.push(p.uid+""),a.push(p.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:s,token:a},c;case Jn.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case Jn.Reconnect:return c.clientRequest={command:"Reconnect"},c;case Jn.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case Jn.UpdateDestChannel:if(l=t&&t.getDestChannelMediaInfo(),!l)throw new B(O.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(p=>{i.push(p.channelName),s.push(p.uid+""),a.push(p.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:s,token:a},c;case Jn.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}function bm(n){var e={},t=!1;function i(s,a){return t=!0,{done:!1,value:new Pv(a=new Dv(function(c){c(n[s](a))}),1)}}return e[Sd!==void 0&&EA||"@@iterator"]=function(){return this},e.next=function(s){return t?(t=!1,s):i("next",s)},typeof n.throw=="function"&&(e.throw=function(s){if(t)throw t=!1,s;return i("throw",s)}),typeof n.return=="function"&&(e.return=function(s){return t?(t=!1,s):i("return",s)}),e}var Bk=m(lk);function jk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Gk(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?jk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):jk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function Wk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Hk(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Wk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Wk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class Rn extends Mf{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return fe(t=Object.keys(aa)).call(t,e)}))]}constructor(e,t){super(e,t),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"statsFilter",void 0),S(this,"useRTX",!1),S(this,"localCapabilities",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"establishPromise",void 0),S(this,"mutex",new Tn("P2PConnection-mutex")),this.store=t,this.peerConnection=new RTCPeerConnection(Rn.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=Cm(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,mt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=ys(e.sdp),i=ah(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:L("FILTER_VIDEO_FEC"),filterAudioFec:L("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,Hk(Hk({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new Q(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,i,s,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(h){S(this,"sessionDesc",void 0),S(this,"localCapabilities",void 0),S(this,"rtpCapabilities",void 0),S(this,"candidates",void 0),S(this,"iceParameters",void 0),S(this,"dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),h=St(h);const{remoteIceParameters:p,remoteDtlsParameters:f,candidates:_,remoteRTPCapabilities:g,remoteSetup:T,localCapabilities:w,sdkCodec:R,cname:I}=h,N=Ot.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=g,this.candidates=_,this.iceParameters=p,this.dtlsParameters=f,this.setup=T,this.localCapabilities=w,this.cname=I;for(let D=0;D<N.mediaDescriptions.length;D++){const V=N.mediaDescriptions[D];if(V.attributes.iceUfrag=p.iceUfrag,V.attributes.icePwd=p.icePwd,V.attributes.fingerprints=f.fingerprints,V.attributes.candidates=_,V.attributes.setup=T,V.media.mediaType==="video"){V.media.fmts=g.videoCodecs.map(F=>F.payloadType.toString(10));let G=g.videoCodecs.filter(F=>{var j,z;return(j=F.rtpMap)===null||j===void 0?void 0:fe(z=j.encodingName.toLowerCase()).call(z,R)});G.length===0&&(G=g.videoCodecs),V.attributes.payloads=G,V.attributes.extmaps=g.videoExtensions}V.media.mediaType==="audio"&&(V.media.fmts=g.audioCodecs.map(G=>G.payloadType.toString(10)),V.attributes.payloads=g.audioCodecs,V.attributes.extmaps=g.audioExtensions),N.mediaDescriptions[D]=this.mungMediaDesc(V)}this.sessionDesc=N,this.currentMidIndex=N.mediaDescriptions.length-1}toString(){return Ot.print(this.sessionDesc)}send(h,p,f){const{ssrcs:_,ssrcGroups:g}=Ii(p,this.cname),T=this.sessionDesc.mediaDescriptions.find(I=>h===Ee.VIDEO?I.media.mediaType==="video":I.media.mediaType==="audio"),w=_[0].attributes.label,R=_[0].attributes.mslabel;return T.attributes.ssrcs=T.attributes.ssrcs.concat(_),T.attributes.ssrcGroups=T.attributes.ssrcGroups.concat(g),{id:w,mslabel:R}}batchSend(h){return h.map(p=>{let{kind:f,ssrcMsg:_}=p;return this.send(f,_,void 0)})}stopSending(h){this.sessionDesc.mediaDescriptions.forEach(p=>{const f=[],_=[],g=[];p.attributes.ssrcs.forEach(T=>{fe(h).call(h,T.attributes.label||"")?g.push(T):f.push(T)}),p.attributes.ssrcGroups.forEach(T=>{var w;fe(w=g.map(R=>R.ssrcId)).call(w,T.ssrcIds[0])||_.push(T)}),p.attributes.ssrcs=f,p.attributes.ssrcGroups=_})}mute(h){const p=this.sessionDesc.mediaDescriptions.find(f=>f.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(h){const p=this.sessionDesc.mediaDescriptions.find(f=>f.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}receive(h,p,f){h.forEach((_,g)=>{const T=_._mediaStreamTrack,w=this.sessionDesc.mediaDescriptions.findIndex(I=>I.attributes.mid===T.kind),R=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],_);this.sessionDesc.mediaDescriptions[w]=R})}stopReceiving(h){}updateCandidates(h){h===xn.TCP?this.candidates.forEach(p=>{this.candidates.findIndex(f=>f.transport==="tcp"&&f.connectionAddress===p.connectionAddress&&f.port===p.port)===-1&&this.candidates.push(Gk(Gk({},p),{},{foundation:"tcpcandidate",priority:Number(p.priority)-1+"",transport:"tcp",port:Number(p.port)+90+""}))}):this.candidates=this.candidates.filter(p=>p.transport!=="tcp");for(const p of this.sessionDesc.mediaDescriptions)p.attributes.candidates=this.candidates}restartICE(h){h=St(h),this.iceParameters=h,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=h.iceUfrag,p.attributes.icePwd=h.icePwd})}predictReceivingMids(h){const p=[];for(let f=0;f<h;f++)p.push((this.currentMidIndex+f+1).toString(10));return p}mungRecvMediaDsec(h,p){const f=St(h);return Aa(f,p),wm(f,p),f}updateRecvMedia(h,p){const f=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===h);if(f!==-1){const _=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],p);this.sessionDesc.mediaDescriptions[f]=_}}bumpMid(h){this.currentMidIndex+=h}updateTrackLabel(h,p,f){const _=this.sessionDesc.mediaDescriptions.find(T=>h===Ee.VIDEO?T.attributes.mid==="video":T.attributes.mid==="audio");if(_){const T=_.attributes.ssrcs.find(w=>w.attributes.label===p);var g;T&&(T.attributes.label=f,(g=T.attributes.msid)===null||g===void 0||g.replace(p,f))}}mungMediaDesc(h){const p=St(h);return Im(p),function(f){const _=f.attributes.extmaps.find(g=>g.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");_&&f.attributes.extmaps.splice(f.attributes.extmaps.indexOf(_),1),f.attributes.payloads.forEach(g=>{const T=g.rtcpFeedbacks.findIndex(w=>w.type==="transport-cc");T!==-1&&g.rtcpFeedbacks.splice(T,1)})}(p),p}getSSRC(h){for(const p of this.sessionDesc.mediaDescriptions)for(const f of p.attributes.ssrcs)if(f.attributes.label===h)return[f]}}({remoteIceParameters:e,remoteDtlsParameters:t,candidates:i,remoteRTPCapabilities:s.send,remoteSetup:a,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:c});const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new Q(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(e,t){var i=this;return Bi(function*(){const s=yield Be(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=e.map(g=>i.peerConnection.addTrack(g._mediaStreamTrack)),c=yield Be(i.peerConnection.createOffer()),l=Ot.parse(c.sdp),h=e.map(g=>{const T=g._mediaStreamTrack,w=l.mediaDescriptions.find(R=>R.attributes.mid===T.kind);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return function(R,I,N){const D=R.attributes.ssrcs.filter(G=>G.attributes.label===I),V=R.attributes.ssrcGroups;if(D.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(V&&D.length>1){const G=V.find(F=>F.ssrcIds.indexOf(D[0].ssrcId)!==-1);return G?[{ssrcId:G.ssrcIds[0],rtx:N?G.ssrcIds[1]:void 0}]:[{ssrcId:D[0].ssrcId}]}return[{ssrcId:D[0].ssrcId}]}(w,T.id,i.useRTX)});let p;try{p=yield h}catch(g){throw a.forEach(T=>{wn()&&T.replaceTrack(null),i.peerConnection.removeTrack(T)}),g}const f=i.mungSendOfferSDP(c.sdp,e);i.remoteSDP.receive(e,t,p);const _=i.remoteSDP.toString();return yield Be(i.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Be(i.applySendEncodings(a,e)),yield Be(i.peerConnection.setRemoteDescription({type:"answer",sdp:_})),e.map((g,T)=>{const w=g._mediaStreamTrack.id;return{localSSRC:h[T],id:w}})}catch(a){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{s()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter(a=>{var c;return e.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(a=>{wn()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(t.toString()))}}async receive(e,t,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:a,mslabel:c}=this.remoteSDP.send(e,t,s),l=new W((f,_)=>{const g=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(a)))},1e4),T=w=>{const R=Ze();if((R.name==="Safari"&&Number(R.version)===11||ni())&&w.track.id!==a&&w.streams[0].id===c){var I;const N=w.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(e,a,w.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(g),void f(N)}if(w.track.id===a)return this.peerConnection.removeEventListener("track",T),clearTimeout(g),void f(w.track)};this.peerConnection.addEventListener("track",T)}),h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await l,id:a}}catch(a){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(i=>{var s;return e.indexOf(((s=i.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map(i=>{if(wn()&&i.track)i.track.enabled=!1;else{const s=i.getParameters();s.encodings.forEach(a=>a.active=!1),i.setParameters(s)}})}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(a=>{var c;return e.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map(async a=>{if(wn()&&a.track)a.track.enabled=!0;else{const c=a.getParameters();c.encodings.forEach(l=>l.active=!0),await a.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return Bi(function*(){const i=yield Be(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(et().supportPCSetConfiguration){const h=t.peerConnection.getConfiguration(),p=e===xn.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(v.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,t.peerConnection.setConfiguration(h))}else if(e===xn.RELAY)return;e!==xn.RELAY&&t.remoteSDP.updateCandidates(e);const s=yield Be(t.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=ys(s.sdp),{remoteIceParameters:c}=yield a.iceParameters;t.remoteSDP.restartICE(c);const l=t.remoteSDP.toString();yield Be(t.peerConnection.setLocalDescription(s)),yield Be(t.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(s){v.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new Q(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,t){const i=this.peerConnection.getSenders().filter(s=>{var a;return((a=s.track)===null||a===void 0?void 0:a.id)===e});i.length===1&&await this.applySendEncodings(i,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const i=this.peerConnection.getSenders().find(s=>{var a;return((a=s.track)===null||a===void 0?void 0:a.id)===t});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new Q(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new Q(O.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},L("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const t={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Od(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...Rn.turnServerConfigToIceServers(e.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...Rn.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(t.iceTransportPolicy="relay")}))),t}static turnServerConfigToIceServers(e){const t=[];return e.forEach(i=>{i.security?i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),t}async updateRtpSenderEncodings(e,t){var i;if(t||(t=this.peerConnection.getSenders().find(p=>{var f;return((f=p.track)===null||f===void 0?void 0:f.id)===e._mediaStreamTrack.id})),!t)return v.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!et().supportSetRtpSenderParameters)return v.warn("Browser not support set rtp-sender parameters");const s={},a={};if(e instanceof Ge)switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(L("DSCP_TYPE")&&ra()){var c;const p=L("DSCP_TYPE");fe(c=["very-low","low","medium","high"]).call(c,p)&&(a.networkPriority=p)}const l=t.getParameters(),h=(i=l.encodings)===null||i===void 0?void 0:i[0];h&&Object.assign(h,a),Object.assign(l,s),v.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await t.setParameters(l)}async applySendEncodings(e,t){try{if(!et().supportSetRtpSenderParameters||e.length!==t.length)return;for(let i=0;i<e.length;i++){const s=e[i],a=t[i];s&&a&&await this.updateRtpSenderEncodings(a,s)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const i=Ot.parse(e);return t.forEach((s,a)=>{const c=s._mediaStreamTrack,l=i.mediaDescriptions.find(h=>h.attributes.mid===c.kind);l&&Aa(l,s)}),Ot.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,e,t,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map((a,c)=>{let{id:l,mslabel:h}=a;const{kind:p}=e[c];return new W((f,_)=>{const g=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(l)))},1e4),T=w=>{const R=Ze();if(R.name==="Safari"&&Number(R.version)===11&&w.track.id!==l&&w.streams[0].id===h){var I;const N=w.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(p,l,w.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(g),void f({track:N,id:l})}if(w.track.id===l)return this.peerConnection.removeEventListener("track",T),clearTimeout(g),void f({track:w.track,id:l})};this.peerConnection.addEventListener("track",T)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await W.all(t)}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t==null?void 0:t[0].ssrcId}setConfiguration(e){if(et().supportPCSetConfiguration){const t=Rn.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}function Or(n,e,t){const i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){const s=this.mutex,a=await s.lock("Locking from P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await i.apply(this,l)}finally{a()}},t}function Kk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Na(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Kk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Kk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}$([Or,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",W)],Rn.prototype,"connect",null),$([Or,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Rn.prototype,"stopSending",null),$([Or,A("design:type",Function),A("design:paramtypes",[String,Array,String,Object]),A("design:returntype",W)],Rn.prototype,"receive",null),$([Or,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Rn.prototype,"stopReceiving",null),$([Or,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],Rn.prototype,"muteRemote",null),$([Or,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],Rn.prototype,"unmuteRemote",null),$([Or,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Rn.prototype,"muteLocal",null),$([Or,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Rn.prototype,"unmuteLocal",null),$([Or,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Rn.prototype,"close",null),$([Or,A("design:type",Function),A("design:paramtypes",[String,Vn]),A("design:returntype",W)],Rn.prototype,"updateEncoderConfig",null),$([Or,A("design:type",Function),A("design:paramtypes",[String,Vn]),A("design:returntype",W)],Rn.prototype,"updateSendParameters",null),$([Or,A("design:type",Function),A("design:paramtypes",[Vn,String]),A("design:returntype",W)],Rn.prototype,"replaceTrack",null),$([Or,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],Rn.prototype,"getRemoteSSRC",null);const hh="9",zk=4e4;function Yk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function dl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Yk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Yk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class Ft extends Mf{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return(e=(t=this.peerConnection.getReceivers()[0])===null||t===void 0||(t=t.transport)===null||t===void 0?void 0:t.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return fe(t=Object.keys(aa)).call(t,e)}))]}constructor(e,t){super(e,t),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"transportEventReceiver",void 0),S(this,"statsFilter",void 0),S(this,"useXR",L("USE_XR")),S(this,"localCapabilities",void 0),S(this,"remoteCodecs",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"dataStreamChannelMap",new Map),S(this,"establishPromise",void 0),S(this,"recoveredDataChannelIds",[]),S(this,"currentDataChannelId",1),S(this,"mutex",new Tn("P2PConnection-mutex")),this.store=t,this.peerConnection=new RTCPeerConnection(Ft.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=Cm(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,mt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,!this.remoteSDP)return void v.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t));if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const a=this.remoteSDP.toString();s==null||s(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}else v.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=ys(e.sdp),i=await Bv({filterRTX:!L("USE_PUB_RTX")&&!L("USE_SUB_RTX"),filterVideoFec:L("FILTER_VIDEO_FEC"),filterAudioFec:L("FILTER_AUDIO_FEC"),filterVideoCodec:L("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=al(i),this.initialOffer=e,dl(dl({},t),{},{rtpCapabilities:i,offerSDP:e.sdp})}catch(e){throw new Q(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,i,s,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return St(this._localCapabilities)}get rtpCapabilities(){return St(this._rtpCapabilities)}get candidates(){return St(this._candidates)}get iceParameters(){return St(this._iceParameters)}get dtlsParameters(){return St(this._dtlsParameters)}constructor(T){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),S(this,"firefoxSsrcMidMap",new Map),T=St(T);const{remoteIceParameters:w,remoteDtlsParameters:R,candidates:I,remoteRTPCapabilities:N,remoteSetup:D,localCapabilities:V,cname:G}=T,F=Ot.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=N,this._candidates=I,this._iceParameters=w,this._dtlsParameters=R,this._localCapabilities=V,this.setup=D,this.cname=G;const j=this.rtpCapabilities.send;for(const z of F.mediaDescriptions){if(z.attributes.iceUfrag=w.iceUfrag,z.attributes.icePwd=w.icePwd,z.attributes.fingerprints=R.fingerprints,z.attributes.candidates=I,z.attributes.setup=D,z.media.mediaType==="video"&&(z.media.fmts=j.videoCodecs.map(Y=>Y.payloadType.toString(10)),z.attributes.payloads=j.videoCodecs,z.attributes.extmaps=j.videoExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Y,ssrcGroups:re}=Ii([{ssrcId:zk,rtx:L("USE_SUB_RTX")?40001:void 0}],this.cname);z.attributes.ssrcs=Y,z.attributes.ssrcGroups=re}if(z.media.mediaType==="audio"&&(z.media.fmts=j.audioCodecs.map(Y=>Y.payloadType.toString(10)),z.attributes.payloads=j.audioCodecs,z.attributes.extmaps=j.audioExtensions,Rs(z),L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Y,ssrcGroups:re}=Ii([{ssrcId:2e4}],this.cname);z.attributes.ssrcs=Y,z.attributes.ssrcGroups=re}}this.sessionDesc=F,this.currentMidIndex=F.mediaDescriptions.length-1}preloadRemoteMedia(){const T=L("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const w=this.candidates,R=this.dtlsParameters,I=this.iceParameters,N=this.rtpCapabilities.send;for(let D=1;D<T;D++){const V=2*D+2e4,G=2*D+zk,{ssrcs:F,ssrcGroups:j}=Ii([{ssrcId:V}],this.cname),{ssrcs:z,ssrcGroups:Y}=Ii([{ssrcId:G,rtx:L("USE_SUB_RTX")?G+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:hh,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.videoCodecs.map(re=>re.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:w,extmaps:N.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:z,ssrcGroups:Y,rtcpFeedbackWildcards:[],payloads:N.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*D)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:hh,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.audioCodecs.map(re=>re.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:w,extmaps:N.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:F,ssrcGroups:j,rtcpFeedbackWildcards:[],payloads:N.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*D+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Ot.print(this.sessionDesc)}send(T,w,R,I){const{ssrcs:N,ssrcGroups:D}=Ii(w,this.cname,L("SYNC_GROUP")?R:void 0),V=this.findPreloadMediaDesc(N);if(V){if(mt()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,V.attributes.mid),I&&(I.twcc||I.remb)){const G=this.sessionDesc.mediaDescriptions.indexOf(V);return this.sessionDesc.mediaDescriptions[G]=this.mungSendMediaDesc(V,I),{mid:V.attributes.mid,needExchangeSDP:!0}}return{mid:V.attributes.mid,needExchangeSDP:!1}}{const G=this.findAvailableMediaIndex(T,N);let F;return G===-1||G===1&&(wn()||BO())||G===0&&L("USE_SUB_RTX")||jO()?(F=this.createOrRecycleSendMedia(T,N,D,"sendonly",I),this.updateBundleMids()):(F=St(this.sessionDesc.mediaDescriptions[G]),F.attributes.direction="sendonly",F.attributes.ssrcs=N,F.attributes.ssrcGroups=D,this.sessionDesc.mediaDescriptions[G]=this.mungSendMediaDesc(F,I)),mt()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,F.attributes.mid),{mid:F.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:T,needExchangeSDP:w}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:T.attributes.mid,needExchangeSDP:w}}batchSend(T){const w=T.map(N=>{let{kind:D,ssrcMsg:V,mslabel:G}=N;return this.send(D,V,G)}),R=[];let I=!1;return w.forEach(N=>{let{mid:D,needExchangeSDP:V}=N;V&&(I=!0),R.push(D)}),{mids:R,needExchangeSDP:I}}stopSending(T){const w=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&T.indexOf(R.attributes.mid)!==-1);if(w.length!==T.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");w.forEach(R=>{R.attributes.mid==="0"||mt()||jO()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(T){const w=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===T);if(!w)throw new Error("mediaDescription not found with ".concat(T," in remote SDP when calling RemoteSDP.mute."));w.attributes.direction="inactive"}unmute(T){const w=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===T);if(!w)throw new Error("mediaDescription not found with ".concat(T," in remote SDP when calling RemoteSDP.unmute."));w.attributes.direction="sendonly"}muteRemote(T){const w=this.sessionDesc.mediaDescriptions.filter(R=>fe(T).call(T,R.attributes.mid||""));if(w.length!==T.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");w.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(T){const w=this.sessionDesc.mediaDescriptions.filter(R=>fe(T).call(T,R.attributes.mid||""));if(w.length!==T.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");w.forEach(R=>{R.attributes.direction="recvonly"})}receive(T,w,R,I){T.forEach((N,D)=>{this.createOrRecycleRecvMedia(N,[],"recvonly",w,R,I[D])}),this.updateBundleMids()}stopReceiving(T){const w=this.sessionDesc.mediaDescriptions.filter(R=>T.indexOf(R.attributes.mid)!==-1);if(w.length!==T.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");w.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(T){const w=this._candidates.filter(R=>R.transport==="udp");if(T===xn.TCP){if(w.length===0)return;if(L("TCP_CANDIDATE_ONLY")){const R=this._candidates.filter(I=>I.transport==="tcp");w.forEach(I=>{R.findIndex(N=>N.connectionAddress===I.connectionAddress)===-1&&R.push(Na(Na({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))}),this._candidates=R}else{const R=[];w.forEach(I=>{R.push(Na(Na({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))}),this._candidates=[...w,...R]}}else if(T===xn.RELAY){if(w.length!==0)return;{const R=this._candidates.filter(I=>I.transport==="tcp");R.forEach(I=>{w.push(Na(Na({},I),{},{foundation:"udpcandidate",priority:Number(I.priority)+1+"",transport:"udp",port:Number(I.port)-90+""}))}),this._candidates=[...w,...R]}}else w.length===0?(this._candidates.filter(R=>R.transport==="tcp").forEach(R=>{w.push(Na(Na({},R),{},{foundation:"udpcandidate",priority:Number(R.priority)+1+"",transport:"udp",port:Number(R.port)-90+""}))}),this._candidates=w):this._candidates=this._candidates.filter(R=>R.transport!=="tcp");for(const R of this.sessionDesc.mediaDescriptions)R.attributes.candidates=this.candidates}restartICE(T){T=St(T),this._iceParameters=T,this.sessionDesc.mediaDescriptions.forEach(w=>{w.attributes.iceUfrag=T.iceUfrag,w.attributes.icePwd=T.icePwd})}predictReceivingMids(T){const w=[];for(let R=0;R<T;R++)w.push((this.currentMidIndex+R+1).toString(10));return w}findAvailableMediaIndex(T,w){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const I=R.media.mediaType===T&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(mt()){if(I){const N=this.firefoxSsrcMidMap.get(w[0].ssrcId);return!(N||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!N||N!==R.attributes.mid)}return!1}return I})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const T="".concat(this.currentMidIndex),w={media:{mediaType:"application",port:hh,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(T),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(w),{mediaDesc:w,needExchangeSDP:!0}}createOrRecycleRecvMedia(T,w,R,I,N,D){const V=T._mediaStreamTrack.kind,G=this.rtpCapabilities.recv,F=Fc(V,G,this.localCapabilities.send,V===Ee.VIDEO?I:N),j=V===Ee.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const z="".concat(this.currentMidIndex);let Y={media:{mediaType:V,port:hh,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.map(ae=>ae.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:w,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:F,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(z)}};Y=this.mungRecvMediaDsec(Y,T,D);const re=this.findFirstClosedMedia(V);if(re){const ae=this.sessionDesc.mediaDescriptions.indexOf(re);this.sessionDesc.mediaDescriptions[ae]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateRemoteCodec(T,w,R){const I=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Y=>Y.rtpMap&&Y.rtpMap.encodingName.toLowerCase()||"").filter(Y=>{var re;return fe(re=Object.keys(aa)).call(re,Y)}))],N=new Set(w);if(I.every(Y=>N.has(Y)))return v.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(w)),!1;const D=this._rtpCapabilities.recv.videoCodecs.filter(Y=>w.some(re=>{var ae;return fe(ae=Y.rtpMap&&Y.rtpMap.encodingName.toLowerCase()||"").call(ae,re)}));if(D.length===0)return v.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(I," codecs: ").concat(w)),!1;const V=[...new Set(D.map(Y=>Y.rtpMap&&Y.rtpMap.encodingName.toLowerCase()||""))];let G;if(v.debug("updateRemoteCodec, from ".concat(I," to ").concat(V)),T.length===0)G=this.sessionDesc.mediaDescriptions.filter(Y=>Y.media.mediaType==="video"&&Y.attributes.direction==="recvonly");else if(G=this.sessionDesc.mediaDescriptions.filter(Y=>Y.attributes.mid&&fe(T).call(T,Y.attributes.mid)&&Y.attributes.direction==="recvonly"),G.length!==T.length)return v.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(T,", codecs: ").concat(w)),!1;this._rtpCapabilities.recv.videoCodecs=D;const F=this.localCapabilities.send,j=this.rtpCapabilities.recv,z=Fc(Ee.VIDEO,j,F,R);return G.forEach(Y=>{const re=z.map(ae=>ae.payloadType.toString(10));v.debug("updateRemoteCodec mid: ".concat(Y.attributes.mid,", from ").concat(Y.attributes.payloads," to ").concat(z)),Y.attributes.payloads=z,Y.media.fmts=re}),!0}createOrRecycleSendMedia(T,w,R,I,N){const D=this.rtpCapabilities.send,V=T===Ee.VIDEO?D.videoCodecs:D.audioCodecs,G=T===Ee.VIDEO?D.videoExtensions:D.audioExtensions;this.currentMidIndex+=1;const F="".concat(this.currentMidIndex);let j={media:{mediaType:T,port:hh,protos:["UDP","TLS","RTP","SAVPF"],fmts:V.map(Y=>Y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:G,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:w,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:V,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(F)}};j=this.mungSendMediaDesc(j,N);const z=this.findFirstClosedMedia(T);if(z){const Y=this.sessionDesc.mediaDescriptions.indexOf(z);this.sessionDesc.mediaDescriptions[Y]=j}else this.sessionDesc.mediaDescriptions.push(j);return j}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(T=>T.media.port!=="0").map(T=>T.attributes.mid)}mungRecvMediaDsec(T,w,R){const I=St(T);return Im(I),Aa(I,w),wm(I,w),Vv(I),ol(I,R,this.localCapabilities.send),I}mungSendMediaDesc(T,w){const R=St(T);return ol(R,w,this.localCapabilities.recv),Rs(R),R}updateRecvMedia(T,w){const R=this.sessionDesc.mediaDescriptions.findIndex(I=>I.attributes.mid===T);if(R!==-1){const I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],w);this.sessionDesc.mediaDescriptions[R]=I}}bumpMid(T){this.currentMidIndex+=T}findFirstClosedMedia(T){return this.sessionDesc.mediaDescriptions.find(w=>mt()?w.media.port==="0"&&w.media.mediaType===T:w.media.port==="0")}findPreloadMediaDesc(T){return this.sessionDesc.mediaDescriptions.find(w=>{var R;return((R=w.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===T[0].ssrcId})}getSSRC(T){var w;return(w=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===T))===null||w===void 0?void 0:w.attributes.ssrcs}}({remoteIceParameters:e,remoteDtlsParameters:t,candidates:i,remoteRTPCapabilities:s,remoteSetup:a,localCapabilities:this.localCapabilities,cname:c}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString(),h=Ot.parse(this.initialOffer.sdp),p=h.mediaDescriptions.find(T=>T.media.mediaType==="audio");p&&Rs(p),this.useXR&&ch(h);const f=Ot.print(h),_=this.logSDPExchange(f||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:f}),_==null||_(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l});const g=this.peerConnection.getTransceivers()[0];if(g!=null&&g.receiver&&this.tryBindTransportEvents(g.receiver),L("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const T=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:T});const w=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(w)}}catch(l){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}send(e,t,i){var s=this;return Bi(function*(){const a=yield Be(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[];e.forEach(R=>{const I=s.peerConnection.addTransceiver(R._mediaStreamTrack,{direction:"sendonly"});c.push(I),R._updateRtpTransceiver(I)}),mt()&&L("SIMULCAST")===!0&&(yield Be(s.applySimulcastForFirefox(c,e)));const l=yield Be(s.peerConnection.createOffer()),h=s.remoteSDP.predictReceivingMids(e.length),p=s.mungSendOfferSDP(l.sdp,e,h),f=Ot.parse(p),_=h.map(R=>{const I=f.mediaDescriptions.find(N=>N.attributes.mid===R);if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return xv(I,L("USE_PUB_RTX"))});let g;try{g=yield _}catch(R){g=[],s.remoteSDP.receive(e,t,i,g);const I=s.remoteSDP.toString();throw yield Be(s.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Be(s.peerConnection.setRemoteDescription({type:"answer",sdp:I})),yield Be(s.stopSending(h,!0)),R}s.remoteSDP.receive(e,t,i,g);const T=s.remoteSDP.toString(),w=s.logSDPExchange(p,"offer","local","send");return yield Be(s.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Be(s.applySimulcastEncodings(c,e)),yield Be(s.applySendEncodings(c,e)),w==null||w(T),yield Be(s.peerConnection.setRemoteDescription({type:"answer",sdp:T})),c.map((R,I)=>{const N=h[I];return{localSSRC:_[I],id:N,transceiver:R}})}catch(c){throw c instanceof Q?c:new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")v.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const a=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof a!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:a,negotiated:!0,ordered:!1,maxRetransmits:L("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}t.forEach(a=>{a._updateOriginDataChannel(i)});const{needExchangeSDP:s}=this.remoteSDP.sendDataChannel();if(s){const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),v.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else v.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof Q?i:new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(t){throw t instanceof Q?t:new Q(O.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(t.toString()))}}async stopSending(e,t){const i=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(h=>e.indexOf(h.mid)!==-1);if(s.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(h=>{var p;h.direction="inactive",(p=h.stop)===null||p===void 0||p.call(h)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(e,t,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(e,t,i,s);if(c){const h=this.remoteSDP.toString(),p=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(f.sdp,a,e);p==null||p(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a,transceiver:l}}catch(a){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:i}=this.remoteSDP.batchSend(e);if(i){const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c),v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return t.map(s=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:s,transceiver:a}})}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(t.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(t.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const a=this.remoteSDP.toString();s==null||s(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const a=this.remoteSDP.toString();s==null||s(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new Q(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return Bi(function*(){const i=yield Be(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(et().supportPCSetConfiguration){const p=t.peerConnection.getConfiguration(),f=e===xn.RELAY?"relay":"all";p.iceTransportPolicy!==f&&(v.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(f,"]")),p.iceTransportPolicy=f,t.peerConnection.setConfiguration(p))}else if(e===xn.RELAY)return;t.remoteSDP.updateCandidates(e);const s=yield Be(t.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=ys(s.sdp),{remoteIceParameters:c}=yield a.iceParameters;t.remoteSDP.restartICE(c);const l=t.remoteSDP.toString(),h=t.logSDPExchange(s.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield Be(t.peerConnection.setLocalDescription(s)),h==null||h(l),yield Be(t.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(s){v.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const a=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new Q(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,t){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===e);i.length===1&&(this.isVP8Simulcast(t)?mt()||await this.applySimulcastEncodings(i,[t]):await this.applySendEncodings(i,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const i=this.peerConnection.getTransceivers().find(s=>s.mid===t);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:i,remote:s}=t.getSelectedCandidatePair();return{local:dl(dl({},eo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:dl(dl({},eo),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},L("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const t={iceServers:[]};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Od(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...Ft.turnServerConfigToIceServers(e.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...Ft.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),L("FORCE_TURN_TCP")?t.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(t.iceTransportPolicy="relay")}))),L("ENABLE_ENCODED_TRANSFORM")&&et().supportWebRTCEncodedTransform&&(t.encodedInsertableStreams=!0),t}static turnServerConfigToIceServers(e){const t=[];return e.forEach(i=>{i.security?i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(pa(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!L("FORCE_TURN_TCP")&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var s;t!=null&&t.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,t.state))},t.onerror=s=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in s?s.error:s)};const i=t.iceTransport;i&&(i.onstatechange=()=>{const s=t==null?void 0:t.iceTransport.state;var a;s&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:a}=i.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var i;if(t||(t=this.peerConnection.getSenders().find(f=>f.track===e._mediaStreamTrack)),!t)return v.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return v.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!et().supportSetRtpSenderParameters)return v.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},a={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(e._encoderConfig){var c;const{bitrateMax:f,frameRate:_,scaleResolutionDownBy:g}=e._encoderConfig;f&&(a.maxBitrate=1e3*f),(fe(c=e._hints).call(c,Tt.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(_&&(a.maxFramerate=nr(_)),g&&g>=1&&(a.scaleResolutionDownBy=g))}if(L("DSCP_TYPE")&&ra()){var l;const f=L("DSCP_TYPE");fe(l=["very-low","low","medium","high"]).call(l,f)&&(a.networkPriority=f)}const h=t.getParameters(),p=(i=h.encodings)===null||i===void 0?void 0:i[0];mt()&&!p&&(s.encodings=[a]),p&&Object.assign(p,a),Object.assign(h,s),v.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h)}async applySendEncodings(e,t){try{if(!et().supportSetRtpSenderParameters||e.length!==t.length)return;for(let i=0;i<e.length;i++){const s=e[i],a=t[i];a instanceof Ge&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,s.sender)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,i){const s=Ot.parse(e);return t.forEach((a,c)=>{const l=i[c],h=s.mediaDescriptions.find(p=>p.attributes.mid===l);h&&(Aa(h,a),Fv(h,a,this.store.codec))}),Ot.print(s)}mungReceiveAnswerSDP(e,t,i){const s=Ot.parse(e),a=s.mediaDescriptions.find(c=>c.attributes.mid===t);return a&&(i===Ee.AUDIO&&a.media.mediaType==="audio"&&Rs(a),this.useXR&&ch(s)),Ot.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,e,t,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;(t=this.onFirstVideoDecodedTimeout)===null||t===void 0||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let h=0;h<e.length;h++){var i,s,a,c,l;const p=e[h],f=t[h];if(f instanceof Ge&&!fe(i=f._hints).call(i,Tt.LOW_STREAM)&&(s=f._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((a=f._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=f._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},g={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const T=p.sender.getParameters();await p.sender.setParameters(Object.assign(T,_))}}}async applySimulcastEncodings(e,t){if(!mt()&&e.length===t.length)for(let i=0;i<e.length;i++){const s=t[i];if(s instanceof Ge&&this.isVP8Simulcast(s)){const a=e[i],c={},l={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,c))}}}isVP8Simulcast(e){var t,i,s,a,c;return!!(e instanceof Ge&&L("SIMULCAST")&&this.store.codec==="vp8"&&!fe(t=e._hints).call(t,Tt.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=e._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(a=e._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,t,i,s){if(L("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(t," SDP during P2PConnection.").concat(s,`
`),e),t==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t==null?void 0:t[0].ssrcId}setConfiguration(e){if(et().supportPCSetConfiguration){const t=Ft.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}function ji(n,e,t){const i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){const s=this.mutex,a=await s.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await i.apply(this,l)}finally{a()}},t}function qk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Jk(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?qk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):qk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}$([ji,A("design:type",Function),A("design:paramtypes",[Array,Array]),A("design:returntype",W)],Ft.prototype,"updateRemoteRTPCapabilities",null),$([ji,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",W)],Ft.prototype,"connect",null),$([ji,A("design:type",Function),A("design:paramtypes",[Object,Array]),A("design:returntype",W)],Ft.prototype,"createDataChannels",null),$([ji,A("design:type",Function),A("design:paramtypes",[String,Array,String,Object]),A("design:returntype",W)],Ft.prototype,"receive",null),$([ji,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Ft.prototype,"batchReceive",null),$([ji,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Ft.prototype,"stopReceiving",null),$([ji,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],Ft.prototype,"muteRemote",null),$([ji,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],Ft.prototype,"unmuteRemote",null),$([ji,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Ft.prototype,"muteLocal",null),$([ji,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Ft.prototype,"unmuteLocal",null),$([ji,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],Ft.prototype,"close",null),$([ji,A("design:type",Function),A("design:paramtypes",[String,Vn]),A("design:returntype",W)],Ft.prototype,"updateEncoderConfig",null),$([ji,A("design:type",Function),A("design:paramtypes",[String,Vn]),A("design:returntype",W)],Ft.prototype,"updateSendParameters",null),$([ji,A("design:type",Function),A("design:paramtypes",[Vn,String]),A("design:returntype",W)],Ft.prototype,"replaceTrack",null),$([ji,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],Ft.prototype,"getRemoteSSRC",null);const Xk=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,Nm="9",zv=2e4,Yv=4e4;class yY{get localCapabilities(){return St(this._localCapabilities)}get rtpCapabilities(){return St(this._rtpCapabilities)}get candidates(){return St(this._candidates)}get iceParameters(){return St(this._iceParameters)}get dtlsParameters(){return St(this._dtlsParameters)}constructor(e){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),S(this,"firefoxSsrcMidMap",new Map),e=St(e);const{remoteIceParameters:t,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:a,remoteSetup:c,localCapabilities:l,cname:h}=e,p=Ot.parse(Xk);this._rtpCapabilities=a,this._candidates=s,this._iceParameters=t,this._dtlsParameters=i,this._localCapabilities=l,this.setup=c,this.cname=h;const f=this.rtpCapabilities.send;for(const _ of p.mediaDescriptions){if(_.attributes.iceUfrag=t.iceUfrag,_.attributes.icePwd=t.icePwd,_.attributes.fingerprints=i.fingerprints,_.attributes.candidates=s,_.attributes.setup=c,_.media.mediaType==="application"&&(_.attributes.sctpPort="5000"),_.media.mediaType==="video"&&(_.media.fmts=f.videoCodecs.map(g=>g.payloadType.toString(10)),_.attributes.payloads=f.videoCodecs,_.attributes.extmaps=f.videoExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:g,ssrcGroups:T}=Ii([{ssrcId:Yv,rtx:L("USE_SUB_RTX")?40001:void 0}],this.cname);_.attributes.ssrcs=g,_.attributes.ssrcGroups=T}if(_.media.mediaType==="audio"&&(_.media.fmts=f.audioCodecs.map(g=>g.payloadType.toString(10)),_.attributes.payloads=f.audioCodecs,_.attributes.extmaps=f.audioExtensions,Rs(_),L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:g,ssrcGroups:T}=Ii([{ssrcId:zv}],this.cname);_.attributes.ssrcs=g,_.attributes.ssrcGroups=T}}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}updateRemoteRTPCapabilities(e){const t=Ot.parse(Xk);this._rtpCapabilities=e;const i=this.rtpCapabilities.send;for(const s of t.mediaDescriptions){if(s.attributes.iceUfrag=this._iceParameters.iceUfrag,s.attributes.icePwd=this._iceParameters.icePwd,s.attributes.fingerprints=this._dtlsParameters.fingerprints,s.attributes.candidates=this._candidates,s.attributes.setup=this.setup,s.media.mediaType==="application"&&(s.attributes.sctpPort="5000"),s.media.mediaType==="video"&&(s.media.fmts=i.videoCodecs.map(a=>a.payloadType.toString(10)),s.attributes.payloads=i.videoCodecs,s.attributes.extmaps=i.videoExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:c}=Ii([{ssrcId:Yv,rtx:L("USE_SUB_RTX")?40001:void 0}],this.cname);s.attributes.ssrcs=a,s.attributes.ssrcGroups=c}if(s.media.mediaType==="audio"&&(s.media.fmts=i.audioCodecs.map(a=>a.payloadType.toString(10)),s.attributes.payloads=i.audioCodecs,s.attributes.extmaps=i.audioExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:c}=Ii([{ssrcId:zv}],this.cname);s.attributes.ssrcs=a,s.attributes.ssrcGroups=c}}this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}preloadRemoteMedia(e){this.rtpCapabilities;const t=this.candidates,i=this.dtlsParameters,s=this.iceParameters,a=this.rtpCapabilities.send;for(let c=1;c<e;c++){const l=2*c+zv,h=2*c+Yv,{ssrcs:p,ssrcGroups:f}=Ii([{ssrcId:l}],this.cname),{ssrcs:_,ssrcGroups:g}=Ii([{ssrcId:h,rtx:L("USE_SUB_RTX")?h+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Nm,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:t,extmaps:a.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:g,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Nm,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:t,extmaps:a.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Ot.print(this.sessionDesc)}send(e,t,i,s){const{ssrcs:a,ssrcGroups:c}=Ii(t,this.cname,L("SYNC_GROUP")?i:void 0),l=this.findPreloadMediaDesc(a);if(l){if(mt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,l.attributes.mid),s&&(s.twcc||s.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(l,s),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(e,a);let p;return h===-1||wn()||ni()||BO()||h===0&&L("USE_SUB_RTX")?(p=this.createOrRecycleSendMedia(e,a,c,"sendonly",s),this.updateBundleMids()):(p=St(this.sessionDesc.mediaDescriptions[h]),p.attributes.direction="sendonly",p.attributes.ssrcs=a,p.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(p,s)),mt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,p.attributes.mid),{mid:p.attributes.mid,needExchangeSDP:!0}}}batchSend(e){const t=e.map(a=>{let{kind:c,ssrcMsg:l,mslabel:h}=a;return this.send(c,l,h)}),i=[];let s=!1;return t.forEach(a=>{let{mid:c,needExchangeSDP:l}=a;l&&(s=!0),i.push(c)}),{mids:i,needExchangeSDP:s}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(i=>{i.attributes.mid==="0"||mt()||wn()||ni()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(i=>fe(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(i=>fe(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="recvonly"})}receive(e,t,i,s){e.forEach((a,c)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",t,i,s[c])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(e){e===xn.TCP?this._candidates.forEach(t=>{this._candidates.findIndex(i=>i.transport==="tcp"&&i.connectionAddress===t.connectionAddress&&i.port===t.port)===-1&&this._candidates.push(Jk(Jk({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))}):this._candidates=this._candidates.filter(t=>t.transport!=="tcp");for(const t of this.sessionDesc.mediaDescriptions)t.attributes.candidates=this.candidates}restartICE(e){e=St(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let i=0;i<e;i++)t.push((this.currentMidIndex+i+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(mt()){if(s){const a=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return s})}createOrRecycleRecvMedia(e,t,i,s,a,c){const l=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,p=Fc(l,h,this.localCapabilities.send,l===Ee.VIDEO?s:a),f=l===Ee.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let g={media:{mediaType:l,port:Nm,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};g=this.mungRecvMediaDsec(g,e,c);const T=this.findFirstClosedMedia(l);if(T){const w=this.sessionDesc.mediaDescriptions.indexOf(T);this.sessionDesc.mediaDescriptions[w]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}updateRemoteCodec(e,t,i){const s=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(g=>g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"").filter(g=>{var T;return fe(T=Object.keys(aa)).call(T,g)}))],a=new Set(t);if(s.every(g=>a.has(g)))return v.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const c=this._rtpCapabilities.recv.videoCodecs.filter(g=>t.some(T=>{var w;return fe(w=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"").call(w,T)}));if(c.length===0)return v.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(s," codecs: ").concat(t)),!1;const l=[...new Set(c.map(g=>g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||""))];let h;if(v.debug("updateRemoteCodec, from ".concat(s," to ").concat(l)),e.length===0)h=this.sessionDesc.mediaDescriptions.filter(g=>g.media.mediaType==="video"&&g.attributes.direction==="recvonly");else if(h=this.sessionDesc.mediaDescriptions.filter(g=>g.attributes.mid&&fe(e).call(e,g.attributes.mid)&&g.attributes.direction==="recvonly"),h.length!==e.length)return v.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;this._rtpCapabilities.recv.videoCodecs=c;const p=this.localCapabilities.send,f=this.rtpCapabilities.recv,_=Fc(Ee.VIDEO,f,p,i);return h.forEach(g=>{const T=_.map(w=>w.payloadType.toString(10));v.debug("updateRemoteCodec mid: ".concat(g.attributes.mid,", from ").concat(g.attributes.payloads," to ").concat(_)),g.attributes.payloads=_,g.media.fmts=T}),!0}createOrRecycleSendMedia(e,t,i,s,a){const c=this.rtpCapabilities.send,l=e===Ee.VIDEO?c.videoCodecs:c.audioCodecs,h=e===Ee.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let f={media:{mediaType:e,port:Nm,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};f=this.mungSendMediaDesc(f,a);const _=this.findFirstClosedMedia(e);if(_){const g=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[g]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,i){const s=St(e);return Im(s),Aa(s,t),wm(s,t),Vv(s),ol(s,i,this.localCapabilities.send),s}mungSendMediaDesc(e,t){const i=St(e);return ol(i,t,this.localCapabilities.recv),Rs(i),i}updateRecvMedia(e,t){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===e);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],t);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>mt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var i;return((i=t.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}}function Qk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Pm(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Qk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Qk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}class jn extends Mf{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let e;return this.localCapabilities&&(e=al(this.localCapabilities)),[...new Set(e&&e.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var i;return fe(i=Object.keys(aa)).call(i,t)}))]}constructor(e,t,i){super(e,t),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"transportEventReceiver",void 0),S(this,"statsFilter",void 0),S(this,"useXR",L("USE_XR")),S(this,"localCapabilities",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"remoteCodecs",void 0),S(this,"dataStreamChannelMap",new Map),S(this,"establishPromise",void 0),S(this,"mutex",new Tn("NVExtentionsConnection-mutex")),S(this,"rtcMedia",void 0),this.store=t,this.peerConnection=i,this.statsFilter=Cm(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,mt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(e){try{const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=ys(t.sdp),s=await Bv({filterRTX:!L("USE_PUB_RTX")&&!L("USE_SUB_RTX"),filterVideoFec:L("FILTER_VIDEO_FEC"),filterAudioFec:L("FILTER_AUDIO_FEC"),filterVideoCodec:L("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=s,this.initialOffer=t,Pm(Pm({},i),{},{rtpCapabilities:s,offerSDP:t.sdp})}catch(t){throw new B(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(e,t,i,s,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new yY({remoteIceParameters:e,remoteDtlsParameters:t,candidates:i,remoteRTPCapabilities:s,remoteSetup:a,localCapabilities:al(this.localCapabilities),cname:c});const l=this.remoteSDP.toString(),h=Ot.parse(this.initialOffer.sdp),p=h.mediaDescriptions.find(g=>g.media.mediaType==="audio");p&&Rs(p),this.useXR&&ch(h);const f=Ot.print(h),_=this.logSDPExchange(f||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:f}),_==null||_(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new B(O.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(l.toString()))}}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,!this.remoteSDP)return void v.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t));if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const a=this.remoteSDP.toString();s==null||s(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}else v.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async updateRemoteConnect(e){var t,i,s,a;(t=this.remoteSDP)===null||t===void 0||t.updateRemoteRTPCapabilities(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&((a=this.remoteSDP)===null||a===void 0||a.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),(i=this.remoteSDP)===null||i===void 0||i.preloadRemoteMedia(2);const c=(s=this.remoteSDP)===null||s===void 0?void 0:s.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});const l=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(l),v.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(e,t,i){var s=this;return Bi(function*(){const a=yield Be(s.mutex.lock("From NVExtentionsConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const c=[];e.forEach(R=>{const I=s.peerConnection.addTransceiver(R._mediaStreamTrack,{direction:"sendonly"});c.push(I)}),mt()&&L("SIMULCAST")===!0&&(yield Be(s.applySimulcastForFirefox(c,e)));const l=yield Be(s.peerConnection.createOffer()),h=s.remoteSDP.predictReceivingMids(e.length),p=s.mungSendOfferSDP(l.sdp,e,h),f=Ot.parse(p),_=h.map(R=>{const I=f.mediaDescriptions.find(N=>N.attributes.mid===R);if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return xv(I,L("USE_PUB_RTX"))});let g;try{g=yield _}catch(R){g=[],s.remoteSDP.receive(e,t,i,g);const I=s.remoteSDP.toString();throw yield Be(s.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Be(s.peerConnection.setRemoteDescription({type:"answer",sdp:I})),yield Be(s.stopSending(h,!0)),R}s.remoteSDP.receive(e,t,i,g);const T=s.remoteSDP.toString(),w=s.logSDPExchange(p,"offer","local","send");return yield Be(s.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Be(s.applySimulcastEncodings(c,e)),yield Be(s.applySendEncodings(c,e)),w==null||w(T),yield Be(s.peerConnection.setRemoteDescription({type:"answer",sdp:T})),c.map((R,I)=>{const N=h[I];return{localSSRC:_[I],id:N,transceiver:R}})}catch(c){throw c instanceof B?c:new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(e,t){const i=t?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(h=>e.indexOf(h.mid)!==-1);if(s.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");s.map(h=>{var p;h.direction="inactive",(p=h.stop)===null||p===void 0||p.call(h)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);return i&&i.readyState==="open"?v.debug("[P2PConnection] Channels are already available and can be reused directly."):(i=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:L("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)),void t.forEach(s=>{s._updateOriginDataChannel(i)})}catch(i){throw i instanceof B?i:new B(O.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t==null||t.close(),void this.dataStreamChannelMap.delete(e)}catch(t){throw t instanceof B?t:new B(O.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(t.toString()))}}async receive(e,t,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(e,t,i,s);if(c){const h=this.remoteSDP.toString(),p=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(f.sdp,a,e);p==null||p(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),v.debug("[NVExtentionsConnection] receive ".concat(e," by exchanging SDP."))}else v.debug("[NVExtentionsConnection] receive ".concat(e," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a}}catch(a){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:i}=this.remoteSDP.batchSend(e);if(i){const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c),v.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else v.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return t.map(s=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:s}})}catch(t){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(t.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(t){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(t){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(t.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),i=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(t){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(t.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const a=this.remoteSDP.toString();s==null||s(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const a=this.remoteSDP.toString();s==null||s(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(t){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return Bi(function*(){const i=yield Be(t.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(et().supportPCSetConfiguration){const p=t.peerConnection.getConfiguration(),f=e===xn.RELAY?"relay":"all";p.iceTransportPolicy!==f&&(v.debug("restartICE change iceTransportPolicy from [".concat(p.iceTransportPolicy,"] to [").concat(f,"]")),p.iceTransportPolicy=f,t.peerConnection.setConfiguration(p))}else if(e===xn.RELAY)return;e!==xn.RELAY&&t.remoteSDP.updateCandidates(e);const s=yield Be(t.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=ys(s.sdp),{remoteIceParameters:c}=yield a.iceParameters;t.remoteSDP.restartICE(c);const l=t.remoteSDP.toString(),h=t.logSDPExchange(s.sdp||"","offer","local","restartICE");yield Be(t.peerConnection.setLocalDescription(s)),h==null||h(l),yield Be(t.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(s){v.warning("restart ICE failed, abort operation",s)}finally{i()}})()}close(){var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const a=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new B(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,t){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===e);i.length===1&&(this.isVP8Simulcast(t)?mt()||await this.applySimulcastEncodings(i,[t]):await this.applySendEncodings(i,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const i=this.peerConnection.getTransceivers().find(s=>s.mid===t);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}getP2PConnectionParams(){var e;if((e=this.peerConnection.currentLocalDescription)===null||e===void 0||!e.sdp||!this.localCapabilities)throw new Error;return Pm(Pm({},ys(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},L("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const t={iceServers:[]};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Od(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...jn.turnServerConfigToIceServers(e.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...jn.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),L("FORCE_TURN_TCP")?t.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(t.iceTransportPolicy="relay")}))),t}static turnServerConfigToIceServers(e){const t=[];return e.forEach(i=>{i.security?i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(pa(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!L("FORCE_TURN_TCP")&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),t}async applySendEncodings(e,t){try{if(!et().supportSetRtpSenderParameters||e.length!==t.length)return;for(let _=0;_<e.length;_++){const g=e[_],T=t[_];if(T&&T instanceof Ge){var i,s,a;if(this.isVP8Simulcast(T))continue;const w={},R={};switch(T._optimizationMode){case"motion":w.degradationPreference="maintain-framerate";break;case"detail":w.degradationPreference="maintain-resolution";break;default:w.degradationPreference="balanced"}var c,l,h,p;if((i=T._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(R.maxBitrate=1e3*((c=T._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)),fe(s=T._hints).call(s,Tt.LOW_STREAM)&&((l=T._encoderConfig)!==null&&l!==void 0&&l.frameRate&&(R.maxFramerate=nr(T._encoderConfig.frameRate)),(h=T._encoderConfig)!==null&&h!==void 0&&h.scaleResolutionDownBy&&((p=T._encoderConfig)===null||p===void 0?void 0:p.scaleResolutionDownBy)>1&&(R.scaleResolutionDownBy=T._encoderConfig.scaleResolutionDownBy)),L("DSCP_TYPE")&&ra()){var f;const D=L("DSCP_TYPE");fe(f=["very-low","low","medium","high"]).call(f,D)&&(R.networkPriority=D)}const I=g.sender.getParameters(),N=(a=I.encodings)===null||a===void 0?void 0:a[0];mt()&&!N&&(w.encodings=[R]),N&&Object.assign(N,R),Object.assign(I,w),await g.sender.setParameters(I)}}}catch{v.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(e,t,i){const s=Ot.parse(e);return t.forEach((a,c)=>{const l=i[c],h=s.mediaDescriptions.find(p=>p.attributes.mid===l);h&&(Aa(h,a),Fv(h,a,this.store.codec))}),Ot.print(s)}mungReceiveAnswerSDP(e,t,i){const s=Ot.parse(e),a=s.mediaDescriptions.find(c=>c.attributes.mid===t);return a&&i===Ee.AUDIO&&a.media.mediaType==="audio"&&Rs(a),this.useXR&&ch(s),Ot.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,e,t,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;(t=this.onFirstVideoDecodedTimeout)===null||t===void 0||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let h=0;h<e.length;h++){var i,s,a,c,l;const p=e[h],f=t[h];if(f instanceof Ge&&!fe(i=f._hints).call(i,Tt.LOW_STREAM)&&(s=f._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((a=f._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=f._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=f._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},g={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const T=p.sender.getParameters();await p.sender.setParameters(Object.assign(T,_))}}}async applySimulcastEncodings(e,t){if(!mt()&&e.length===t.length)for(let i=0;i<e.length;i++){const s=t[i];if(s instanceof Ge&&this.isVP8Simulcast(s)){const a=e[i],c={},l={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,c))}}}isVP8Simulcast(e){var t,i,s,a,c;return!!(e instanceof Ge&&L("SIMULCAST")&&this.store.codec==="vp8"&&!fe(t=e._hints).call(t,Tt.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=e._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(a=e._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,t,i,s){if(L("SDP_LOGGING"))return v.upload("exchanging ".concat(i," ").concat(t," SDP during NVExtentionsConnection.").concat(s,`
`),e),t==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t==null?void 0:t[0].ssrcId}setConfiguration(e){if(et().supportPCSetConfiguration){const t=jn.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}function wi(n,e,t){const i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){const s=this.mutex,a=await s.lock("From NVExtentionsConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await i.apply(this,l)}finally{a()}},t}function $k(n){var e,t,i,s=2;for(typeof Symbol<"u"&&(t=Bk,i=Symbol.iterator);s--;){if(t&&(e=n[t])!=null)return e.call(n);if(i&&(e=n[i])!=null)return new Dm(e.call(n));t="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Dm(n){function e(t){if(Object(t)!==t)return W.reject(new TypeError(t+" is not an object."));var i=t.done;return W.resolve(t.value).then(function(s){return{value:s,done:i}})}return Dm=function(t){this.s=t,this.n=t.next},Dm.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var i=this.s.return;return i===void 0?W.resolve({value:t,done:!0}):e(i.apply(this.s,arguments))},throw:function(t){var i=this.s.return;return i===void 0?W.reject(t):e(i.apply(this.s,arguments))}},new Dm(n)}$([wi,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",W)],jn.prototype,"connect",null),$([wi,A("design:type",Function),A("design:paramtypes",[Array,Array]),A("design:returntype",W)],jn.prototype,"updateRemoteRTPCapabilities",null),$([wi,A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],jn.prototype,"updateRemoteConnect",null),$([wi,A("design:type",Function),A("design:paramtypes",[Object,Array]),A("design:returntype",W)],jn.prototype,"createDataChannels",null),$([wi,A("design:type",Function),A("design:paramtypes",[String,Array,String,Object]),A("design:returntype",W)],jn.prototype,"receive",null),$([wi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],jn.prototype,"batchReceive",null),$([wi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],jn.prototype,"stopReceiving",null),$([wi,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],jn.prototype,"muteRemote",null),$([wi,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],jn.prototype,"unmuteRemote",null),$([wi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],jn.prototype,"muteLocal",null),$([wi,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],jn.prototype,"unmuteLocal",null),$([wi,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],jn.prototype,"close",null),$([wi,A("design:type",Function),A("design:paramtypes",[String,Vn]),A("design:returntype",W)],jn.prototype,"updateEncoderConfig",null),$([wi,A("design:type",Function),A("design:paramtypes",[String,Vn]),A("design:returntype",W)],jn.prototype,"updateSendParameters",null),$([wi,A("design:type",Function),A("design:paramtypes",[Vn,String]),A("design:returntype",W)],jn.prototype,"replaceTrack",null),$([wi,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],jn.prototype,"getRemoteSSRC",null);class hn extends Mf{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(e,t){super(e,t),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"cname",void 0),S(this,"mutex",new Tn("DataChannelConnection-mutex")),S(this,"dataChannel",void 0),S(this,"_p2pConnection",void 0),S(this,"establishPromise",void 0),S(this,"_nvMedia",void 0),this.store=t,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(hn.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new jn(e,t,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var e;const t=(e=this._nvMedia)===null||e===void 0?void 0:e.getLocalRtpCapabilities();return await this._p2pConnection.establish(t)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(e,t,i,s,a,c){return this.cname=c,await this._p2pConnection.connect(e,t,i,s,a,c),await new W((l,h)=>{const p=setTimeout(()=>{this.closeSignal(),h(new B(O.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(i))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(p),void l()},this.dataChannel.onerror=f=>{this.closeSignal(),h(f)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(e,t){return this._p2pConnection.updateRemoteRTPCapabilities(e,t)}send(e,t,i){var s=this;return Bi(function*(){const a=yield Be(s.mutex.lock("From DataChannelConnection.send"));try{return yield*bm($k(s._p2pConnection.send(e,t,i)))}finally{a()}})()}async stopSending(e,t){return this._p2pConnection.stopSending(e,t)}async createDataChannels(e,t){return this._p2pConnection.createDataChannels(e,t)}async stopDataChannels(e){return this._p2pConnection.stopDataChannels(e)}async receive(e,t,i,s){return this._nvMedia?(v.debug("[DataChannelConnection] receive ".concat(e," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(e,t,this.cname)):(v.debug("[DataChannelConnection] receive ".concat(e," by WebRTC.")),await this._p2pConnection.receive(e,t,i,s))}async batchReceive(e){return[...await this._p2pConnection.batchReceive(e)]}async stopReceiving(e){return await this._p2pConnection.stopReceiving(e)}async muteRemote(e){return await this._p2pConnection.muteRemote(e)}async unmuteRemote(e){return await this._p2pConnection.unmuteRemote(e)}async muteLocal(e){return await this._p2pConnection.muteLocal(e)}async unmuteLocal(e){return await this._p2pConnection.unmuteLocal(e)}restartICE(e){var t=this;return Bi(function*(){return yield*bm($k(t._p2pConnection.restartICE(e)))})()}close(){var e;(e=this._nvMedia)===null||e===void 0||e.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(e){return this._p2pConnection.getRemoteVideoIsReady(e)}updateRemoteConnect(e){var t;(t=this._nvMedia)===null||t===void 0||t.setRemoteRtpCapabilities(e),this._p2pConnection.updateRemoteConnect(e)}async updateEncoderConfig(e,t){return await this._p2pConnection.updateEncoderConfig(e,t)}async updateSendParameters(e,t){return await this._p2pConnection.updateSendParameters(e,t)}setStatsRemoteVideoIsReady(e,t){this._p2pConnection.setStatsRemoteVideoIsReady(e,t)}async replaceTrack(e,t){return await this._p2pConnection.replaceTrack(e,t)}async getRemoteSSRC(e){return this._p2pConnection.getRemoteSSRC(e)}logSDPExchange(e,t,i,s){if(L("SDP_LOGGING"))return v.upload("exchanging ".concat(i," ").concat(t," SDP during DataChannelConnection.").concat(s,`
`),e),t==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",s)}:void 0}static resolvePCConfiguration(e){const t={iceServers:[]};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Od(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...hn.turnServerConfigToIceServers(e.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...hn.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),L("FORCE_TURN_TCP")?t.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(t.iceTransportPolicy="relay")}))),t}static turnServerConfigToIceServers(e){const t=[];return e.forEach(i=>{i.security?i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(pa(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!L("FORCE_TURN_TCP")&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&t.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),t}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=e=>{var t;return(t=this.onICEConnectionStateChange)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onConnectionStateChange=e=>{var t;return(t=this.onConnectionStateChange)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportStateChange=e=>{var t;return(t=this.onDTLSTransportStateChange)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportError=e=>{var t;return(t=this.onDTLSTransportError)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onICETransportStateChange=e=>{var t;return(t=this.onICETransportStateChange)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioReceived=e=>{var t;return(t=this.onFirstAudioReceived)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoReceived=e=>{var t;return(t=this.onFirstVideoReceived)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioDecoded=e=>{var t;return(t=this.onFirstAudioDecoded)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoDecoded=(e,t,i)=>{var s;return(s=this.onFirstVideoDecoded)===null||s===void 0?void 0:s.call(this,e,t,i)},this._p2pConnection.onFirstVideoDecodedTimeout=e=>{var t;return(t=this.onFirstVideoDecodedTimeout)===null||t===void 0?void 0:t.call(this,e)},this._p2pConnection.onSelectedLocalCandidateChanged=(e,t)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,e,t)},this._p2pConnection.onSelectedRemoteCandidateChanged=(e,t)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,e,t)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}setConfiguration(e){this._p2pConnection.setConfiguration(e)}}function ur(n,e,t){const i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){const s=this.mutex,a=await s.lock("From DataChannelConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await i.apply(this,l)}finally{a()}},t}function Zk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Pa(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Zk(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Zk(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function eL(n){var e,t,i,s=2;for(typeof Symbol<"u"&&(t=Bk,i=Symbol.iterator);s--;){if(t&&(e=n[t])!=null)return e.call(n);if(i&&(e=n[i])!=null)return new km(e.call(n));t="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function km(n){function e(t){if(Object(t)!==t)return W.reject(new TypeError(t+" is not an object."));var i=t.done;return W.resolve(t.value).then(function(s){return{value:s,done:i}})}return km=function(t){this.s=t,this.n=t.next},km.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var i=this.s.return;return i===void 0?W.resolve({value:t,done:!0}):e(i.apply(this.s,arguments))},throw:function(t){var i=this.s.return;return i===void 0?W.reject(t):e(i.apply(this.s,arguments))}},new km(n)}$([ur,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",W)],hn.prototype,"connect",null),$([ur,A("design:type",Function),A("design:paramtypes",[Array,Array]),A("design:returntype",W)],hn.prototype,"updateRemoteRTPCapabilities",null),$([ur,A("design:type",Function),A("design:paramtypes",[Object,Array]),A("design:returntype",W)],hn.prototype,"createDataChannels",null),$([ur,A("design:type",Function),A("design:paramtypes",[String,Array,String,Object]),A("design:returntype",W)],hn.prototype,"receive",null),$([ur,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],hn.prototype,"stopReceiving",null),$([ur,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],hn.prototype,"muteRemote",null),$([ur,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],hn.prototype,"unmuteRemote",null),$([ur,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],hn.prototype,"muteLocal",null),$([ur,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],hn.prototype,"unmuteLocal",null),$([ur,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],hn.prototype,"close",null),$([ur,A("design:type",Function),A("design:paramtypes",[String,Vn]),A("design:returntype",W)],hn.prototype,"updateEncoderConfig",null),$([ur,A("design:type",Function),A("design:paramtypes",[String,Vn]),A("design:returntype",W)],hn.prototype,"updateSendParameters",null),$([ur,A("design:type",Function),A("design:paramtypes",[Vn,String]),A("design:returntype",W)],hn.prototype,"replaceTrack",null),$([ur,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],hn.prototype,"getRemoteSSRC",null);class Cn extends At{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Oe.StateChange,t,this._state)}constructor(e,t){super(),S(this,"store",void 0),S(this,"statsUploader",void 0),S(this,"connection",void 0),S(this,"localTrackMap",new Map),S(this,"remoteUserMap",new Map),S(this,"localDataChannels",[]),S(this,"remoteDataChannelMap",new Map),S(this,"pendingLocalTracks",[]),S(this,"pendingRemoteTracks",[]),S(this,"pendingLocalDataChannels",[]),S(this,"pendingRemoteDataChannels",[]),S(this,"statsCollector",void 0),S(this,"isPlanB",!1),S(this,"shouldForwardP2PCreation",void 0),S(this,"iceFailedCount",0),S(this,"dtlsFailedCount",0),S(this,"mutex",new Tn("P2PChannel-mutex")),S(this,"_state",st.Disconnected),S(this,"_pcStatsUploadType",L("NEW_ICE_RESTART")?Ss.FIRST_CONNECTION:Ss.OLD_FIRST_CONNECTION),S(this,"_isInRestartIce",!1),S(this,"_isStartRestartIce",!1),S(this,"_restartStates",["disconnected","failed"]),S(this,"_restartTimer",void 0),S(this,"_isFirstConnected",!0),S(this,"handleMuteLocalTrack",async(i,s,a)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==st.Connected)return void a(new Q(O.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const l=this.filterTobeMutedTracks(i);if(l.length===0)return void s();const h=l.find(f=>f[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(l.map(f=>{let[,{id:_}]=f;return _}));const p=this.createMuteMessage(l);await _t(this,Oe.RequestMuteLocal,p),s()}catch(l){a(l)}finally{c()}}),S(this,"handleUnmuteLocalTrack",async(i,s,a)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==st.Connected)return void a(new Q(O.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const l=this.filterTobeUnmutedTracks(i);if(l.length===0)return void s();const h=l.find(f=>f[0]==="videoLowTrack");if(h){const f=h[1];if(f.track._originMediaStreamTrack.stop(),!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&et().supportDualStreamEncoding){const _=i._mediaStreamTrack.clone();f.track._mediaStreamTrack=_,f.track._originMediaStreamTrack=_}else{const _=jv(i,gc(this,Oe.RequestLowStreamParameter));f.track._mediaStreamTrack=_,f.track._originMediaStreamTrack=_}await new W((_,g)=>{this.handleReplaceTrack(f.track,_,g,!0)})}await this.connection.unmuteLocal(l.map(f=>{let[,{id:_}]=f;return _}));const p=this.createUnmuteMessage(l);await _t(this,Oe.RequestUnmuteLocal,p),s()}catch(l){a(l)}finally{c()}}),S(this,"handleUpdateVideoEncoder",async(i,s,a)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const l=this.localTrackMap.get(te.LocalVideoTrack);if(!this.connection||!l||l.track!==i||this.state!==st.Connected)return void s();const{id:h,track:p}=l;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(Oe.UpdateVideoEncoder,p),s()}catch(l){a(l)}finally{c()}}),S(this,"handleSetOptimizationMode",async(i,s,a)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const l=this.localTrackMap.get(te.LocalVideoTrack);if(!this.connection||!l||l.track!==i||this.state!==st.Connected)return;const{id:h,track:p}=l;await this.connection.updateSendParameters(h,p),s()}catch(l){a(l)}finally{c()}}),S(this,"handleReplaceMixingTrack",async(i,s,a,c)=>{if(!this.connection||this.state!==st.Connected)return void s();const l=Kv([i]);let h;v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l.getTrackId(),"]")),typeof c=="boolean"&&c||(h=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,l),s()}catch(f){a(f)}finally{var p;(p=h)===null||p===void 0||p()}}),S(this,"handleReplaceTrack",async(i,s,a,c)=>{let l;v.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof c=="boolean"&&c||(l=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var h;const f=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:g}]=_;return i===g});if(!this.connection||!f||this.state!==st.Connected)return void s();if(await((h=this.connection)===null||h===void 0?void 0:h.replaceTrack(i,f[1].id)),this.isPlanB){const _=f[1];_.id=i._mediaStreamTrack.id,this.localTrackMap.set(f[0],_)}if(f[0]===te.LocalVideoTrack&&!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&et().supportDualStreamEncoding){const _=this.localTrackMap.get(te.LocalVideoLowTrack);if(_){const g=i._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=g,_.track._originMediaStreamTrack=g,await new W((T,w)=>{this.handleReplaceTrack(_.track,T,w,!0)})}}s()}catch(f){a(f)}finally{var p;(p=l)===null||p===void 0||p()}}),S(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),S(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),S(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),S(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),S(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new Lk(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!et().supportUnifiedPlan||L("CHROME_FORCE_PLAN_B")&&ra(),this.shouldForwardP2PCreation=L("FORWARD_P2P_CREATION")&&et().supportPCSetConfiguration&&function(){const i=uf();return i===on.ANDROID||i===on.IOS||i===on.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new hn({},this.store):this.isPlanB?new Rn({},this.store):new Ft({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var i;this.state=st.New;const s=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new hn(e,this.store):this.isPlanB?new Rn(e,this.store):new Ft(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=L("NEW_ICE_RESTART")?Ss.FIRST_CONNECTION:Ss.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,i,s,a,c){if(!this.connection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof hn?this.connection.updateRemoteConnect(s):(this.store.peerConnectionStart(),await this.connection.connect(e,t,i,s,a,c),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=st.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(a=>{var c;let[l]=a;return fe(c=[te.LocalVideoLowTrack,te.LocalVideoTrack]).call(c,l)}),i=t.map(a=>{let[,{id:c}]=a;return c}),s=t.map(a=>{let[c]=a;return c});if(this.connection instanceof Ft){if(Te.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(s),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!fe(e).call(e,this.store.codec)){const a=["vp8","h264"].find(c=>fe(e).call(e,c));a&&(this.store.codec=a,v.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(a,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async preConnect(e,t,i,s,a,c){if(!this.connection)throw new Q(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const l=await this.connection.connect(e,t,i,s,a,c);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=st.Connected,l}getEstablishParams(){if(this.connection instanceof hn)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(e){if(!this.connection||this.state!==st.Connected){if(this.state===st.Disconnected)throw new Q(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return void e.forEach(i=>{var s;fe(s=this.pendingLocalDataChannels).call(s,i)||this.pendingLocalDataChannels.push(i)})}const t=this.filterTobePublishedDataChannels(e);t.length!==0&&(t.forEach(i=>{const s=Date.now();this.store.publish(i.id.toString(),"datachannel",s)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(i=>{this.localDataChannels.push(i);const s=Date.now();this.store.publish(i.id+"","datachannel",void 0,s)}))}publish(e,t,i){var s=this;return Bi(function*(){const a=yield Be(s.mutex.lock("From P2PChannel.publish"));try{if(!s.connection||s.state!==st.Connected){if(s.state===st.Disconnected)throw new Q(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(e);const l=e.filter(h=>s.pendingLocalTracks.indexOf(h)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(l))}s.store.pubId=s.store.pubId+1,Fn.markPublishStart(s.store.clientId,s.store.pubId);const c=s.filterTobePublishedTracks(e,t,i);if(c.length===0)return void(yield Be(s.tryToUnmuteAudio(e)));yield*bm(eL(s.doPublish(s.connection,c)))}finally{a()}})()}doPublish(e,t){var i=this;return Bi(function*(){t.forEach(g=>{let{track:T,type:w}=g;const R=Date.now();i.store.publish(T.getTrackId(),w===te.LocalAudioTrack?"audio":"video",R)}),i.bindLocalTrackEvents(t);const s=t.map(g=>{let{track:T}=g;return T}),a=yield Be(e.send(t.map(g=>{let{track:T}=g;return T}),i.store.codec,i.store.audioCodec)),c=(yield Be(a.next())).value,l=i.createGatewayPublishMessage(t,c);let h;try{h=yield l}catch(g){throw a.throw(g),(g==null?void 0:g.code)===O.WS_ABORT&&t.forEach(T=>{let{track:w}=T;i.pendingLocalTracks.indexOf(w)===-1&&i.pendingLocalTracks.push(w)}),i.unbindLocalTrackEvents(t),g}const p=i.mapPubResToRemoteConfig(l,h),f=(yield Be(a.next(p))).value,_=L("ENABLE_VIDEO_SEI");s.forEach(async g=>{const T=g.getRTCRtpTransceiver();T&&_&&(g.trackMediaType===Ee.VIDEO?await async function(w,R){if(!et().supportWebRTCEncodedTransform)return void v.warning("browser not support video encoded transform");if(Rm.has(w)||!w.track)return;const I={track:w.track};if(_o()){if(!w.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let D=null;try{D=w.createEncodedStreams()}catch(F){return void v.error("create video-encoded-streams error",F&&F.message)}let V=[];R.on("sei-to-send",F=>{V.push(F)});const G=new TransformStream({transform(F,j){I.controller||(I.controller=j),w.track&&w.track.id!==I.track.id&&(v.debug("video track changed: ".concat(I.track.id," => ").concat(w.track.id)),I.track.removeEventListener("ended",N),I.track=w.track,I.track.addEventListener("ended",N));const z=V.shift();z&&(F.data=Xz(F.data,z)),j.enqueue(F)}});D.readable.pipeThrough(G).pipeTo(D.writable)}else{if(!wn())return;{if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");const D=Tm(),V=new MessageChannel;await new W(F=>D.onmessage=j=>{j.data==="registered"&&F(void 0)});const G=new RTCRtpScriptTransform(D,{name:"tx",port:V.port2},[V.port2]);w.transform=G,await new W(F=>D.onmessage=j=>{j.data==="started"&&F(void 0)}),R.on("sei-to-send",F=>{V.port1.postMessage({sei:F})}),V.port1.onmessage=F=>{var j;F.data.transformed&&w.track&&((j=w.track)===null||j===void 0?void 0:j.id)!==I.track.id&&(v.debug("video track changed: ".concat(I.track.id," => ").concat(w.track.id)),I.track.removeEventListener("ended",N),I.track=w.track,I.track.addEventListener("ended",N))},I.worker=D}}function N(){if(w.track){if(this.id!==w.track.id)return;w.track.removeEventListener("ended",N)}const D=Rm.get(w);if(D){Rm.delete(w);try{var V,G;(V=D.controller)===null||V===void 0||V.terminate(),(G=D.worker)===null||G===void 0||G.terminate()}catch(F){v.warning(F&&F.message)}}}Rm.set(w,I),w.track.addEventListener("ended",N)}(T.sender,g):g.trackMediaType===Ee.AUDIO&&await async function(w){if(!et().supportWebRTCEncodedTransform)return void v.warning("browser not support audio encoded transform");if(vm.has(w)||!w.track)return;const R={track:w.track};if(_o()){if(!w.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let N=null;try{N=w.createEncodedStreams()}catch(V){return void v.error("create audio-encoded-streams error",V&&V.message)}const D=new TransformStream({transform(V,G){R.controller||(R.controller=G),w.track&&w.track.id!==R.track.id&&(v.debug("audio track changed: ".concat(R.track.id," => ").concat(w.track.id)),R.track.removeEventListener("ended",I),R.track=w.track,R.track.addEventListener("ended",I)),G.enqueue(V)}});N.readable.pipeThrough(D).pipeTo(N.writable)}else if(wn()){if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");const N=Tm(),D=new MessageChannel;await new W(G=>N.onmessage=F=>{F.data==="registered"&&G(void 0)});const V=new RTCRtpScriptTransform(N,{name:"tx",port:D.port2},[D.port2]);w.transform=V,await new W(G=>N.onmessage=F=>{F.data==="started"&&G(void 0)}),D.port1.onmessage=G=>{var F;G.data.transformed&&w.track&&((F=w.track)===null||F===void 0?void 0:F.id)!==R.track.id&&(v.debug("audio track changed: ".concat(R.track.id," => ").concat(w.track.id)),R.track.removeEventListener("ended",I),R.track=w.track,R.track.addEventListener("ended",I))},R.worker=N}function I(){if(w.track){if(this.id!==w.track.id)return;w.track.removeEventListener("ended",I)}const N=vm.get(w);if(N){vm.delete(w);try{var D,V;(D=N.controller)===null||D===void 0||D.terminate(),(V=N.worker)===null||V===void 0||V.terminate()}catch(G){v.warning(G&&G.message)}}}vm.set(w,R),w.track.addEventListener("ended",I)}(T.sender))}),t.forEach(g=>{let{type:T}=g;i.statsCollector.addLocalStats(T)}),i.assignLocalTracks(t,f),i.statsUploader.startUploadOutboundStats(),t.forEach(g=>{let{track:T,type:w}=g;const R=Date.now();i.store.publish(T.getTrackId(),w===te.LocalAudioTrack?"audio":"video",void 0,R)})})()}async updateVideoStreamParameter(e,t){const i=this.localTrackMap.get(t);if(!i)return;if(!(i.track instanceof Ge))return v.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof Ft||this.connection instanceof Rn))return v.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:s}=i,a=function(c,l){const h={};return c.height&&c.width&&(h.scaleResolutionDownBy=aT(c,l)),h.maxFramerate=c.framerate?nr(c.framerate):void 0,h.maxBitrate=c.bitrate?1e3*c.bitrate:void 0,h}(e,s);if(s._encoderConfig||(s._encoderConfig={}),t!==te.LocalVideoLowTrack||!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&et().supportDualStreamEncoding)a.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=a.scaleResolutionDownBy);else{const c=s._originMediaStreamTrack;if(!c.canvas)return v.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(l,h){const p=l.canvas;h.width&&(p.width=nr(h.width)),h.height&&(p.height=nr(h.height)),h.framerate&&(p.stopCapture&&p.stopCapture(),p.stopCapture=CT(()=>{!p.startCapture&&p.stopCapture&&p.stopCapture(),p.startCapture&&p.startCapture()},nr(h.framerate)))})(c,e)}a.maxBitrate!=null&&(s._encoderConfig.bitrateMax=a.maxBitrate/1e3),a.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=a.maxFramerate:s._encoderConfig.frameRate={max:a.maxFramerate}),v.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(e){var t=this;return Bi(function*(){if(!t.connection||t.state!==st.Connected)return;const i=yield Be(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const a=t.localTrackMap.get(te.LocalVideoTrack);if(!a)throw new Q(O.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(te.LocalVideoLowTrack))throw new Q(O.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const c=[{track:t.getLowVideoTrack(a.track,e),type:te.LocalVideoLowTrack}];if(yield*bm(eL(t.doPublish(t.connection,c))),a.track.muted||!a.track.enabled){var s;const l=(s=t.localTrackMap.get(te.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;l!==void 0&&(yield Be(t.connection.muteLocal([l])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Xt(this,Oe.RequestRePublish,this.pendingLocalTracks),this.emit(Oe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(v.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Xt(this,Oe.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:i,kind:s}=this.pendingRemoteTracks[t];(s!==Ee.AUDIO||i._audio_added_&&i._audioSSRC)&&(s!==Ee.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Xt(this,Oe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:i}of this.pendingRemoteTracks)await this.subscribe(t,i,i===Ee.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:i}=t;this.emit(Oe.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==st.Connected)return void e.forEach(s=>{const a=this.pendingLocalTracks.indexOf(s);a!==-1&&this.pendingLocalTracks.splice(a,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const i=t.find(s=>s[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==st.Connected)return void e.forEach(i=>{const s=this.pendingLocalDataChannels.indexOf(i);s!==-1&&this.pendingLocalDataChannels.splice(s,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(i=>{const s=this.localDataChannels.indexOf(i);s!==-1&&this.localDataChannels.splice(s,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==st.Connected)return;const e=this.localTrackMap.get(te.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[te.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const i=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(s=>{let[,{id:a}]=s;return a})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(s=>{let[a,{track:c}]=s;return{type:a,track:c}})),t.forEach(s=>{let[a]=s;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,t){if(!this.connection||this.state!==st.Connected)throw new Q(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=t.filter(s=>{var a;return!((a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.get(s.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(s=>{var a;this.remoteDataChannelMap.has(e)?(a=this.remoteDataChannelMap.get(e))===null||a===void 0||a.set(s.id,s):this.remoteDataChannelMap.set(e,new Map([[s.id,s]]));const c=this.pendingRemoteDataChannels.findIndex(l=>{let{user:h,id:p}=l;return h.uid===e.uid&&p===s.id});c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),i.map(s=>s.id)}async subscribe(e,t,i,s,a){var c;if(!this.connection||this.state!==st.Connected)throw new Q(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;let l,h,p;if(a){const g=a.find(w=>{let{stream_type:R}=w;return R===t});if(!g)throw new Q(O.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const T=await this.connection.receive(t,g.ssrcs,String(e._uintid),g.attributes);this.connection instanceof Ft&&(p=T.transceiver),l=T.track,h=T.id}else{const g=await this.connection.receive(t,[{ssrcId:i,rtx:s}],String(e._uintid),void 0);this.connection instanceof Ft&&(p=g.transceiver),l=g.track,h=g.id}t===Ee.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new Yr(l,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new Ys(l,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack)),L("ENABLE_VIDEO_SEI")&&p&&(t==Ee.VIDEO?await Qz(p.receiver,{onSei:g=>{var T;(T=e._videoTrack)===null||T===void 0||T._onSei(g)}}):t==Ee.AUDIO&&await qz(p.receiver));const f=this.remoteUserMap.get(e);f?f.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const _=this.pendingRemoteTracks.findIndex(g=>{let{user:T,kind:w}=g;return T.uid===e.uid&&t===w});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Oe.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==st.Connected)throw new Q(O.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var s;let{user:a,mediaType:c}=i;return!((s=this.remoteUserMap.get(a))!==null&&s!==void 0&&s.has(c))});const t=await this.connection.batchReceive(e.map(i=>{let{user:s,mediaType:a,ssrcId:c,rtxSsrcId:l}=i;return{kind:a,ssrcMsg:[{ssrcId:c,rtx:l}],mslabel:String(s._uintid)}}));e.forEach((i,s)=>{let{user:a,mediaType:c}=i;const{track:l,id:h,transceiver:p}=t[s];c===Ee.AUDIO?(a._audioTrack?a._audioTrack._updateOriginMediaStreamTrack(l):(a._audioTrack=new Yr(l,a.uid,a._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(a._audioTrack.getTrackId()))),p&&a._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(a,a._audioTrack)):(a._videoTrack?a._videoTrack._updateOriginMediaStreamTrack(l):(a._videoTrack=new Ys(l,a.uid,a._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(a._videoTrack.getTrackId()))),p&&a._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(a,a._videoTrack));const f=this.remoteUserMap.get(a);f?f.set(c,h):this.remoteUserMap.set(a,new Map([[c,h]])),this.statsCollector.addRemoteStats(a.uid),this.statsUploader.startUploadInboundStats();const _=this.pendingRemoteTracks.findIndex(g=>{let{user:T,kind:w}=g;return T.uid===a.uid&&c===w});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Oe.MediaReconnectEnd,a.uid))})}async unsubscribe(e,t,i){const s=this.pendingRemoteTracks.filter(l=>{let{user:h,kind:p}=l;return t!==void 0?h.uid===e.uid&&t===p:h.uid===e.uid});if(s.forEach(l=>{const h=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(h,1)}),this.connection&&this.state===st.Connected||i||s.forEach(l=>{let{kind:h}=l;var p;if(h===Ee.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(h===Ee.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==st.Connected)return;const a=this.filterTobeUnSubscribedTracks(e,t);if(a.length===0)return;await this.connection.stopReceiving(a.map(l=>{let[,{id:h}]=l;return h}));const c=this.createUnsubscribeMessage(a);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),a.forEach(l=>{let[h,{kind:p}]=l;var f,_;if(p===Ee.VIDEO&&h._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===Ee.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((_=h._videoTrack)===null||_===void 0||_._destroy(),h._videoTrack=void 0);else if(p===Ee.AUDIO){var g;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((g=h._audioTrack)===null||g===void 0||g._destroy(),h._audioTrack=void 0)}}),c}async unsubscribeDataChannel(e,t){if(t.forEach(a=>{const c=this.pendingRemoteDataChannels.findIndex(l=>l.id===a.id);c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,t);if(i.length===0)return;t.forEach(a=>{a._close()});const s=this.remoteDataChannelMap.get(e);return i.forEach(a=>{s&&s.delete(a.id)}),s&&s.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(a=>a.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:a,mediaType:c}of e){const l=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:f}=h;return c!==void 0?p.uid===a.uid&&c===f:p.uid===a.uid});l.forEach(h=>{const p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),t=t.concat(l)}if(!this.connection||this.state!==st.Connected)return void t.forEach(a=>{let{user:c,kind:l}=a;var h;if(l===Ee.AUDIO)(h=c._audioTrack)===null||h===void 0||h._destroy(),c._audioTrack=void 0;else if(l===Ee.VIDEO){var p;(p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0}});const i=To(e).call(e,(a,c)=>{let{user:l,mediaType:h}=c;const p=this.filterTobeUnSubscribedTracks(l,h);return a.concat(p)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(a=>{let[,{id:c}]=a;return c}));const s=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(a=>{let[c,{kind:l}]=a;var h,p;if(l===Ee.VIDEO&&c._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===Ee.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),(p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0;else if(l===Ee.AUDIO){var f;this.unbindRemoteTrackEvents(c._audioTrack),(f=c._audioTrack)===null||f===void 0||f._destroy(),c._audioTrack=void 0}}),s}async muteRemote(e,t){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const s=t===Ee.VIDEO?e._videoSSRC:e._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(te.LocalAudioTrack);if((t==null?void 0:t.track)instanceof tn){const i=t.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return a!==te.LocalAudioTrack}).filter(s=>{let[a]=s;return!(e&&a===te.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(e&&s===te.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,i,s,a){if(e){const l=this.localTrackMap.get(te.LocalAudioTrack),h=s?this.localTrackMap.get(te.LocalVideoLowTrack):this.localTrackMap.get(te.LocalVideoTrack);Te.publish(this.store.sessionId,{eventElapse:Fn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(Tt.SCREEN_TRACK))!==-1,audio:!!l,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var c;i||(i=[]);const l=i.find(p=>p instanceof lt),h=s?(c=this.localTrackMap.get(te.LocalVideoTrack))===null||c===void 0?void 0:c.track:i.find(p=>p instanceof Ge);Te.publish(this.store.sessionId,{eventElapse:Fn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l==null?void 0:l.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(Tt.SCREEN_TRACK))!==-1,audio:!!l,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,i,s){const a=s===Ee.VIDEO?i._videoSSRC:i._audioSSRC;a&&Te.subscribe(this.store.sessionId,{succ:e,ec:t,video:s===Ee.VIDEO,audio:s===Ee.AUDIO,peerid:i.uid,subscribeRequestid:s===Ee.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Fn.measureFromSubscribeStart(this.store.clientId,a)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Tn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new hn({},this.store):this.isPlanB?new Rn({},this.store):new Ft({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(te.LocalAudioTrack);if((e==null?void 0:e.track)instanceof tn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=st.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(te.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(te.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Ge||t&&t.track instanceof lt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;const i=Array.from($i(t=this.remoteUserMap).call(t)).find(s=>s.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(te.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=du(e).call(e,(i,s)=>i.level-s.level),e}async disconnectForReconnect(){this.connection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=st.Reconnecting,L("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new hn({},this.store):this.isPlanB?new Rn({},this.store):new Ft({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:s}]=e;switch(i){case te.LocalVideoTrack:fe(t=s._hints).call(t,Tt.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case te.LocalAudioTrack:s instanceof tn?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case te.LocalVideoLowTrack:}}),this.emit(Oe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from($i(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(t,s)}),this.emit(Oe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,i]=e;Array.from($i(i).call(i)).forEach(s=>{this.setPendingRemoteDataChannel(t,s)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const i of this.pendingRemoteDataChannels){const{user:s,id:a}=i;if((e instanceof On?e.uid:e)===s.uid&&a===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const i of this.pendingRemoteTracks){const{user:s,kind:a}=i;if((e instanceof On?e.uid:e)===s.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Bi(function*(){if(!t.connection||t.state!==st.Connected||t.connection instanceof hn)return;const i=yield Be(t.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield Be(t.connection.restartICE(e));const c=yield Be(s.next());if(c.done)return;const l=c.value,h=yield l;switch(t.reportPCDisconnectedOrFailed(e),e){case xn.TCP:t._pcStatsUploadType=Ss.TCP_RESTART;break;case xn.RELAY:t._pcStatsUploadType=Ss.RELAY_RESTART;break;default:t._pcStatsUploadType=Ss.OLD_RESTART}t._isInRestartIce=!0,s.next(h)}catch(c){var a;(a=s)===null||a===void 0||a.throw(c)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(te.LocalVideoTrack),i=this.localTrackMap.get(te.LocalAudioTrack),s=e.videoSend.find(w=>w.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),a=e.audioSend.find(w=>w.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!s||!a)return 1;const c=Ui(this,Oe.NeedSignalRTT),l=s?s.rttMs:void 0,h=a?a.rttMs:void 0,p=l&&h?(l+h)/2:l||h,f=(p&&c?(p+c)/2:p||c)||0,_=100*e.sendPacketLossRate*.7/50+.3*f/1500,g=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,T=t==null?void 0:t.track;if(T&&T._encoderConfig&&T._hints.indexOf(Tt.SCREEN_TRACK)===-1){const w=T._encoderConfig.bitrateMax,R=e.bitrate.actualEncoded;if(w&&R){const I=(1e3*w-R)/(1e3*w);return eN[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const a=s._audioSSRC,c=s._videoSSRC,l=e.audioRecv.find(R=>R.ssrc===a),h=e.videoRecv.find(R=>R.ssrc===c);if(!l&&!h)return void(t+=1);const p=Ui(this,Oe.NeedSignalRTT),f=e.rtt,_=(f&&p?(f+p)/2:f||p)||0,g=l?l.jitterMs:void 0,T=e.recvPacketLossRate;let w=.7*T*100/50+.3*_/1500;g&&(w=.6*T*100/50+.2*_/1500+.2*g/400),t+=w<.1?1:w<.17?2:w<.36?3:w<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new W((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}async replaceTrack(e,t){var i;if(v.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==st.Connected)return;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:l}]=c;return e===l});if(!s)return;const a=s[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:a}]),this.bindLocalTrackEvents([{track:t,type:a}]),s[1].track=t),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(t,s[1].id)),this.isPlanB){const c=s[1];c.id=t._mediaStreamTrack.id,this.localTrackMap.set(a,c)}if(a===te.LocalVideoTrack&&!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&et().supportDualStreamEncoding){const c=this.localTrackMap.get(te.LocalVideoLowTrack);if(c){const l=e._mediaStreamTrack.clone();c.track._originMediaStreamTrack.stop(),c.track._mediaStreamTrack=l,c.track._originMediaStreamTrack=l,await new W((h,p)=>{this.handleReplaceTrack(c.track,h,p,!0)})}}}filterTobePublishedTracks(e,t,i){const s=[],a=this.getAllTracks();e=bd(e=e.filter(p=>a.indexOf(p)===-1));let c,l=!1;const h=this.localTrackMap.get(te.LocalAudioTrack);for(const p of e){if(p instanceof Ge&&(this.localTrackMap.has(te.LocalVideoTrack)||l?new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:p,type:te.LocalVideoTrack}),l=!0),t)){const f=this.getLowVideoTrack(p,i);s.push({track:f,type:te.LocalVideoLowTrack})}if(p instanceof lt)if(h){const f=h.track;if(f instanceof tn)Hv([p]),f.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0);else{const _=Kv([f,p]);v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_.getTrackId(),"]")),this.replaceTrack(f,_)}}else c instanceof tn?(Hv([p]),c.addAudioTrack(p)):c||!p._useAudioElement&&et().webAudioMediaStreamDest&&!p._bypassWebAudio?c=Kv(c?[p,c]:[p]):c=p}return c&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(c.getTrackId(),"]")),s.push({track:c,type:te.LocalAudioTrack})),s}filterTobeUnpublishedTracks(e){const t=[],i=this.getAllTracks();e=bd(e=e.filter(s=>i.indexOf(s)!==-1));for(const s of e){if(s instanceof lt){const a=this.localTrackMap.get(te.LocalAudioTrack);if(!a)continue;a.track instanceof tn?(a.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),a.track.trackList.length===0&&(t.push([te.LocalAudioTrack,a]),a.track.close())):t.push([te.LocalAudioTrack,a])}if(s instanceof Ge){const a=this.localTrackMap.get(te.LocalVideoTrack);if(!a)continue;t.push([te.LocalVideoTrack,a]);const c=this.localTrackMap.get(te.LocalVideoLowTrack);c&&t.push([te.LocalVideoLowTrack,c])}}return t}filterTobePublishedDataChannels(e){return e=(e=bd(e)).filter(t=>this.localDataChannels.findIndex(i=>i.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=bd(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:s}=t;switch(s){case te.LocalVideoTrack:i.addListener(he.GET_STATS,this.handleGetLocalVideoStats),i.addListener(he.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(he.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(he.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.addListener(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case te.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case te.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof tn?e.trackList.forEach(i=>{i.addListener(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(he.GET_STATS,this.handleGetLocalAudioStats),i.addListener(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(he.GET_STATS,this.handleGetLocalAudioStats),e.addListener(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(he.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:s}]=t;return{track:s,type:i}})),e.forEach(t=>{let{track:i,type:s}=t;switch(s){case te.LocalVideoTrack:i.off(he.GET_STATS,this.handleGetLocalVideoStats),i.off(he.GET_RTC_STATS,this.handleGetRTCStats),i.off(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(he.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(he.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.off(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case te.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof tn?e.trackList.forEach(t=>{t.off(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(he.GET_STATS,this.handleGetLocalAudioStats),t.off(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(he.GET_STATS,this.handleGetLocalAudioStats),e.off(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(he.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Ys&&t.addListener(he.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof Yr&&t.addListener(he.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(he.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(Ee.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(Ee.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,s)=>{var a;let c,l,{track:h,type:p}=i;switch(p){case te.LocalAudioTrack:c=it.Audio,l={dtx:h instanceof Ac&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case te.LocalVideoTrack:c=fe(a=h._hints).call(a,Tt.SCREEN_TRACK)?it.Screen:it.High,l=Pa(Pa({},vN(h)),{},{codec:this.store.codec});break;case te.LocalVideoLowTrack:c=it.Low,l=Pa(Pa({},vN(h)),{},{codec:this.store.codec})}return{stream_type:c,attributes:l,ssrcs:t[s]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let s,[a,{track:c,ssrcs:l,id:h}]=t;switch(a){case te.LocalVideoTrack:s=fe(i=c._hints).call(i,Tt.SCREEN_TRACK)?it.Screen:it.High;break;case te.LocalAudioTrack:s=it.Audio;break;case te.LocalVideoLowTrack:s=it.Low}return{stream_type:s,ssrcs:l,mid:h}})}assignLocalTracks(e,t){e.forEach((i,s)=>{let{track:a,type:c}=i;this.localTrackMap.set(c,{track:a,id:t[s].id,ssrcs:t[s].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Oe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),L("NEW_ICE_RESTART")){var i;if(fe(i=this._restartStates).call(i,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=l=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(v.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(l)),Ui(this,Oe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Oe.RequestRestartICE,l))},a=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),v.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Oe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},c=L("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(L("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&et().supportPCSetConfiguration)s(xn.RELAY),this._restartTimer=window.setTimeout(a,c);else if(mt())s(xn.UDP),this._restartTimer=window.setTimeout(a,4e3);else{if(s(xn.TCP),et().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{s(xn.RELAY),this._restartTimer=window.setTimeout(a,c)},c));this._restartTimer=window.setTimeout(a,c)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&L("ICE_RESTART")&&Ui(this,Oe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Oe.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Oe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Oe.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Te.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Pt.TRACER}).onSuccess(),this.emit(Oe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;const s=Array.from($i(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===t);var a;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(a=s.audioTrack)===null||a===void 0||a.emit(ga.FIRST_FRAME_DECODED),Te.firstRemoteFrame(this.store.sessionId,cn.FIRST_AUDIO_DECODE,Ct.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Fn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;const s=Array.from($i(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===t);s&&Te.firstRemoteFrame(this.store.sessionId,cn.FIRST_AUDIO_RECEIVED,Ct.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Fn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,s)=>{this.reportVideoFirstFrameDecoded(t,i,s)},e.onFirstVideoReceived=t=>{var i;const s=Array.from($i(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===t);s&&Te.firstRemoteFrame(this.store.sessionId,cn.FIRST_VIDEO_RECEIVED,Ct.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Fn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{const s=t.candidateType==="relay",a=i.candidateType==="relay";i.candidateType!=="unknown"&&s===a||this.emit(Oe.ConnectionTypeChange,s),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(fa(i))," -> ").concat(JSON.stringify(fa(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(fa(i))," -> ").concat(JSON.stringify(fa(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const i=this.localTrackMap.get(te.LocalAudioTrack);if(e instanceof lt&&(i==null?void 0:i.track)instanceof tn)return i.track.isActive||t.push([te.LocalAudioTrack,i]),t;const s=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:c}]=a;return e===c});if(s&&(t.push(s),s[0]===te.LocalVideoTrack)){const a=this.localTrackMap.get(te.LocalVideoLowTrack);a&&t.push([te.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){const t=[],i=this.localTrackMap.get(te.LocalAudioTrack);if(e instanceof lt&&(i==null?void 0:i.track)instanceof tn)return i.track.isActive&&t.push([te.LocalAudioTrack,i]),t;const s=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:c}]=a;return e===c});if(s)if(s[0]===te.LocalVideoTrack){t.push(s);const a=this.localTrackMap.get(te.LocalVideoLowTrack);a&&t.push([te.LocalVideoLowTrack,a])}else t.push(s);return t}createMuteMessage(e){return e.map(t=>{var i;let s,[a,{track:c,ssrcs:l,id:h}]=t;switch(a){case te.LocalAudioTrack:s=it.Audio;break;case te.LocalVideoTrack:s=fe(i=c._hints).call(i,Tt.SCREEN_TRACK)?it.Screen:it.High;break;case te.LocalVideoLowTrack:s=it.Low}return{stream_type:s,ssrcs:l,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var i;let s,[a,{track:c,ssrcs:l,id:h}]=t;switch(a){case te.LocalAudioTrack:s=it.Audio;break;case te.LocalVideoTrack:s=fe(i=c._hints).call(i,Tt.SCREEN_TRACK)?it.Screen:it.High;break;case te.LocalVideoLowTrack:s=it.Low}return{stream_type:s,ssrcs:l,mid:h}})}filterTobeUnSubscribedTracks(e,t){const i=[],s=this.remoteUserMap.get(e);if(!s)return i;if(t){const a=s.get(t);if(!a)return i;i.push([e,{kind:t,id:a}])}else Array.from(s.entries()).forEach(a=>{let[c,l]=a;i.push([e,{kind:c,id:l}])});return i}filterTobeUnSubscribedDataChannels(e,t){const i=[];return t.forEach(s=>{var a;(a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.has(s.id)&&i.push(s)}),i}createUnsubscribeMessage(e){const t=[];return e.forEach(i=>{let[s,{kind:a,id:c}]=i;switch(a){case Ee.VIDEO:return void(s._videoSSRC&&t.push({stream_type:Ee.VIDEO,ssrcId:s._videoSSRC}));case Ee.AUDIO:return void(s._audioSSRC&&t.push({stream_type:Ee.AUDIO,ssrcId:s._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(i=>{let[s,{kind:a}]=i;if(t.has(s)){let c=t.get(s);a===Ee.VIDEO?c|=en.Video:c|=en.Audio,t.set(s,c)}else a===Ee.VIDEO?t.set(s,en.Video):t.set(s,en.Audio)}),{users:Array.from(t.entries()).map(i=>{let[s,a]=i;return{stream_id:s.uid,stream_type:a}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:s}]=t;const a=this.remoteUserMap.get(i);a&&(a.delete(s),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(te.LocalVideoTrack),i=this.localTrackMap.get(te.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((i,s)=>{var a;let{stream_type:c}=i;return(a=t.find(l=>{let{stream_type:h}=l;return c===h}))===null||a===void 0?void 0:a.attributes})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof lt){var t;const s=this.filterTobeUnmutedTracks(e[i]);if(s.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(s.map(c=>{let[,{id:l}]=c;return l})));const a=this.createUnmuteMessage(s);return void await _t(this,Oe.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Oe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Oe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Sn(Sf(this.dtlsFailedCount,$t)),this.emit(Oe.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Xt(this,Oe.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Oe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(te.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Ge)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Ge).length>1)throw new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof lt).length>1&&(e.some(t=>t instanceof lt&&t._bypassWebAudio)||!et().webAudioMediaStreamDest))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Ge&&this.pendingLocalTracks.some(i=>i instanceof Ge))throw new Q(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof lt&&this.pendingLocalTracks.some(i=>i instanceof lt)&&(!et().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof lt&&i._bypassWebAudio)))throw new Q(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const i=!L("DISABLE_DUAL_STREAM_USE_ENCODING")&&et().supportDualStreamEncoding,s=Pa(Pa({},{width:160,height:120,framerate:15,bitrate:50}),t);let a;a=i?e._mediaStreamTrack.clone():jv(e,s);const c=Et(8,"track-low-"),l=new Ge(a,Pa(Pa({},i&&{scaleResolutionDownBy:aT(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,c);return l.on(_a.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,ma.LOW_STREAM)}),l._hints.push(Tt.LOW_STREAM),e.on("sei-to-send",h=>{l.emit("sei-to-send",h)}),e.addListener(he.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ft){var a,c,l,h;const p=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:f,dtlsTransportState:_,peerConnectionState:g}=this.connection,{local:T,remote:w}=await this.connection.getSelectedCandidatePair();Te.pcStats(this.store.sessionId,{startTime:p,eventElapse:e-p||0,iceconnectionsate:f,dtlsstate:_,connectionstate:g,intSucc:t?1:2,error:s,selectedLocalCandidateProtocol:(a=T==null?void 0:T.protocol)!==null&&a!==void 0?a:"",selectedLocalCandidateType:(c=T.candidateType)!==null&&c!==void 0?c:"",selectedLocalCandidateAddress:"".concat(T.address,":").concat(T.port),selectedRemoteCandidateProtocol:(l=w.protocol)!==null&&l!==void 0?l:"",selectedRemoteCandidateType:(h=w.candidateType)!==null&&h!==void 0?h:"",selectedRemoteCandidateAddress:"".concat(w.address,":").concat(w.port),restartCnt:i})}}reportVideoFirstFrameDecoded(e,t,i,s){var a;const c=Array.from($i(a=this.remoteUserMap).call(a)).find(l=>l._videoSSRC===e);if(c){s||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());const l=this.store.keyMetrics,h=l.subscribe.find(p=>p.userId===c.uid&&p.type==="video");Te.firstRemoteVideoDecode(this.store.sessionId,cn.FIRST_VIDEO_DECODE,Ct.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:i,subscribeElapse:Fn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.connection)return!1;const s=this.remoteUserMap.get(e);if(!s)return!1;const a=s.get(t);if(!a)return!1;const c=await this.connection.getRemoteSSRC(a);return c!==void 0&&c!==i}resetConnection(e){v.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===st.Connected?(v.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===kf.datachannel?new hn({},this.store):this.isPlanB?new Rn({},this.store):new Ft({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===te.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,ma.LOW_STREAM):i._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof Ft&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Ss.TCP_RESTART&&e===xn.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Ss.DISCONNECTED_OR_FAILED)))}}function Zn(n,e,t){const i=n[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){const s=this.mutex,a=await s.lock("From P2PChannel.".concat(e));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await i.apply(this,l)}finally{a()}},t}function RY(n){let e=iL();return function(t,i){let s=t.appId;s!==void 0&&(ct(i,10),to(i,s));let a=t.cid;a!==void 0&&(ct(i,16),ct(i,a));let c=t.cname;c!==void 0&&(ct(i,26),to(i,c));let l=t.deviceId;l!==void 0&&(ct(i,34),to(i,l));let h=t.elapse;h!==void 0&&(ct(i,40),Da(i,h));let p=t.fileSize;p!==void 0&&(ct(i,48),Da(i,ll(p)));let f=t.height;f!==void 0&&(ct(i,56),Da(i,ll(f)));let _=t.jpg;_!==void 0&&(ct(i,66),ct(i,_.length),function(Gi,ee){let se=ul(Gi,ee.length);Gi.bytes.set(ee,se)}(i,_));let g=t.networkType;g!==void 0&&(ct(i,72),Da(i,ll(g)));let T=t.osType;T!==void 0&&(ct(i,80),Da(i,ll(T)));let w=t.requestId;w!==void 0&&(ct(i,90),to(i,w));let R=t.sdkVersion;R!==void 0&&(ct(i,98),to(i,R));let I=t.sequence;I!==void 0&&(ct(i,104),Da(i,ll(I)));let N=t.sid;N!==void 0&&(ct(i,114),to(i,N));let D=t.timestamp;D!==void 0&&(ct(i,120),Da(i,D));let V=t.uid;V!==void 0&&(ct(i,128),ct(i,V));let G=t.vid;G!==void 0&&(ct(i,136),ct(i,G));let F=t.width;F!==void 0&&(ct(i,144),Da(i,ll(F)));let j=t.service;j!==void 0&&(ct(i,152),ct(i,j));let z=t.callbackData;z!==void 0&&(ct(i,162),to(i,z));let Y=t.jpgEncryption;Y!==void 0&&(ct(i,168),ct(i,Y));let re=t.requestType;re!==void 0&&(ct(i,176),ct(i,re));let ae=t.scorePorn;ae!==void 0&&(ct(i,185),$v(i,ae));let Ue=t.scoreSexy;Ue!==void 0&&(ct(i,193),$v(i,Ue));let ze=t.scoreNeutral;ze!==void 0&&(ct(i,201),$v(i,ze));let vt=t.scene;vt!==void 0&&(ct(i,208),ct(i,vt));let nn=t.ossFilePrefix;nn!==void 0&&(ct(i,218),to(i,nn));let It=t.serviceVendor;if(It!==void 0)for(let Gi of It){ct(i,226);let ee=iL();wY(Gi,ee),ct(i,ee.limit),NY(i,ee),bY(ee)}}(n,e),function(t){let i=t.bytes,s=t.limit;return i.length===s?i:i.subarray(0,s)}(e)}function CY(n){return function(t){let i={};e:for(;!rL(t);){let s=no(t);switch(s>>>3){case 0:break e;case 1:i.code=no(t);break;case 2:i.msg=sL(t,no(t));break;case 3:{let a=AY(t);i.data=IY(t),t.limit=a;break}default:tL(t,7&s)}}return i}({bytes:e=n,offset:0,limit:e.length});var e}function IY(n){let e={};e:for(;!rL(n);){let t=no(n);switch(t>>>3){case 0:break e;case 1:e.requestId=sL(n,no(n));break;case 2:e.requestType=no(n)>>>0;break;case 3:e.scorePorn=Qv(n);break;case 4:e.scoreSexy=Qv(n);break;case 5:e.scoreNeutral=Qv(n);break;case 6:e.requestScene=no(n)>>>0;break;case 7:e.scene=no(n)>>>0;break;default:tL(n,7&t)}}return e}function wY(n,e){let t=n.service;t!==void 0&&(ct(e,8),ct(e,t));let i=n.vendor;i!==void 0&&(ct(e,16),ct(e,i));let s=n.token;s!==void 0&&(ct(e,26),to(e,s));let a=n.callbackUrl;a!==void 0&&(ct(e,34),to(e,a))}function AY(n){let e=no(n),t=n.limit;return n.limit=n.offset+e,t}function tL(n,e){switch(e){case 0:for(;128&oL(n););break;case 2:Jv(n,no(n));break;case 5:Jv(n,4);break;case 1:Jv(n,8);break;default:throw new Error("Unimplemented type: "+e)}}$([Zn,A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",W)],Cn.prototype,"startP2PConnection",null),$([Zn,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",W)],Cn.prototype,"connect",null),$([Zn,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",void 0)],Cn.prototype,"updateRemoteRTPCapabilities",null),$([Zn,A("design:type",Function),A("design:paramtypes",[Object,Object,Array,Object,String,String]),A("design:returntype",W)],Cn.prototype,"preConnect",null),$([Zn,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Cn.prototype,"publishDataChannel",null),$([Zn,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Cn.prototype,"unpublish",null),$([Zn,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Cn.prototype,"unpublishDataChannel",null),$([Zn,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",W)],Cn.prototype,"unpublishLowStream",null),$([Zn,A("design:type",Function),A("design:paramtypes",[On,Array]),A("design:returntype",W)],Cn.prototype,"subscribeDataChannel",null),$([Zn,A("design:type",Function),A("design:paramtypes",[On,String,Number,Number,Array]),A("design:returntype",W)],Cn.prototype,"subscribe",null),$([Zn,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Cn.prototype,"massSubscribe",null),$([Zn,A("design:type",Function),A("design:paramtypes",[On,String,Boolean]),A("design:returntype",W)],Cn.prototype,"unsubscribe",null),$([Zn,A("design:type",Function),A("design:paramtypes",[On,Array]),A("design:returntype",W)],Cn.prototype,"unsubscribeDataChannel",null),$([Zn,A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],Cn.prototype,"massUnsubscribe",null),$([Zn,A("design:type",Function),A("design:paramtypes",[On,String]),A("design:returntype",W)],Cn.prototype,"muteRemote",null),$([Zn,A("design:type",Function),A("design:paramtypes",[On,String]),A("design:returntype",W)],Cn.prototype,"unmuteRemote",null),$([Zn,A("design:type",Function),A("design:paramtypes",[On,String]),A("design:returntype",W)],Cn.prototype,"hasRemoteMediaWithLock",null),$([Zn,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",W)],Cn.prototype,"disconnectForReconnect",null),$([Zn,A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],Cn.prototype,"updateBitrateLimit",null),$([Zn,A("design:type",Function),A("design:paramtypes",[On,String,Number]),A("design:returntype",W)],Cn.prototype,"remoteMediaSsrcChanged",null);let OY=new Float32Array(1);new Uint8Array(OY.buffer);let qv=new Float64Array(1),Ai=new Uint8Array(qv.buffer);function ll(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let nL=[];function iL(){const n=nL.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}function bY(n){nL.push(n)}function Jv(n,e){if(n.offset+e>n.limit)throw new Error("Skip past limit");n.offset+=e}function rL(n){return n.offset>=n.limit}function ul(n,e){let t=n.bytes,i=n.offset,s=n.limit,a=i+e;if(a>t.length){let c=new Uint8Array(2*a);c.set(t),n.bytes=c}return n.offset=a,a>s&&(n.limit=a),i}function Xv(n,e){let t=n.offset;if(t+e>n.limit)throw new Error("Read past limit");return n.offset+=e,t}function sL(n,e){let t=Xv(n,e),i=String.fromCharCode,s=n.bytes,a="�",c="";for(let l=0;l<e;l++){let h,p,f,_,g=s[l+t];128&g?(224&g)==192?l+1>=e?c+=a:(h=s[l+t+1],(192&h)!=128?c+=a:(_=(31&g)<<6|63&h,_<128?c+=a:(c+=i(_),l++))):(240&g)==224?l+2>=e?c+=a:(h=s[l+t+1],p=s[l+t+2],(49344&(h|p<<8))!=32896?c+=a:(_=(15&g)<<12|(63&h)<<6|63&p,_<2048||_>=55296&&_<=57343?c+=a:(c+=i(_),l+=2))):(248&g)==240?l+3>=e?c+=a:(h=s[l+t+1],p=s[l+t+2],f=s[l+t+3],(12632256&(h|p<<8|f<<16))!=8421504?c+=a:(_=(7&g)<<18|(63&h)<<12|(63&p)<<6|63&f,_<65536||_>1114111?c+=a:(_-=65536,c+=i(55296+(_>>10),56320+(1023&_)),l+=3))):c+=a:c+=i(g)}return c}function to(n,e){let t=e.length,i=0;for(let c=0;c<t;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<t&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}ct(n,i);let s=ul(n,i),a=n.bytes;for(let c=0;c<t;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<t&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?a[s++]=l:(l<2048?a[s++]=l>>6&31|192:(l<65536?a[s++]=l>>12&15|224:(a[s++]=l>>18&7|240,a[s++]=l>>12&63|128),a[s++]=l>>6&63|128),a[s++]=63&l|128)}}function NY(n,e){let t=ul(n,e.limit),i=n.bytes,s=e.bytes;for(let a=0,c=e.limit;a<c;a++)i[a+t]=s[a]}function oL(n){return n.bytes[Xv(n,1)]}function aL(n,e){let t=ul(n,1);n.bytes[t]=e}function Qv(n){let e=Xv(n,8),t=n.bytes;return Ai[0]=t[e++],Ai[1]=t[e++],Ai[2]=t[e++],Ai[3]=t[e++],Ai[4]=t[e++],Ai[5]=t[e++],Ai[6]=t[e++],Ai[7]=t[e++],qv[0]}function $v(n,e){let t=ul(n,8),i=n.bytes;qv[0]=e,i[t++]=Ai[0],i[t++]=Ai[1],i[t++]=Ai[2],i[t++]=Ai[3],i[t++]=Ai[4],i[t++]=Ai[5],i[t++]=Ai[6],i[t++]=Ai[7]}function no(n){let e,t=0,i=0;do e=oL(n),t<32&&(i|=(127&e)<<t),t+=7;while(128&e);return i}function ct(n,e){for(e>>>=0;e>=128;)aL(n,127&e|128),e>>>=7;aL(n,e)}function Da(n,e){let t=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,s=e.high>>>24,a=s===0?i===0?t<16384?t<128?1:2:t<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,c=ul(n,a),l=n.bytes;switch(a){case 10:l[c+9]=s>>>7&1;case 9:l[c+8]=a!==9?128|s:127&s;case 8:l[c+7]=a!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=a!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=a!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=a!==5?128|i:127&i;case 4:l[c+3]=a!==4?t>>>21|128:t>>>21&127;case 3:l[c+2]=a!==3?t>>>14|128:t>>>14&127;case 2:l[c+1]=a!==2?t>>>7|128:t>>>7&127;case 1:l[c]=a!==1?128|t:127&t}}function cL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}const PY=new Map([["moderation",1],["supervise",2]]);class Lm extends At{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(ln.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=To(t=e.map(i=>PY.get(i)||0)).call(t,(i,s)=>i+s),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),S(this,"name","AgoraRTCVideoContentInspect"),S(this,"_connectionState",er.CONNECTING),S(this,"_innerConnectionState",void 0),S(this,"sequence",0),S(this,"inspectStartTime",void 0),S(this,"workerManagerConnection",void 0),S(this,"workerConnection",void 0),S(this,"workerMessageLengthLimit",void 0),S(this,"inspectIntervalMinimum",void 0),S(this,"qualityRatio",void 0),S(this,"_connectInfo",void 0),S(this,"_cancelTokenSource",vi.CancelToken.source()),S(this,"_retryConfig",void 0),S(this,"wmSequence",0),S(this,"inspectInterval",void 0),S(this,"inspectTimer",null),S(this,"ossFilePrefix",void 0),S(this,"extraInfo",void 0),S(this,"_inspectType",void 0),S(this,"_inspectMode",void 0),S(this,"_quality",1),S(this,"qualityTimer",null),S(this,"_inspectId",void 0),S(this,"_needWorkUrlOnly",!1),S(this,"inspectImage",()=>{if(this.connectionState!==er.CONNECTED)throw new B(O.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===er.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Et(5,"inspect-"),this.workerMessageLengthLimit=L("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=L("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=L("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Pu("worker-manager-"+this._inspectId,$t),this.on(ln.STATE_CHANGE,(t,i)=>{this._innerConnectionState=t,v.debug("[".concat(this._inspectId,"] Inspect operation :").concat(tr[t]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Pu("worker-"+this._inspectId,$t),this.handleWorkerEvents()}async init(e,t){this.emit(ln.STATE_CHANGE,tr.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=t,new W((s,a)=>{this.on(ln.CONNECTION_STATE_CHANGE,(c,l)=>{l===er.CONNECTED&&s()}),this.requestAP(e,i,t).then(c=>{this.connectWorkerManager(c)}).catch(c=>{a(c)})})}async requestAP(e,t,i){const s=L("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),a=await function(l,h,p,f){let{appId:_,areaCode:g,cname:T,sid:w,token:R,uid:I}=h;Vd++;const N="image_moderation_api",D={service_name:N,json_body:JSON.stringify({appId:_,areaCode:g,cname:T,command:"allocateEdge",requestId:Vd,seq:Vd,sid:w,token:R,ts:Date.now(),uid:I+""})};let V,G,F=l[0];return _s(async()=>{V=Date.now();const j=await Io(F,{data:D,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(G=Date.now()-V,j.code!==0){const ae=new B(O.UNEXPECTED_RESPONSE,"image inspect ap error, code"+j.code,{retry:!0,responseTime:G});throw v.error(ae.toString()),ae}const z=JSON.parse(j.json_body);if(z.code!==200){const ae=new B(O.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(z.code,", reason: ").concat(z.reason),{code:z.code,responseTime:G});throw v.error(ae.toString()),ae}if(!z.servers||!Array.isArray(z.servers)||z.servers.length===0){const ae=new B(O.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:z.code,responseTime:G});throw v.error(ae.toString()),ae}const Y=L("VIDEO_INSPECT_WORKER_MANAGER_HOST"),re=L("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:z.servers.map(ae=>{let{address:Ue,wss:ze}=ae;if(Ue&&ze)return"wss://".concat(Ue.replace(/\./g,"-"),".").concat(Y,":").concat(re||ze)}).filter(ae=>!!ae),workerToken:z.workerToken,vid:z.vid,responseTime:G}},(j,z)=>(Te.apworkerEvent(w,{success:!0,sc:200,serviceName:N,responseDetail:JSON.stringify(j.addressList),firstSuccess:z===0,responseTime:G,serverIp:l[z%l.length]}),!1),(j,z)=>(Te.apworkerEvent(w,{success:!1,sc:j.data&&j.data.code||200,serviceName:N,responseTime:G,serverIp:l[z%l.length]}),!!(j.code!==O.OPERATION_ABORTED&&j.code!==O.UNEXPECTED_RESPONSE||j.data&&j.data.retry)&&(F=l[(z+1)%l.length],!0)),f)}(s,e,t,i);this.emit(ln.STATE_CHANGE,tr.AP_CONNECTED);const{addressList:c}=a;return this.wmSequence++,c}async connectWorkerManager(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=t,this.emit(ln.STATE_CHANGE,tr.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ne.CONNECTED,async()=>{this.emit(ln.STATE_CHANGE,tr.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.20.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ne.CLOSED,()=>{this._innerConnectionState<tr.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ne.FAILED,()=>{this._innerConnectionState<tr.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ne.RECONNECTING,()=>{this._innerConnectionState<tr.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ne.ON_MESSAGE,async e=>{this.emit(ln.STATE_CHANGE,tr.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(e.data);if(i.code!==200)throw v.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new B(O.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&t))throw v.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new B(O.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const s=L("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,a=t.replace(/:\d+\/?$/,":".concat(s));this.emit(ln.STATE_CHANGE,tr.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(ln.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(Ne.WILL_RECONNECT,(e,t,i)=>{i(e)}),this.workerManagerConnection.on(Ne.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(Ne.CONNECTED,async()=>{this.emit(ln.STATE_CHANGE,tr.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=er.CONNECTED}),this.workerConnection.on(Ne.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const i=CY(new Uint8Array(e.data));if(L("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&v.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ln.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var t;const s={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},a=To(t=Object.keys(s)).call(t,(l,h)=>s[l]>s[h]?l:h,"porn"),c=Object.keys(s).find(l=>l===a);this.emit(ln.INSPECT_RESULT,c)}else this.emit(ln.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(ln.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else v.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ln.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ne.CLOSED,()=>{this.connectionState=er.CLOSED}),this.workerConnection.on(Ne.FAILED,()=>{this.connectionState=er.CLOSED}),this.workerConnection.on(Ne.RECONNECTING,()=>{this.connectionState=this.connectionState===er.CONNECTED?er.RECONNECTING:er.CONNECTING}),this.workerConnection.on(Ne.WILL_RECONNECT,(e,t,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(Ne.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(ln.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{t(i)})})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){this.sequence++;const e=Ui(this,ln.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(ln.INSPECT_RESULT,void 0,new B(O.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(e,t);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(ln.INSPECT_RESULT,void 0,new B(O.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:i,cname:s,cid:a,vid:c,sid:l,uid:h}=t;const p=Date.now(),f=await e.getCurrentFrameImage("image/jpeg",this.quality),_=await TP(f,i,s),g=this.sequence+"-"+a+"-"+h+"-"+p+"-"+Et(12,""),T={appId:i,cid:a,cname:s,deviceId:"",elapse:Lm.intToLong(Number(p-this.inspectStartTime)),fileSize:_.byteLength,jpgEncryption:2,height:f.height,width:f.width,jpg:_,networkType:6,osType:7,requestId:g,sdkVersion:"4.20.2",sequence:this.sequence,sid:l,timestamp:Lm.intToLong(p),uid:h,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete T.callbackData,this.ossFilePrefix===void 0&&delete T.ossFilePrefix;const w=RY(T);if(w.byteLength<this.workerMessageLengthLimit){if(L("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const R=function(I){for(var N=1;N<arguments.length;N++){var D=arguments[N]!=null?arguments[N]:{};N%2?cL(Object(D),!0).forEach(function(V){S(I,V,D[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(D)):cL(Object(D)).forEach(function(V){Object.defineProperty(I,V,Object.getOwnPropertyDescriptor(D,V))})}return I}({},T);delete R.jpg,v.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(R))}return w}{const R=this.quality*this.qualityRatio;return this.quality=R,await this.generateRequestData(e,{appId:i,cname:s,cid:a,vid:c,sid:l,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=vi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=er.CLOSED,this.emit(ln.STATE_CHANGE,tr.CLOSED)}}function DY(n){let e=function(){const t=MY.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(t,i){let s=t.appId;s!==void 0&&(Yt(i,10),ka(i,s));let a=t.cid;a!==void 0&&(Yt(i,16),Yt(i,a));let c=t.cname;c!==void 0&&(Yt(i,26),ka(i,c));let l=t.deviceId;l!==void 0&&(Yt(i,34),ka(i,l));let h=t.elapse;h!==void 0&&(Yt(i,40),La(i,h));let p=t.fileSize;p!==void 0&&(Yt(i,48),La(i,hl(p)));let f=t.height;f!==void 0&&(Yt(i,56),La(i,hl(f)));let _=t.jpg;_!==void 0&&(Yt(i,66),Yt(i,_.length),lL(i,_));let g=t.networkType;g!==void 0&&(Yt(i,72),La(i,hl(g)));let T=t.osType;T!==void 0&&(Yt(i,80),La(i,hl(T)));let w=t.requestId;w!==void 0&&(Yt(i,90),ka(i,w));let R=t.sdkVersion;R!==void 0&&(Yt(i,98),ka(i,R));let I=t.sequence;I!==void 0&&(Yt(i,104),La(i,hl(I)));let N=t.sid;N!==void 0&&(Yt(i,114),ka(i,N));let D=t.timestamp;D!==void 0&&(Yt(i,120),La(i,D));let V=t.uid;V!==void 0&&(Yt(i,128),Yt(i,V));let G=t.vid;G!==void 0&&(Yt(i,136),Yt(i,G));let F=t.width;F!==void 0&&(Yt(i,144),La(i,hl(F)));let j=t.service;j!==void 0&&(Yt(i,152),Yt(i,j));let z=t.callbackData;z!==void 0&&(Yt(i,162),Yt(i,z.length),lL(i,z));let Y=t.ticket;Y!==void 0&&(Yt(i,170),ka(i,Y));let re=t.vendorConfigs;re!==void 0&&(Yt(i,178),ka(i,re))}(n,e),function(t){let i=t.bytes,s=t.limit;return i.length===s?i:i.subarray(0,s)}(e)}function kY(n){return function(t){let i={};e:for(;!UY(t);){let s=ph(t);switch(s>>>3){case 0:break e;case 1:i.code=ph(t);break;case 2:i.msg=uL(t,ph(t));break;case 3:i.requestId=uL(t,ph(t));break;case 4:i.timestamp=xY(t,!1);break;default:LY(t,7&s)}}return i}({bytes:e=n,offset:0,limit:e.length});var e}function LY(n,e){switch(e){case 0:for(;128&ss(n););break;case 2:Zv(n,ph(n));break;case 5:Zv(n,4);break;case 1:Zv(n,8);break;default:throw new Error("Unimplemented type: "+e)}}function hl(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let MY=[];function Zv(n,e){if(n.offset+e>n.limit)throw new Error("Skip past limit");n.offset+=e}function UY(n){return n.offset>=n.limit}function Mm(n,e){let t=n.bytes,i=n.offset,s=n.limit,a=i+e;if(a>t.length){let c=new Uint8Array(2*a);c.set(t),n.bytes=c}return n.offset=a,a>s&&(n.limit=a),i}function dL(n,e){let t=n.offset;if(t+e>n.limit)throw new Error("Read past limit");return n.offset+=e,t}function lL(n,e){let t=Mm(n,e.length);n.bytes.set(e,t)}function uL(n,e){let t=dL(n,e),i=String.fromCharCode,s=n.bytes,a="�",c="";for(let l=0;l<e;l++){let h,p,f,_,g=s[l+t];128&g?(224&g)==192?l+1>=e?c+=a:(h=s[l+t+1],(192&h)!=128?c+=a:(_=(31&g)<<6|63&h,_<128?c+=a:(c+=i(_),l++))):(240&g)==224?l+2>=e?c+=a:(h=s[l+t+1],p=s[l+t+2],(49344&(h|p<<8))!=32896?c+=a:(_=(15&g)<<12|(63&h)<<6|63&p,_<2048||_>=55296&&_<=57343?c+=a:(c+=i(_),l+=2))):(248&g)==240?l+3>=e?c+=a:(h=s[l+t+1],p=s[l+t+2],f=s[l+t+3],(12632256&(h|p<<8|f<<16))!=8421504?c+=a:(_=(7&g)<<18|(63&h)<<12|(63&p)<<6|63&f,_<65536||_>1114111?c+=a:(_-=65536,c+=i(55296+(_>>10),56320+(1023&_)),l+=3))):c+=a:c+=i(g)}return c}function ka(n,e){let t=e.length,i=0;for(let c=0;c<t;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<t&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}Yt(n,i);let s=Mm(n,i),a=n.bytes;for(let c=0;c<t;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<t&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?a[s++]=l:(l<2048?a[s++]=l>>6&31|192:(l<65536?a[s++]=l>>12&15|224:(a[s++]=l>>18&7|240,a[s++]=l>>12&63|128),a[s++]=l>>6&63|128),a[s++]=63&l|128)}}function ss(n){return n.bytes[dL(n,1)]}function hL(n,e){let t=Mm(n,1);n.bytes[t]=e}function ph(n){let e,t=0,i=0;do e=ss(n),t<32&&(i|=(127&e)<<t),t+=7;while(128&e);return i}function Yt(n,e){for(e>>>=0;e>=128;)hL(n,127&e|128),e>>>=7;hL(n,e)}function xY(n,e){let t,i=0,s=0,a=0;return t=ss(n),i=127&t,128&t&&(t=ss(n),i|=(127&t)<<7,128&t&&(t=ss(n),i|=(127&t)<<14,128&t&&(t=ss(n),i|=(127&t)<<21,128&t&&(t=ss(n),s=127&t,128&t&&(t=ss(n),s|=(127&t)<<7,128&t&&(t=ss(n),s|=(127&t)<<14,128&t&&(t=ss(n),s|=(127&t)<<21,128&t&&(t=ss(n),a=127&t,128&t&&(t=ss(n),a|=(127&t)<<7))))))))),{low:i|s<<28,high:s>>>4|a<<24,unsigned:e}}function La(n,e){let t=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,s=e.high>>>24,a=s===0?i===0?t<16384?t<128?1:2:t<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,c=Mm(n,a),l=n.bytes;switch(a){case 10:l[c+9]=s>>>7&1;case 9:l[c+8]=a!==9?128|s:127&s;case 8:l[c+7]=a!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=a!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=a!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=a!==5?128|i:127&i;case 4:l[c+3]=a!==4?t>>>21|128:t>>>21&127;case 3:l[c+2]=a!==3?t>>>14|128:t>>>14&127;case 2:l[c+1]=a!==2?t>>>7|128:t>>>7&127;case 1:l[c]=a!==1?128|t:127&t}}const pL={},fL={},Um=4294967296,VY=Um*Um,mL=VY/2;EL(0,!0);const _L=EL(0),FY=fh(0,-2147483648,!1),BY=fh(-1,2147483647,!1);function EL(n,e){let t,i,s;return e?(s=0<=(n>>>=0)&&n<256)&&(i=fL[n],i)?i:(t=fh(n,0,!0),s&&(fL[n]=t),t):(s=-128<=(n|=0)&&n<128)&&(i=pL[n],i)?i:(t=fh(n,n<0?-1:0,!1),s&&(pL[n]=t),t)}function fh(n,e,t){return{low:0|n,high:0|e,unsigned:!!t}}function jY(n,e){if(isNaN(n))return _L;{if(n<=-mL)return FY;if(n+1>=mL)return BY}return n<0?_L:fh(n%Um|0,n/Um|0,e)}function gL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}class ey extends At{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(yr.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var t;super(),S(this,"name","AgoraRTCImageModeration"),S(this,"_connectionState",xi.CONNECTING),S(this,"_sequence",0),S(this,"_moderationStartTime",void 0),S(this,"_workerConnection",void 0),S(this,"_workerMessageLengthLimit",void 0),S(this,"_qualityRatio",void 0),S(this,"_connectInfo",void 0),S(this,"_cancelTokenSource",vi.CancelToken.source()),S(this,"_retryConfig",void 0),S(this,"_moderationInterval",void 0),S(this,"_moderationTimer",null),S(this,"_moderationMode",1),S(this,"_quality",1),S(this,"_qualityTimer",null),S(this,"_ticket",void 0),S(this,"_moderationIntervalMinimum",void 0),S(this,"_uploadFailedNum",0),S(this,"_uploadNum",0),S(this,"_uploadTimer",null),S(this,"_extraInfo",void 0),S(this,"_vendor",""),S(this,"_encoder",new TextEncoder),S(this,"_moderationId",void 0),S(this,"inspectImage",()=>{if(this.connectionState!==xi.CONNECTED)throw new B(O.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===xi.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Et(5,"image-moderation-"),this._workerMessageLengthLimit=L("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=L("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(t=e.interval)!==null&&t!==void 0?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=L("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Pu("worker-"+this._moderationId,$t),this.on(yr.STATE_CHANGE,(i,s)=>{v.debug("[".concat(this._moderationId,"] Moderation operation :").concat(ua[i]," ").concat(s||""))}),this.handleWorkerEvents()}async init(e,t){this.emit(yr.STATE_CHANGE,ua.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=t,new W((s,a)=>{this.on(yr.CONNECTION_STATE_CHANGE,(c,l)=>{c===xi.CONNECTED&&s()}),this.requestAP(e,i,t).then(c=>{this.connectWorker(c)}).catch(c=>{a(c)})})}updateConfig(e){var t;this._moderationInterval=(t=e.interval)!==null&&t!==void 0?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),v.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===xi.CONNECTED&&this.inspectImage()}async requestAP(e,t,i){const s=L("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),a=await function(h,p,f,_){let{appId:g,areaCode:T,cname:w,sid:R,token:I,uid:N}=p;Vd++;const D="moderation_plugin",V={service_name:D,json_body:JSON.stringify({appId:g,areaCode:T,cname:w,command:"allocateEdge",requestId:Vd,seq:Vd,sid:R,appToken:I,ts:Date.now(),uid:N+""})};let G,F,j=h[0];return _s(async()=>{G=Date.now();const z=await Io(j,{data:V,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(F=Date.now()-G,z.code!==0){const ae=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+z.code,{retry:!0,responseTime:F});throw v.error(ae.toString()),ae}const Y=JSON.parse(z.json_body);if(Y.code!==200){const ae=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Y.code,", reason: ").concat(Y.reason),{code:Y.code,responseTime:F});throw v.error(ae.toString()),ae}if(!Y.servers||!Array.isArray(Y.servers)||Y.servers.length===0){const ae=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Y.code,responseTime:F});throw v.error(ae.toString()),ae}if(!Y.servers.some(ae=>!!ae.wss)){const ae=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Y.code,responseTime:F});throw v.error(ae.toString()),ae}const re=L("IMAGE_MODERATION_WORKER_HOST");return{addressList:Y.servers.map(ae=>{let{address:Ue,wss:ze}=ae;if(Ue&&ze)return"wss://".concat(Ue.replace(/\./g,"-"),".").concat(re,":").concat(ze,"/moderation")}).filter(ae=>!!ae),workerToken:Y.workerToken,vid:Y.vid,ticket:Y.appTicket,responseTime:F}},(z,Y)=>(Te.apworkerEvent(R,{success:!0,sc:200,serviceName:D,responseDetail:JSON.stringify(z.addressList),firstSuccess:Y===0,responseTime:F,serverIp:h[Y%h.length]}),!1),(z,Y)=>(Te.apworkerEvent(R,{success:!1,sc:z.data&&z.data.code||200,serviceName:D,responseTime:F,serverIp:h[Y%h.length]}),!!(z.code!==O.OPERATION_ABORTED&&z.code!==O.UNEXPECTED_RESPONSE||z.data&&z.data.retry)&&(j=h[(Y+1)%h.length],!0)),_)}(s,e,t,i);this.emit(yr.STATE_CHANGE,ua.AP_CONNECTED);const{addressList:c,ticket:l}=a;return this._ticket=l,c}async connectWorker(e){this.emit(yr.STATE_CHANGE,ua.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Ne.CONNECTED,async()=>{this.emit(yr.STATE_CHANGE,ua.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=xi.CONNECTED}),this._workerConnection.on(Ne.CLOSED,()=>{this.connectionState=xi.CLOSED}),this._workerConnection.on(Ne.FAILED,()=>{this.connectionState=xi.CLOSED}),this._workerConnection.on(Ne.RECONNECTING,()=>{this.connectionState=this.connectionState===xi.CONNECTED?xi.RECONNECTING:xi.CONNECTING}),this._workerConnection.on(Ne.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const t=kY(new Uint8Array(e.data));L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,t.code===void 0||t.code===0||(this._uploadFailedNum++,v.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Te.reportApiInvoke(this._connectInfo.sid||null,{name:Jt.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:Pt.TRACER}).onError(new B(O.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null},L("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else v.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Ne.WILL_RECONNECT,(e,t,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on(Ne.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=Ui(this,yr.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(e,t);this._workerConnection.sendMessage(i,!0,!0)}else L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:i,cname:s,cid:a,vid:c,sid:l,uid:h}=t;const p=Date.now(),f=await e.getCurrentFrameImage("image/jpeg",this.quality),_=await TP(f,i,s),g=this._sequence+"-"+a+"-"+h+"-"+p+"-"+Et(12,""),T={appId:i,cid:a,cname:s,deviceId:"",elapse:ey.intToLong(Number(p-this._moderationStartTime)),fileSize:f.buffer.byteLength,height:f.height,width:f.width,jpg:_,networkType:6,osType:7,requestId:g,sdkVersion:"4.20.2",sequence:this._sequence,sid:l,timestamp:jY(p),uid:h,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete T.callbackData;const w=DY(T);if(w.byteLength<this._workerMessageLengthLimit){if(L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const R=function(I){for(var N=1;N<arguments.length;N++){var D=arguments[N]!=null?arguments[N]:{};N%2?gL(Object(D),!0).forEach(function(V){S(I,V,D[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(D)):gL(Object(D)).forEach(function(V){Object.defineProperty(I,V,Object.getOwnPropertyDescriptor(D,V))})}return I}({},T);delete R.jpg,v.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(R))}return w}{const R=this.quality*this._qualityRatio;return this.quality=R,await this.generateRequestData(e,{appId:i,cname:s,cid:a,vid:c,sid:l,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=vi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=xi.CLOSED,this.emit(yr.STATE_CHANGE,ua.CLOSED)}}function SL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function TL(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?SL(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):SL(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const GY=Date.now(),WY=20,ty=new Map,xm=new Map;async function vL(n){const e=ty.get(n),t=Array.isArray(e)&&e[e.length-1],i=xm.get(n);if(!t)return void(i.isSyncing=!1);const s={uid:t.uid,payload:t.payload};i.firstRecvTs===0&&(i.firstRecvTs=t.recvTs,i.firstSendTs=t.sendTs);const a=t.sendTs-i.firstSendTs,c=a-(Date.now()-i.firstRecvTs);c>0&&(i.firstRecvTs=Date.now()-a);let l=t.mediaDelay+c;l<=0?(e.pop(),yL(t.context,s),l=0):l=Math.min(l,WY),setTimeout(()=>e.length&&vL(n),l)}function yL(n,e){n.safeEmit(qe.STREAM_MESSAGE,e.uid,e.payload),n.onStreamMessage&&n.onStreamMessage(e)}function HY(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0;if(!n.syncWithAudio)return yL(t,{uid:n.uid,payload:n.payload});const i="".concat(t.id,"-").concat(n.uid),s=ty.get(i)||[],a=s.findIndex(p=>n.sendTs>=p.sendTs),c=TL(TL({},n),{},{context:t,mediaDelay:e,recvTs:Date.now()});a===-1?s.push(c):s.splice(a,0,c),ty.set(i,s);let l=!1;var h;xm.has(i)?l=!((h=xm.get(i))===null||h===void 0||!h.isSyncing):xm.set(i,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||vL(i)}const KY=Ze().name;function zY(){return!function(n,e,t){const i=Ze();if(i.os!==on.IOS||!i.osVersion)return!1;const s=i.osVersion.split(".");return Number(s[0])<n}(16)&&!function(n,e,t){const i=Ze();if(i.name!==rt.SAFARI||!i.osVersion)return!1;const s=i.version.split(".");return Number(s[0])<n}(16)}function RL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function Is(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?RL(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):RL(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}Tn.setLogger(v);class ut extends At{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),S(this,"store",void 0),S(this,"_uid",void 0),S(this,"_channelName",void 0),S(this,"_uintUid",void 0),S(this,"_users",[]),S(this,"_config",void 0),S(this,"_clientId",void 0),S(this,"_appId",void 0),S(this,"_sessionId",null),S(this,"_key",void 0),S(this,"_rtmConfig",{}),S(this,"_joinInfo",void 0),S(this,"_gateway",void 0),S(this,"_statsCollector",void 0),S(this,"_configDistribute",void 0),S(this,"_leaveMutex",new Tn("client-leave")),S(this,"_publishMutex",new Tn("client-publish")),S(this,"_renewTokenMutex",new Tn("client-renewtoken")),S(this,"_subscribeMutex",new Tn("client-subscribe")),S(this,"_encryptionMode","none"),S(this,"_encryptionSecret",null),S(this,"_encryptionSalt",null),S(this,"_encryptDataStream",!1),S(this,"_encryptDataStreamKey",null),S(this,"_encryptDataStreamIv",null),S(this,"_proxyServer",void 0),S(this,"_turnServer",{servers:[],mode:"auto"}),S(this,"_cloudProxyServerMode","disabled"),S(this,"_isDualStreamEnabled",!1),S(this,"_defaultStreamFallbackType",void 0),S(this,"_lowStreamParameter",void 0),S(this,"_streamFallbackTypeCacheMap",new Map),S(this,"_remoteStreamTypeCacheMap",new Map),S(this,"_axiosCancelSource",vi.CancelToken.source()),S(this,"_audioVolumeIndicationInterval",void 0),S(this,"_networkQualityInterval",void 0),S(this,"_userOfflineTimeout",void 0),S(this,"_streamRemovedTimeout",void 0),S(this,"_injectStreamingClient",void 0),S(this,"_liveTranscodeStreamingClient",void 0),S(this,"_liveRawStreamingClient",void 0),S(this,"_channelMediaRelayClient",void 0),S(this,"_networkQualitySensitivity","normal"),S(this,"_p2pChannel",void 0),S(this,"_useLocalAccessPoint",!1),S(this,"_setLocalAPVersion",void 0),S(this,"_joinAndNotLeaveYet",!1),S(this,"_numberOfJoinCount",0),S(this,"_remoteDefaultVideoStreamType",void 0),S(this,"_inspect",void 0),S(this,"_moderation",void 0),S(this,"_license",void 0),S(this,"_pendingPublishedUsers",[]),S(this,"ntpAlignErrorCount",0),S(this,"remoteInboundOffset",0),S(this,"_handleLocalTrackEnable",(i,s,a)=>{this.publish(i,!1).then(s).catch(a)}),S(this,"_handleLocalTrackDisable",(i,s,a)=>{this.unpublish(i).then(s).catch(a)}),S(this,"_handleUserOnline",i=>{if(L("BLOCK_LOCAL_CLIENT")&&vc(i.uid,this.channelName))return void v.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&v.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(a=>a.uid===i.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(qe.USER_JOINED,s));else{const a=new On(i.uid,i.uint_id||i.uid);this._users.push(a),v.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(qe.USER_JOINED,a)}}),S(this,"_handleUserOffline",i=>{if(L("BLOCK_LOCAL_CLIENT")&&vc(i.uid,this.channelName))return;const s=this._users.find(a=>a.uid===i.uid);s&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:mf(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),v.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(qe.USER_LEAVED,s,i.reason))}),S(this,"_handleAddAudioOrVideoStream",(i,s,a,c,l,h,p)=>{if(L("BLOCK_LOCAL_CLIENT")&&vc(s,this.channelName))return;const f=this._users.find(g=>g.uid===s);if(!f)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(f.uid,i,void 0,void 0,void 0,Date.now());const _=i==="audio"?f.hasAudio:f.hasVideo;f._uintid||(f._uintid=l||s),i==="audio"?f._trust_audio_stream_added_state_=!0:f._trust_video_stream_added_state_=!0,i==="audio"?(f._audio_added_=!0,a!==void 0&&(f._audioSSRC=a),c!==void 0&&(f._cname=c),h&&(f._audioOrtc=h)):(f._video_added_=!0,a!==void 0&&(f._videoSSRC=a),c!==void 0&&(f._cname=c),p!==void 0&&(f._rtxSsrcId=p),h&&(f._videoOrtc=h)),(i==="audio"?f.hasAudio:f.hasVideo)&&!_&&(v.info("[".concat(this._clientId,"] remote user ").concat(f.uid," published ").concat(i)),this.safeEmit(qe.USER_PUBLISHED,f,i)),i==="video"?Te.onGatewayStream(this._sessionId,cn.ON_ADD_VIDEO_STREAM,Ct.ON_ADD_VIDEO_STREAM,{peer:l||s,ssrc:f._videoSSRC}):Te.onGatewayStream(this._sessionId,cn.ON_ADD_AUDIO_STREAM,Ct.ON_ADD_AUDIO_STREAM,{peer:l||s,ssrc:f._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(f,i,a).then(g=>{if(g&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(f.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Cn))return this._p2pChannel.unsubscribe(f,i,!0).then(()=>this._subscribe(f,i,!0).catch(T=>{v.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(f,i)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(f.uid," after reconnect.")),this._subscribe(f,i,!0).catch(g=>{v.error("[".concat(this._clientId,"] resubscribe error"),g.toString())}))}),S(this,"_handleRemoveStream",i=>{if(L("BLOCK_LOCAL_CLIENT")&&vc(i.uid,this.channelName))return;const s=this._users.find(c=>c.uid===i.uid);if(!s)return void v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));v.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let a=()=>{};s.hasAudio&&s.hasVideo?a=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(qe.USER_UNPUBLISHED,s,"audio"),v.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(qe.USER_UNPUBLISHED,s,"video")}:s.hasVideo?a=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(qe.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(a=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(qe.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof Cn&&this._p2pChannel.unsubscribe(s).then(c=>{if(c)return this._gateway.unsubscribe(c,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),Te.onGatewayStream(this._sessionId,cn.ON_REMOVE_STREAM,Ct.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),a()}),S(this,"_handleSetStreamLocalEnable",(i,s,a)=>{if(L("BLOCK_LOCAL_CLIENT")&&vc(s,this.channelName))return;const c=this._users.find(p=>p.uid===s);if(!c)return void v.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));v.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(a?"enabled":"disabled"," with uid ").concat(s));const l=i==="audio"?c.hasAudio:c.hasVideo;if(i==="audio"){c._trust_audio_enabled_state_=!0;const p=c._audio_enabled_;if(c._audio_enabled_=a,c._audio_enabled_===p)return;{const f=c._audio_enabled_?"enable-local-audio":"disable-local-audio";v.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(f)),this.safeEmit(qe.USER_INFO_UPDATED,s,f)}}else{c._trust_video_enabled_state_=!0;const p=c._video_enabled_;if(c._video_enabled_=a,c._video_enabled_===p)return;{const f=c._video_enabled_?"enable-local-video":"disable-local-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(f)),this.safeEmit(qe.USER_INFO_UPDATED,s,f)}}const h=i==="audio"?c.hasAudio:c.hasVideo;return l!==h?!l&&h?(v.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(i)),void this.safeEmit(qe.USER_PUBLISHED,c,i)):(i==="video"&&c._videoTrack&&c._videoTrack._destroy(),i==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,i),v.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(i)),void this.safeEmit(qe.USER_UNPUBLISHED,c,i)):void 0}),S(this,"_handleMuteStream",(i,s,a)=>{if(L("BLOCK_LOCAL_CLIENT")&&vc(i,this.channelName))return;v.debug("[".concat(this._clientId,"] receive mute message"),i,s,a);const c=this._users.find(p=>p.uid===i);if(!c)return void v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const l=s==="audio"?c.hasAudio:c.hasVideo;if(s==="audio"){c._trust_audio_mute_state_=!0;const p=c._audio_muted_;if(c._audio_muted_=a,c._audio_muted_===p)return;{const f=c._audio_muted_?"mute-audio":"unmute-audio";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(f)),this.safeEmit(qe.USER_INFO_UPDATED,i,f)}}else{c._trust_video_mute_state_=!0;const p=c._video_muted_;if(c._video_muted_=a,c._video_muted_===p)return;{const f=c._video_muted_?"mute-video":"unmute-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(f)),this.safeEmit(qe.USER_INFO_UPDATED,i,f)}}const h=s==="audio"?c.hasAudio:c.hasVideo;if(l!==h){if(!l&&h)return(s==="audio"?c._audioSSRC:c._videoSSRC)?(v.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(s)),void this.safeEmit(qe.USER_PUBLISHED,c,s)):void v.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&c._videoTrack&&!c._video_pre_subscribed&&c._videoTrack._destroy(),s==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,s),v.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(s)),this.safeEmit(qe.USER_UNPUBLISHED,c,s)}}),S(this,"_handleP2PLost",async i=>{v.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():v.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),S(this,"_handleTokenWillExpire",()=>{v.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(qe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),S(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),v.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),S(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(qe.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(qe.NETWORK_QUALITY,i)}),S(this,"_handleP2PAddAudioOrVideoStream",(i,s,a,c)=>{const l=this._users.find(p=>p.uid===s);if(!l)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(l.uid,i,void 0,void 0,void 0,Date.now());const h=i==="audio"?l.hasAudio:l.hasVideo;i==="audio"?l._trust_audio_stream_added_state_=!0:l._trust_video_stream_added_state_=!0,i==="audio"?(l._audio_added_=!0,a!==void 0&&(l._audioSSRC=a),c!==void 0&&(l._audioMid=c)):(l._video_added_=!0,a!==void 0&&(l._videoSSRC=a),c!==void 0&&(l._videoMid=c)),(i==="audio"?l.hasAudio:l.hasVideo)&&!h&&(v.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published ").concat(i)),this.safeEmit(qe.USER_PUBLISHED,l,i)),this._p2pChannel.hasPendingRemoteMedia(l,i)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(l.uid," after reconnect.")),this._subscribe(l,i,!0).catch(p=>{v.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=e,this._clientId=Et(5,"client-"),this.store=new e6(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),v.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Tr," build: ").concat(zS,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{ZO(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(i){v.warning("[".concat(this._clientId,"] ").concat(i.toString()))}this._statsCollector=new lh(this.store),this._statsCollector.onStatsException=(i,s,a)=>{v.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(s,", uid: ").concat(a)),this.safeEmit(qe.EXCEPTION,{code:i,msg:s,uid:a})},this._statsCollector.onUploadPublishDuration=(i,s,a,c)=>{const l=this._users.find(h=>h.uid===i);l&&Te.peerPublishStatus(this._sessionId,{subscribeElapse:c,audioPublishDuration:s,videoPublishDuration:a,peer:l._uintid})},this.store.useDataChannel=et().supportDataChannel&&L("SIGNAL_CHANNEL"),this.store.useP2P=e.mode==="p2p",this._gateway=new V6(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||$t,httpRetryConfig:e.httpRetryConfig||$t,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new Y6,this.store.useP2P?(this._p2pChannel=new un(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new Cn(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,i,s,a){let c=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],l=arguments.length>6&&arguments[6]!==void 0&&arguments[6];ft("JOIN_GATEWAY_USE_443PORT_ONLY",c),ft("JOIN_GATEWAY_USE_DUAL_DOMAIN",l);const h=this._gateway.signal.websocket;return h instanceof Nu&&(h.use443PortOnly=c,h.tryDoubleDomain=l),async function(p,f,_){df.get(p)||df.set(p,[]),lf.get(p)||lf.set(p,f),Fs.get(p)||Fs.set(p,0);const g=df.get(p),T=lf.get(p);if(!g||!T)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Fs.get(p)===T){const D=gu();g.push(D),await D.promise}Fs.set(p,Fs.get(p)+1);for(var w=arguments.length,R=new Array(w>3?w-3:0),I=3;I<w;I++)R[I-3]=arguments[I];const N=await _(...R);return Fs.set(p,Fs.get(p)-1),Fs.get(p)===T-1&&g.length>0&&(g[0].resolve(),g.shift()),Fs.get(p)===0&&(df.set(p,[]),lf.set(p,0),Fs.set(p,0)),N}("client.join",L("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,i,s,a)}async join(e,t,i,s,a){const c=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const l=ZH(),h=Wb()?window.isSecureContext:"Browser Not Support";(!Wb()&&!l||!window.isSecureContext)&&v.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");const p=CS();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),v.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const f=Te.reportApiInvoke(p,{name:Jt.JOIN,options:[e,t,i,s],states:{isHttps:l,isSecureContext:h},tag:Pt.TRACER});Te.setAppId(e);try{if(!i&&i!==null)throw new B(O.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Un(i,"token",1,2047),Un(e,"appid",1,2047),XS(t),s&&QS(s),a&&Un(a,"optionalInfo",1,2047)}catch(R){throw f.onError(R),R}if(v.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(c)),this._leaveMutex.isLocked&&(v.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),v.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const R=new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw f.onError(R),R}this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const _=Is(Is({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:a,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(_.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(_.stringUid=s,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_.aesmode=this._encryptionMode,_.aespassword=await EH(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const R=new TextEncoder,I=L("USE_PURE_ENCRYPTION_MASTER_KEY")?R.encode(_.appId+this._encryptionSecret+this._encryptionSecret):R.encode(_.appId+_.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(N,D,V){const G=await window.crypto.subtle.importKey("raw",D,"PBKDF2",!1,["deriveBits","deriveKey"]),F=N==="aes-128-gcm2"?128:256,j=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:Yb,hash:"SHA-256",salt:V},G,F+t6);return new Uint8Array(j).subarray(F/8)}(this._encryptionMode,I,vu(this._encryptionSalt)),this._encryptDataStreamKey=await async function(N,D,V){const G=await window.crypto.subtle.importKey("raw",D,"PBKDF2",!1,["deriveBits","deriveKey"]),F=N==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:Yb,hash:"SHA-256",salt:V},G,{name:"AES-GCM",length:F},!0,["encrypt","decrypt"])}(this._encryptionMode,I,vu(this._encryptionSalt))}else h?v.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):v.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,v.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:_.stringUid});const g=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&g===this._sessionId&&Te.joinChannelTimeout(this._sessionId,5)},5e3);try{var T;let R;const I=_.cloudProxyServer;if(fe(T=["proxy3","proxy4","proxy5"]).call(T,I)){const F=L("PROXY_SERVER_TYPE3");Array.isArray(F)?_.proxyServer=F[0]:_.proxyServer=F}if(Te.setProxyServer(_.proxyServer),v.setProxyServer(_.proxyServer),this.store.requestAPStart(),_.stringUid&&!_.uid){let F;[F,R]=await W.all([UN(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||$t,this.store),MN(_,this._axiosCancelSource.token,this._config.httpRetryConfig||$t,!0,this.store)]),v.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_.stringUid," => ").concat(F)),_.uid=F,R.gatewayInfo.uid=F,R.gatewayInfo.res.uid=F}else R=await MN(_,this._axiosCancelSource.token,this._config.httpRetryConfig||$t,!0,this.store);if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on(bu.UPDATE_BITRATE_LIMIT,F=>{this._p2pChannel.updateBitrateLimit(F)})},0),this._key=i||e;const N=R.gatewayInfo,D=_.uid?_.uid:N.uid;this._joinInfo=Is(Is({},_),{},{cid:N.cid,uid:D,vid:N.vid,apResponse:N.res,uni_lbs_ip:N.uni_lbs_ip,gatewayAddrs:N.gatewayAddrs}),this.store.intUid=D;const V=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));f.onSuccess(V),this._appId=e,this._channelName=_.cname,this._uid=V,this.store.uid=V,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(wn()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const G=_.stringUid?"string uid: ".concat(_.stringUid,",uid: ").concat(_.uid):"uid: ".concat(this._uid);return v.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(G)),setTimeout(()=>{v.startUpload()},5e3),this.store.joinEnd(),w=this,fe(ca).call(ca,w)||ca.push(w),V}catch(R){const I=Array.isArray(R)?R[0]:R;throw I&&I.code===O.OPERATION_ABORTED?v.warning("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),I):v.error("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),I),I.code!==O.OPERATION_ABORTED&&this._numberOfJoinCount===c&&(this._gateway.state="DISCONNECTED",this._reset()),f.onError(I),I}var w}_joinGateway(){if(!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!L("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(e=>e).catch(e=>{if(e.code===O.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,Ye.FALLBACK),e;if(e.code===O.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,Ye.FALLBACK),e;throw e}).then(e=>{if(e instanceof B){if(e.code===O.INIT_WEBSOCKET_TIMEOUT){if(v.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const t=L("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){const s=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),a=s.slice(s.length-2).join(".");t.forEach(c=>{this._joinInfo&&fe(c).call(c,a)&&(this._joinInfo.proxyServer=c)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;const i=L("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return i&&i[1]&&i[1]!=="443"&&v.setProxyServer(this._joinInfo.proxyServer),L("STATS_COLLECTOR_PORT").toString()!=="443"&&Te.setProxyServer(this._joinInfo.proxyServer),Te.reportApiInvoke(this._sessionId,{name:Jt.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Pt.TRACER}).onSuccess(),this.safeEmit(qe.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),L("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(s=>{"forceturn"in s&&(s.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(v.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);return Te.reportApiInvoke(this._sessionId,{name:Jt.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Pt.TRACER}).onSuccess(),this._joinGateway()}return e}).then(e=>e)}async leave(){v.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(wn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const i=ca.indexOf(t);i!==-1&&ca.splice(i,1)}(this);const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return v.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),v.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Vn))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new B(O.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new B(O.INVALID_OPERATION,"audience can not publish stream");for(const a of i){if(!(a instanceof Vn))throw new B(O.INVALID_PARAMS,"parameter is not local track");if(!a._enabled&&t)throw new B(O.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(a.getTrackId()))}v.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(a=>"".concat(a.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&i.forEach(a=>{const c=this._configDistribute.getBitrateLimit();a instanceof Ge&&c&&a.setBitrateLimit(c.uplink)});try{await this._publishHighStream(i),v.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(a=>"".concat(a.getTrackId()," "))))}catch(a){throw v.error("[".concat(this._clientId,"] publish error"),a.toString()),a}finally{s()}}async _publishDataChannel(e){pt(e.id,"id",0,65535,!0),Eo(e.ordered,"ordered"),Un(e.metadata,"metadata",0,512),v.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(s=>s.id===e.id)!==-1)throw new B(O.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&L("FORCE_TURN")&&!L("TURN_ENABLE_TCP")&&!L("TURN_ENABLE_UDP"))throw new B(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=new hD(e);if(await this._p2pChannel.publishDataChannel([i]),!this._p2pChannel.isP2PDisconnected()){if(typeof i._originDataChannelId!="number")throw v.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new B(O.CREATE_DATACHANNEL_ERROR);try{const s={streamId:e.id,ordered:e.ordered,maxRetransmits:L("DATASTREAM_MAX_RETRANSMITS"),metadata:e.metadata,channelId:i._originDataChannelId};await this._gateway.publishDataChannel(this._uid,s,!0),await i._waitTillOpen()}catch(s){if(s.code!==O.DISCONNECT_P2P)throw s}}return v.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw v.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Vn))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);v.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(s=>"".concat(s.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this._p2pChannel instanceof un){const s=await this._p2pChannel.unpublish(t);s&&await this._gateway.sendExtensionMessage(xt.UNPUBLISH,{unpubMsg:s},!0)}else{const s=await this._p2pChannel.unpublish(t);s&&await this._gateway.unpublish(s,this._uid),v.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(a=>"".concat(a.getTrackId()))))}}catch(s){throw v.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),v.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const t=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),v.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(s=>"".concat(s.id))))}catch(i){throw v.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{t&&t()}}async subscribe(e,t,i){return t==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,t)}async presubscribe(e,t){if(an(t,"mediaType",["audio","video"]),this._p2pChannel instanceof un)throw new B(O.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=t===Ee.AUDIO,s=t===Ee.VIDEO,a=await this._subscribeMutex.lock();try{const{ssrcId:c,ortc:l,rtxSsrcId:h,cname:p,uint_id:f}=await this._gateway.presubscribe(e,t,!0);if(c==null)throw new B(O.UNEXPECTED_RESPONSE,"no ssrc id");let _=this._users.find(T=>T.uid===e);_||(_=new On(e,f||e),_._is_pre_created=!0,this._users.push(_)),p&&(_._cname=p),_._uintid||(_._uintid=f||e),i&&(_._audioSSRC=c,_._audio_pre_subscribed=!0,l&&(_._audioOrtc=l)),s&&(_._videoSSRC=c,_._video_pre_subscribed=!0,l&&(_._videoOrtc=l),h!=null&&(_._rtxSsrcId=h)),v.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(c)),await this._p2pChannel.subscribe(_,t,c,h,l);const g=i?_._audioTrack:_._videoTrack;if(!g)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(_._trust_audio_stream_added_state_=!0,_._audio_added_=!0),s&&(_._trust_video_stream_added_state_=!0,_._video_added_=!0),g}catch(c){throw v.error("[".concat(this._clientId,"] presub user ").concat(e," error"),c),c}finally{a()}}async _subscribeDataChannel(e,t){var i;if(pt(t,"channelId",0,65535,!0),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e))throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new B(O.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new B(O.INVALID_REMOTE_USER,"user is not published");const s=(i=e._dataChannels)===null||i===void 0?void 0:i.find(l=>l.id===t);if(!s)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new B(O.REMOTE_USER_IS_NOT_PUBLISHED);const a=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const l=await this._p2pChannel.subscribeDataChannel(e,[s]);if(l&&fe(l).call(l,s.id))try{var c;if(typeof s._originDataChannelId!="number")throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new B(O.CREATE_DATACHANNEL_ERROR);const h={id:s.id,datachannelId:s._originDataChannelId,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:(c=s.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(e.uid,h,!0),await s._waitTillOpen()}catch(h){if((h==null?void 0:h.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[s]),h;await this._p2pChannel.unsubscribeDataChannel(e,[s]),this._p2pChannel.setPendingRemoteDataChannel(e,s.id)}return v.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),s}finally{a()}}async _p2pSubscribe(e,t,i){if(an(t,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===e)){const a=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),a}if(!e.hasAudio&&!e.hasVideo){const a=new B(O.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),a}if(!i&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const a=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),a}const s=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const c=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof un&&await this._p2pChannel.subscribe(e,t,c,l)}catch(c){throw c}v.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(c=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const a=t==="audio"?e._audioTrack:e._videoTrack;if(!a)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user object");return a}catch(a){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),a),a}finally{s()}}async _subscribe(e,t,i){if(this._p2pChannel instanceof un)return this._p2pSubscribe(e,t);if(an(t,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===e)){const p=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),p}if(!e.hasAudio&&!e.hasVideo){const p=new B(O.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),p}if(!(i||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const p=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),p}let s=t==="audio"?e._audioSSRC:e._videoSSRC,a=t==="audio"?e._audioOrtc:e._videoOrtc,c=t==="video"?e._rtxSsrcId:void 0,l={stream_type:t==="audio"?Ee.AUDIO:Ee.VIDEO,ssrcId:s};const h=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const f=t==="audio"?e._audioSSRC:e._videoSSRC;f!==void 0&&f!==s&&(s=f,a=t==="audio"?e._audioOrtc:e._videoOrtc,c=t==="video"?e._rtxSsrcId:void 0,l={stream_type:t==="audio"?Ee.AUDIO:Ee.VIDEO,ssrcId:s}),Fn.markSubscribeStart(this.store.clientId,s),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,s,c,a);try{await this._gateway.subscribe(e.uid,l,!0)}catch(_){if((_==null?void 0:_.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),_;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(f){throw this._p2pChannel.reportSubscribeEvent(!1,f==null?void 0:f.code,e,t),f}v.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(f=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),f)});const p=t==="audio"?e._audioTrack:e._videoTrack;if(!p)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),p),p}finally{h()}}async massSubscribe(e){if(go(e,"subscribeList"),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),i=new Map,s=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(h=>{let{user:p,mediaType:f}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(f)}).join("; ")));const a=(e=[...e]).map(h=>{let{user:p,mediaType:f}=h;return{user:p,mediaType:f}}),c=await this._p2pChannel.globalLock();try{var l;for(let p=e.length-1;p>=0;p--){const f=e[p],{user:_,mediaType:g}=f;if(an(g,"mediaType",["audio","video"]),!_){const R=new B(O.INVALID_PARAMS,"user property does not exist in subscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),R}if(!this._users.find(R=>R===_)){const R=new B(O.INVALID_REMOTE_USER,"user is not in the channel");v.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_.uid,", this user is not in the channel")),a[p].error=R,e.splice(p,1);continue}if(g==="audio"&&(!_.hasAudio||_._audioSSRC===void 0)||g==="video"&&(!_.hasVideo||_._videoSSRC===void 0)){const R=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);v.error("[".concat(this._clientId,"] can not subscribe ").concat(_.uid," with mediaType ").concat(g,", remote user is not published")),a[p].error=R,e.splice(p,1);continue}const T=en.Video|en.LwoVideo,w=i.get(_);if(w){if(g==="video"?w&T:w&en.Audio){e.splice(p,1),v.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_.uid,", mediaType:").concat(g," twice"));continue}i.set(_,w|(g==="video"?T:en.Audio))}else i.set(_,g==="video"?T:en.Audio)}for(let p=e.length-1;p>=0;p--){const f=e[p],{user:_,mediaType:g}=f,T=en.Video|en.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_,g)){await this._p2pChannel.unmuteRemoteNoLock(_,g);const w=i.get(_);i.set(_,g==="video"?w^T:w^en.Audio),e.splice(p,1)}}this.store.massSubscribe(e.map(p=>({userId:p.user.uid,type:p.mediaType})),t);const h=To(l=Array.from(i.entries())).call(l,(p,f)=>{let[_,g]=f;if(g===0)return p;const T={stream_id:_.uid,stream_type:g};return g&en.Audio&&(T.audio_ssrc=_._audioSSRC),g&en.Video&&(T.video_ssrc=_._videoSSRC),p.push(T),p},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(f=>{let{user:_,mediaType:g}=f;return{user:_,mediaType:g,ssrcId:g===Ee.VIDEO?_._videoSSRC:_._audioSSRC,rtxSsrcId:g===Ee.VIDEO?_._rtxSsrcId:void 0}}));const p=new Map;if(h.length>0){const f=await this._gateway.subscribeAll(h,!0);((f==null?void 0:f.users)||[]).forEach(_=>{let{stream_id:g,video_error_code:T,audio_error_code:w,error_code:R}=_;(T||w||R)&&p.set(g,{video_error_code:T,audio_error_code:w,error_code:R})})}if(Array.from(p.entries()).length>0){const f=[];Array.from(p.entries()).forEach(_=>{let[g,T]=_;const w=this.remoteUsers.find(R=>R.uid===g);if(w){let R;T.error_code||T.video_error_code&&T.audio_error_code?R=void 0:T.video_error_code?R=Ee.VIDEO:T.audio_error_code&&(R=Ee.AUDIO),f.push({user:w,mediaType:R})}}),f.length>0&&await this._p2pChannel.massUnsubscribeNoLock(f)}for(const f of a){const _=p.get(f.user.uid);if(_){const g=_.error_code||f.mediaType==="audio"&&_.audio_error_code||f.mediaType==="video"&&_.video_error_code;if(g){const T=Rc(g);v.error("user:".concat(f.user.uid," mediaType:").concat(f.mediaType," has massSubscribe error ").concat(T.desc)),f.error=new B(O.SUBSCRIBE_FAILED,"code ".concat(g,": ").concat(T.desc))}}f.error||(f.mediaType==="video"?f.track=f.user.videoTrack:f.track=f.user.audioTrack)}return this.store.massSubscribe(a.filter(f=>!f.error).map(f=>({userId:f.user.uid,type:f.mediaType})),void 0,Date.now()),a.forEach(f=>{var _;Te.subscribe(this.store.sessionId,{succ:!!f.error,ec:((_=f.error)===null||_===void 0?void 0:_.code)||null,video:f.mediaType===Ee.VIDEO,audio:f.mediaType===Ee.AUDIO,peerid:f.user.uid,subscribeRequestid:f.mediaType===Ee.VIDEO?f.user._videoSSRC:f.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)}),v.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(f=>{let{user:_,mediaType:g}=f;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(g)}).join("; "))),a}catch(p){throw await this._p2pChannel.massUnsubscribeNoLock(e),p}}finally{c(),s()}}async unsubscribe(e,t,i){if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(t&&an(t,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(a=>a===e)){const a=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const s=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof un)await this._p2pChannel.unsubscribe(e,t);else{const a=await this._p2pChannel.unsubscribe(e,t);a&&await this._gateway.unsubscribe(a,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&mf(this._users,e),v.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(a){if(a.code===O.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}finally{s()}}async _unsubscribeDataChannel(e,t){if(t&&pt(t,"id",0,65535,!0),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(s=>s===e)){const s=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}let i;if(typeof t=="number"){const s=e._dataChannels.find(a=>a.id===t);s&&(i=[s])}else i=e._dataChannels;if(i===void 0){const s=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),s}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(s=>s.id)));try{const s=await this._p2pChannel.unsubscribeDataChannel(e,i);s&&await this._gateway.unsubscribeDataChannel(s,e.uid),v.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s))}catch(s){if(s.code===O.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}}async massUnsubscribe(e){if(go(e,"unsubscribeList"),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");v.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:s,mediaType:a}=i;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(a,";")}).join())),e=[...e];const t=new Map;for(let i=e.length-1;i>=0;i--){const{user:s,mediaType:a}=e[i];if(!s){const l=new B(O.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(an(a,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===s)){v.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),e.splice(i,1);continue}const c=en.Video|en.LwoVideo;if(t.has(s)){const l=t.get(s);let h;switch(a){case"video":h=l&c;break;case"audio":h=l&en.Audio;break;default:h=l&(en.Audio|c)}if(h){v.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(a," twice.")),e.splice(i,1);continue}a?a==="audio"?t.set(s,l|en.Audio):a==="video"&&t.set(s,l|c):t.set(s,l|en.Audio|c)}else a?a==="audio"?t.set(s,en.Audio):a==="video"&&t.set(s,c):t.set(s,en.Audio|c)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),v.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(s=>{let{user:a,mediaType:c}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")}).join()))}catch(i){if(i.code===O.DISCONNECT_P2P)return void v.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw v.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new Q(O.INVALID_PARAMS);Lt(i.width)||SS(i.width,"streamParameter.width"),Lt(i.height)||SS(i.height,"streamParameter.height"),Lt(i.framerate)||SS(i.framerate,"streamParameter.framerate"),Lt(i.bitrate)||pt(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&v.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),v.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,te.LocalVideoLowTrack)}async enableDualStream(){if(!et().supportDualStream)throw Te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new B(O.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new B(O.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),v.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(te.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Te.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),v.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){an(i,"role",["audience","host"])}(e),t&&ZO(t),this.mode==="rtc"||this.mode==="p2p")throw v.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new B(O.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new B(O.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new B(O.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,v.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const i=t.timestamp-Date.now();return Math.abs(i)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Un(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Te.setProxyServer(this._proxyServer),v.setProxyServer(this._proxyServer),v.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy")}if(Od(e))return this._turnServer={servers:e,mode:"original-manual"},void v.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>$O(i)),this._turnServer={servers:e,mode:"manual"},v.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"you should set license before join channel");if(Un(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new B(O.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,v.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new B(O.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new B(O.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Stop proxy server after leave channel");Te.setProxyServer(),v.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new B(O.INVALID_PARAMS,"accessPoints is required.");go(e.accessPoints.serverList,"accessPoints.serverList"),Un(e.accessPoints.domain,"accessPoints.domain");const t=(T,w)=>{pt(T,w,0,65535,!0)};let i=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");L("CLOSE_AFB_FOR_LOCAL_AP")&&(ft("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),ft("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,a=e.accessPoints.domain,c=e.accessPoints.serverList.map(T=>s.test(T)?"".concat(T.replace(/\./g,"-"),".").concat(a):T),l=c.map(T=>"".concat(T,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,ft("WEBCS_DOMAIN",l),ft("WEBCS_DOMAIN_BACKUP_LIST",l),ft("GATEWAY_DOMAINS",[a]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(go(e.report.hostname,"report.hostname"),ft("EVENT_REPORT_DOMAIN",e.report.hostname[0]),ft("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(ft("EVENT_REPORT_DOMAIN",c[0]),ft("EVENT_REPORT_BACKUP_DOMAIN",c[1]||c[0]));let h=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),h=e.report.port),ft("STATS_COLLECTOR_PORT",h),e.report?ft("ENABLE_EVENT_REPORT",!0):ft("ENABLE_EVENT_REPORT",!1);let p="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(go(e.log.hostname,"log.hostname"),p=e.log.hostname[0]):p=c[0];let f=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),f=e.log.port),ft("LOG_UPLOAD_SERVER","".concat(p,":").concat(f));let _=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(go(e.cds.hostname,"cds.hostname"),_=e.cds.hostname):_=c;let g=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),g=e.cds.port),ft("CDS_AP",_.map(T=>"".concat(T,":").concat(g))),e.cds?ft("ENABLE_CONFIG_DISTRIBUTE",!0):ft("ENABLE_CONFIG_DISTRIBUTE",!1),v.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(go(e,"serverList"),Un(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(s=>i.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(t):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,ft("WEBCS_DOMAIN",e),ft("WEBCS_DOMAIN_BACKUP_LIST",e),ft("GATEWAY_DOMAINS",[t]),ft("EVENT_REPORT_DOMAIN",e[0]),ft("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),ft("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),v.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(an(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw v.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else v.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){an(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const i=this._users.find(s=>s.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw v.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}v.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){an(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(i){throw v.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}v.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,i,s){(function(c){an(c,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Un(t,"secret");const a=["aes-128-gcm2","aes-256-gcm2"];if(fe(a).call(a,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new B(O.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new B(O.INVALID_PARAMS,"current encrypt mode does not need salt");if(s){if(Eo(s,"encryptDataStream"),!fe(a).call(a,e))throw new B(O.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||v.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,i&&(this._encryptionSalt=Pd(i))}async renewToken(e){if(Un(e,"token",1,2047),!this._key||!this._joinInfo)throw new B(O.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(L("USE_NEW_TOKEN")){v.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const s=await z6(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||$t);v.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:s})}else v.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});v.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=t,this._joinInfo.token=t,v.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?v.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(qe.VOLUME_INDICATOR,e)},L("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new B(O.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new B(O.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new B(O.LIVE_STREAMING_TASK_CONFLICT);const i=t?dn.TRANSCODE:dn.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(dn.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!t.length)throw new B(O.INVALID_PARAMS,"can not find live streaming url to stop");await W.all(t.map(i=>i&&i.stopLiveStreamingTask(e)))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const i=this._createLiveStreamingClient(dn.INJECT);i.setInjectStreamConfig(t,0),await i.startLiveStreamingTask(e,dn.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(dn.INJECT),i=Array.from(Es(e=t.streamingTasks).call(e)).find(s=>s.mode===dn.INJECT);if(!this._joinInfo||!i)throw new B(O.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(i.url)}async startChannelMediaRelay(e){Fk(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){Fk(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const a=new TextEncoder;e.payload=a.encode(e.payload)}let s=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&fe(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(s=!0,e.payload=await async function(a,c,l){var h;const p=To(h=Array.from(l)).call(h,(I,N)=>I+N,0),f={serverTs:0,seq:n6++,length:l.length,checkSum:p},_=new Uint8Array(cb(p,2)),g=new ArrayBuffer(Md),T=new DataView(g);T.setUint32(0,f.serverTs),T.setUint16(4,f.seq),T.setUint16(6,f.length),T.setUint16(8,f.checkSum);const w=16-l.length%16;l=ib(l,new Uint8Array(w));const R=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a,tagLength:zb,additionalData:_},c,l);return ib(new Uint8Array(g),new Uint8Array(R))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new B(O.INVALID_PARAMS,s?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ve.DATA_STREAM,{payload:Pd(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-GY},!i)}sendMetadata(e){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new B(O.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ve.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Pd(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(r6),!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send custom report, not joined");await Te.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){an(t.spatialLayer,"spatialLayer",[0,1,2,3]),an(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(i){throw v.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:i}=e;if(Eo(t,"apRTM"),pt(i,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=i,v.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(v.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=vi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Tn("client-publish"),this._subscribeMutex=new Tn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var i;const s=e||CS();e?v.debug("[".concat(this._clientId,"] new Session ").concat(s)):v.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s));const a=e?"":this._sessionId||"";this._sessionId=s,this.store.sessionId=s;const c={lts:new Date().getTime(),mode:this.mode,stringUid:(t==null?void 0:t.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:a,clientRole:this.role==="audience"?2:1};t?Te.sessionInit(this._sessionId,Is({cname:t.channel,appid:t.appId},c)):this._joinInfo?Te.sessionInit(this._sessionId,Is({cname:this._joinInfo.cname,appid:this._joinInfo.appId},c)):this._gateway.joinInfo&&Te.sessionInit(this._sessionId,Is({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},c)),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&L("FORCE_TURN")&&!L("TURN_ENABLE_TCP")&&!L("TURN_ENABLE_UDP"))throw new B(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");v.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof un){const s=(await i.next()).value;if(s){try{await this._gateway.sendExtensionMessage(xt.PUBLISH,s,!0)}catch(a){throw i.throw(a),a}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const s=(await i.next()).value;if(s){var t;let a;try{a=await this._gateway.publish(this._uid,s,!0)}catch(c){if(c.code!==O.DISCONNECT_P2P)throw i.throw(c),c}await i.next(((t=a)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const a of e)a instanceof Ge&&a._encoderConfig&&this._gateway.setVideoProfile(a._encoderConfig),!a.muted&&a.enabled||await this._p2pChannel.muteLocalTrack(a)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===O.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));v.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await i.next()).value;if(s){var t;let a;try{a=await this._gateway.publish(this._uid,s,!0)}catch(c){if(c.code!==O.DISCONNECT_P2P)throw i.throw(c),c}i.next(((t=a)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===O.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new B(O.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new SY(this._joinInfo,this._config.websocketRetryConfig||$t,this._config.httpRetryConfig||$t),i=s=>{s.onLiveStreamError=(a,c)=>{Te.reportApiInvoke(this._sessionId,{name:Jt.ON_LIVE_STREAM_ERROR,options:[a,c],tag:Pt.TRACER}).onSuccess(),this.safeEmit(qe.LIVE_STREAMING_ERROR,a,c)},s.onLiveStreamWarning=(a,c)=>{Te.reportApiInvoke(this._sessionId,{name:Jt.ON_LIVE_STREAM_WARNING,options:[a,c],tag:Pt.TRACER}).onSuccess(),this.safeEmit(qe.LIVE_STREAMING_WARNING,a,c)},s.on(xd.REQUEST_WORKER_MANAGER_LIST,(a,c,l)=>{if(!this._joinInfo)return l(new B(O.INVALID_OPERATION,"can not find join info to get worker manager"));VN(a,this._joinInfo,this._axiosCancelSource.token,$t).then(c).catch(l)})};switch(e){case dn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),i(this._liveRawStreamingClient)),this._liveRawStreamingClient;case dn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),i(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case dn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(xd.REQUEST_WORKER_MANAGER_LIST,(s,a,c)=>{if(!this._joinInfo)return c(new B(O.INVALID_OPERATION,"can not find join info to get worker manager"));VN(s,this._joinInfo,this._axiosCancelSource.token,$t).then(a).catch(c)}),this._injectStreamingClient.onInjectStatusChange=(s,a,c)=>{this.safeEmit(qe.INJECT_STREAM_STATUS,s,a,c)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new B(O.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),i={width:e,height:t};this._channelMediaRelayClient=new vY(this._joinInfo,this._clientId,this._config.websocketRetryConfig||$t,this._config.httpRetryConfig||$t,i),this._channelMediaRelayClient.on("state",s=>{s===li.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(qe.CHANNEL_MEDIA_RELAY_STATE,s)}),this._channelMediaRelayClient.on("event",s=>{this.safeEmit(qe.CHANNEL_MEDIA_RELAY_EVENT,s)}),this._statsCollector.onStatsChanged=(s,a)=>{var c;s==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(a))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:i,deleted:s}=e,a=[];Array.isArray(i)&&i.length>0&&i.forEach(c=>{const{uid:l,stream_id:h,ordered:p,max_retrans_times:f,metadata:_}=c,g=this._users.find(T=>T._uintid===l);if(!g)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(v.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(l)),fe(a).call(a,g)||a.push(g),g._uintid||(g._uintid=l),g._dataChannels.findIndex(T=>T.id===c.stream_id)===-1){const T={id:h,ordered:!!p,maxRetransmits:f,metadata:_},w=new h8(T);g._dataChannels.push(w),v.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published datachannel")),t||this.safeEmit(qe.USER_PUBLISHED,g,"datachannel",T)}this._p2pChannel.hasPendingRemoteDataChannel(g,c.stream_id)&&(v.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(g.uid," after reconnect.")),this._subscribeDataChannel(g,c.stream_id).catch(T=>{v.error("[".concat(this._clientId,"] resubscribe datachannel error"),T.toString())}))}),t&&(this.safeEmit(qe.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(c=>{const{uid:l,stream_id:h}=c,p=this._users.find(_=>_._uintid===l);if(!p)return void v.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const f=p._dataChannels.find(_=>_.id===c.stream_id);f&&(v.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(l)),this._p2pChannel.unsubscribeDataChannel(p,[f]).then(_=>{if(p._dataChannels=p._dataChannels.filter(g=>g!==f),_)return this._gateway.unsubscribeDataChannel(_,p.uid)}),v.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished datachannel ,id:").concat(f.id)),this.safeEmit(qe.USER_UNPUBLISHED,p,"datachannel",f._config))})}_handleRemoveDataChannels(e){const t=this._users.find(i=>i.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){v.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(s=>{this.safeEmit(qe.USER_UNPUBLISHED,t,"datachannel",s._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(s=>{if(s)return this._gateway.unsubscribeDataChannel(s,t.uid)}),i()}}else v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Ut.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Ut.CONNECTION_STATE_CHANGE,(e,t,i)=>{var s;if(i===Ye.FALLBACK)return;const a=()=>{this.safeEmit(qe.CONNECTION_STATE_CHANGE,e,t,i)};if(Te.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:Jt.CONNECTION_STATE_CHANGE,options:[e,t,i],tag:Pt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:i})),v.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void a();if(e==="RECONNECTING")this._users.forEach(l=>{l._trust_in_room_=!1,l._trust_audio_enabled_state_=!1,l._trust_video_enabled_state_=!1,l._trust_audio_mute_state_=!1,l._trust_video_mute_state_=!1,l._trust_audio_stream_added_state_=!1,l._trust_video_stream_added_state_=!1,l._is_pre_created||(l._audio_pre_subscribed||(l._audioSSRC=void 0,l._audioOrtc=void 0),l._video_pre_subscribed||(l._videoSSRC=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),l._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var c;this._streamFallbackTypeCacheMap.forEach((l,h)=>{this._gateway.setStreamFallbackOption(h,l).catch(p=>{v.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),p)})}),this._remoteStreamTypeCacheMap.forEach((l,h)=>{this._gateway.setRemoteVideoStreamType(h,l).catch(p=>{v.warning("[".concat(this._clientId,"] auto set remote stream type failed"),p)})}),this._remoteDefaultVideoStreamType!==void 0&&((c=this._joinInfo)===null||c===void 0?void 0:c.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{v.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(l=>{v.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(l))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(l=>!l._trust_in_room_).forEach(l=>{v.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(l.uid)),this._handleUserOffline({uid:l.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(l=>{l._trust_audio_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,Ee.AUDIO,!1)),l._trust_video_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,Ee.VIDEO,!1)),l._trust_audio_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(l.uid)),this._handleSetStreamLocalEnable("audio",l.uid,!0)),l._trust_video_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(l.uid)),this._handleSetStreamLocalEnable("video",l.uid,!0)),l._trust_video_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(l.uid)),this._handleResetAddStream(l,"video")),l._trust_audio_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(l.uid)),this._handleResetAddStream(l,"audio")),l._video_added_||l._audio_added_||(v.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(l.uid)),this._handleRemoveStream({uid:l.uid,uint_id:l._uintid}))}))},1e3))}a()}),this._gateway.on(Ut.REQUEST_NEW_GATEWAY_LIST,(e,t)=>{if(!this._joinInfo)return t(new B(O.UNEXPECTED_ERROR,"can not recover, no join info"));mT(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||$t,this.store).then(i=>{this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const s=[];i.gatewayInfo.gatewayAddrs.forEach(a=>{let{address:c}=a;const[l,h]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:l,port:h}):s.push({host:l,port:h})}),e(s)}).catch(t)}),this._gateway.on(Ut.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(qe.NETWORK_QUALITY,e)}),this._gateway.on(Ut.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(qe.STREAM_TYPE_CHANGED,e,t),Te.reportApiInvoke(this._sessionId,{name:Jt.STREAM_TYPE_CHANGE,options:[e,t],tag:Pt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(Ut.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Ut.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(Ut.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,i)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(s){i(s)}}),this._gateway.on(Ut.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;const{dtlsParameters:i,iceParameters:s,candidates:a,rtpCapabilities:c,setup:l,cname:h}=Ok(e.ortc,t);this._p2pChannel.connect(s,i,a,c,l,h)}),this._gateway.on(Ut.REQUEST_DC_CONNECTION_PARAMS,e=>{e(this._p2pChannel.getEstablishParams())}),this._gateway.on(Ut.RESET_SIGNAL,e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()}),this._gateway.on(Ut.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(Ut.DATACHANNEL_PRECONNECT,async(e,t,i,s)=>{var a,c,l,h,p,f;await this._p2pChannel.startP2PConnection({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},!0);const _=function(g,T){let w;return T&&T.ip&&typeof T.port=="number"?(w=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:T.ip,port:T.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(T.ip,":").concat(T.port)),T.ip6&&(w.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:T.ip6,port:T.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(T.ip6,":").concat(T.port)))):w=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:g.ip,port:g.port.toString(),type:"host",extension:{}}],w}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat((c=this._joinInfo)===null||c===void 0?void 0:c.apResponse.cid,"_").concat((l=this._joinInfo)===null||l===void 0?void 0:l.apResponse.cert),icePwd:"".concat((h=this._joinInfo)===null||h===void 0?void 0:h.apResponse.cid,"_").concat((p=this._joinInfo)===null||p===void 0?void 0:p.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(f=L("FINGERPRINT"))!==null&&f!==void 0?f:e.fingerprint}]},_,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(i).catch(s)})}_handleGatewaySignalEvents(){this._gateway.signal.on(De.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(De.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(De.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(De.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(De.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(De.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams,deleted:[]},!0)}),this._gateway.signal.on(De.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(De.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(De.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Ee.AUDIO,!0)),this._gateway.signal.on(De.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Ee.AUDIO,!1)),this._gateway.signal.on(De.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Ee.VIDEO,!0)),this._gateway.signal.on(De.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Ee.VIDEO,!1)),this._gateway.signal.on(De.RECEIVE_METADATA,e=>{const t=vu(e.metadata);this.safeEmit(qe.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(De.ON_DATA_STREAM,async e=>{var t;if(!e)return;let i=vu(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&fe(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Md)throw new B(O.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Md));i=await async function(c,l,h){const p=h.subarray(0,Md),f=p.slice(8,Md),_=(f[0]<<8)+f[1],g=(p[6]<<8)+p[7],T=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:zb,additionalData:new Uint8Array(cb(_,2))},l,h.subarray(Md));return new Uint8Array(T).subarray(0,g)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let s=0;if(e.ordered||e.syncWithAudio){const a=this._p2pChannel.getStats(),c=this.remoteUsers.find(h=>h.uid===e.uid),l=a==null?void 0:a.audioRecv.find(h=>h.ssrc===(c==null?void 0:c._audioSSRC));s=l==null?void 0:l.jitterBufferMs}s==null&&(s=0),HY(Is(Is({},e),{},{payload:i}),s,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(De.ON_CRYPT_ERROR,()=>{Nd(()=>{v.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(qe.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(De.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(De.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{v.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ye.TOKEN_EXPIRE),this.safeEmit(qe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(De.ON_STREAM_FALLBACK_UPDATE,e=>{v.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(qe.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(De.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),v.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(De.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(De.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(pe.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ve.PUBLISH:{if(!t)return;const a=t.ortc;if(a){var i,s;const c=a.some(p=>{let{stream_type:f}=p;return f===it.Audio}),l=a.some(p=>{let{stream_type:f}=p;return f!==it.Audio}),h=a.some(p=>{let{stream_type:f}=p;return f===it.Screen||f===it.ScreenLow});t.state==="offer"&&Te.publish(this._joinInfo.sid,{eventElapse:Fn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:O.TIMEOUT,audio:c,video:l,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:h,audioName:c?(i=a.find(p=>{let{stream_type:f}=p;return f===it.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:l?(s=a.find(p=>{let{stream_type:f}=p;return f!==it.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case ve.SUBSCRIBE:t&&Te.subscribe(this._joinInfo.sid,{succ:!1,ec:O.TIMEOUT,audio:t.stream_type===Ee.AUDIO,video:t.stream_type===Ee.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Fn.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}}),this._gateway.signal.on(De.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(De.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;L("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(s=>!vc(s.string_id||s.stream_id,this.channelName)));const t=[],i=[];for(const s of e.users){let a=this._users.find(_=>_._uintid===s.stream_id);a?a._trust_in_room_=!0:(a=new On(s.string_id||s.stream_id,s.stream_id),this._users.push(a),this.getListeners(qe.PUBLISHED_USER_LIST).length===0&&(v.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(qe.USER_JOINED,a)));const c=en.Audio&s.stream_type,l=(en.Video|en.LwoVideo)&s.stream_type,h=(65280&s.stream_type)!=0,p=c&&a.hasAudio,f=l&&a.hasVideo;l&&(a._trust_video_stream_added_state_=!0,a._video_added_=!0,a._videoSSRC=s.video_ssrc,a._rtxSsrcId=s.video_rtx),c&&(a._trust_audio_stream_added_state_=!0,a._audio_added_=!0,a._audioSSRC=s.audio_ssrc),c&&!p&&this.getListeners(qe.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published audio")),this.safeEmit(qe.USER_PUBLISHED,a,"audio")),l&&!f&&this.getListeners(qe.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published video")),this.safeEmit(qe.USER_PUBLISHED,a,"video")),(c&&!p||l&&!f||h)&&t.push(a),l&&this._p2pChannel.hasPendingRemoteMedia(a,"video")&&i.push({user:a,mediaType:"video"}),c&&this._p2pChannel.hasPendingRemoteMedia(a,"audio")&&i.push({user:a,mediaType:"audio"})}i.length>0&&(v.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(s=>{v.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(qe.PUBLISHED_USER_LIST).length>0?L("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(v.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(s=>s.uid).join(", "))),this.safeEmit(qe.PUBLISHED_USER_LIST,t)):v.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(s=>s.uid).join(", ")))}),this._gateway.signal.on(De.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof Cn&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(i=>i.toLowerCase()).filter(i=>{var s;return fe(s=Object.keys(aa)).call(s,i)}))})}_handleP2PEvents(){this._gateway.signal.on(De.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(xt.PUBLISH,(e,t,i)=>{const{uid:s}=e;e.forEach(a=>{const{kind:c,ssrcs:l,mid:h,isMuted:p}=a;this._handleP2PAddAudioOrVideoStream(c,s,l[0].ssrcId,h);const f=this._users.find(_=>_.uid===s);return f&&this._p2pChannel instanceof un?this._p2pChannel.mockSubscribe(f,c,l[0].ssrcId,h).then(()=>{t()}).catch(i):t(),this._handleMuteStream(s,c,!!p)})}),this._gateway.signal.on(xt.CALL,async(e,t,i)=>{if(this._p2pChannel instanceof un)try{var s;t(await this._p2pChannel.startP2P({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer},e))}catch(a){i(a)}}),this._gateway.signal.on(pe.P2P_CONNECTION,async e=>{this._p2pChannel instanceof un&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(xt.UNPUBLISH,async(e,t,i)=>{if(this._p2pChannel instanceof un){const{unpubMsg:s,uid:a}=e,c=this._users.find(l=>l.uid===a);if(!c)return v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a)),void t();try{s.forEach(async l=>{let{stream_type:h}=l;const p=h===it.Audio?Ee.AUDIO:Ee.VIDEO;await this._p2pChannel.unsubscribe(c,p),this._handleMuteStream(a,p,!0)}),t()}catch(l){i(l)}}}),this._gateway.signal.on(xt.CONTROL,async(e,t)=>{const{action:i}=e;switch(i){case Ks.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Ee.VIDEO,!0);break;case Ks.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Ee.AUDIO,!0);break;case Ks.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Ee.VIDEO,!1);break;case Ks.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Ee.AUDIO,!1)}}),this._gateway.signal.on(xt.RESTART_ICE,async(e,t,i)=>{if(this._p2pChannel instanceof un)try{const{direction:s,iceParameter:a}=e;s!==qn.SEND_ONLY||a?t(await this._p2pChannel.restartICE(s,a)):(this._p2pChannel.handleDisconnect(s),t())}catch(s){i(s)}}),this._gateway.signal.on(xt.CANDIDATE,e=>{if(this._p2pChannel instanceof un){const{candidate:t,direction:i}=e;this._p2pChannel.addRemoteCandidate(t,i)}}),this._p2pChannel.on(Oe.RequestP2PRestartICE,async(e,t,i)=>{try{const{direction:s}=e;t(await this._gateway.sendExtensionMessage(xt.RESTART_ICE,e,s===qn.SEND_ONLY))}catch(s){i(s)}}),this._p2pChannel.on(Oe.LocalCandidate,e=>{this._gateway.sendExtensionMessage(xt.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Oe.RequestP2PMuteLocal,async(e,t,i)=>{try{await this._gateway.sendExtensionMessage(xt.CONTROL,e,!0),t()}catch(s){i(s)}}),this._p2pChannel.on(Oe.RequestP2PUnmuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===O.DISCONNECT_P2P?t():i(s)}else t()}),this._p2pChannel.on(Oe.RequestP2PMuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===O.DISCONNECT_P2P?t():i(s)}else t()}),this._p2pChannel.on(Oe.StateChange,(e,t)=>{t===st.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Oe.RequestMuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===O.DISCONNECT_P2P?t():i(s)}else t()}),this._p2pChannel.on(Oe.RequestUnmuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===O.DISCONNECT_P2P?t():i(s)}else t()}),this._p2pChannel.on(Oe.RequestRePublish,(e,t,i)=>{this.publish(e,!1).then(t).catch(i)}),this._p2pChannel.on(Oe.RequestRePublishDataChannel,(e,t,i)=>{W.all(e.map(async s=>{await this._p2pChannel.publishDataChannel([s]);const a={streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,a,!0)}catch(c){if(c.code!==O.DISCONNECT_P2P)throw c}})).then(t).catch(i)}),this._p2pChannel.on(Oe.RequestReSubscribe,async(e,t,i)=>{try{for(const{user:s,kind:a}of e)a===Ee.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");t()}catch(s){i(s)}}),this._p2pChannel.on(Oe.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Oe.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Oe.MediaReconnectStart,e=>{this.safeEmit(qe.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Oe.MediaReconnectEnd,e=>{this.safeEmit(qe.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Oe.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Oe.RequestRestartICE,async e=>{if(this._p2pChannel instanceof un)return;const t=await this._p2pChannel.restartICE(e),i=await t.next();if(i.done)return;const s=i.value;let a;try{a=await this._gateway.restartICE({iceParameters:s})}catch(l){return void t.throw(l)}const{iceParameters:c}=function(l){const h=l.iceParameters;return{iceParameters:{iceUfrag:h.iceUfrag,icePwd:h.icePwd}}}(a);await t.next({remoteIceParameters:c})}),this._p2pChannel.on(Oe.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Oe.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:i,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:a,gatewayAddress:c}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:i,rtpCapabilities:s}),{dtlsParameters:l,iceParameters:h,candidates:p,rtpCapabilities:f,setup:_,cname:g}=Ok(a,c);await this._p2pChannel.connect(h,l,p,f,_,g),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Oe.RequestUnpublishForReconnectPC,async(e,t,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):i()}),this._p2pChannel.on(Oe.P2PLost,()=>{this.safeEmit(qe.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Oe.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Oe.ConnectionTypeChange,e=>{this.safeEmit(qe.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Oe.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Oe.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach(i=>{var s;if(!fe(s=["supervise","moderation"]).call(s,i))throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(i," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new Lm(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},$t)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Eo(e,"enabled"),e){if(!t)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(pt(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(t&&t.vendor&&t.vendor.length>1024)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] config.vendor length cannot exceed 1024 bytes"));if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);const i=new ey(t);this._moderation=i,this.handleImageModerationEvents(this._moderation),await i.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},$t)}catch(i){throw Array.isArray(i)?i[0]:i}}else{if(!this._moderation)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}setP2PTransport(e){if(function(t){an(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new B(O.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,v.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}handleImageModerationEvents(e){e.on(yr.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(qe.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,i),t===xi.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new B(O.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(yr.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}handleVideoInspectEvents(e){e.on(ln.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(qe.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,i),i===er.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(qe.CONTENT_INSPECT_ERROR,new B(O.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(ln.INSPECT_RESULT,(t,i)=>{var s;if((i==null?void 0:i.code)===O.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return v.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(qe.CONTENT_INSPECT_RESULT,t,i)}),e.on(ln.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return v.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Eo(e,"enabled"),ft("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}$([Ae(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",W)],ut.prototype,"leave",null),$([Ae({argsMap:(n,e)=>{if(!Array.isArray(e)){if(!(e instanceof Vn))return[e];e=[e]}return e.map(t=>t?Object(t).toString():"null")}}),A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",W)],ut.prototype,"publish",null),$([Ae({argsMap:(n,e)=>(e||(e=[]),e instanceof hD?[e.getChannelId()]:(Array.isArray(e)||(e=[e]),e.map(t=>t.getTrackId())))}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],ut.prototype,"unpublish",null),$([Ae({argsMap:(n,e,t,i)=>[e.uid,t,i]}),A("design:type",Function),A("design:paramtypes",[On,String,Number]),A("design:returntype",W)],ut.prototype,"subscribe",null),$([Ae({argsMap:(n,e,t)=>[e,t]}),A("design:type",Function),A("design:paramtypes",[Object,String]),A("design:returntype",W)],ut.prototype,"presubscribe",null),$([Ae({argsMap:(n,e)=>e.map(t=>{let{user:i,mediaType:s}=t;return[i==null?void 0:i.uid,s]})}),A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],ut.prototype,"massSubscribe",null),$([Ae({argsMap:(n,e,t,i)=>[e.uid,t,i]}),A("design:type",Function),A("design:paramtypes",[On,String,Number]),A("design:returntype",W)],ut.prototype,"unsubscribe",null),$([Ae({argsMap:(n,e)=>e.map(t=>{let{user:i,mediaType:s}=t;return{uid:i==null?void 0:i.uid,mediaType:s}})}),A("design:type",Function),A("design:paramtypes",[Array]),A("design:returntype",W)],ut.prototype,"massUnsubscribe",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],ut.prototype,"setLowStreamParameter",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",W)],ut.prototype,"enableDualStream",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",W)],ut.prototype,"disableDualStream",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[String,Object]),A("design:returntype",W)],ut.prototype,"setClientRole",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[String,Boolean]),A("design:returntype",void 0)],ut.prototype,"setProxyServer",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Object,Boolean]),A("design:returntype",void 0)],ut.prototype,"setTurnServer",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",void 0)],ut.prototype,"setLicense",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",void 0)],ut.prototype,"startProxyServer",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],ut.prototype,"stopProxyServer",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",void 0)],ut.prototype,"setLocalAccessPointsV2",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Array,String]),A("design:returntype",void 0)],ut.prototype,"setLocalAccessPoints",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Number]),A("design:returntype",W)],ut.prototype,"setRemoteDefaultVideoStreamType",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Object,Number]),A("design:returntype",W)],ut.prototype,"setRemoteVideoStreamType",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Object,Number]),A("design:returntype",W)],ut.prototype,"setStreamFallbackOption",null),$([Ae({argsMap:(n,e)=>[e]}),A("design:type",Function),A("design:paramtypes",[String,String,Uint8Array,Boolean]),A("design:returntype",void 0)],ut.prototype,"setEncryptionConfig",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],ut.prototype,"renewToken",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],ut.prototype,"enableAudioVolumeIndicator",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[String,Boolean]),A("design:returntype",W)],ut.prototype,"startLiveStreaming",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],ut.prototype,"setLiveTranscoding",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",W)],ut.prototype,"stopLiveStreaming",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[String,Object]),A("design:returntype",W)],ut.prototype,"addInjectStreamUrl",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",W)],ut.prototype,"removeInjectStreamUrl",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Om]),A("design:returntype",W)],ut.prototype,"startChannelMediaRelay",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Om]),A("design:returntype",W)],ut.prototype,"updateChannelMediaRelay",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",W)],ut.prototype,"stopChannelMediaRelay",null),$([Ae({argsMap:(n,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],ut.prototype,"sendCustomReportMessage",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Object,Object]),A("design:returntype",W)],ut.prototype,"pickSVCLayer",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],ut.prototype,"setRTMConfig",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",W)],ut.prototype,"enableContentInspect",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",W)],ut.prototype,"disableContentInspect",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Boolean,Object]),A("design:returntype",W)],ut.prototype,"setImageModeration",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",void 0)],ut.prototype,"setP2PTransport",null),$([Ae({reportResult:!0}),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Array)],ut.prototype,"getJoinChannelServiceRecords",null),$([Ae(),A("design:type",Function),A("design:paramtypes",[Boolean]),A("design:returntype",W)],ut.prototype,"setPublishAudioFilterEnabled",null);class mh{constructor(e,t){S(this,"id",0),S(this,"element",void 0),S(this,"peerPair",void 0),S(this,"context",void 0),S(this,"audioPlayerElement",void 0),S(this,"audioTrack",void 0),mh.count+=1,this.id=mh.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(i,s)=>{const a=s==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(a),i.iceGatheringState==="complete"?i.localDescription:new W(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},t=async(i,s)=>await i.setRemoteDescription(s);try{const i=await e(this.peerPair[0],"offer");await t(this.peerPair[1],i);const s=await e(this.peerPair[1],"answer");await t(this.peerPair[0],s)}catch(i){throw new B(O.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(s){throw new B(O.LOCAL_AEC_ERROR,s.toString()).print()}if(!t)throw new B(O.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=t.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){v.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}S(mh,"count",0);const YY=window.AudioContext||window.webkitAudioContext;class CL{constructor(){S(this,"units",[]),S(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return v.debug("the system does not need to process local aec"),-1;this.context||(this.context=new YY);let t=this.units.find(i=>i&&i.getElement()===e);return t||(t=new mh(e,this.context),this.units.push(t)),t.startEchoCancellation(),v.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Ze().name!==rt.SAFARI}}$([Ae({report:Te}),A("design:type",Function),A("design:paramtypes",[HTMLAudioElement]),A("design:returntype",Number)],CL.prototype,"processExternalMediaAEC",null);const qY=new CL;function IL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function wL(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?IL(Object(t),!0).forEach(function(i){S(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):IL(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const ny=window||document;function AL(n){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!ny)return;const t=Zt._cspEventHandlerPointer;if(t&&e)return void console.error(t,e);const i=s=>{if(!(s&&s.blockedURI&&(Zt.onSecurityPolicyViolation||Zt.getListeners(Wr.SECURITY_POLICY_VIOLATION).length>0)))return;const a=s.blockedURI;L("CSP_DETECTED_HOSTNAME_LIST").some(c=>fe(a).call(a,c))&&(Zt.onSecurityPolicyViolation&&typeof Zt.onSecurityPolicyViolation=="function"&&Zt.onSecurityPolicyViolation(s),Zt.getListeners(Wr.SECURITY_POLICY_VIOLATION).length>0&&Zt.safeEmit(Wr.SECURITY_POLICY_VIOLATION,s))};t&&ny.removeEventListener("securitypolicyviolation",t),(e||n&&typeof n=="function"||Zt.getListeners(Wr.SECURITY_POLICY_VIOLATION).length>0)&&ny.addEventListener("securitypolicyviolation",i),Zt._cspEventHandlerPointer=i}ft("PROCESS_ID","process-".concat(Et(8,""),"-").concat(Et(4,""),"-").concat(Et(4,""),"-").concat(Et(4,""),"-").concat(Et(12,""))),function(){let n;try{n=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void v.error("Error loading sdk config",e.message)}if(n)try{const e=JSON.parse(window.atob(n)),t=Date.now();v.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(ri,i)){const{value:s,expires:a}=e[i];if(a&&a<=t)return;oa[i]=s,ri[i]=s}})}catch(e){v.error("Error loading mutableParamsCache: ".concat(n),e.message)}}(),Array.isArray(oa.AREAS)&&oa.AREAS.length>0&&uT(oa.AREAS,!0);const OL=(n,e,t)=>{v.debug("setParameter key:".concat(n,", value:").concat(JSON.stringify(e))),ft(n,e,t)},Zt=function(n){const e=new At,t=n,i={getListeners:e.getListeners.bind(e),on:(s,a)=>(function(c,l){c===Wr.SECURITY_POLICY_VIOLATION&&AL(l,!0)}(s,a),e.on.bind(e)(s,a)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return wL(wL({},t),i)}({__TRACK_LIST__:jd,VERSION:Tr,BUILD:zS,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:OL,getParameter:L,getSupportedCodec:async function(){let n={audio:[],video:[]};try{let e=new RTCPeerConnection;e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"});const t=(await e.createOffer()).sdp;if(!t)return n;e.close(),e=null,n=function(i){const s={video:[],audio:[]};return i.match(/ VP8/i)&&s.video.push("VP8"),i.match(/ VP9/i)&&s.video.push("VP9"),i.match(/ AV1/i)&&s.video.push("AV1"),i.match(/ H264/i)&&s.video.push("H264"),i.match(/ H265/i)&&s.video.push("H265"),i.match(/ opus/i)&&s.audio.push("OPUS"),i.match(/ PCMU/i)&&s.audio.push("PCMU"),i.match(/ PCMA/i)&&s.audio.push("PCMA"),i.match(/ G722/i)&&s.audio.push("G722"),s}(t)}catch(e){throw new B(O.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return n},checkSystemRequirements:function(){const n=Te.reportApiInvoke(null,{name:Jt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Pt.TRACER});let e=!1;try{const a=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;e=!!(a&&c&&l)}catch(a){return v.error("check system requirement failed: ",a),!1}let t=!1;const i=Ze();i.name===rt.CHROME&&Number(i.version)>=58&&(!_H()||mH())&&(t=!0),i.name===rt.FIREFOX&&Number(i.version)>=56&&(t=!0),i.name===rt.OPERA&&Number(i.version)>=45&&(t=!0),i.name===rt.SAFARI&&Number(i.version)>=11&&(t=!0),(WO()||Ze().name===rt.QQ)&&(t=!0),v.debug("checkSystemRequirements, api:",e,"browser",t);const s=e&&t;return n.onSuccess(s),s},getDevices:function(n){return sr.enumerateDevices(!0,!0,n)},getMicrophones:function(n){return sr.getRecordingDevices(n)},getCameras:function(n){return sr.getCamerasDevices(n)},getElectronScreenSources:$N,getPlaybackDevices:function(n){return sr.getSpeakers(n)},createClient:function(){var n;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=Te.reportApiInvoke(null,{name:Jt.CREATE_CLIENT,options:[e],tag:Pt.TRACER});try{(function(i){an(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),an(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&an(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&Un(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&$O(i.turnServer),i.httpRetryConfig!==void 0&&QO(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&QO(i.websocketRetryConfig)})(e)}catch(i){throw t.onError(i),i}return zY()||(e.codec==="vp9"&&(e.codec="vp8",v.debug("browser not support vp9, force use vp8")),ft("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),t.onSuccess(),new ut(Is(Is({forceWaitGatewayResponse:!0},e),{},{role:fe(n=["rtc","p2p"]).call(n,e.mode)?"host":e.role||"audience"}))},createCameraVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Te.reportApiInvoke(null,{tag:Pt.TRACER,name:Jt.CREATE_CAM_VIDEO_TRACK,options:[qf({},n)]}),t=Yf(n),i=Et(8,"track-cam-");let s=null;const a=n.encoderConfig==="720p_auto";v.info("start create camera video track with config",JSON.stringify(n),"trackId",i);try{s=(await rr({video:t},i)).getVideoTracks()[0]||null}catch(l){throw e.onError(l),l}if(!s){const l=new Q(O.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(l),l.throw(v)}n.optimizationMode&&PT(i,s,n,zs(n.encoderConfig));const c=new Ta(s,n,t,n.scalabiltyMode?Wf(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,i);return a&&c.startMonitorStats(),e.onSuccess(c.getTrackId()),v.info("create camera video success, trackId:",i),c},createCustomVideoTrack:function(n){const e=Te.reportApiInvoke(null,{tag:Pt.TRACER,name:Jt.CREATE_CUSTOM_VIDEO_TRACK,options:[n]}),t=new Ge(n.mediaStreamTrack,{width:n.width,height:n.height,frameRate:n.frameRate,bitrateMax:n.bitrateMax,bitrateMin:n.bitrateMin},n.scalabiltyMode?Wf(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,Et(8,"track-cus-"),[Tt.CUSTOM_TRACK]);return e.onSuccess(t.getTrackId()),v.info("create custom video track success with config",n,"trackId",t.getTrackId()),t},createScreenVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const t=Te.reportApiInvoke(null,{tag:Pt.TRACER,name:Jt.CREATE_SCREEN_VIDEO_TRACK,options:[qf({},n),e]}),i=n.encoderConfig==="720p_auto";n.encoderConfig?typeof n.encoderConfig=="string"||n.encoderConfig.width&&n.encoderConfig.height||(n.encoderConfig.width={max:1920},n.encoderConfig.height={max:1080}):n.encoderConfig="1080p_2";const s=function(_){const g={};_.screenSourceType&&(g.mediaSource=_.screenSourceType),_.extensionId&&_o()&&(g.extensionId=_.extensionId);const{displaySurface:T,selfBrowserSurface:w,surfaceSwitching:R,systemAudio:I}=_;(ES(107)||VO(107)||FO(93))&&(T&&(an(T,"displaySurface",["browser","window","monitor"]),g.displaySurface=T),w?(an(w,"selfBrowserSurface",["exclude","include"]),g.selfBrowserSurface=w):g.selfBrowserSurface="include",R&&(an(R,"surfaceSwitching",["exclude","include"]),g.surfaceSwitching=R)),(ES(105)||VO(105)||FO(91))&&I&&(an(I,"systemAudio",["exclude","include"]),g.systemAudio=I),_.electronScreenSourceId&&(g.sourceId=_.electronScreenSourceId);const N=_.encoderConfig?ET(_.encoderConfig):null;return g.mandatory={chromeMediaSource:"desktop",maxWidth:N?N.width:void 0,maxHeight:N?N.height:void 0},N&&(N.frameRate&&(typeof N.frameRate=="number"?(g.mandatory.maxFrameRate=N.frameRate,g.mandatory.minFrameRate=N.frameRate):(g.mandatory.maxFrameRate=N.frameRate.max||N.frameRate.ideal||N.frameRate.exact||void 0,g.mandatory.minFrameRate=N.frameRate.min||N.frameRate.ideal||N.frameRate.exact||void 0),g.frameRate=N.frameRate),N.width&&(g.width=N.width),N.height&&(g.height=N.height)),g}(n),a=Et(8,"track-scr-v-");let c=null,l=null;const h=et();if(!h.supportShareAudio&&e==="enable"){const _=new Q(O.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return t.onError(_),_.throw(v)}v.info("start create screen video track with config",n,"withAudio",e,"trackId",a);try{const _=await rr({screen:s,screenAudio:e==="auto"?h.supportShareAudio:e==="enable"},a);c=_.getVideoTracks()[0]||null,l=_.getAudioTracks()[0]||null}catch(_){throw t.onError(_),_}if(!c){const _=new Q(O.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(_),_.throw(v)}if(!l&&e==="enable"){c&&c.stop();const _=new Q(O.SHARE_AUDIO_NOT_ALLOWED);return t.onError(_),_.throw(v)}n.optimizationMode||(n.optimizationMode="detail"),n.optimizationMode&&(PT(a,c,n,n.encoderConfig&&ET(n.encoderConfig)||void 0),n.encoderConfig&&typeof n.encoderConfig!="string"&&(n.encoderConfig.bitrateMin=n.encoderConfig.bitrateMax));const p=new Ge(c,n.encoderConfig?ET(n.encoderConfig):{},n.scalabiltyMode?Wf(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,a,[Tt.SCREEN_TRACK]);if(i&&p.startMonitorStats(),!l)return t.onSuccess(p.getTrackId()),v.info("create screen video track success","video:",p.getTrackId()),p;const f=new lt(l,void 0,Et(8,"track-scr-a-"),!1);return t.onSuccess([p.getTrackId(),f.getTrackId()]),v.info("create screen video track success","video:",p.getTrackId(),"audio:",f.getTrackId()),[p,f]},createMicrophoneAndCameraTracks:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=Te.reportApiInvoke(null,{tag:Pt.TRACER,name:Jt.CREATE_MIC_AND_CAM_TRACKS,options:[n,e]}),i=e.encoderConfig==="720p_auto",s=Yf(e),a=hP(n),c=Et(8,"track-mic-"),l=Et(8,"track-cam-");let h=null,p=null;v.info("start create camera video track(".concat(l,") and microphone audio track(").concat(c,") with config, audio: ").concat(JSON.stringify(n),", video: ").concat(JSON.stringify(e)));try{const g=await rr({audio:a,video:s},"".concat(c,"-").concat(l));h=g.getAudioTracks()[0],p=g.getVideoTracks()[0]}catch(g){throw t.onError(g),g}if(!h||!p){const g=new Q(O.UNEXPECTED_ERROR,"can not find tracks in media stream");return t.onError(g),g.throw(v)}e.optimizationMode&&PT(l,p,e,zs(e.encoderConfig));const f=new Ac(h,n,a,c),_=new Ta(p,e,s,e.scalabiltyMode?Wf(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,l);return i&&_.startMonitorStats(),t.onSuccess([f.getTrackId(),_.getTrackId()]),v.info("create camera video track(".concat(l,") and microphone audio track(").concat(c,") success")),[f,_]},createMicrophoneAudioTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Te.reportApiInvoke(null,{tag:Pt.TRACER,name:Jt.CREATE_MIC_AUDIO_TRACK,options:[n]}),t=hP(n),i=Et(8,"track-mic-");let s=null;v.info("start create microphone audio track with config",JSON.stringify(n),"trackId",i);try{s=(await rr({audio:t},i)).getAudioTracks()[0]||null}catch(c){throw e.onError(c),c}if(!s){const c=new Q(O.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(c),c.throw(v)}const a=new Ac(s,n,t,i);return e.onSuccess(a.getTrackId()),v.info("create microphone audio track success, trackId:",i),a},createCustomAudioTrack:function(n){const e=Te.reportApiInvoke(null,{tag:Pt.TRACER,name:Jt.CREATE_CUSTOM_AUDIO_TRACK,options:[n]}),t=new lt(n.mediaStreamTrack,n.encoderConfig?Hf(n.encoderConfig):{},Et(8,"track-cus-"),!1);return v.info("create custom audio track success with config",n,"trackId",t.getTrackId()),e.onSuccess(t.getTrackId()),t},createBufferSourceAudioTrack:async function(n){var e;const{cacheOnlineFile:t,encoderConfig:i}=n;let{source:s}=n;const a={source:s instanceof AudioBuffer?"AudioBuffer":s instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":s,cacheOnlineFile:t,encoderConfig:i},c=Te.reportApiInvoke(null,{tag:Pt.TRACER,name:Jt.CREATE_BUFFER_AUDIO_TRACK,options:[a]});if(L("DISABLE_WEBAUDIO"))throw new Q(O.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const l=Et(8,"track-buf-");v.info("start create buffer source audio track with config",JSON.stringify(a),"trackId",l);const h=s;if(!(s instanceof AudioBuffer))try{s=await sK(s,t)}catch(_){return c.onError(_),_.throw(v)}const p=new rK(s),f=new Sa(h,p,i?Hf(i):{},l);return v.info("create buffer source audio track success, trackId:",l),c.onSuccess(f.getTrackId()),f},setAppType:function(n){if(v.debug("setAppType: ".concat(n)),!(Number.isInteger(n)&&n>=0))throw v.debug("Invalid appType"),new B(O.INVALID_PARAMS,"invalid app type",n);ft("APP_TYPE",Math.floor(n))},setLogLevel:function(n){v.setLogLevel(n)},enableLogUpload:function(){L("USE_NEW_LOG")?ft("UPLOAD_LOG",!0):v.enableLogUpload()},disableLogUpload:function(){L("USE_NEW_LOG")?ft("UPLOAD_LOG",!1):v.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Om},checkAudioTrackIsActive:async function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const t=Te.reportApiInvoke(null,{tag:Pt.TRACER,name:Jt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(n instanceof lt||n instanceof Yr)){const h=new B(O.INVALID_TRACK,"the parameter is not a audio track");return t.onError(h),h.throw()}e&&e<1e3&&(e=1e3);const i=n instanceof lt?n.getTrackLabel():"remote_track",s=n.getVolumeLevel();let a=s,c=s;const l=Date.now();return new W(h=>{const p=setInterval(()=>{const f=n.getVolumeLevel();a=f>a?f:a,c=f<c?f:c;const _=a-c>1e-4,g=Date.now()-l;if(_||g>e){clearInterval(p);const T=_,w={duration:g,deviceLabel:i,maxVolumeLevel:a,result:T};v.info("[track-".concat(n.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(w))),t.onSuccess(w),h(T)}},200)})},checkVideoTrackIsActive:async function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const t=Te.reportApiInvoke(null,{tag:Pt.TRACER,name:Jt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(n instanceof Ge||n instanceof Ys)){const _=new B(O.INVALID_TRACK,"the parameter is not a video track");return t.onError(_),_.throw()}e&&e<1e3&&(e=1e3);const i=n instanceof Ge?n.getTrackLabel():"remote_track",s=n.getMediaStreamTrack(!0),a=document.createElement("video");a.style.width="1px",a.style.height="1px",a.setAttribute("muted",""),a.muted=!0,a.setAttribute("playsinline",""),a.controls=!1,(wn()||hf())&&(a.style.opacity="0.01",a.style.position="fixed",a.style.left="0",a.style.top="0",document.body.appendChild(a)),a.srcObject=new MediaStream([s]),a.play();const c=document.createElement("canvas");c.width=160,c.height=120;let l=0,h=0;try{const _=Date.now();l=await function(g,T,w,R){let I,N=0,D=null;return new W((V,G)=>{function F(){N>R&&I&&(I(),V(N));const j=w.getContext("2d");if(!j){const re=new B(O.UNEXPECTED_ERROR,"can not get canvas 2d context.");return v.error(re.toString()),void G(re)}j.drawImage(g,0,0,160,120);const z=j.getImageData(0,0,w.width,w.height),Y=Math.floor(z.data.length/3);if(D){for(let re=0;re<Y;re+=3)if(z.data[re]!==D[re])return N+=1,void(D=z.data);D=z.data}else D=z.data}setTimeout(()=>{I&&(I(),V(N))},T),I=CT(()=>{F()},30)})}(a,e,c,4),h=Date.now()-_}catch(_){throw t.onError(_),_}KY===rt.SAFARI&&(a.pause(),a.remove()),a.srcObject=null;const p=l>4,f={duration:h,changedPicNum:l,deviceLabel:i,result:p};return v.info("[track-".concat(n.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(f))),t.onSuccess(f),p},setArea:uT,audioElementPlayCenter:fi,resumeAudioContext:function(){fi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(n){qY.processExternalMediaAEC(n)},registerExtensions:function(n){const e=L("PLUGIN_INFO")||[];n.forEach(t=>{"name"in t&&!fe(e).call(e,t.name)&&e.push(t.name);const i=t;i.__registered__=!0,i.logger.hookLog=v.extLog,i.reporter.hookApiInvoke=Te.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(s=>{i.parameters[s]=L(s)})}),OL("PLUGIN_INFO",e)},ChannelMediaRelayError:la,ChannelMediaRelayEvent:gs,ChannelMediaRelayState:li,RemoteStreamFallbackType:ST,RemoteStreamType:gT,ConnectionDisconnectedReason:Ye,AudienceLatencyLevelType:yS,AREAS:Qe});return Object.defineProperties(Zt,{onAudioAutoplayFailed:{get:()=>or.onAudioAutoplayFailed,set:n=>{or.onAudioAutoplayFailed=n}},onAutoplayFailed:{get:()=>or.onAutoplayFailed,set:n=>{or.onAutoplayFailed=n}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Zt._onSecurityPolicyViolation,set(n){Zt._onSecurityPolicyViolation=n,AL(n)}},__CLIENT_LIST__:{get:()=>L("SHOW_GLOBAL_CLIENT_LIST")?ca:[]}}),sr.on(wo.CAMERA_DEVICE_CHANGED,n=>{v.info("camera device changed",JSON.stringify(n)),Zt.onCameraChanged&&Zt.onCameraChanged(n),Zt.safeEmit(Wr.CAMERA_CHANGED,n)}),sr.on(wo.RECORDING_DEVICE_CHANGED,n=>{v.info("microphone device changed",JSON.stringify(n)),Zt.onMicrophoneChanged&&Zt.onMicrophoneChanged(n),Zt.safeEmit(Wr.MICROPHONE_CHANGED,n)}),sr.on(wo.PLAYOUT_DEVICE_CHANGED,n=>{v.debug("playout device changed",JSON.stringify(n)),Zt.onPlaybackDeviceChanged&&Zt.onPlaybackDeviceChanged(n),Zt.safeEmit(Wr.PLAYBACK_DEVICE_CHANGED,n)}),fi.onAutoplayFailed=()=>{v.info("detect audio element autoplay failed"),or.onAudioAutoplayFailed&&or.onAudioAutoplayFailed()},dt.on("autoplay-failed",()=>{v.info("detect webaudio autoplay failed"),or.onAudioAutoplayFailed&&or.onAudioAutoplayFailed(),Zt.safeEmit(Wr.AUTOPLAY_FAILED)}),dt.on(fn.STATE_CHANGE,(n,e)=>{v.info("audio context state changed: ".concat(e," => ").concat(n)),Zt.onAudioContextStateChanged&&Zt.onAudioContextStateChanged(n,e),Zt.safeEmit(Wr.AUDIO_CONTEXT_STATE_CHANGED,n,e)}),Qt.on(So.NETWORK_STATE_CHANGE,(n,e)=>{v.info("[network-indicator] network state changed, ".concat(e," => ").concat(n))}),window&&(window.__ARTC__=Zt),Zt})})(Vx);var G$=Vx.exports;const Fx=RM(G$),W$=({user:r,username:o})=>(le.useRef(),le.useEffect(()=>{console.log("playing video track")},[]),ce.jsx("div",{})),H$="eadb6e134cf641d183125d8746725119",Uo=Fx.createClient({mode:"rtc",codec:"vp8"}),K$=()=>{const[r,o]=le.useState([]),[d,u]=le.useState([]),m=le.useRef([]),E=localStorage.getItem("room-ID"),[y,b]=le.useState(!0);console.log("room id from video room:",E),console.log(localStorage);const P=async(M,X)=>{await Uo.subscribe(M,X),r.some(Z=>Z.uid===M.uid)||X==="audio"&&(o(Z=>[...Z,M]),M.audioTrack.play())},U=M=>{o(X=>X.filter(oe=>oe.uid!==M.uid))};le.useEffect(()=>((async()=>{try{let X=E;const Z=await(await fetch(`http://3.142.174.77:8080/access_token?channelName=${X}&role=audience`)).json();console.log("data",Z);const ne=Z.token;if(X=Z.channelName,console.log("token",ne),console.log("channel",X),ne&&X){Uo.on("user-published",P),Uo.on("user-left",U);const[Se,J]=await Promise.all([Fx.createMicrophoneAudioTrack(),Uo.join(H$,X,ne,null)]),H=Se;m.current=Se,console.log("currently mic muted is",y),u(Se),o(q=>q.some(Re=>Re.uid===J)?q:[...q,{uid:J,audioTrack:H}]),Uo.publish(Se),K(),K()}else console.error("token or channel not found")}catch(X){console.error(X)}})(),()=>{m.current&&m.current.length>0&&(console.log("local track",m.current),m.current.stop(),m.current.close()),Uo.off("user-published",P),Uo.off("user-left",U),m.current&&Uo.unpublish(m.current).then(()=>{Uo.leave()})}),[E]);const K=()=>{y?(console.log("mic is muted"),m.current.setMuted(!1),b(!1)):(console.log("mic is unmuted"),m.current.setMuted(!0),b(!0))};return ce.jsxs("div",{children:[ce.jsx("div",{onClick:K,children:y?ce.jsxs("div",{className:"text-red-500 text-2xl mb-4",children:[ce.jsx("div",{children:ce.jsx(B$,{className:"inline-block",size:30})}),ce.jsx("div",{children:"Muted"})]}):ce.jsxs("div",{className:"text-green-500 text-2xl mb-4 gap-4",children:[ce.jsx("div",{children:ce.jsx(j$,{className:"inline-block",size:30})}),ce.jsx("div",{children:"Unmuted"})]})}),r.map(M=>ce.jsx(W$,{user:M},M.uid))]})},yM=()=>{const[r,o]=le.useState(!0);return ce.jsx("div",{className:"mt-4 mb-4",children:ce.jsx("div",{children:r&&ce.jsx("div",{className:"mt-2",children:ce.jsx(K$,{})})})})};function z$(){const[r,o]=zi.useState([]),d=localStorage.getItem("room-ID"),u=localStorage.getItem("username"),m=rd(),[E,y]=le.useState(!1),b=localStorage.getItem("token"),P=le.useRef();le.useState(!1),le.useState(null),le.useEffect(()=>(P.current=Gh("http://3.142.174.77:4000"),K(r),P.current.on("updateParticipants",({channel:Z,participants:ne})=>{Z===d&&(o(ne),U())}),()=>{P.current.disconnect()}),[d]),le.useEffect(()=>{U()},[d]);const U=async()=>{var Z;try{const ne=await Kt.get(`http://3.142.174.77:4000/editor/participants/${d}`,{headers:{Authorization:`Bearer ${b}`}});o(ne.data.participants)}catch(ne){((Z=ne.response)==null?void 0:Z.status)===400?m("/home"):console.error("Error fetching participants:",ne)}},K=Z=>{o(Z),P.current.emit("updateParticipants",{channel:d,participants:Z}),U()},M=()=>{navigator.clipboard.writeText(d).then(()=>{y(!0),setTimeout(()=>y(!1),800)},()=>{console.error("Failed to copy room ID")})},X=async Z=>{var ne,Se,J,H;Z.preventDefault();try{const q=await Kt.post("http://3.142.174.77:4000/logout",{roomId:d,username:u},{headers:{Authorization:`Bearer ${b}`}});localStorage.removeItem("room-id"),m("/login"),K(r)}catch(q){console.log(((Se=(ne=q.response)==null?void 0:ne.data)==null?void 0:Se.error)||"An error occurred")}try{localStorage.removeItem("room-id"),m("/login"),K(r)}catch(q){console.log(((H=(J=q.response)==null?void 0:J.data)==null?void 0:H.error)||"An error occurred")}},oe=async Z=>{var ne,Se,J,H;Z.preventDefault(),K([]);try{const q=await Kt.delete(`http://3.142.174.77:4000/deleteroom/${d}`,{headers:{Authorization:`Bearer ${b}`}})}catch(q){console.log(((Se=(ne=q.response)==null?void 0:ne.data)==null?void 0:Se.error)||"An error occurred while deleting the room")}try{localStorage.removeItem("room-id"),m("/home")}catch(q){console.log(((H=(J=q.response)==null?void 0:J.data)==null?void 0:H.error)||"An error occurred")}};return ce.jsxs("div",{className:"bg-gray-800 h-full w-64 px-4 py-2 bg-opacity-50",children:[ce.jsxs("div",{className:"my-2 mb-4",children:[ce.jsx("h1",{className:"text-2xl",children:"EchoLab"}),ce.jsxs("h3",{className:"text-gray-400",children:["Room:",ce.jsx("button",{onClick:M,className:"text-sm text-black py-1 px-3 rounded mt-2",children:"Copy Room ID"}),d]}),E&&ce.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:ce.jsx("div",{className:"bg-green-500 text-white px-4 py-2 rounded",children:"Room ID Copied!"})}),ce.jsx("br",{}),ce.jsxs("div",{children:[ce.jsx("h3",{className:"text-gray-400",children:"Participants"}),ce.jsx("ul",{children:r.map((Z,ne)=>ce.jsx("li",{children:Z},ne))})]})]}),ce.jsx("hr",{className:"border-white-700"}),ce.jsx("div",{children:ce.jsx(yM,{})}),ce.jsx("hr",{className:"border-white-700"}),ce.jsx("div",{className:"mt-4",children:ce.jsx("button",{className:"bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded",onClick:X,children:"Leave Room"})}),ce.jsx("div",{className:"mt-4",children:ce.jsx("button",{className:"bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded",onClick:oe,children:"Delete Room"})}),ce.jsx("hr",{className:"border-white-700"}),ce.jsxs("div",{children:[ce.jsx("h3",{className:"text-gray-400",children:"Microphone Permission"}),ce.jsx(yM,{})]}),ce.jsx("hr",{className:"border-white-700"})]})}const Y$=r=>{switch(r){case"node":return"javascript";case"cpp":return"cpp";case"java":return"java";case"rust":return"rust";default:return r}};function q$(){const[r,o]=le.useState("python"),[d,u]=le.useState(""),[m,E]=le.useState(!1),[y,b]=le.useState(""),[P,U]=le.useState(""),K=rd(),M=localStorage.getItem("room-ID"),X=localStorage.getItem("token"),oe=le.useRef();le.useEffect(()=>(oe.current=Gh("http://3.142.174.77:4000"),oe.current.on("languageUpdate",({channel:q,language:ue})=>{q===M&&(o(ue),ne(ue))}),oe.current.on("codeUpdate",({channel:q,code:ue})=>{q===M&&(u(ue),E(!0))}),()=>oe.current.disconnect()),[M]),le.useEffect(()=>{X?ne(r):K("/login")},[K,X,r]);const Z=q=>{o(q),oe.current.emit("languageUpdate",{channel:M,language:q}),ne(q)},ne=async q=>{try{const ue=await Kt.get(`http://3.142.174.77:4000/editor/${M}`,{headers:{Authorization:`Bearer ${X}`}});u(ue.data.room[`${q}Code`]),E(!0)}catch(ue){console.error("Fetch code error:",ue)}},Se=q=>{u(q),oe.current.emit("codeChange",{channel:M,code:q,language:r}),J(q)},J=async q=>{try{await Kt.post(`http://3.142.174.77:4000/editor/${M}`,{code:q,lang:r},{headers:{Authorization:`Bearer ${X}`}})}catch(ue){console.error("Update database error:",ue),ue.response&&ue.response.status===401&&K("/login")}},H=async q=>{var Re,be;q.preventDefault(),b(""),U("");const ue=`http://3.142.174.77:4000/compile/${r.toLowerCase()}`;try{const we=await Kt.post(ue,{code:d},{headers:{Authorization:`Bearer ${X}`}});b(we.data.result)}catch(we){U(((be=(Re=we.response)==null?void 0:Re.data)==null?void 0:be.error)||"An error occurred")}};return ce.jsx(ce.Fragment,{children:ce.jsxs("div",{className:"editor",children:[ce.jsx("div",{className:"background-static"}),ce.jsx("div",{className:"min-h-screen flex flex-col",children:ce.jsx("div",{className:"flex-grow overflow-y-auto",children:ce.jsxs("div",{className:"editor-container",children:[ce.jsxs("h2",{children:[r.toUpperCase()," Editor"]}),ce.jsx("div",{children:ce.jsxs("select",{value:r,onChange:q=>Z(q.target.value),className:"mb-4",children:[ce.jsx("option",{value:"python",children:"Python"}),ce.jsx("option",{value:"java",children:"Java"}),ce.jsx("option",{value:"node",children:"Node.js"}),ce.jsx("option",{value:"cpp",children:"C++"}),ce.jsx("option",{value:"rust",children:"Rust"})]})}),ce.jsxs("div",{className:"flex",children:[ce.jsx("div",{className:"w-3/4 flex flex-col items-center",children:ce.jsxs("form",{onSubmit:H,className:"e-form w-full",children:[m&&ce.jsx(WQ,{height:"75vh",defaultLanguage:Y$(r),theme:"vs-dark",value:d,onChange:Se},r),ce.jsxs("div",{className:"flex flex-col items-center w-full",children:[ce.jsx("button",{type:"submit",className:"mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Run"}),ce.jsxs("div",{className:"output-container mt-4 w-full max-h-50 overflow-y-auto",children:[ce.jsx("div",{className:"text-sm -600 mb-2",children:"OUTPUT"}),y&&ce.jsx("pre",{className:"bg-gray-800 text-white rounded p-3 whitespace-pre-wrap break-words",children:y}),P&&ce.jsx("pre",{className:"bg-red-200 text-red-800 rounded p-3 whitespace-pre-wrap break-words",children:P})]})]})]})}),ce.jsx("div",{className:"w-1/4",children:ce.jsx(z$,{})})]})]})})})]})})}function J$(){return ce.jsx(E9,{children:ce.jsx("div",{className:"App",children:ce.jsxs(l9,{children:[ce.jsx(Hc,{path:"/register",element:ce.jsx(MX,{})}),ce.jsx(Hc,{path:"/login",element:ce.jsx(UX,{})}),ce.jsx(Hc,{path:"/home",element:ce.jsx(xX,{})}),ce.jsx(Hc,{path:"/editor/:id",element:ce.jsx(W1,{replace:!0,to:"/editor/:id/room"})}),ce.jsx(Hc,{path:"/editor/:id/room",element:ce.jsx(q$,{})}),ce.jsx(Hc,{path:"*",element:ce.jsx(W1,{replace:!0,to:"/login"})})]})})})}Fy.createRoot(document.getElementById("root")).render(ce.jsx(J$,{}));
